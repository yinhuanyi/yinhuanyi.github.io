(window.webpackJsonp=window.webpackJsonp||[]).push([[369],{2226:function(s,n,a){"use strict";a.r(n);var t=a(9),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-sqlx介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-sqlx介绍"}},[s._v("#")]),s._v(" 一：sqlx介绍")]),s._v(" "),a("h3",{attrs:{id:"一-概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-概念"}},[s._v("#")]),s._v(" (一)：概念")]),s._v(" "),a("ul",[a("li",[s._v("sqlx是database/sql包基础上的扩展，提供了很多database/sql没有的数据操作方法")])]),s._v(" "),a("h3",{attrs:{id:"二-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-安装"}},[s._v("#")]),s._v(" (二)：安装")]),s._v(" "),a("ul",[a("li",[s._v("直接在项目中安装即可")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("go get -u github.com/jmoiron/sqlx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"三-数据库连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-数据库连接"}},[s._v("#")]),s._v(" (三)：数据库连接")]),s._v(" "),a("ul",[a("li",[s._v("sqlx与database/sql连接创建类似")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('var db *sqlx.DB\n\nfunc initDB() (err error) {\n\tdsn := "user:password@tcp(127.0.0.1:3306)/sql_test?charset=utf8mb4&parseTime=True"\n\t// 也可以使用MustConnect连接不成功就panic\n\tdb, err = sqlx.Connect("mysql", dsn)\n\tif err != nil {\n\t\tfmt.Printf("connect DB failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdb.SetMaxOpenConns(20)\n\tdb.SetMaxIdleConns(10)\n\treturn\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"二-crud操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-crud操作"}},[s._v("#")]),s._v(" 二：CRUD操作")]),s._v(" "),a("h3",{attrs:{id:"一-查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-查询"}},[s._v("#")]),s._v(" (一)：查询")]),s._v(" "),a("ul",[a("li",[s._v("单行查询")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 查询单条数据示例\nfunc queryRowDemo() {\n\tsqlStr := "select id, name, age from user where id=?"\n\tvar u user\n\terr := db.Get(&u, sqlStr, 1)\n\tif err != nil {\n\t\tfmt.Printf("get failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Printf("id:%d name:%s age:%d\\n", u.ID, u.Name, u.Age)\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("多行查询")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('func queryMultiRowDemo() {\n\tsqlStr := "select id, name, age from user where id > ?"\n\tvar users []user\n\terr := db.Select(&users, sqlStr, 0)\n\tif err != nil {\n\t\tfmt.Printf("query failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Printf("users:%#v\\n", users)\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"二-插入操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-插入操作"}},[s._v("#")]),s._v(" (二)：插入操作")]),s._v(" "),a("ul",[a("li",[s._v("插入数据")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('func insertRowDemo() {\n\tsqlStr := "insert into user(name, age) values (?,?)"\n\tret, err := db.Exec(sqlStr, "Robby", 30)\n\tif err != nil {\n\t\tfmt.Printf("insert failed, err:%v\\n", err)\n\t\treturn\n\t}\n\ttheID, err := ret.LastInsertId() // 新插入数据的id\n\tif err != nil {\n\t\tfmt.Printf("get lastinsert ID failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Printf("insert success, the id is %d.\\n", theID)\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"三-更新操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-更新操作"}},[s._v("#")]),s._v(" (三)：更新操作")]),s._v(" "),a("ul",[a("li",[s._v("更新数据")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('func updateRowDemo() {\n\tsqlStr := "update user set age=? where id = ?"\n\tret, err := db.Exec(sqlStr, 31, 3)\n\tif err != nil {\n\t\tfmt.Printf("update failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tn, err := ret.RowsAffected() // 操作影响的行数\n\tif err != nil {\n\t\tfmt.Printf("get RowsAffected failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Printf("update success, affected rows:%d\\n", n)\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"四-删除操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-删除操作"}},[s._v("#")]),s._v(" (四)：删除操作")]),s._v(" "),a("ul",[a("li",[s._v("删除数据")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('func deleteRowDemo() {\n\tsqlStr := "delete from user where id = ?"\n\tret, err := db.Exec(sqlStr, 3)\n\tif err != nil {\n\t\tfmt.Printf("delete failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tn, err := ret.RowsAffected() // 操作影响的行数\n\tif err != nil {\n\t\tfmt.Printf("get RowsAffected failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Printf("delete success, affected rows:%d\\n", n)\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"五-namedexec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-namedexec"}},[s._v("#")]),s._v(" (五)：NamedExec")]),s._v(" "),a("ul",[a("li",[s._v("DB.NamedExec方法用来绑定SQL语句与结构体或map中的同名字段，支持插入、更新操作")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('func insertUserDemo()(err error){\n\tsqlStr := "INSERT INTO user (name,age) VALUES (:name,:age)"\n\t_, err = db.NamedExec(sqlStr,\n\t\tmap[string]interface{}{\n\t\t\t"name": "Robby",\n\t\t\t"age": 30,\n\t\t})\n\treturn\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"六-namedquery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六-namedquery"}},[s._v("#")]),s._v(" (六)：NamedQuery")]),s._v(" "),a("ul",[a("li",[s._v("NamedQuery方法用来绑定SQL语句与结构体或map中的同名字段，支持查询操作")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('func namedQuery(){\n\tsqlStr := "SELECT * FROM user WHERE name=:name"\n\t// 使用map做命名查询，这里返回多行数据\n\trows, err := db.NamedQuery(sqlStr, map[string]interface{}{"name": "Robby"})\n\tif err != nil {\n\t\tfmt.Printf("db.NamedQuery failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer rows.Close()\n\tfor rows.Next(){\n\t\tvar u user\n\t\terr := rows.StructScan(&u)\n\t\tif err != nil {\n\t\t\tfmt.Printf("scan failed, err:%v\\n", err)\n\t\t\tcontinue\n\t\t}\n\t\tfmt.Printf("user:%#v\\n", u)\n\t}\n\n\tu := user{\n\t\tName: "Robby",\n\t}\n\t// 使用结构体命名查询，根据结构体字段的 db tag进行映射，这里返回多行数据\n\trows, err = db.NamedQuery(sqlStr, u)\n\tif err != nil {\n\t\tfmt.Printf("db.NamedQuery failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer rows.Close()\n\tfor rows.Next(){\n\t\tvar u user\n\t\terr := rows.StructScan(&u)\n\t\tif err != nil {\n\t\t\tfmt.Printf("scan failed, err:%v\\n", err)\n\t\t\tcontinue\n\t\t}\n\t\tfmt.Printf("user:%#v\\n", u)\n\t}\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("h2",{attrs:{id:"三-事务操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-事务操作"}},[s._v("#")]),s._v(" 三：事务操作")]),s._v(" "),a("h3",{attrs:{id:"一-事务操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-事务操作"}},[s._v("#")]),s._v(" (一)：事务操作")]),s._v(" "),a("ul",[a("li",[s._v("使用sqlx中提供的db.Beginx()方法、tx.Exec()方法、tx.Rollback()方法")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('func transactionDemo() (err error) {\n\n\ttx, err := db.Beginx() // 开启事务\n\tif err != nil {\n\t\tfmt.Printf("begin trans failed, err:%v\\n", err)\n\t\treturn err\n\t}\n\n\t// 在defer和recover中完成事务commit提交\n\tdefer func() {\n\t\tif p := recover(); p != nil {\n\t\t\ttx.Rollback()\n\t\t\tpanic(p)\n\t\t} else if err != nil {\n\t\t\tfmt.Println("rollback")\n\t\t\ttx.Rollback() // 回滚\n\t\t} else {\n\t\t\terr = tx.Commit()\n\t\t\tfmt.Println("commit")\n\t\t}\n\t}()\n\n\tsqlStr1 := "Update user set age=20 where id=?"\n\trs, err := tx.Exec(sqlStr1, 1)\n\tif err != nil {\n\t\ttx.Rollback() // 回滚\n\t\treturn err\n\t}\n\tn, err := rs.RowsAffected()\n\tif err != nil {\n\t\ttx.Rollback() // 回滚\n\t\treturn err\n\t}\n\tif n != 1 {\n\t\treturn errors.New("exec sqlStr1 failed")\n\t}\n\n\tsqlStr2 := "Update user set age=50 where i=?"\n\trs, err = tx.Exec(sqlStr2, 5)\n\tif err != nil {\n\t\ttx.Rollback() // 回滚\n\t\treturn err\n\t}\n\tn, err = rs.RowsAffected()\n\tif err != nil {\n\t\ttx.Rollback() // 回滚\n\t\treturn err\n\t}\n\tif n != 1 {\n\t\treturn errors.New("exec sqlStr1 failed")\n\t}\n\treturn err\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br")])]),a("h2",{attrs:{id:"四-sqlx-in方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-sqlx-in方法"}},[s._v("#")]),s._v(" 四：sqlx.In方法")]),s._v(" "),a("h3",{attrs:{id:"一-sqlx-in的批量插入示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-sqlx-in的批量插入示例"}},[s._v("#")]),s._v(" (一)：sqlx.In的批量插入示例")]),s._v(" "),a("ul",[a("li",[s._v("这里先需要说明一下，SQL语句中参数的占位符，为了避免SQL注入，应该使用参数占位符给SQL语句传递参数，但是不同的数据库，参数占位符不一样")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：MySQL中使用?\n\n2：PostgreSQL使用枚举的$1、$2等\n\n3：SQLite中?和$1的语法都支持\n\n4：Oracle中使用:name的语法\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("参数占位符只用于向SQL语句中插入值，不允许更改SQL语句的结构")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('db.Query("SELECT * FROM ?", "mytable")  // 这是错误的，不能使用表名\n\ndb.Query("SELECT ?, ? FROM people", "name", "location")  // 这是错误的，不是使用列名\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("使用sqlx.In实现批量插入是有前提条件的：需要我们的结构体实现driver.Valuer接口，"),a("code",[s._v("下面的代码中User结构体实现了driver.Valuer接口的Value方法")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('var db *sqlx.DB\n\nfunc initDB() (err error) {\n\tdsn := "root:yhy3426356@tcp(127.0.0.1:3306)/sql_test?charset=utf8mb4&parseTime=True"\n\t// 也可以使用MustConnect连接不成功就panic\n\tdb, err = sqlx.Connect("mysql", dsn)\n\tif err != nil {\n\t\tfmt.Printf("connect DB failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdb.SetMaxOpenConns(20)\n\tdb.SetMaxIdleConns(10)\n\treturn\n}\n\ntype User struct {\n\tName string `db:"name"`\n\tAge  int    `db:"age"`\n}\n\n// Value 实现driver.Valuer接口的Value方法，才能满足sqlx.In的批量插入\nfunc (u *User) Value() (driver.Value, error) {\n\t// 这里的interface{}类型，实际上是map类型\n\treturn []interface{}{u.Name, u.Age}, nil\n}\n\n// BatchInsertUsers 使用sqlx.In帮我们拼接语句和参数, 注意传入的参数是[]interface{}\nfunc BatchInsertUsers(users []interface{}) error {\n\t// 生成批量插入的SQL语句\n\tquery, args, _ := sqlx.In("INSERT INTO user (name, age) VALUES (?), (?), (?)", users...)\n\n\t// 查看生成的SQL语句\n\tfmt.Printf("sqlString=%s\\n", query)\n\t// 查看结构体生成的参数\n\tfmt.Printf("args=%v\\n", args)\n\n\t// 执行SQL语句\n\t_, err := db.Exec(query, args...)\n\n\treturn err\n}\n\nfunc main() {\n\n\t_ = initDB()\n\n\tvar users []interface{}\n\n\tusers = append(users, &User{"zhangshan", 21}, &User{"lisi", 22}, &User{"wangwu", 23})\n\t\n\tif err := BatchInsertUsers(users); err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n}\n\n\n输出结果：\nsqlString=INSERT INTO user (name, age) VALUES (?, ?), (?, ?), (?, ?)\nargs=[zhangshan 21 lisi 22 wangwu 23]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("h3",{attrs:{id:"二-也可以使用namedexec实现批量插入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-也可以使用namedexec实现批量插入"}},[s._v("#")]),s._v(" (二)：也可以使用NamedExec实现批量插入")]),s._v(" "),a("ul",[a("li",[s._v("使用NamedExec方法实现批量插入可能会更加简单一下")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 使用NamedExec批量插入数据\nfunc BatchInsertUserByNamedExec(users []*User) error {\n\t_, err := db.NamedExec("INSERT INTO user (name, age) VALUES (:name, :age)", users)\n\treturn err\n}\n\nfunc main() {\n\n\t_ = initDB()\n\n\tvar users []*User\n\n\tusers = append(users, &User{"zhangshan", 21}, &User{"lisi", 22}, &User{"wangwu", 100})\n\n\terr := BatchInsertUserByNamedExec(users)\n\tif err != nil {\n\t\tfmt.Println(err)\n\t}\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h3",{attrs:{id:"三-sqlx-in的查询示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-sqlx-in的查询示例"}},[s._v("#")]),s._v(" (三)：sqlx.In的查询示例")]),s._v(" "),a("ul",[a("li",[s._v("实现SQL语句"),a("code",[s._v("SELECT * FROM user WHERE id in (3, 2, 1);")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// QueryByIDs 根据给定ID查询\nfunc QueryByIDs(ids []int) (users []User, err error) {\n\n\t// 动态填充id\n\tquery, args, err := sqlx.In("SELECT name, age FROM user WHERE id IN (?)", ids)\n\tif err != nil {\n\t\treturn\n\t}\n\n\t// 这里需Rebind，将查询从 QUESTION 转换为 DB 驱动程序的 bindvar 类型\n\tquery = db.Rebind(query)\n\n\t// 这里是真正的查询过程\n\terr = db.Select(&users, query, args...)\n\treturn\n\n}\n\nfunc main() {\n\n\t_ = initDB()\n\n\tusers, _ := QueryByIDs([]int{1, 2, 3})\n\n\tfor _, userItem := range users {\n\t\tfmt.Println(userItem.Age, "", userItem.Name)\n\t}\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("ul",[a("li",[s._v("实现SQL语句")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// QueryAndOrderByIDs 按照指定id查询并维护顺序\nfunc QueryAndOrderByIDs(ids []int) (users []User, err error) {\n\t// 动态填充id\n\tstrIDs := make([]string, 0, len(ids))\n\tfor _, id := range ids {\n\t\tstrIDs = append(strIDs, fmt.Sprintf("%d", id))\n\t}\n\tquery, args, err := sqlx.In("SELECT name, age FROM user WHERE id IN (?) ORDER BY FIND_IN_SET(id, ?)", ids, strings.Join(strIDs, ","))\n\tif err != nil {\n\t\treturn\n\t}\n\n\t// sqlx.In 返回带 `?` bindvar的查询语句, 我们使用Rebind()重新绑定它\n\tquery = db.Rebind(query)\n\n\terr = db.Select(&users, query, args...)\n\treturn\n}\n\nfunc main() {\n\n\t_ = initDB()\n\n\tusers, _ := QueryAndOrderByIDs([]int{1, 2, 3})\n\n\tfor _, userItem := range users {\n\t\tfmt.Println(userItem.Age, "", userItem.Name)\n\t}\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);