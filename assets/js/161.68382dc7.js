(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{1560:function(n,a,s){n.exports=s.p+"assets/img/hdfs.8cd0a7cf.png"},1561:function(n,a,s){n.exports=s.p+"assets/img/zk.ac898e4b.png"},1562:function(n,a,s){n.exports=s.p+"assets/img/yarn.75af0341.jpg"},2588:function(n,a,s){"use strict";s.r(a);var e=s(9),r=Object(e.a)({},(function(){var n=this,a=n.$createElement,e=n._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h2",{attrs:{id:"一-hdfs-高可用原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-hdfs-高可用原理"}},[n._v("#")]),n._v(" 一：HDFS 高可用原理")]),n._v(" "),e("h3",{attrs:{id:"一-高可用原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-高可用原理"}},[n._v("#")]),n._v(" (一)高可用原理")]),n._v(" "),e("ul",[e("li",[n._v("知识点说明：\n"),e("ul",[e("li",[n._v("1：namenode节点作用是保存元数据，数据存放在datanode节点上")])])])]),n._v(" "),e("p",[e("img",{attrs:{src:s(1560),alt:"Alt text"}})]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1： namenode节点作用是保存元数据，数据存放在datanode节点上,每一次读取和写入数据到hdfs，都会基于日志记录下来到edits中，之后更新元数据FsImage\n\n2：主namenode节点的edits日志也会实时同步到JournalNode节点上，且从namenode节点会从JournalNode节点上读取最新的日志内容，更新自身所维护的信息\n\n3：namenode节点的转移是基于zookeeper转移的，zookeeper会存储namenode活动状态的信息，当一个active状态的namenode挂掉了，马上将standby状态的namenode设置为active状态\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br")])]),e("p",[e("img",{attrs:{src:s(1561),alt:"Alt text"}})]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1: datanode新写入的数据，会反馈给namenode，namenode会将元数据信息同步到JournalNode节点上，此时备份的namenode会从JournalNode节点同步这些元数据信息，保证主namenode的元数据信息与从namenode元数据信息实时同步\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("h2",{attrs:{id:"二-hdfs-高可用配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-hdfs-高可用配置"}},[n._v("#")]),n._v(" 二：HDFS 高可用配置")]),n._v(" "),e("h3",{attrs:{id:"一-高可用配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-高可用配置"}},[n._v("#")]),n._v(" (一)高可用配置")]),n._v(" "),e("ul",[e("li",[n._v("知识点说明：\n"),e("ul",[e("li",[n._v("1：在node1和node2节点都配置namenode服务")]),n._v(" "),e("li",[n._v("2：3台节点都安装journalnode服务")]),n._v(" "),e("li",[n._v("3: 高可用配置可以在"),e("code",[n._v("https://hadoop.apache.org/docs/r2.5.2/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html")]),n._v("页面获取")])])])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1：在3台节点上，先备份hadoop的配置文件,\ncd /opt/modules/hadoop-2.5.0-cdh5.3.5/etc\ncp -r hadoop hadoop_backup\n\n2: vi /opt/modules/hadoop-2.5.0-cdh5.3.5/etc/hadoop/hdfs-site.xml\n<configuration>\n    <property>\n        <name>dfs.replication</name>\n        \x3c!-- 三个给数据设置副本数 --\x3e\n        <value>2</value>\n    </property>\n    \x3c!-- 禁用hdfs检查 --\x3e\n    <property>\n        <name>dfs.permissions.enabled</name>\n        <value>false</value>\n    </property>\n    \x3c!--给名称服务取名称--\x3e\n    <property>\n        <name>dfs.nameservices</name>\n        <value>mycluster</value>\n    </property>\n    \x3c!--设置名称服务中每个名称节点的唯一标识符--\x3e\n    <property>\n        <name>dfs.ha.namenodes.mycluster</name>\n        <value>nn1,nn2</value>\n    </property>\n    \x3c!--每个名称节点的RPC地址--\x3e\n    <property>\n        <name>dfs.namenode.rpc-address.mycluster.nn1</name>\n        <value>node1:8020</value>\n    </property>\n    <property>\n        <name>dfs.namenode.rpc-address.mycluster.nn2</name>\n        <value>node2:8020</value>\n    </property>\n    \x3c!--每个名称节点的HTTP地址--\x3e\n    <property>\n        <name>dfs.namenode.http-address.mycluster.nn1</name>\n        <value>node1:50070</value>\n    </property>\n    <property>\n        <name>dfs.namenode.http-address.mycluster.nn2</name>\n        <value>node2:50070</value>\n    </property>\n    \x3c!--名称节点将写入/读取编辑日志地址--\x3e\n    <property>\n        <name>dfs.namenode.shared.edits.dir</name>\n        <value>qjournal://node1:8485;node2:8485;node3:8485/mycluster</value>\n    </property>\n    \x3c!--journalNode守护程序将存储路径,这里先要创建一个目录--\x3e\n    <property>\n        <name>dfs.journalnode.edits.dir</name>\n        <value>/opt/modules/hadoop-2.5.0-cdh5.3.5/data/journalnodeData</value>\n    </property>\n    \x3c!--设置故障转移的类--\x3e\n    <property>\n        <name>dfs.client.failover.proxy.provider.mycluster</name>\n        <value>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider</value>\n    </property>\n    \x3c!--高可用的隔离机制--\x3e\n    <property>\n        <name>dfs.ha.fencing.methods</name>\n        <value>sshfence</value>\n    </property>\n    \x3c!--这里需要修改用户的私钥--\x3e\n    <property>\n        <name>dfs.ha.fencing.ssh.private-key-files</name>\n        <value>/root/.ssh/id_rsa</value>\n    </property>\n</configuration>\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br"),e("span",{staticClass:"line-number"},[n._v("51")]),e("br"),e("span",{staticClass:"line-number"},[n._v("52")]),e("br"),e("span",{staticClass:"line-number"},[n._v("53")]),e("br"),e("span",{staticClass:"line-number"},[n._v("54")]),e("br"),e("span",{staticClass:"line-number"},[n._v("55")]),e("br"),e("span",{staticClass:"line-number"},[n._v("56")]),e("br"),e("span",{staticClass:"line-number"},[n._v("57")]),e("br"),e("span",{staticClass:"line-number"},[n._v("58")]),e("br"),e("span",{staticClass:"line-number"},[n._v("59")]),e("br"),e("span",{staticClass:"line-number"},[n._v("60")]),e("br"),e("span",{staticClass:"line-number"},[n._v("61")]),e("br"),e("span",{staticClass:"line-number"},[n._v("62")]),e("br"),e("span",{staticClass:"line-number"},[n._v("63")]),e("br"),e("span",{staticClass:"line-number"},[n._v("64")]),e("br"),e("span",{staticClass:"line-number"},[n._v("65")]),e("br"),e("span",{staticClass:"line-number"},[n._v("66")]),e("br"),e("span",{staticClass:"line-number"},[n._v("67")]),e("br"),e("span",{staticClass:"line-number"},[n._v("68")]),e("br"),e("span",{staticClass:"line-number"},[n._v("69")]),e("br"),e("span",{staticClass:"line-number"},[n._v("70")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// 这里主要是修改namenode的访问，以前是node1，现在node1和node2都有namenode服务，因此需要修改为nameservice的名称\n1: vi /opt/modules/hadoop-2.5.0-cdh5.3.5/etc/hadoop/core-site.xml\n<configuration>\n    <property>\n        <name>fs.defaultFS</name>\n        \x3c!-- 这里不在是node1，需要修改为nameservice的名称  --\x3e\n        <value>hdfs://mycluster</value>\n    </property>\n        \x3c!-- 修改http用户  --\x3e\n    <property>\n        <name>hadoop.http.staticuser.user</name>\n        <value>admin</value>\n    </property>\n \x3c!-- 配置hdfs数据存放目录  --\x3e\n    <property>\n        <name>hadoop.tmp.dir</name>\n        <value>/opt/modules/hadoop-2.5.0-cdh5.3.5/data/tmp</value>\n    </property>\n</configuration>\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1：将node2、node3的data下的tmp目录改名\nmv /opt/modules/hadoop-2.5.0-cdh5.3.5/data/tmp /opt/modules/hadoop-2.5.0-cdh5.3.5/data/tmp_back\n\n2：将node2、node3的配置文件删除, 之前已经备份过了\nrm -fr /opt/modules/hadoop-2.5.0-cdh5.3.5/etc/hadoop\n\n3: 将node1的hadoop配置拷贝到node2和node3\nscp -rp hadoop node2:/opt/modules/hadoop-2.5.0-cdh5.3.5/etc/\nscp -rp hadoop node3:/opt/modules/hadoop-2.5.0-cdh5.3.5/etc/\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br")])]),e("h3",{attrs:{id:"二-高可用启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-高可用启动"}},[n._v("#")]),n._v(" (二)高可用启动")]),n._v(" "),e("ul",[e("li",[n._v("知识点说明：\n"),e("ul",[e("li",[n._v("1："),e("strong",[n._v("先将说有的服务全部停止掉")])])])])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1: 在namenode格式化之前,三台节点都启动journalnode\nhadoop-daemon.sh start journalnode\n\n2：node1格式化namenode\nhdfs namenode -format\n\n3: node1启动namenode\nhadoop-daemon.sh start namenode\n\n4: 在node2上，同步node1的namenode元数据到node2的namenode\nhdfs namenode -bootstrapStandby\n\n5: node2启动namenode\nhadoop-daemon.sh start namenode\n\n6：设置namenode1为active状态, 从监控界面可以看到node1为active状态，node2为standby状态\nhdfs haadmin -transitionToActive nn1\n\n7: 停止所有的hdfs节点，在启动\nstop-dfs.sh\nstart-dfs.sh\n\n8: 如果发现有datanode没有启动成功，如下列错误，需要删除data/tmp目录，然后重启hdfs\nInitialization failed for Block pool <registering### (Datanode Uuid unassigned) service to node2\n\n9: 将namenode1设置为主节点\nhdfs haadmin -transitionToActive nn1\n\n10: 在hdfs中创建目录，且上传文件, 读取文件\nhdfs dfs -mkdir -p /user/root/data\nhdfs dfs -put anaconda-ks.cfg /user/root/data/\nhdfs dfs -text /user/root/data/anaconda-ks.cfg\n\n11: 在node1上停止namenode，将node2的namenode强制设置为active\nhadoop-daemon.sh stop namenode\nhdfs haadmin -transitionToActive nn2 --forceactive\n\n12: 在node1上再次读取文件，验证没有问题\nhdfs dfs -text /user/root/data/anaconda-ks.cfg\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br")])]),e("h2",{attrs:{id:"三-zookeeper自动故障转移配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-zookeeper自动故障转移配置"}},[n._v("#")]),n._v(" 三：Zookeeper自动故障转移配置")]),n._v(" "),e("h3",{attrs:{id:"一-zookeeper自动故障转移配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-zookeeper自动故障转移配置"}},[n._v("#")]),n._v(" (一)Zookeeper自动故障转移配置")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1: 在node1和node2中配置zookeeper的failover\nvi  hdfs-site.xml 添加如下配置内容\n    \x3c!--配置基于zookeeper的故障转移--\x3e\n    <property>\n        <name>dfs.ha.automatic-failover.enabled.mycluster</name>\n        <value>true</value>\n    </property>\n    <property>\n        <name>ha.zookeeper.quorum</name>\n        <value>node1:2181,node2:2181,node3:2181</value>\n    </property>\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br")])]),e("h3",{attrs:{id:"二-启动zookeeper"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-启动zookeeper"}},[n._v("#")]),n._v(" (二)启动Zookeeper")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1: 先停止掉所有的服务\nstop-dfs.sh\nzkServer.sh stop \n\n2: 3台节点启动zookeeper服务\nzkServer.sh start \n\n3: 在node1使用hdfs格式化zookeeper，\nhdfs zkfc -formatZK\n\n4：启动hdfs\nstart-dfs.sh\n\n5：node1、node2节点启动zkfc,让zookeeper实时监控namenode服务的状态, 是一个DFSZKFailoverController服务\nhadoop-daemon.sh start zkfc\n\n6: 上传文件测试\nhdfs dfs -put wordcount.txt  /user/root/data/ \n\n7: 停止node1的namenode服务\nhadoop-daemon.sh stop namenode\n\n8: 随意一台节点，查看文件\nhdfs dfs -text /user/root/data/wordcount.txt\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br")])]),e("h2",{attrs:{id:"四-yarn-ha的架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-yarn-ha的架构"}},[n._v("#")]),n._v(" 四：Yarn-HA的架构")]),n._v(" "),e("h3",{attrs:{id:"一-原理介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-原理介绍"}},[n._v("#")]),n._v(" (一)原理介绍")]),n._v(" "),e("p",[e("img",{attrs:{src:s(1562),alt:"Alt text"}})]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("\tYarn是Hadoop集群的资源管理系统， ResourceManager和NodeManager两个进程主要负责系统管理方面的任务。ResourceManager有一个Scheduler，负责各个集群中应用的资源分配。对于每种类型的每个应用，都会对应一个ApplicationMaster实例，ApplicationMaster通过和ResourceManager沟通获得Container资源来运行具体的job，并跟踪这个job的运行状态、监控运行进度\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("h3",{attrs:{id:"二-配置-参考文档-https-hadoop-apache-org-docs-r2-5-2-hadoop-yarn-hadoop-yarn-site-resourcemanagerha-html"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-配置-参考文档-https-hadoop-apache-org-docs-r2-5-2-hadoop-yarn-hadoop-yarn-site-resourcemanagerha-html"}},[n._v("#")]),n._v(" (二)配置， 参考文档: https://hadoop.apache.org/docs/r2.5.2/hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html")]),n._v(" "),e("ul",[e("li",[n._v("1：node1、node2上配置ResourceManager服务")]),n._v(" "),e("li",[n._v("2：node1、node2、node3上配置NodeManager服务")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1：在node1上 vi yarn-site.xml \n<configuration>\n    <property>\n        <name>yarn.nodemanager.aux-services</name>\n        <value>mapreduce_shuffle</value>\n    </property>\n    \x3c!-- 让mapreduce运行的日志存储到hdfs上  --\x3e\n    <property>\n        <name>yarn.log-aggregation-enable</name>\n        <value>true</value>\n    </property>\n    \x3c!-- 指定日志存放的天数  --\x3e\n    <property>\n        <name>yarn.log-aggregation.retain-seconds</name>\n        <value>100000</value>\n    </property>\n    \x3c!-- 配置yarn的高可用 --\x3e\n    <property>\n        <name>yarn.resourcemanager.ha.enabled</name>\n        <value>true</value>\n    </property>\n    <property>\n        <name>yarn.resourcemanager.cluster-id</name>\n        <value>cluster1</value>\n    </property>\n    <property>\n        <name>yarn.resourcemanager.ha.rm-ids</name>\n        <value>rm1,rm2</value>\n    </property>\n    <property>\n        <name>yarn.resourcemanager.hostname.rm1</name>\n        <value>node1</value>\n    </property>\n    <property>\n        <name>yarn.resourcemanager.hostname.rm2</name>\n        <value>node2</value>\n    </property>\n    <property>\n        <name>yarn.resourcemanager.zk-address</name>\n        <value>node1:2181,node2:2181,node3:2181</value>\n    </property>\n    \x3c!--配置yarn支持自动重启--\x3e\n    <property>\n        <name>yarn.resourcemanager.recovery.enabled</name>\n        <value>true</value>\n    </property>\n    <property>\n        <name>yarn.resourcemanager.store.class</name>\n        <value>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore</value>\n    </property>\n</configuration>\n\n\n2: 将node1上的yarn-site.xml分发到node2、node3上\nscp -r yarn-site.xml  node2:/opt/modules/hadoop-2.5.0-cdh5.3.5/etc/hadoop/\nscp -r yarn-site.xml  node3:/opt/modules/hadoop-2.5.0-cdh5.3.5/etc/hadoop/\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br"),e("span",{staticClass:"line-number"},[n._v("51")]),e("br"),e("span",{staticClass:"line-number"},[n._v("52")]),e("br"),e("span",{staticClass:"line-number"},[n._v("53")]),e("br"),e("span",{staticClass:"line-number"},[n._v("54")]),e("br"),e("span",{staticClass:"line-number"},[n._v("55")]),e("br"),e("span",{staticClass:"line-number"},[n._v("56")]),e("br")])]),e("h3",{attrs:{id:"三-检测yarn的高可用配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-检测yarn的高可用配置"}},[n._v("#")]),n._v(" (三)检测yarn的高可用配置")]),n._v(" "),e("ul",[e("li",[n._v("1：在node1、node2启动resourcemanager")]),n._v(" "),e("li",[n._v("2：在node1、node2、node3启动nodemanager")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1: 按规则启动resourcemanager、nodemanager\nyarn-daemon.sh start resourcemanager\nyarn-daemon.sh start nodemanager\n\n2：创建结果输出目录\nhdfs dfs -mkdir -p /user/root/data/output\n\n3: 在node1基于yarn运行mapreduce程序\nyarn jar hadoop-mapreduce-examples-2.5.0-cdh5.3.5.jar wordcount /user/root/data/wordcount.txt /user/root/data/output/2\n\n4：在node1yarn运行mapreduce程序的时候，将node1的resourcemanager进程杀掉\n kill -9  3871\n\n5: 此时node1会显示：Failing over to rm2，mapreduce程序转移到node2上运行\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);