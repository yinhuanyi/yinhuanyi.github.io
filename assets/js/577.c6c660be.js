(window.webpackJsonp=window.webpackJsonp||[]).push([[577],{2619:function(s,a,t){"use strict";t.r(a);var n=t(9),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"一-mysql-日志功能详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-mysql-日志功能详解"}},[s._v("#")]),s._v(" "),t("code",[s._v("(一) MySQL 日志功能详解")])]),s._v(" "),t("ul",[t("li",[s._v("MySQL日志分类")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：查询日志 ：query log  \n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：慢查询日志：slow_query_log 查询执行时长超过指定时长的查询操作所记录日志\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：错误日志：error log  \n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：二进制日志：binary log\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("：中继日志：relay "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("主从复制会讲解"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("：事务日志：transaction log \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("查询日志 （query log一般不启用）")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("general_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 是否启用查询日志\ngeneral_log_file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("general_log：当log_output为"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FILE")]),s._v("类型时，日志信息的记录位置；\nlog_output "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NONE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    log_output "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FILE")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("慢查询日志 （slow_query_log 必须启用）")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("慢查询日志产生的来源\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句返回的结果集大，或者"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句没有被优化器优化，或"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句没有使用索引\n\n\n慢查询日志的作用\n    慢查询日志用于对执行速率较慢的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句就像过滤，有利于"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("代码的优化\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：执行时长超出指定时长的操作 \n    show global variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'long_query_time'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 查看指定的时长\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" global long_query_time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 自定义时长\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：slow_query_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("：是否启用慢查询日志\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" global slow_query_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：slow_query_log_file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mariadb1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：log_slow_filter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("filesort"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("filesort_on_disk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("full_join"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("full_scan"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("query_cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("query_cache_miss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("tmp_table"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("tmp_table_on_disk 过滤条件\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("：log_slow_rate_limit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 指定记录速率\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("：log_slow_verbosity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 指定内容级别\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("中继日志（relay log）")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("在主从复制架构中，从服务器用于保存从主服务器的二进制日志中读取到的时间\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("事物日志（transaction log）")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("事物日志由事物型存储引擎自行管理和使用，无需手动管理\n    redo log：将一组"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句安装先后顺序再执行一次\n    undo log：回滚到之前数据集没有发生改变的状态 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("错误日志 （error log 必须启用）")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：错误日志信息产生的来源\n    mysqld启动和关闭过程中输出的信息；\n    mysqld运行中产生的错误信息；\n    event scheduler运行一个event时产生的日志信息\n    在主从复制架构中的从服务器上启动从服务器线程时产生的日志信息； \n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：错误日志的作用\n    二进制日志可以反应MySQL数据库的错误信息，用于调试\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：如何开启错误日志\n    log_error "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("to"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("somefile\n    log_warnings "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("：是否记录警告信息于错误日志中；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("二进制日志（binary log）")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：二级制日志信息产生的来源\n    记录导致数据改变，或者潜在改变数据的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：二级制日志的作用\n    用于通过"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'重新执行'")]),s._v("日志文件中的记录的事件（"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句）来生成数据副本，也就是用于主从复制\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：服务器变量\n    （"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）sql_log_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("on"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 是否记录二进制日志"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 通常为on\n    （"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）log_bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on ：记录位置，通常为on，如果为off，那么需要在my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf配置文件中添加一项：log_bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin，用来指明二进制日志保存的路径名，对于yum安装的MySQL，保存于"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v("这样的二进制日志中\n    （"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("）binlog_format "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MIXED")]),s._v(" ：二进制记录的格式\n    （"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("）max_binlog_size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1073741824")]),s._v(" ：单个二进制文件的最大值，默认为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("G \n        到达最大值会自动滚动\n        文件达到上限的大小未必是精确值\n    （"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("）max_binlog_cache_size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18446744073709547520")]),s._v("\n    （"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("）sync_binlog "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("：设定多久同步一次二进制日志文件；"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("表示不同步；任何正值都表示记录多少个语句后同步一次； \n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：查看二进制文件的信息\n    show master status： 显示当前正在使用的二进制文件名\n    show "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("binary "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" logs：查看当前二进制文件记录end_log_pos（结束位置）的值，其实当前正在记录的二进制文件的大小。\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("：日志记录的格式分类\n    基于“"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句”记录"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" statement\n    基于“行”记录：row\n    “混合模式” ：mixed，系统自行判断\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("：二进制日志文件的构成\n    日志文件：mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("文件序号 \n        例如： mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v("\n\n    索引文件：mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("index \n        例如：mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("index\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("：使用 mysqlbinlog 客户端命令工具查看二进制文件\n    mysqlbinlog "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("： 二进制格式解析\n\n# at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19364")]),s._v(" \n\n#"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140829")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" server id "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" end_log_pos "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19486")]),s._v(" Query thread_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" exec_time"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" error_code"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TIMESTAMP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1409298607")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*!*/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" tdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" tuser@localhost \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*!*/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n# at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19486")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("事件发生的日期和时间；")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140829")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n事件发生在服务器的标识（server id） \n事件的结束位置：（end_log_pos "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19486")]),s._v("） \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("事件的类型：")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Query"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n事件发生时所在的服务器执行此事件的线程的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ID")]),s._v("：（thread_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("） \n语句的时间戳与将其写入二进制文件中的时间差：（exec_time"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("） \n错误代码：（error_code"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n事件内容：（"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TIMESTAMP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1409298607")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*!*/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" tdb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" tuser@localhost） \n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GTID")]),s._v("事件专属： \n事件所属的全局事务的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GTID")]),s._v("：（"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GTID")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br")])]),t("h3",{attrs:{id:"二-mysql-备份和恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-mysql-备份和恢复"}},[s._v("#")]),s._v(" "),t("code",[s._v("(二) MySQL 备份和恢复")])]),s._v(" "),t("ul",[t("li",[s._v("制定备份策略的注意点")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：可容忍丢失多少数据\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：恢复需要在多长时间内完成\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：备份的对象\n    数据、二进制日志和InnoDB的事务日志、"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("代码（存储过程和存储函数、触发器、事件调度器等）、服务器配置文件\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("备份类型")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）站在数据集是否完整的角度上\n    完全备份，部分备份 \n\n\n（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）站在完全备份的基础上\n    增量备份，差异备份 \n\n\n（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("）站在是否影响数据集读写的角度上\n\n    热备份：在线备份，读写操作不受影响；\n\n    温备份：在线备份，读操作可继续进行，但写操作不允许\n\n    冷备份：离线备份，数据库服务器离线，备份期间不能为业务提供读写服务\n    MyISAM存储引擎"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 能够实现温备\n    InnoDB存储引擎"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 能够实现热备\n\n\n（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("）站在数据存储角度上\n    物理备份：直接复制数据文件进行的备份\n    逻辑备份：从数据库中“导出”操作数据的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句，再执行，实现备份\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("ul",[t("li",[s._v("数据库备份具体解决方案")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("数据：完全备份 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 增量备份\n\n备份：物理 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 逻辑\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("mysqldump: 客户端SQL导出工具，通过mysql协议连接至mysqld服务器")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）使用格式：\n    mysqldump "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" backup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql\n\n（"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）选项说明\n\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 备份所有的数据库\n\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("B")]),s._v(" 数据库"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 数据库"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 数据库"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：指定需要备份的数据库\n    MyISAM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" InnoDB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 温备 \n\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x 或 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("all"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tables：锁定所有表\n\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l 或 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tables：锁定备份数据库中的表\n\n\n    InnoDB：热备\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("single"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("transaction：启动一个大的单一事务实现备份\n\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("B")]),s._v(" 或 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("databases 数据库"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，数据库"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：备份指定的数据库\n\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("C")]),s._v(" 或 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("compress：压缩传输\n\n注意：二进制文件不应该与数据文件放在同一个磁盘上\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("ul",[t("li",[s._v("由于mysqldump只能实现数据库中指定数据库或数据表的完全备份，无法实现对表的单行或多行的增量备份，那么对应增量备份，将使用二进制文件进行备份")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("第一步：\n使用mysqldump做完全备份，其中使用 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 选项会在hellodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql中增加一条注释说明完全备份的结束位置"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并且会显示完全备份结束后，滚到到了那个日志文件\n\nmysqldump "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h192"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("168.23")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p123456 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("B")]),s._v(" uplooking "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("flush"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("logs  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" uplooking"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql\n\n\n第二步：\n对完全备份之后的时间点到当前时间点做增量备份，在需要备份的服务器上操作，其中"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8631")]),s._v("是完全备份后的时间点，因此，将从这个点开始到最后的日志文件的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句都备份出来\nmysqlbinlog  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000005")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql\n（对于之后的每次增量做备份，可以无需指定开始时间，我们可以在增量备份之前将，二进制日志滚动，那么每次增量的时候，登入mysql使用 flush logs 命令，滚动日志，那么如何再有日志产生，将会写在下一个日志文件里，那么对于上一次增量备份到此时，可以直接使用客户端命令 mysqlbinlog  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000005")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 再将备份文件拷贝到备份的数据库中就可以了）\n\n\n第三步：\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" sql_log_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OFF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 关闭二进制文件\nshow variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sql_log_bin'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 查看状态\n\n\n\n第四步：\n将hellodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql和increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql文件都拷贝到对应的数据恢复的主机上，将备份的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("文件进行导入（关闭备份数据库服务器的二进制日志功能）\nmysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p123456 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" hellodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql\nmysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p123456 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" increment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql\n\n第五步：\n# 当关闭二进制文件之后再导入文件系统上保存的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("文件，但是"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("文件不要放在"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root目录下面，因为"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root目录对其它用户的权限是"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("，而mysqld进程的属主和属组都是mysql，因此无法进入"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root目录里面，去读取"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("文件，切记\n# 导入了"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("文件之后，在开启二进制文件\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" sql_log_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 开启二进制文件\nshow variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sql_log_bin'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 查看状态\n\n\n注意："),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("文件进行导入的时候不能一个同样的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("进行重复导入，如果是插入语句，就会一直插入值\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);