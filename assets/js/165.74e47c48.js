(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{1666:function(s,a,t){s.exports=t.p+"assets/img/2020-11-293.20.33.720567e2.png"},1667:function(s,a,t){s.exports=t.p+"assets/img/2020-11-2910.42.25.632d61ab.png"},1668:function(s,a,t){s.exports=t.p+"assets/img/2020-11-2910.42.31.190198b9.png"},2632:function(s,a,t){"use strict";t.r(a);var r=t(9),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h2",{attrs:{id:"一-单台percona-mysql数据库-https-www-percona-com"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-单台percona-mysql数据库-https-www-percona-com"}},[s._v("#")]),s._v(" 一：单台Percona MySQL数据库(https://www.percona.com)")]),s._v(" "),r("h3",{attrs:{id:"一-介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-介绍"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) 介绍")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("\tPercona Server由领先的MySQL咨询公司Percona发布。 Percona Server是一款独立的数据库产品，其可以完全与MySQL兼容，可以在不更改代码的情况了下将存储引擎更换成XtraDB 。\n\tPercona团队的最终声明是“Percona Server是由Oracle发布的最接近官方MySQL Enterprise发行版的版本”，因此与其他更改了大量基本核心MySQL代码的分支有所区别。 Percona Server的一个缺点是他们自己管理代码，不接受外部开发人员的贡献，以这种方式确保他们对产品中所包含功能的控制。\n\tPercona提供了高性能XtraDB引擎，还提供"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("高可用解决方案，并且附带了perconatoolkit等"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DBA")]),s._v("管理工具箱\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h3",{attrs:{id:"二-安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-安装"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) 安装")])]),s._v(" "),r("ul",[r("li",[s._v("apt安装单台的Percona for MySQL数据库(国内访问比较慢)")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" install gnupg2\nwget https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repo"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release_latest"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lsb_release "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sc"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("_all"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deb\ndpkg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release_latest"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lsb_release "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sc"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("_all"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deb\npercona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release setup ps80\napt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" install percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("ul",[r("li",[s._v("使用deb包安装")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("下载打包好的debian包\nhttps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("downloads"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("downloads"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".13")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("binary"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("debian"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bionic"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x86_64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".13")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ra920dd6"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bionic"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x86_64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bundle"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h2",{attrs:{id:"二-pxc-percona-xtradb-cluster"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-pxc-percona-xtradb-cluster"}},[s._v("#")]),s._v(" 二：PXC(Percona XtraDB Cluster)")]),s._v(" "),r("h3",{attrs:{id:"一-pxc介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-pxc介绍"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) PXC介绍")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("是基于Galera的多主同步复制"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("只支持InnoDB数据引擎，只有InnoDB数据引擎才会被同步\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("必须卸载掉MySQL和mariadb")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("apt purge maria"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("是基于Galera的面向"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OLTP")]),s._v("的多主同步复制插件\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("主要是用于解决MySQL集群中数据同步的强一致性问题\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("同步复制，事务在所有节点要么同时提交，要么不提交\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("是多主的集群，可以在任意节点写入数据\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("节点越多，同步速度越慢\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("数据同步取决于配置最慢的那个节点\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("ul",[r("li",[s._v("开发端口")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" MySQL服务器端口\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("："),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4444")]),s._v(" 请求全量同步端口\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("："),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4567")]),s._v(" 数据库节点之间的通信端口\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("："),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4568")]),s._v(" 请求增量同步端口\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("PXC安装准备工作")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("Ubuntu 系统\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：卸载本机的mariadb和mysql\napt purge "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("mariadb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\napt purge "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\nrm "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fr "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n\nCentos系统\nyum remove -y mariadb*\nyum remove -y mysql*\nrm -fr /var/lib/mysql/*\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("ul",[r("li",[s._v("在Percona官方网站下载软件包(如果安装包有依赖问题，可以使用repo仓库安装)")])]),s._v(" "),r("p",[r("img",{attrs:{src:t(1666),alt:"Alt text"}})]),s._v(" "),r("ul",[r("li",[s._v("使用repo仓库安装的方法(实测可以，本次安装使用mysql5.7版本，安装方法可以在document中找到)")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# ubuntu\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：卸载MySQL\napt purge "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("maria"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\napt purge "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\nrm "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fr "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\napt-get remove -y apparmor\n\n2：写入package.list\napt-get update\napt-get install -y wget gnupg2 lsb-release\nwget https://repo.percona.com/apt/percona-release_latest.generic_all.deb\ndpkg -i percona-release_latest.generic_all.deb\napt-get install --fix-broken\napt update\n\n3：安装PXC\napt-get install -y percona-xtradb-cluster-57\n\n\n# centos\n1: 下载MySQL\nyum remove -y mariadb*\nyum remove -y mysql*\nrm -fr /var/lib/mysql/*\n\n2：写入package.list\nyum update\nyum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm\n\n3: 安装\nyum install -y Percona-XtraDB-Cluster-57 \n\n4：卸载\nyum remove -y Percona*\n\n5: 启动mysql\nsystemctl start mysql\n\n6：获取密码(如果密码无法获取，那么应该是数据目录/var/lib/mysql之前有数据，删除就好)\ngrep \"temporary password\" /var/log/mysqld.log\n2020-12-26T06:17:23.818016Z 1 [Note] A temporary password is generated for root@localhost: #ywu!ZqHL1Y8\n\n7: 修改root密码，且授权root远程访问\nalter user 'root'@'localhost' identified by '123456';\ngrant all on *.* to 'root'@'%' identified by '123456';\nflush privileges;\n\n8：授权同步用户\nCREATE USER 'sstuser'@'localhost' IDENTIFIED BY 'passw0rd';\nGRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT ON *.* TO 'sstuser'@'localhost';\nFLUSH PRIVILEGES;\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br"),r("span",{staticClass:"line-number"},[s._v("38")]),r("br"),r("span",{staticClass:"line-number"},[s._v("39")]),r("br"),r("span",{staticClass:"line-number"},[s._v("40")]),r("br"),r("span",{staticClass:"line-number"},[s._v("41")]),r("br"),r("span",{staticClass:"line-number"},[s._v("42")]),r("br"),r("span",{staticClass:"line-number"},[s._v("43")]),r("br"),r("span",{staticClass:"line-number"},[s._v("44")]),r("br"),r("span",{staticClass:"line-number"},[s._v("45")]),r("br"),r("span",{staticClass:"line-number"},[s._v("46")]),r("br"),r("span",{staticClass:"line-number"},[s._v("47")]),r("br"),r("span",{staticClass:"line-number"},[s._v("48")]),r("br"),r("span",{staticClass:"line-number"},[s._v("49")]),r("br"),r("span",{staticClass:"line-number"},[s._v("50")]),r("br"),r("span",{staticClass:"line-number"},[s._v("51")]),r("br")])]),r("ul",[r("li",[s._v("如果在安装过程中遇到循环依赖，例如安装PXC的时候需要重写"),r("code",[s._v("/usr/lib/libgalera_smm.so")]),s._v("文件，但是"),r("code",[s._v("galera-3")]),s._v("也需要这个文件，因此无法安装，形成的循环依赖")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("dpkg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" error processing archive "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cache"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("archives"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7_5")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".31")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.45")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("focal_amd64"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("deb")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("unpack"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n trying to overwrite "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/lib/libgalera_smm.so'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" which is also "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" galera"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.3")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".29")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nErrors were encountered "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" processing"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cache"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("archives"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7_5")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".31")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.45")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("focal_amd64"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deb\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Sub"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("process "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dpkg returned an error "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("code")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("ul",[r("li",[s._v("解决办法：先强制安装PXC")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("dpkg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("force"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("overwrite "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cache"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("archives"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7_5")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".31")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.45")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("focal_amd64"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deb\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("再修复")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("apt install "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("fix"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("broken\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("如果还是不行，再移除包")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("dpkg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("P")]),s._v(" percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("如果还是不行，把软件包重新删除")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("sudo mv "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dpkg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("info"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("tmp")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),s._v("\nsudo dpkg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("remove "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("force"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("remove"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reinstreq percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("\nsudo apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" remove percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("\nsudo apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" autoremove "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" sudo apt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" autoclean\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("如果系统提示是包损坏了例如："),r("code",[s._v("package is in a very bad inconsistent state; you should reinstall it before attempting a removal")]),s._v("，此时需要删除坏的包，再重新安装")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("dpkg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("remove "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("force"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("remove"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reinstreq percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"二-pxc配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-pxc配置"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) PXC配置")])]),s._v(" "),r("ul",[r("li",[s._v("在ubuntu 的/etc/mysql/my.cnf(centos /etc/my.cnf)文件中，可以看到，有两部分配置，一部分是关于mysql的配置，另外一部分是关于percona的配置")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("includedir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("includedir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtradb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("ul",[r("li",[s._v("进入到/etc/mysql/percona-xtradb-cluster.conf.d/中，有4个配置文件")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf ：客户端的配置文件\nmysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf ：服务器端配置文件 \nmysqld_safe"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf  \nwsrep"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf ："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("配置文件\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("3个配置/etc/mysql/my.cnf((centos /etc/my.cnf))(默认的配置删除，重新配置)")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nport"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\nsocket"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n# 节点"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ID")]),s._v("在集群中唯一（各节点需要修改）\nserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ndatadir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\nsocket"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\nlog"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("error"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\npid"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid\nlog"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin\nlog_slave_updates\nexpire_logs_days"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\nsymbolic"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("links"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n# 自定义添加\ncharacter_set_server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\nbind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\nskip"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("resolve\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("ul",[r("li",[s._v("如果centos安装，默认是没有密码的，那么需要设置无密码启动，在mysqld的配置项中加上"),r("code",[s._v("skip-grant-tables")]),s._v("即可， 然后登录数据库，修改root密码， 然后删除"),r("code",[s._v("skip-grant-tables")]),s._v("配置，重启数据库即可")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# 添加跳过权限配置\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nskip"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("grant"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tables\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("确定三节点PXC集群")])]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",{staticStyle:{"text-align":"center"}},[s._v("节点1")]),s._v(" "),r("th",{staticStyle:{"text-align":"center"}},[s._v("节点2")]),s._v(" "),r("th",{staticStyle:{"text-align":"center"}},[s._v("节点3")])])]),s._v(" "),r("tbody",[r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.201.245 (MK yw4-1)")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.201.244 (MK yw4-2)")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.201.242 (MK yw5-2)")])])])]),s._v(" "),r("ul",[r("li",[s._v("3个节点的PXC安装完毕后，停止mysql")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("systemctl stop mysql\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("3个节点在mysqld.cnf配置文件中的[mysqld]配置区中添加如下配置(wsrep_sync_wait=1这个配置不要加，这个配置加上会造成读延时)")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# galera同步依赖库"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" centos是："),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("libgalera_smm"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("so\nwsrep_provider"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("libgalera_smm"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("so\n# 集群名称\nwsrep_cluster_name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pxc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster \n# 集群节点\nwsrep_cluster_address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gcomm"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".245")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".244")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".242")]),s._v("\n# 当前节点名称（各节点需要修改）\nwsrep_node_name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yw4"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n# 当前节点"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("（各节点需要修改）\nwsrep_node_address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".245")]),s._v("\n# 集群内数据同步方法\nwsrep_sst_method"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xtrabackup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v2 \n# 同步数据使用的用户和密码\nwsrep_sst_auth"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sstuser"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("passw0rd\n# 同步严厉模式\npxc_strict_mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ENFORCING")]),s._v("\n# 基于"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROW")]),s._v("复制\nbinlog_format"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROW")]),s._v(" \n# 默认引擎\ndefault_storage_engine"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("InnoDB \n# 主键自增不锁表\ninnodb_autoinc_lock_mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n# 设置默认的同步线程数（"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CPU")]),s._v("逻辑线程的"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("倍）\nwsrep_slave_threads"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br")])]),r("ul",[r("li",[s._v("选择yw5-2节点作为启动节点, 启动和停止")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# ubuntu\nroot@yw5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v("# "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("init"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pxc\n "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" Bootstrapping Percona XtraDB Cluster database server mysqld\n\n# centos\nsystemctl start mysql@bootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\nsystemctl stop mysql@bootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("ul",[r("li",[s._v("在yw5-2节点中创建同步数据使用的用户名和密码")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("mysql "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\nmysql### "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("USER")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sstuser'")]),s._v("@"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IDENTIFIED")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BY")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'passw0rd'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql### "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RELOAD")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOCK")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLES")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PROCESS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REPLICATION")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLIENT")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sstuser'")]),s._v("@"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql### "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FLUSH")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PRIVILEGES")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("在yw4-2、yw4-1节点启动mysql，加入到集群")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("systemctl start mysql\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("在yw5-2节点中查看集群状态, wsrep_cluster_size表示集群是一个3节点的集群")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("mysql### show status like "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wsrep_cluster%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_weight     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_conf_id    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("                                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_size       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_state_uuid "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v("f6af2d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3230")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("eb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("acaf"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("aa3964891e0c "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_status     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Primary                              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" rows "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h2",{attrs:{id:"三-pxc-管理与控制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三-pxc-管理与控制"}},[s._v("#")]),s._v(" 三：PXC 管理与控制")]),s._v(" "),r("h3",{attrs:{id:"一-测试集群数据同步情况"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-测试集群数据同步情况"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) 测试集群数据同步情况")])]),s._v(" "),r("ul",[r("li",[s._v("在yw5-2上创建了test数据库，在yw4-1和yw4-2上都可以看到这个库，说明集群数据同步完毕")])]),s._v(" "),r("h3",{attrs:{id:"二-同步基本原理讲解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-同步基本原理讲解"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) 同步基本原理讲解")])]),s._v(" "),r("ul",[r("li",[s._v("集群节点之间数据同步是基于wsrep_replicated线程完成，可以参考wsrep的参数")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("mysql### show status like "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%wsrep%"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value         \n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_replicated                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" ：发送"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("次数据\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_received                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" ：接收"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("次数据\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h3",{attrs:{id:"三-队列"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三-队列"}},[s._v("#")]),s._v(" "),r("code",[s._v("(三) 队列")])]),s._v(" "),r("ul",[r("li",[r("p",[s._v("当一个节点发送数据到其他节点，先将数据保存到队列中，如果有空闲的线程就会将队列中的数据同步到磁盘中。接收数据也是一样")])]),s._v(" "),r("li",[r("p",[s._v("队列修改的参数（如果发送队列长度和平均长度都非常大，那么复制就可能出现问题了，接收队列也是一样，就需要排查网络情况和同步线程数）")])])]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",{staticStyle:{"text-align":"center"}},[s._v("参数名称")]),s._v(" "),r("th",{staticStyle:{"text-align":"center"}},[s._v("参数意义")])])]),s._v(" "),r("tbody",[r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_send_queue")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("发送队列长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_send_queue_max")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("发送队列最大长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_send_queue_min")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("发送队列最小长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_send_queue_avg")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("发送队列平均长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_recv_queue")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("接收队列长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_recv_queue_max")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("接收队列最大长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_recv_queue_min")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("接收队列最小长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_recv_queue_avg")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("接收队列平均长度")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_local_recv_queue_avg")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("接收队列平均长度")])])])]),s._v(" "),r("h3",{attrs:{id:"四-流量控制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四-流量控制"}},[s._v("#")]),s._v(" "),r("code",[s._v("(四) 流量控制")])]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",{staticStyle:{"text-align":"center"}},[s._v("参数名称")]),s._v(" "),r("th",{staticStyle:{"text-align":"center"}},[s._v("参数意义")])])]),s._v(" "),r("tbody",[r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_paused_ns")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("控制暂停状态下花费的总时间 纳秒")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_paused")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("流量控制暂停时间占比")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_sent")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("发送流量暂停事件的数量")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_recv")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("接收流量暂停事件的数量")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_interval")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("流量控制的上限和下限")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_interval_low")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("流控下限值")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_interval_high")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("流控上限值")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_status")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("流量控制状态")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("wsrep_flow_control_status")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("当前是否处于流控")])])])]),s._v(" "),r("ul",[r("li",[s._v("举例说明")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("wsrep_flow_control_interval "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("： 如果队列长度大于"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),s._v("，那么会启动流控，直到队列长度小于"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("时，才允许写入数据\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("如果队列长度过大，触发流控，那么解决方法如下")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 增大网卡流量\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：增加同步线程数量\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：更换硬件配置\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h2",{attrs:{id:"四-pxc-集群的状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四-pxc-集群的状态"}},[s._v("#")]),s._v(" 四：PXC 集群的状态")]),s._v(" "),r("h3",{attrs:{id:"一-节点状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-节点状态"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) 节点状态")])]),s._v(" "),r("p",[r("img",{attrs:{src:t(1667),alt:"Alt text"}})]),s._v(" "),r("ul",[r("li",[s._v("查看节点状态")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("wsrep_local_state_comment：节点状态\nwsrep_connected：节点是否连接到集群\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"二-集群状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-集群状态"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) 集群状态")])]),s._v(" "),r("p",[r("img",{attrs:{src:t(1668),alt:"Alt text"}})]),s._v(" "),r("ul",[r("li",[s._v("查看集群状态")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[s._v("wsrep_cluster_status：集群状态")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("primary、Non_Primary、Disconnected"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwsrep_ready：集群是否工作正常\nwsrep_cluster_size：节点数量\nwsrep_desync_count：延时节点数量\nwsrep_incoming_address：集群节点"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("地址\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("ul",[r("li",[s._v("集群事务相关常用参数")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("wsrep_cert_deps_distance：事务执行并发数\nwsrep_apply_oooe：接收队列中事务的占比\nwsrep_apply_oool：接收队列中事务乱序执行的频率\nwsrep_apply_window：接收队列中事务平均数量\nwsrep_commit_oooe：发送队列中事务的占比\nwsrep_commit_oool：无任何意义\nwsrep_commit_window：发送队列中事务平均数量\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"五-pxc-集群节点上线与下线"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#五-pxc-集群节点上线与下线"}},[s._v("#")]),s._v(" 五：PXC 集群节点上线与下线")]),s._v(" "),r("h3",{attrs:{id:"一-启动和停止节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-启动和停止节点"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) 启动和停止节点")])]),s._v(" "),r("ul",[r("li",[s._v("主节点启动")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("init"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pxc\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("主节点停止")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("直接kill掉进程即可\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("从节点启动")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("systemctl start mysql\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("从节点停止")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("systemctl stop mysql\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"二-恢复节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-恢复节点"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) 恢复节点")])]),s._v(" "),r("ul",[r("li",[r("p",[s._v("PXC集群中，如果有节点意外宕机，如果超过半数(3个节点的集群，2个节点意外宕机)，那么剩下的那1个节点无法读写，也就是说，集群不可用。但是可以直接让这个节点成为主节点"),r("code",[s._v("SET GLOBAL wsrep_provider_options='pc.bootstrap=YES';")]),s._v("。")])]),s._v(" "),r("li",[r("p",[s._v("如果是手动停止进程，不是意外宕机，1个节点依然可用，不需要设置为主节点")])]),s._v(" "),r("li",[r("p",[s._v("如何PXC节点全部宕机，恢复集群的方法如下：")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：查看各个节点上"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("grastate"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dat文件"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 如果safe_to_bootstrap为"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，那么这个节点启动的时候就是作为主节点启动，使用"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("init"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pxc命令启动，如果是"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("，那么直接作为从节点启动即可systemctl start mysql\n\nroot@yw5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v("# cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("grastate"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dat\n# "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GALERA")]),s._v(" saved state\nversion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v("\nuuid"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v("f6af2d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3230")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("eb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("acaf"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("aa3964891e0c\nseqno"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsafe_to_bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：那么在恢复节点的时候，safe_to_bootstrap作为主节点恢复，其他节点作为从节点恢复\n\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：如果"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("个节点同时宕机，那么可以从其中选择一台，修改"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("grastate"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dat文件safe_to_bootstrap为"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，作为主节点启动\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("ul",[r("li",[s._v("如果是两个节点的PXC集群，当其中一个节点宕机，那么另外一个未宕机节点是不可用的，报错内容为："),r("code",[s._v("WSREP has not yet prepared node for application use")]),s._v(", 那么需要将这个未宕机的节点提升为主节点，让集群可用。那么此时如果宕机的节点启动后，直接"),r("code",[s._v("systemctl start mysql")]),s._v("即可启动节点")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("查看当前集群状态")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("不可用"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmysql### show status like "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wsrep_cluster%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_weight     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_conf_id    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18446744073709551615")]),s._v("                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_size       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_state_uuid "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" a6eee3ef"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4743")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("eb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("991")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7316516")]),s._v("eee46 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_status     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" non"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Primary                          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n\n# 调整当前节点为主节点\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SET")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GLOBAL")]),s._v(" wsrep_provider_options"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pc.bootstrap=YES'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n# "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("查看当前集群状态")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可用"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmysql### show status like "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wsrep_cluster%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_weight     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_conf_id    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_size       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_state_uuid "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" a6eee3ef"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4743")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("eb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("991")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7316516")]),s._v("eee46 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" wsrep_cluster_status     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Primary                              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br")])]),r("h2",{attrs:{id:"六-pxc-集群中间件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#六-pxc-集群中间件"}},[s._v("#")]),s._v(" 六：PXC 集群中间件")]),s._v(" "),r("h3",{attrs:{id:"一-负载均衡类"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-负载均衡类"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) 负载均衡类")])]),s._v(" "),r("ul",[r("li",[s._v("功能")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("负载均衡提供了请求转发，降低了单一节点的负载\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("常见中间件有")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：Haproxy\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：MySQL"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proxy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"二-数据切分类"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-数据切分类"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) 数据切分类")])]),s._v(" "),r("ul",[r("li",[s._v("功能")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("按照不同的路由算法分发"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句就形成了数据切分\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：Mycat：基于阿里的Corba中间件，跨平台。具有分片算法、读写分离、全局主键、分布式事务\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：Atlas："),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("360")]),s._v("开源\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：ProxySQL：Percona推荐\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);