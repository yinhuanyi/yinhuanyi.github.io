(window.webpackJsonp=window.webpackJsonp||[]).push([[330],{2142:function(s,n,e){"use strict";e.r(n);var a=e(9),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"一-思考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-思考"}},[s._v("#")]),s._v(" 一：思考")]),s._v(" "),e("h3",{attrs:{id:"一-service服务对于数据返回的思考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-service服务对于数据返回的思考"}},[s._v("#")]),s._v(" (一)：service服务对于数据返回的思考")]),s._v(" "),e("ul",[e("li",[s._v("在category service中，有时候涉及到嵌套的数据结构，按照微服务设计的思想:"),e("code",[s._v("service层应该将字段扁平化返回，然后再web层，对数据进行拼接，最终返回的客户端")]),s._v("， 由于golang语言在数据拼接过程中，需要使用结构体，很多层的结构体不方便，因此，"),e("code",[s._v("在service层可以返回一个json类型的字段，把数据拼接好，供web 层调用")]),s._v("。然后在Web层作为一个Backend For Fronted层，将service层的返回的json数据进行组织，最后返回给前端。")])]),s._v(" "),e("h3",{attrs:{id:"二-web服务要注册到配置中心-那么可以设计一个接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-web服务要注册到配置中心-那么可以设计一个接口"}},[s._v("#")]),s._v(" (二)：web服务要注册到配置中心，那么可以设计一个接口")]),s._v(" "),e("ul",[e("li",[s._v("在utils/register/consul/register.go中，设计一个接口，用于实现consul注册，这个功能所有的BBF层服务都需要使用。register.go代码如下")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// NewRegistryClient 这里是判断是否client实现了Register，DeRegister两个方法\nfunc NewRegistryClient(client RegistryClient) RegistryClient {\n\treturn client\n}\n\n// RegistryClient 接口\ntype RegistryClient interface {\n\tRegister(address string, port int, name string, tags []string, id string) error\n\tDeRegister(serviceId string) error\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("ul",[e("li",[s._v("consul_register.go代码如下")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('package consul\n\nimport (\n\t"fmt"\n\t"github.com/hashicorp/consul/api"\n)\n\n\n// Registry 这个结构是consul的地址\ntype Registry struct{\n\tHost string\n\tPort int\n}\n\n// Register 注册web访问到consul\nfunc (r *Registry)Register(host string, port int, name string, tags []string, id string) error {\n\tcfg := api.DefaultConfig()  // 创建consul的配置\n\tcfg.Address = fmt.Sprintf("%s:%d", r.Host, r.Port)\n\n\tclient, err := api.NewClient(cfg)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t//生成对应的检查对象\n\tcheck := &api.AgentServiceCheck{\n\t\tHTTP: fmt.Sprintf("http://%s:%d/health", host, port),\n\t\tTimeout: "5s",\n\t\tInterval: "5s",\n\t\tDeregisterCriticalServiceAfter: "5s",\n\t}\n\n\t//生成注册对象\n\tregistration := new(api.AgentServiceRegistration)\n\tregistration.Name = name\n\tregistration.ID = id\n\tregistration.Port = port\n\tregistration.Tags = tags\n\tregistration.Address = host\n\tregistration.Check = check\n\n\terr = client.Agent().ServiceRegister(registration)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn nil\n}\n\n// DeRegister 注销web访问到consul\nfunc (r *Registry)DeRegister(serviceId string) error{\n\tcfg := api.DefaultConfig()\n\tcfg.Address = fmt.Sprintf("%s:%d", r.Host, r.Port)\n\n\tclient, err := api.NewClient(cfg)\n\tif err != nil {\n\t\treturn err\n\t}\n\terr = client.Agent().ServiceDeregister(serviceId)\n\treturn err\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br")])]),e("h2",{attrs:{id:"二-商品服务开发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-商品服务开发"}},[s._v("#")]),s._v(" 二：商品服务开发")]),s._v(" "),e("h3",{attrs:{id:"一-业务实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-业务实现"}},[s._v("#")]),s._v(" (一)：业务实现")]),s._v(" "),e("ul",[e("li",[s._v("商品相关业务表")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('from datetime import datetime\n\nfrom peewee import *\nfrom playhouse.shortcuts import ReconnectMixin\nfrom playhouse.pool import PooledMySQLDatabase\nfrom playhouse.mysql_ext import JSONField\n\nfrom goods_srv.settings.setting import DB\n\n# 创建一个连接池\nclass ReconnectMySQLDatabase(ReconnectMixin, PooledMySQLDatabase):\n    pass\n\ndb = ReconnectMySQLDatabase(\'good_srv\',\n                            host=\'127.0.0.1\',\n                            port=3306,\n                            user="root",\n                            password="yhy3426356")\n\n# 基类\nclass BaseModel(Model):\n    add_time = DateTimeField(default=datetime.now, verbose_name="添加时间")\n    is_deleted = BooleanField(default=False, verbose_name="是否删除")\n    update_time = DateTimeField(default=datetime.now, verbose_name="更新时间")\n\n    def save(self, *args, **kwargs):\n        #判断这是一个新添加的数据还是更新的数据\n        if self._pk is not None: # 判断主键是否是空，如果是空，说明是新记录\n            # 这是一条更新数据\n            self.update_time = datetime.now()\n        return super().save(*args, **kwargs)\n\n    # cls.delete删除\n    # 重写了model的delete操作，删除的时候，只标记为字段删除\n    @classmethod\n    def delete(cls, permanently=False): #permanently表示是否永久删除\n        if permanently:\n            # 这里的super()返回的是实例记录\n            return super().delete()\n        else:\n            return super().update(is_deleted=True)\n\n    # self.delete删除\n    def delete_instance(self, permanently=False, recursive=False, delete_nullable=False):\n        if permanently:\n            # self._pk_expr()是判断当前记录是否有主键，有主键where就是true\n            return self.delete(permanently).where(self._pk_expr()).execute()\n        else:\n            self.is_deleted = True\n            self.save()\n\n    # super().select(*fields)是调用了父类的方法\n    @classmethod\n    def select(cls, *fields):\n        return super().select(*fields).where(cls.is_deleted==False)\n\n    class Meta:\n        database = DB\n\n# 类别表\nclass Category(BaseModel):\n    name = CharField(max_length=20, verbose_name="名称")\n    # 一级类别可以没有父类别, 所以null可以为True\n    parent_category = ForeignKeyField("self", verbose_name="父类别", null=True)\n    level = IntegerField(default=1, verbose_name="级别")\n    is_tab = BooleanField(default=False, verbose_name="是否显示在首页tab")\n\n# 品牌表\nclass Brands(BaseModel):\n    name = CharField(max_length=50, verbose_name="名称", index=True, unique=True)\n    logo = CharField(max_length=200, null=True, verbose_name="图标", default="")\n\n# 商品表\nclass Goods(BaseModel):\n    """\n    商品， 分布式的事务最好的解决方案 就是不要让分布式事务出现\n    """\n    category = ForeignKeyField(Category, verbose_name="商品类目", on_delete=\'CASCADE\')\n    brand = ForeignKeyField(Brands, verbose_name="品牌", on_delete=\'CASCADE\')\n    on_sale = BooleanField(default=True, verbose_name="是否上架")\n    goods_sn = CharField(max_length=50, default="", verbose_name="商品唯一货号")\n    name = CharField(max_length=100, verbose_name="商品名")\n    click_num = IntegerField(default=0, verbose_name="点击数")\n    sold_num = IntegerField(default=0, verbose_name="商品销售量")\n    fav_num = IntegerField(default=0, verbose_name="收藏数") # 库存是电商中一个重要的环节\n    market_price = FloatField(default=0, verbose_name="市场价格")\n    shop_price = FloatField(default=0, verbose_name="本店价格")\n    goods_brief = CharField(max_length=200, verbose_name="商品简短描述")\n    ship_free = BooleanField(default=True, verbose_name="是否承担运费")\n    images = JSONField(verbose_name="商品轮播图")\n    desc_images = JSONField(verbose_name="详情页图片")\n    goods_front_image = CharField(max_length=200, verbose_name="封面图")\n    is_new = BooleanField(default=False, verbose_name="是否新品")\n    is_hot = BooleanField(default=False, verbose_name="是否热销")\n\n# 品牌类别表\nclass GoodsCategoryBrand(BaseModel):\n    # 这里设置id为自增主键的主要目的是防止联合主键的设置，取消了自增主键\n    id = AutoField(primary_key=True, verbose_name="id")\n    category = ForeignKeyField(Category, verbose_name="类别")\n    brand = ForeignKeyField(Brands, verbose_name="品牌")\n\n    class Meta:\n        indexes = (\n            #联合主键\n            (("category", "brand"), True),\n        )\n\n# 轮播的商品\nclass Banner(BaseModel):\n    image = CharField(max_length=200, default="", verbose_name="图片url")\n    url = CharField(max_length=200, default="", verbose_name="访问url")\n    index = IntegerField(default=0, verbose_name="轮播顺序")\n\nif __name__ == \'__main__\':\n    # 1：创建数据表\n    db.create_tables([Category, Goods, Brands, GoodsCategoryBrand, Banner])\n    # db.create_tables([Category])\n    # c1 = Category(name=\'肉类\', level=1)\n    # c2 = Category(name=\'水果\', level=2)\n    # c1.save()\n    # c2.save()\n\n    # 2：删除表记录\n    # c1 = Category.get(Category.id==1)\n    # c1.delete_instance()\n\n    # 3：查询操作, 只会查询is_delete字段中，没有删除的记录\n    # for c in Category.select():\n    #     print(c.id, c.name)\n\n    # 4：使用类方法进行删除记录\n    # Category.delete().where(Category.id==2).execute()\n\n    # 5：真删除记录\n    # Category.delete(permanently=True).where(Category.id==1).execute()\n    pass\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br"),e("span",{staticClass:"line-number"},[s._v("137")]),e("br")])]),e("ul",[e("li",[s._v("proto文件：goods.proto内容如下")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('syntax = "proto3";\nimport "google/protobuf/empty.proto";\noption go_package = "./;proto";\n// python -m grpc_tools.protoc --python_out=. --grpc_python_out=.  -I . goods.proto\nservice Goods{\n    // todo：商品接口，这里没有获取所有商品的接口\n    // 商品列表，带过滤\n    rpc GoodsList(GoodsFilterRequest) returns(GoodsListResponse);\n    // 创建商品\n    rpc CreateGoods(CreateGoodsInfo) returns (GoodsInfoResponse);\n    // 删除商品\n    rpc DeleteGoods(DeleteGoodsInfo) returns (google.protobuf.Empty);\n    // 更新商品数据\n    rpc UpdateGoods(CreateGoodsInfo) returns (GoodsInfoResponse);\n    // 商品详情数据\n    rpc GetGoodsDetail(GoodInfoRequest) returns(GoodsInfoResponse);\n    // 返回多个商品，是上面商品详情数据的列表\n    rpc BatchGetGoods(BatchGoodsIdInfo) returns(GoodsListResponse);\n\n    //todo: 商品分类\n    //获取所有的分类\n    rpc GetAllCategorysList(google.protobuf.Empty) returns(CategoryListResponse);\n    //获取子分类\n    rpc GetSubCategory(CategoryListRequest) returns(SubCategoryListResponse);\n    //新建分类信息\n    rpc CreateCategory(CategoryInfoRequest) returns(CategoryInfoResponse);\n    //删除分类\n    rpc DeleteCategory(DeleteCategoryRequest) returns(google.protobuf.Empty);\n    //修改分类信息\n    rpc UpdateCategory(CategoryInfoRequest) returns(google.protobuf.Empty);\n\n    //todo: 品牌和轮播图\n    //批量获取品牌信息\n    rpc BrandList(BrandFilterRequest) returns(BrandListResponse);\n    //新建品牌信息\n    rpc CreateBrand(BrandRequest) returns(BrandInfoResponse);\n    //删除品牌\n    rpc DeleteBrand(BrandRequest) returns(google.protobuf.Empty);\n    //修改品牌信息\n    rpc UpdateBrand(BrandRequest) returns(google.protobuf.Empty);\n\n    //todo: 轮播图\n    //获取轮播列表信息\n    rpc BannerList(google.protobuf.Empty) returns(BannerListResponse);\n    //添加banner图\n    rpc CreateBanner(BannerRequest) returns(BannerResponse);\n    //删除轮播图\n    rpc DeleteBanner(BannerRequest) returns(google.protobuf.Empty);\n    //修改轮播图\n    rpc UpdateBanner(BannerRequest) returns(google.protobuf.Empty);\n\n    //todo: 品牌分类\n    //获取轮播列表信息\n    rpc CategoryBrandList(CategoryBrandFilterRequest) returns(CategoryBrandListResponse);\n    //通过category获取brands\n    rpc GetCategoryBrandList(CategoryInfoRequest) returns(BrandListResponse);\n    //添加banner图\n    rpc CreateCategoryBrand(CategoryBrandRequest) returns(CategoryBrandResponse);\n    //删除轮播图\n    rpc DeleteCategoryBrand(CategoryBrandRequest) returns(google.protobuf.Empty);\n    //修改轮播图\n    rpc UpdateCategoryBrand(CategoryBrandRequest) returns(google.protobuf.Empty);\n}\n\nmessage CategoryListRequest {\n    int32 id = 1;\n    int32 level = 2;\n}\n\n\nmessage CategoryInfoRequest {\n    int32 id = 1;\n    string name = 2;\n    int32 parentCategory = 3;\n    int32 level = 4;\n    bool isTab = 5;\n}\n\n\nmessage DeleteCategoryRequest {\n    int32 id = 1;\n}\n\nmessage QueryCategoryRequest {\n    int32 id = 1;\n    string name = 2;\n}\n\nmessage CategoryInfoResponse {\n    int32 id = 1;\n    string name = 2;\n    int32 parentCategory = 3;\n    int32 level = 4;\n    bool isTab = 5;\n}\n\nmessage CategoryListResponse {\n    int32 total = 1;\n    repeated CategoryInfoResponse data = 2;\n    // 加这个字段的目的是，方便go web层对json数据拼接，因为在Python层比较简单\n    string jsonData = 3;\n}\n\nmessage SubCategoryListResponse {\n    int32 total = 1;\n    CategoryInfoResponse info = 2;\n    repeated CategoryInfoResponse subCategorys = 3;\n}\n\n\n\nmessage CategoryBrandFilterRequest  {\n    int32 pages = 1;\n    int32 pagePerNums = 2;\n}\n\nmessage FilterRequest  {\n    int32 pages = 1;\n    int32 pagePerNums = 2;\n}\n\nmessage CategoryBrandRequest{\n    int32 id = 1;\n    int32 categoryId = 2;\n    int32 brandId = 3;\n}\nmessage CategoryBrandResponse{\n    int32 id = 1;\n    BrandInfoResponse brand = 2;\n    CategoryInfoResponse category = 3;\n}\n\nmessage BannerRequest {\n    int32 id = 1;\n    int32 index = 2;\n    string image = 3;\n    string url = 4;\n}\n\nmessage BannerResponse {\n    int32 id = 1;\n    int32 index = 2;\n    string image = 3;\n    string url = 4;\n}\n\nmessage BrandFilterRequest {\n    int32 pages = 1;\n    int32 pagePerNums = 2;\n}\n\nmessage BrandRequest {\n    int32 id = 1;\n    string name = 2;\n    string logo = 3;\n}\n\nmessage BrandInfoResponse {\n    int32 id = 1;\n    string name = 2;\n    string logo = 3;\n}\n\nmessage BrandListResponse {\n    int32 total = 1;\n    repeated BrandInfoResponse data = 2;\n}\n\nmessage BannerListResponse {\n    int32 total = 1;\n    repeated BannerResponse data = 2;\n}\n\nmessage CategoryBrandListResponse {\n    int32 total = 1;\n    repeated CategoryBrandResponse data = 2;\n}\n\n\n\nmessage BatchGoodsIdInfo {\n    repeated int32 id = 1;\n}\n\n\nmessage DeleteGoodsInfo {\n    int32 id = 1;\n}\n\nmessage CategoryBriefInfoResponse {\n    int32 id = 1;\n    string name = 2;\n}\n\nmessage CategoryFilterRequest {\n    int32 id = 1;\n    bool  isTab = 2;\n}\n\nmessage GoodInfoRequest {\n    int32 id = 1;\n}\n\nmessage CreateGoodsInfo {\n    int32 id = 1;\n    string name = 2;\n    string goodsSn = 3;\n    int32 stocks = 7; //库存，\n    float marketPrice = 8;\n    float shopPrice = 9;\n    string goodsBrief = 10;\n    string goodsDesc = 11;\n    bool shipFree = 12;\n    repeated string images = 13;\n    repeated string descImages = 14;\n    string goodsFrontImage = 15;\n    bool isNew = 16;\n    bool isHot = 17;\n    bool onSale = 18;\n    int32 categoryId = 19;\n    int32 brandId = 20;\n}\n\nmessage GoodsReduceRequest {\n    int32 GoodsId = 1;\n    int32 nums = 2;\n}\n\nmessage BatchCategoryInfoRequest {\n    repeated int32 id = 1;\n    int32 goodsNums = 2;\n    int32 brandNums = 3;\n}\n\nmessage GoodsFilterRequest  {\n    int32 priceMin = 1;\n    int32 priceMax = 2;\n    bool  isHot = 3;\n    bool  isNew = 4;\n    bool  isTab = 5;\n    int32 topCategory = 6;\n    int32 pages = 7;\n    int32 pagePerNums = 8;\n    string keyWords = 9;\n    int32 brand = 10;\n}\n\n\nmessage GoodsInfoResponse {\n    int32 id = 1;\n    int32 categoryId = 2;\n    string name = 3;\n    string goodsSn = 4;\n    int32 clickNum = 5;\n    int32 soldNum = 6;\n    int32 favNum = 7;\n    float marketPrice = 9;\n    float shopPrice = 10;\n    string goodsBrief = 11;\n    string goodsDesc = 12;\n    bool shipFree = 13;\n    repeated string images = 14;\n    repeated string descImages = 15;\n    string goodsFrontImage = 16;\n    bool isNew = 17;\n    bool isHot = 18;\n    bool onSale = 19;\n    int64 addTime = 20;\n    // 带上商品的分类\n    CategoryBriefInfoResponse category = 21;\n    // 带上商品的品牌\n    BrandInfoResponse brand = 22;\n}\n\nmessage GoodsListResponse {\n    int32 total = 1;\n    repeated GoodsInfoResponse data = 2;\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br"),e("span",{staticClass:"line-number"},[s._v("137")]),e("br"),e("span",{staticClass:"line-number"},[s._v("138")]),e("br"),e("span",{staticClass:"line-number"},[s._v("139")]),e("br"),e("span",{staticClass:"line-number"},[s._v("140")]),e("br"),e("span",{staticClass:"line-number"},[s._v("141")]),e("br"),e("span",{staticClass:"line-number"},[s._v("142")]),e("br"),e("span",{staticClass:"line-number"},[s._v("143")]),e("br"),e("span",{staticClass:"line-number"},[s._v("144")]),e("br"),e("span",{staticClass:"line-number"},[s._v("145")]),e("br"),e("span",{staticClass:"line-number"},[s._v("146")]),e("br"),e("span",{staticClass:"line-number"},[s._v("147")]),e("br"),e("span",{staticClass:"line-number"},[s._v("148")]),e("br"),e("span",{staticClass:"line-number"},[s._v("149")]),e("br"),e("span",{staticClass:"line-number"},[s._v("150")]),e("br"),e("span",{staticClass:"line-number"},[s._v("151")]),e("br"),e("span",{staticClass:"line-number"},[s._v("152")]),e("br"),e("span",{staticClass:"line-number"},[s._v("153")]),e("br"),e("span",{staticClass:"line-number"},[s._v("154")]),e("br"),e("span",{staticClass:"line-number"},[s._v("155")]),e("br"),e("span",{staticClass:"line-number"},[s._v("156")]),e("br"),e("span",{staticClass:"line-number"},[s._v("157")]),e("br"),e("span",{staticClass:"line-number"},[s._v("158")]),e("br"),e("span",{staticClass:"line-number"},[s._v("159")]),e("br"),e("span",{staticClass:"line-number"},[s._v("160")]),e("br"),e("span",{staticClass:"line-number"},[s._v("161")]),e("br"),e("span",{staticClass:"line-number"},[s._v("162")]),e("br"),e("span",{staticClass:"line-number"},[s._v("163")]),e("br"),e("span",{staticClass:"line-number"},[s._v("164")]),e("br"),e("span",{staticClass:"line-number"},[s._v("165")]),e("br"),e("span",{staticClass:"line-number"},[s._v("166")]),e("br"),e("span",{staticClass:"line-number"},[s._v("167")]),e("br"),e("span",{staticClass:"line-number"},[s._v("168")]),e("br"),e("span",{staticClass:"line-number"},[s._v("169")]),e("br"),e("span",{staticClass:"line-number"},[s._v("170")]),e("br"),e("span",{staticClass:"line-number"},[s._v("171")]),e("br"),e("span",{staticClass:"line-number"},[s._v("172")]),e("br"),e("span",{staticClass:"line-number"},[s._v("173")]),e("br"),e("span",{staticClass:"line-number"},[s._v("174")]),e("br"),e("span",{staticClass:"line-number"},[s._v("175")]),e("br"),e("span",{staticClass:"line-number"},[s._v("176")]),e("br"),e("span",{staticClass:"line-number"},[s._v("177")]),e("br"),e("span",{staticClass:"line-number"},[s._v("178")]),e("br"),e("span",{staticClass:"line-number"},[s._v("179")]),e("br"),e("span",{staticClass:"line-number"},[s._v("180")]),e("br"),e("span",{staticClass:"line-number"},[s._v("181")]),e("br"),e("span",{staticClass:"line-number"},[s._v("182")]),e("br"),e("span",{staticClass:"line-number"},[s._v("183")]),e("br"),e("span",{staticClass:"line-number"},[s._v("184")]),e("br"),e("span",{staticClass:"line-number"},[s._v("185")]),e("br"),e("span",{staticClass:"line-number"},[s._v("186")]),e("br"),e("span",{staticClass:"line-number"},[s._v("187")]),e("br"),e("span",{staticClass:"line-number"},[s._v("188")]),e("br"),e("span",{staticClass:"line-number"},[s._v("189")]),e("br"),e("span",{staticClass:"line-number"},[s._v("190")]),e("br"),e("span",{staticClass:"line-number"},[s._v("191")]),e("br"),e("span",{staticClass:"line-number"},[s._v("192")]),e("br"),e("span",{staticClass:"line-number"},[s._v("193")]),e("br"),e("span",{staticClass:"line-number"},[s._v("194")]),e("br"),e("span",{staticClass:"line-number"},[s._v("195")]),e("br"),e("span",{staticClass:"line-number"},[s._v("196")]),e("br"),e("span",{staticClass:"line-number"},[s._v("197")]),e("br"),e("span",{staticClass:"line-number"},[s._v("198")]),e("br"),e("span",{staticClass:"line-number"},[s._v("199")]),e("br"),e("span",{staticClass:"line-number"},[s._v("200")]),e("br"),e("span",{staticClass:"line-number"},[s._v("201")]),e("br"),e("span",{staticClass:"line-number"},[s._v("202")]),e("br"),e("span",{staticClass:"line-number"},[s._v("203")]),e("br"),e("span",{staticClass:"line-number"},[s._v("204")]),e("br"),e("span",{staticClass:"line-number"},[s._v("205")]),e("br"),e("span",{staticClass:"line-number"},[s._v("206")]),e("br"),e("span",{staticClass:"line-number"},[s._v("207")]),e("br"),e("span",{staticClass:"line-number"},[s._v("208")]),e("br"),e("span",{staticClass:"line-number"},[s._v("209")]),e("br"),e("span",{staticClass:"line-number"},[s._v("210")]),e("br"),e("span",{staticClass:"line-number"},[s._v("211")]),e("br"),e("span",{staticClass:"line-number"},[s._v("212")]),e("br"),e("span",{staticClass:"line-number"},[s._v("213")]),e("br"),e("span",{staticClass:"line-number"},[s._v("214")]),e("br"),e("span",{staticClass:"line-number"},[s._v("215")]),e("br"),e("span",{staticClass:"line-number"},[s._v("216")]),e("br"),e("span",{staticClass:"line-number"},[s._v("217")]),e("br"),e("span",{staticClass:"line-number"},[s._v("218")]),e("br"),e("span",{staticClass:"line-number"},[s._v("219")]),e("br"),e("span",{staticClass:"line-number"},[s._v("220")]),e("br"),e("span",{staticClass:"line-number"},[s._v("221")]),e("br"),e("span",{staticClass:"line-number"},[s._v("222")]),e("br"),e("span",{staticClass:"line-number"},[s._v("223")]),e("br"),e("span",{staticClass:"line-number"},[s._v("224")]),e("br"),e("span",{staticClass:"line-number"},[s._v("225")]),e("br"),e("span",{staticClass:"line-number"},[s._v("226")]),e("br"),e("span",{staticClass:"line-number"},[s._v("227")]),e("br"),e("span",{staticClass:"line-number"},[s._v("228")]),e("br"),e("span",{staticClass:"line-number"},[s._v("229")]),e("br"),e("span",{staticClass:"line-number"},[s._v("230")]),e("br"),e("span",{staticClass:"line-number"},[s._v("231")]),e("br"),e("span",{staticClass:"line-number"},[s._v("232")]),e("br"),e("span",{staticClass:"line-number"},[s._v("233")]),e("br"),e("span",{staticClass:"line-number"},[s._v("234")]),e("br"),e("span",{staticClass:"line-number"},[s._v("235")]),e("br"),e("span",{staticClass:"line-number"},[s._v("236")]),e("br"),e("span",{staticClass:"line-number"},[s._v("237")]),e("br"),e("span",{staticClass:"line-number"},[s._v("238")]),e("br"),e("span",{staticClass:"line-number"},[s._v("239")]),e("br"),e("span",{staticClass:"line-number"},[s._v("240")]),e("br"),e("span",{staticClass:"line-number"},[s._v("241")]),e("br"),e("span",{staticClass:"line-number"},[s._v("242")]),e("br"),e("span",{staticClass:"line-number"},[s._v("243")]),e("br"),e("span",{staticClass:"line-number"},[s._v("244")]),e("br"),e("span",{staticClass:"line-number"},[s._v("245")]),e("br"),e("span",{staticClass:"line-number"},[s._v("246")]),e("br"),e("span",{staticClass:"line-number"},[s._v("247")]),e("br"),e("span",{staticClass:"line-number"},[s._v("248")]),e("br"),e("span",{staticClass:"line-number"},[s._v("249")]),e("br"),e("span",{staticClass:"line-number"},[s._v("250")]),e("br"),e("span",{staticClass:"line-number"},[s._v("251")]),e("br"),e("span",{staticClass:"line-number"},[s._v("252")]),e("br"),e("span",{staticClass:"line-number"},[s._v("253")]),e("br"),e("span",{staticClass:"line-number"},[s._v("254")]),e("br"),e("span",{staticClass:"line-number"},[s._v("255")]),e("br"),e("span",{staticClass:"line-number"},[s._v("256")]),e("br"),e("span",{staticClass:"line-number"},[s._v("257")]),e("br"),e("span",{staticClass:"line-number"},[s._v("258")]),e("br"),e("span",{staticClass:"line-number"},[s._v("259")]),e("br"),e("span",{staticClass:"line-number"},[s._v("260")]),e("br"),e("span",{staticClass:"line-number"},[s._v("261")]),e("br"),e("span",{staticClass:"line-number"},[s._v("262")]),e("br"),e("span",{staticClass:"line-number"},[s._v("263")]),e("br"),e("span",{staticClass:"line-number"},[s._v("264")]),e("br"),e("span",{staticClass:"line-number"},[s._v("265")]),e("br"),e("span",{staticClass:"line-number"},[s._v("266")]),e("br"),e("span",{staticClass:"line-number"},[s._v("267")]),e("br"),e("span",{staticClass:"line-number"},[s._v("268")]),e("br"),e("span",{staticClass:"line-number"},[s._v("269")]),e("br"),e("span",{staticClass:"line-number"},[s._v("270")]),e("br"),e("span",{staticClass:"line-number"},[s._v("271")]),e("br"),e("span",{staticClass:"line-number"},[s._v("272")]),e("br"),e("span",{staticClass:"line-number"},[s._v("273")]),e("br"),e("span",{staticClass:"line-number"},[s._v("274")]),e("br"),e("span",{staticClass:"line-number"},[s._v("275")]),e("br"),e("span",{staticClass:"line-number"},[s._v("276")]),e("br"),e("span",{staticClass:"line-number"},[s._v("277")]),e("br"),e("span",{staticClass:"line-number"},[s._v("278")]),e("br")])]),e("ul",[e("li",[s._v("基于goods.proto文件，生成python文件，将GoodsService组成到gRPC服务端中，提供gRPC请求服务。server.py代码如下")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// ... 部分代码省略\ndef serve():\n    parser = argparse.ArgumentParser()\n    parser.add_argument('--ip', nargs='?', type=str, default=setting.SERVICE_IP, help='Binding IP ADDR')\n    parser.add_argument('--port', nargs='?', type=int, default=0, help='Binding PORT')\n    args = parser.parse_args()\n    if args.port == 0:\n        port = get_free_tcp_port() # 获取随机端口\n    else:\n        port = args.port\n\n    if not args.ip or not args.port:\n        logger.info(\"Server Default Binding {}:{}\".format(setting.SERVICE_IP, port))\n    else:\n        logger.info(\"Server Binding {}:{}\".format(args.ip, port))\n\n\n    logger.add(\"logs/goods_srv_{time}.log\",\n               rotation=\"00:00\",\n               retention='10 days',\n               compression='zip')\n\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    # 注册用户服务的handler\n    goods_pb2_grpc.add_GoodsServicer_to_server(GoodsService(), server)\n    # goods_pb2_grpc.add_GoodsServicer_to_server(CategoryService(), server)\n    # 注册健康检查的handler\n    health_pb2_grpc.add_HealthServicer_to_server(HealthServicer(), server)\n\n    server.add_insecure_port('{}:{}'.format(args.ip, port))\n\n    # 主进程退出信号处理\n    service_id = str(uuid.uuid1())\n    signal.signal(signal.SIGINT, partial(on_exit, service_id=service_id))\n    signal.signal(signal.SIGTERM, partial(on_exit, service_id=service_id))\n    server.start()\n\n    logger.info(f\"goods-srv服务注册开始\")\n\n    register = ConsulRegister(setting.CONSUL_HOST, setting.CONSUL_PORT)\n\n    # 注册访问\n    if not register.register(name=setting.SERVICE_NAME,\n                             id=service_id,\n                             address=args.ip,\n                             port=port,\n                             tags=setting.SERVICE_TAGS,\n                             check=None):\n\n        logger.info(f\"服务注册失败, 停止服务\")\n        sys.exit(0)\n\n    logger.info(f\"goods-srv服务注册成功\")\n\n    server.wait_for_termination()\n\n\nif __name__ == '__main__':\n    # TODO：监听nacos配置的修改, 这里会使得重启进程报错\n    setting.client.add_config_watcher(setting.NACOS[\"DataId\"], setting.NACOS[\"Group\"], setting.update_cfg)\n    serve()\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br")])]),e("ul",[e("li",[s._v("GoodsService实现了proto文件中定义的所有方法，goods.py文件模板如下")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("class GoodsService(goods_pb2_grpc.GoodsServicer):\n\t// ......\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"三-golang端商品服务开发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-golang端商品服务开发"}},[s._v("#")]),s._v(" 三：Golang端商品服务开发")]),s._v(" "),e("h3",{attrs:{id:"一-业务实现-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-业务实现-2"}},[s._v("#")]),s._v(" (一)：业务实现")]),s._v(" "),e("ul",[e("li",[s._v("Golang开发的BBF层业务，是网关的Backend和Service层的Fronted。服务器启动的是HTTP协议，调用gRPC接口获取Service层数据。handler目录设计如下")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("api\n├── banner\n│   └── banner.go\n├── base.go // 在base文件中，定义了将gRPC错误状态码和错误内容，转换为HTTP的错误状态码和错误内容\n├── brand\n│   └── brand.go\n├── category\n│   └── category.go\n└── goods\n    └── goods.go\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);