(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{2239:function(s,a,t){"use strict";t.r(a);var n=t(9),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-加密算法分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-加密算法分类"}},[s._v("#")]),s._v(" 一：加密算法分类")]),s._v(" "),n("h3",{attrs:{id:"一-概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-概念"}},[s._v("#")]),s._v(" (一)：概念")]),s._v(" "),n("ul",[n("li",[s._v("常用的加密算法有："),n("strong",[s._v("对称加密、非对称加密、单向加密")])])]),s._v(" "),n("h3",{attrs:{id:"二-对称加密"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-对称加密"}},[s._v("#")]),s._v(" (二)：对称加密")]),s._v(" "),n("ul",[n("li",[s._v("对称加密中，需要有一个字符串类型的秘钥，基于秘钥对数据进行加解密。常用的算法有")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AES")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DES")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("："),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("DES\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"三-非对称加密"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-非对称加密"}},[s._v("#")]),s._v(" (三)：非对称加密")]),s._v(" "),n("ul",[n("li",[s._v("非对称加密其实就是"),n("code",[s._v("私钥和公钥")]),s._v("，可以通过公钥加密，私钥解密。也可以通过私钥加密，公钥解密("),n("code",[s._v("这种形式叫做数字签名")]),s._v(")。公钥从私钥中提取出来的，创建私钥和公钥的常用算法有")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RSA")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DSA")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"四-单向加密"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-单向加密"}},[s._v("#")]),s._v(" (四)：单向加密")]),s._v(" "),n("ul",[n("li",[s._v("单向加密是不可逆加密算法，基于单向函数("),n("code",[s._v("哈希函数")]),s._v(")生成，一般用于生成摘要，常用的单向加密算法有")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MD5")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SHA")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("C2C32")]),s._v("：在一致性哈希算法中，计算key的哈希使用了"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("C2C32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ChecksumIEEE函数生成哈希")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("摘要"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"二-ssl-tls握手"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-ssl-tls握手"}},[s._v("#")]),s._v(" 二：SSL/TLS握手")]),s._v(" "),n("h3",{attrs:{id:"一-安全的http协议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-安全的http协议"}},[s._v("#")]),s._v(" (一)：安全的HTTP协议")]),s._v(" "),n("ul",[n("li",[s._v("HTTP协议存在三个风险")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：窃听风险，比如通信链路上可以获取通信内容，用户号容易没\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：篡改风险，比如强制植入垃圾广告，视觉污染，用户眼容易瞎\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：冒充风险，比如冒充淘宝网站，用户钱容易没\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("HTTPS 在 HTTP 与 TCP 层之间加入了 TLS 协议，来解决上述的风险")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(762),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("TLS 协议是如何解决 HTTP 的风险的呢")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：信息加密防止窃听："),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" 交互信息是被加密的，第三方就无法被窃取\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：校验机制防止篡改：校验信息传输过程中是否有被第三方篡改过，如果被篡改过，则会有警告提示\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：身份证书防止冒充：证明淘宝是真的淘宝网\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"二-openssl应用程序的加解密过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-openssl应用程序的加解密过程"}},[s._v("#")]),s._v(" (二)：OpenSSL应用程序的加解密过程")]),s._v(" "),n("p",[n("img",{attrs:{src:t(763),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("上图描述了OpenSSL应用程序的一次加解密的过程，这里简单的将加密方作为客户端，解密方作为服务器端")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("加密过程：\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("：通过单向加密算法计算裸报文的【摘要】，例如在Linux系统上对文件运行md5sum会得到文件的摘要")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("防止篡改"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MD5")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b3286dc9a8655345bb673889d215c3ee\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：使用私钥对【摘要】进行加密，得到【数字签名】，并将数字签名附加到报文后面\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("：使用对称加密，加密【报文】和【数字签名】")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("防止窃听"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：基于"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("的证书，验证服务器发送的【公钥】")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("防止冒充"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，如果服务器端的公钥验证通过，使用【服务器的公钥】加密【对称加密数据】，附件到【对称加密数据】后面\n\n\n\n解密过程：\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：服务器端使用【自己的私钥】解密报文，得到【对称加密数据】\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：使用对称加密，解密【对称加密数据】，得到【裸报文】、【数字签名】\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：使用【客户端公钥】解密【数字签名】，此时客户端身份得到验证\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：使用同样的单向加密算法，加密【裸报文】，得到【摘要】，与客户端的摘要对比，如果相同完整性得到验证\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h3",{attrs:{id:"三-https握手过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-https握手过程"}},[s._v("#")]),s._v(" (三)：HTTPS握手过程")]),s._v(" "),n("ul",[n("li",[s._v("HTTPS协议的握手过程与OpenSSL加解密数据的过程类似，但是服务器需要借助网络获取到客户端的公钥，指定客户端的对称加密算法等。下图描述了HTTPS的握手过程")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(764),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：客户端发送"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SSL")]),s._v("版本信息到服务器端\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：服务器端给客户端返回"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SSL")]),s._v("版本、随机数、【服务器公钥】等信息\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：客户端基于网络"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("校验【服务器的证书是否合法】，不合法会发出告警\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：客户端校验服务器证书通过后，将【自己的证书】和【公钥】发送给服务器端\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("：服务器端校验客户端证书，获取客户端公钥\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("：客户端发送对称加密算法供服务器端选择\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("：服务器端选择【对称加密算法】后，使用【客户端公钥加密】发送给客户端\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("：客户端使用【自己的私钥】进行解密，获取到【对称加密算法】，生成【对称加密秘钥】，使用【服务器端的公钥】加密【对称加密秘钥】，发送给服务器端\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("：服务器端使用自己的私钥解密【对称加密秘钥】，得到【对称加密秘钥】\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("：此时客户端和服务器端就可以通过对称加密进行安全通信了\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("HTTPS的握手过程实际上是完成了"),n("code",[s._v("对称加密算法的指定")]),s._v("和"),n("code",[s._v("对称加密秘钥的生成")]),s._v("。只要客户端和服务器端都有了算法和秘钥后，就可以随意的对HTTP的裸报文进行加解密了")])]),s._v(" "),n("h2",{attrs:{id:"三-什么是系统调用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-什么是系统调用"}},[s._v("#")]),s._v(" 三：什么是系统调用")]),s._v(" "),n("h3",{attrs:{id:"一-概念-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-概念-2"}},[s._v("#")]),s._v(" (一)：概念")]),s._v(" "),n("p",[n("img",{attrs:{src:t(765),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("一个应用程序要想与外界交流，必须在内核的帮助下通过"),n("code",[s._v("系统调用")]),s._v("才能完成。系统调用是从一个应用程序到内核的函数调用，出于安全考虑，应用程序进行系统调用的时候，只能调用内核的 API接口("),n("code",[s._v("例如 open()函数")]),s._v(")，这个过程简称为"),n("code",[s._v("system call")])])]),s._v(" "),n("p",[n("img",{attrs:{src:t(766),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("每个应用程序(进程)都有自己的"),n("code",[s._v("虚拟地址空间")]),s._v("，应用程序的二进制文件、库文件、数据等都被映射到实际的内存中。在 Linux 中，一个进程并不是一出生就知道它的 PID的，必须通过一次系统调用获取其PID，然后将PID缓存到自己的虚拟地址空间中，避免下次再次获取还需要进行系统调用")])]),s._v(" "),n("h2",{attrs:{id:"四-什么是sendfile零拷贝"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-什么是sendfile零拷贝"}},[s._v("#")]),s._v(" 四：什么是sendfile零拷贝")]),s._v(" "),n("h3",{attrs:{id:"一-概念-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-概念-3"}},[s._v("#")]),s._v(" (一)：概念")]),s._v(" "),n("ul",[n("li",[s._v("传统的数据拷贝过程")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(767),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("一个应用程序需要从磁盘将数据发送到网卡，需要完成如下步骤：\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：应用程序发起syscall，让数据从磁盘被读取到内核缓冲区\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：数据从内核缓冲区返回到用户缓冲区\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：应用程序从用户缓冲区读取数据进行处理\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：将应用程序处理完成的数据发送到用户缓冲区\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("：应用程序再次发起syscall，将数据从用户缓冲区发送到socket缓冲区\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("：再从socket缓冲区将数据发送到网卡\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("sendfile数据零拷贝过程")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(768),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("sendfile零拷贝可以直接将数据从内核缓冲区发送到网卡：\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：应用程序发起syscall，让数据从磁盘被读取到内核缓冲区\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：基于sendfile技术，数据直接内核缓冲区发送到socket缓冲区\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：再从socket缓冲区将数据发送到网卡\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("sendfile() 系统调用")]),n("strong",[s._v("不需要")]),n("code",[s._v("将数据拷贝到应用程序地址空间中去")]),s._v("，所以 "),n("strong",[s._v("sendfile() 只是适用于应用程序地址空间不需要对所访问数据进行处理的情况")])])]),s._v(" "),n("h3",{attrs:{id:"二-哪些组件应用到了sendfile零拷贝"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-哪些组件应用到了sendfile零拷贝"}},[s._v("#")]),s._v(" (二)：哪些组件应用到了sendfile零拷贝")]),s._v(" "),n("ul",[n("li",[s._v("Nginx")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("Nginx的sendfile可以让静态资源的请求响应过程，不需要经过用户空间，直接再内核空间完成数据的交互\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("Kafka")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("在Kafka的持久化机制中，每个 Partition 其实是一个 append"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only 日志文件，消息会被直接追加到日志文件的尾部。消息写入的时候是顺序写入，不是随机写入，保证了写入到磁盘的效率。读取消息的时候，基于sendfile系统调用，将数据读取后加载到内核缓冲区，直接发送到socket缓冲区\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"五-什么是-copy-on-write-写时复制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五-什么是-copy-on-write-写时复制"}},[s._v("#")]),s._v(" 五：什么是 copy-on-write 写时复制")]),s._v(" "),n("h3",{attrs:{id:"一-概念-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-概念-4"}},[s._v("#")]),s._v(" (一)：概念")]),s._v(" "),n("ul",[n("li",[s._v("内核只为新生成的子进程创建虚拟空间结构，但是不为这些段分配物理内存，它们共享父进程的物理内存空间，当父子进程中有更改相应段的行为发生时，再为子进程相应的段分配物理空间。主要思想是只有父进程数据变化了，才会给子进程分配物理内存")])]),s._v(" "),n("h3",{attrs:{id:"二-哪些组件使用到了copy-on-write"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-哪些组件使用到了copy-on-write"}},[s._v("#")]),s._v(" (二)：哪些组件使用到了copy-on-write")]),s._v(" "),n("ul",[n("li",[s._v("Redis的RDB机制")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("其中"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RDB")]),s._v("在进行快照时候，需要考虑到性能和内存使用问题使用了Linux操作系统的copy on write机制，当Redis储存有"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("G数据的时候，进行"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RDB")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("快照持久化，Redis会新开一个fork子进程，此时已然是主进程对外提供服务，由子进程拷贝内存数据到文件中，此时的fork子进程不会分配物理内存，只是拷贝主进程的虚拟内存空间")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("内存页"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，如果"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RDB")]),s._v("过程中没有写入操作，就不需要为子进程额外开辟内存空间，如果有写入操作到read"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only内存段，那么会发生page"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fault，子进程会捕获处理这个异常，此时开会为子进程开辟内存空间，但是也只是开辟数据变化的这段内存。这样"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RDB")]),s._v("过程中，子进程做到了按需拷贝父进程数据的机制，大大节约了内存开销和时间开销\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports},762:function(s,a,t){s.exports=t.p+"assets/img/2022-02-1922.59.13.a81d3aba.png"},763:function(s,a,t){s.exports=t.p+"assets/img/1645285667612.9ea99512.png"},764:function(s,a,t){s.exports=t.p+"assets/img/2022-02-2000.42.27.3f59acec.png"},765:function(s,a,t){s.exports=t.p+"assets/img/2022-02-2313.26.19.9b8da84c.png"},766:function(s,a,t){s.exports=t.p+"assets/img/2022-02-2313.37.44.ae635cb2.png"},767:function(s,a,t){s.exports=t.p+"assets/img/2022-02-2315.00.45.71b0d65f.png"},768:function(s,a,t){s.exports=t.p+"assets/img/2022-02-2315.04.23.2c397cad.png"}}]);