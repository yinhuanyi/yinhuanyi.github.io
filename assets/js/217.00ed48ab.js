(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{1748:function(s,e,t){s.exports=t.p+"assets/img/B10BFE2F924B0ACBEEFB8C95C2DBBE7C.bf51e1aa.jpg"},1749:function(s,e,t){s.exports=t.p+"assets/img/2019-09-0410.03.53.92a9879d.png"},2690:function(s,e,t){"use strict";t.r(e);var a=t(9),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"一-监控指标的计算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-监控指标的计算"}},[s._v("#")]),s._v(" 一：监控指标的计算")]),s._v(" "),a("h3",{attrs:{id:"一-常用计算函数-官方地址-https-prometheus-io-docs-prometheus-latest-querying-functions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-常用计算函数-官方地址-https-prometheus-io-docs-prometheus-latest-querying-functions"}},[s._v("#")]),s._v(" (一)常用计算函数, 官方地址：https://prometheus.io/docs/prometheus/latest/querying/functions/")]),s._v(" "),a("ul",[a("li",[s._v("increase函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("increase函数用来对Counter数据，截取一段时间的增量，例如：increase(node_cpu_seconds_total[1m]) 就截取了1分钟内的增量\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("sum函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sum函数就是求和，例如\nsum(increase(node_cpu_seconds_total[1m]))：把所有的CPU核心数加起来\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("rate函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("一般适应counter类型的数据，作用是设置一个时间段，取这个时间段内平均每秒的增量,例如：rate(node_network_receive_bytes_total[1m])：一分钟内，每秒的增量，也就是瞬时流量\n一般而言：5分钟比1分钟的图形要平滑，因此，如果生产环境对流量异常要求特别高，可以将平均时间缩短一些,这样凸起就更加明显一些\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("topk函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("top函数是取前几位的最高值\n对Gauage类型的使用\n\ttopk(2, node_network_receive_bytes_total): 取前两个服务器的最高值\n对Counter类型的使用\n\ttopk(2, rate(node_network_receive_bytes_total[1m]))：取前两个服务器的最高值\n\n这个函数适合在Console中查看，适用于阈值报警\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("count函数")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("count函数是把数据符合输出条件的数目进行累加，\n例如：查看TCP连接数超过20的服务器个数\ncount(node_netstat_Tcp_ActiveOpens ### 20) \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"二-cpu使用率的计算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-cpu使用率的计算"}},[s._v("#")]),s._v(" (二)CPU使用率的计算")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CPU的使用率的计算：\n\tCPU使用率 = user time + nice time + sys time + wait time +...（除了idle time，其他的time都算上）/ all time\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"三-cpu各个状态的时间统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-cpu各个状态的时间统计"}},[s._v("#")]),s._v(" (三)CPU各个状态的时间统计")]),s._v(" "),a("p",[a("img",{attrs:{src:t(1748),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("在Prometheus中计算每一个监控节点的CPU使用率")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('(1 - (sum(increase(node_cpu_seconds_total{mode="idle"}[1m]))  by (instance) /  sum(increase(node_cpu_seconds_total[1m]))  by(instance))) * 100\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(1749),alt:"Alt text"}})]),s._v(" "),a("h3",{attrs:{id:"四-cpu使用率的公式拆分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-cpu使用率的公式拆分"}},[s._v("#")]),s._v(" (四)CPU使用率的公式拆分")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('1：node_cpu_seconds_total{mode="idle"}: 表示CPU状态的idle状态\n\n2：node_cpu_seconds_total：表示全部CPU时间\n\n3：increase(node_cpu_seconds_total{mode="idle"}[1m]): 一分钟的CPU的idle状态时间增量\n\n4：increase(node_cpu_seconds_total[1m])：一分钟所有CPU状态时间的增量\n\n5：sum(increase(node_cpu_seconds_total{mode="idle"}[1m])): 将所有的CPU的idel状态相加\n\n6：sum(increase(node_cpu_seconds_total{mode="idle"}[1m])) by (instance): 将CPU的idel状态相加后根据不同的主机进行拆分，这里的instance是服务器的标签，在生产环境可以也会安装业务进行拆分，例如：cluster标签，这个就需要自定义标签了\n\n7：sum(increase(node_cpu_seconds_total{mode="idle"}[1m]))  by (instance) /  sum(increase(node_cpu_seconds_total[1m]))  by(instance) ：CPU的idle状态的百分比\n\n8：(1 - (sum(increase(node_cpu_seconds_total{mode="idle"}[1m]))  by (instance) /  sum(increase(node_cpu_seconds_total[1m]))  by(instance))) * 100：CPU使用率\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"五-标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-标签"}},[s._v("#")]),s._v(" (五)标签")]),s._v(" "),a("ul",[a("li",[s._v("标签的作用是对metric的进一步过滤")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('prometheus_tsdb_compaction_chunk_size_bytes_bucket{instance="localhost:9090", job="node1"}: 这里的instance后面的就是标签\n\n标签有精确匹配和模糊匹配：=，~=, !=\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);