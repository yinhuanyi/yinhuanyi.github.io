(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{1657:function(s,t,a){s.exports=a.p+"assets/img/2021-01-034.43.07.deec62f2.png"},1658:function(s,t,a){s.exports=a.p+"assets/img/2021-01-035.44.53.c2bd1c08.png"},1659:function(s,t,a){s.exports=a.p+"assets/img/2021-01-036.06.32.89d5ea70.png"},2626:function(s,t,a){"use strict";a.r(t);var n=a(9),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-导入数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-导入数据"}},[s._v("#")]),s._v(" 一：导入数据")]),s._v(" "),n("h3",{attrs:{id:"一-单节点mysql命令行导入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-单节点mysql命令行导入"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 单节点MySQL命令行导入")])]),s._v(" "),n("ul",[n("li",[s._v("1：source命令导入：适合小量数据的导入")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 导入本地的user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql脚本数据，但是这个比较慢，原因是因为执行create语句的执行，都会进入MySQL的执行器进行"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("优化，使得速度非常慢\nMySQL "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("### source user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("2：load data命令导入：适合大量数据导入")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("load data local infile "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user.txt'")]),s._v(" into table orders fields terminated by "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" optionally enclosed by "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),s._v(" lines terminated by "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\n'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("user.txt如下")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"我爱你"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"相貌平常，经常耍流氓！哈哈"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"李奎"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"21"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"相貌平常，经常耍流氓！哈哈"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"王二米"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"相貌平常，经常耍流氓！哈哈"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"老三"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"24"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"很强"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"老四"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"34"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"XXXXX"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"老五"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"52"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"***%*￥*￥*￥*￥"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小猫"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"45"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"中间省略。。。"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小狗"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"12"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"就会叫"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小妹"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"21"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PP的很"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小坏蛋"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"52"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表里不一"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"二-如何给pxc集群导入大量数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-如何给pxc集群导入大量数据"}},[s._v("#")]),s._v(" "),n("code",[s._v("(二) 如何给PXC集群导入大量数据")])]),s._v(" "),n("ul",[n("li",[s._v("1：先准备好需要导入的数据文件，例如user.txt，假如user.txt文件有10亿行数据, user.txt文件文件内容如下")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"我爱你"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"相貌平常，经常耍流氓！哈哈"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"李奎"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"21"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"相貌平常，经常耍流氓！哈哈"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"王二米"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"相貌平常，经常耍流氓！哈哈"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"老三"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"24"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"很强"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"老四"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"34"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"XXXXX"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"老五"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"52"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"***%*￥*￥*￥*￥"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小猫"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"45"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"中间省略。。。"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小狗"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"12"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"就会叫"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小妹"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"21"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PP的很"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小坏蛋"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"52"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表里不一"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("ul",[n("li",[s._v("2：使用"),n("code",[s._v("split")]),s._v("对文件进行拆分，拆分为小文件，然后启动多线程导入")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l指定文件切割的行数，"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d指定切割后的文件名按照数字排序命名\nsplit "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt\n\n# 切分完毕后，是这样的，x00表示一个切分后的子数据集\nuser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt  x00  x01  x02\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("3：修改mysqld配置文件, /etc/my.cnf")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n# 让二进制日志提前写入到硬盘，不会在处理事务的时候写入硬盘\ninnodb_flush_log_at_trx_commit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n# 让二进制日志数据直接写入到磁盘\ninnodb_flush_method"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("O_DIRECT")]),s._v("\n# 增加buffer可以减少写入磁盘的次数，buffer越大越好\ninnodb_buffer_pool_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("M\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("4：当数据在插入到PXC集群的时候，需要注意的是，每个分片只保留一个节点可用，其他的手动停止即可。使用mycat来导入数据，将数据写入到两个分片中，然后启动其他的节点，将数据拷贝到其他节点，不同让节点之间同步数据，这样会很慢的")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("只保留一个写节点即可\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("5：需要编辑Mycat的schema.xml文件，只保留一个写节点，且让dataHost标签的balance属性设置为0，表示写节点只负责写入")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("直接修改Mycat的schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xml文件即可\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("6：如果使用Python的多进程导入数据，可以使用CPU多核的优势，那么在每个进程里面，可以使用pymysql，连接到数据库，然后"),n("code",[s._v("执行原生SQL语句")]),s._v("，导入数据")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 导入数据的原生"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("如下\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"load data local infile '/home/ipfsmian/{}' into table orders fields terminated by ',' optionally enclosed by '\"")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' lines terminated by '")]),s._v("\\n'\""),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("这里需要遍历当前"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ipfsmian"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("目录下的文件名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("7：当数据导入成功后，还原/etc/my.cnf的配置，还原到导入数据之前的配置，再启动其他PXC节点，让其他节点自动同步数据，(当然这里也可以使用备份的方法，将数据同步到其他PXC节点)。最后修改Mycat的schema.xml文件，还原到导入之前的配置")])]),s._v(" "),n("h2",{attrs:{id:"二-常用的分页查询sql优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-常用的分页查询sql优化"}},[s._v("#")]),s._v(" 二：常用的分页查询SQL优化")]),s._v(" "),n("h3",{attrs:{id:"一-分页查询基本sql语句优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-分页查询基本sql语句优化"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 分页查询基本SQL语句优化")])]),s._v(" "),n("ul",[n("li",[s._v("分页查询示例，你会发现最后一条SQL语句，返回的时间非常长，原因是因为："),n("code",[s._v("limit关键字是进行全局扫描的，因此返回结果中最后一条执行速度特别慢")])])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("开始查询，返回"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("条记录\nselect id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user from t_user limit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# 从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("开始查询，返回"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("条记录\nselect id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user from t_user limit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# 从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("开始查询，返回"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("条记录\nselect id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user from t_user limit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# 从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v("开始查询，返回"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("条纪律\nselect id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user from t_user limit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("那对于上面所述的分页查询优化有两种方法")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：使用where条件过滤id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 再向后取"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("条记录\nselect id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user from t_user where id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(" limit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：使用where条件过滤id\nselect id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user from t_user where id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(" and id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"三-tokudb的安装与使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-tokudb的安装与使用"}},[s._v("#")]),s._v(" 三：TokuDB的安装与使用")]),s._v(" "),n("h3",{attrs:{id:"一-介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-介绍"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 介绍")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("\tPercona Server "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" MySQL与单独提供的TokuDB存储引擎软件包兼容。必须单独下载TokuDB引擎，然后将其作为插件组件启用。该软件包可与标准Percona Server "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" MySQL "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),s._v("发行版（从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("67.0")]),s._v("开始）一起安装，并且不需要任何特别改版的Percona Server "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" MySQL。\n\n\tTokuDB存储引擎是可伸缩的，符合"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACID")]),s._v("和"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MVCC")]),s._v("的存储引擎，它提供了基于索引的查询改进，提供了在线模式修改，并减少了硬盘驱动器和闪存的从属延迟。该存储引擎是专为通过分形树索引实现的写密集型工作负载的高性能而设计的。要了解有关分形树索引的更多信息，您可以访问以下Wikipedia页面\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"二-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-安装"}},[s._v("#")]),s._v(" "),n("code",[s._v("(二) 安装")])]),s._v(" "),n("ul",[n("li",[s._v("安装Percona MySQL")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 安装源仓库\nyum install https"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("percona"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("noarch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rpm\n# 卸载mariadb\nyum remove "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("mariadb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\nrm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n# 安装percona mysql tokudb jemalloc\nyum install -y Percona-Server-server-57 jemalloc Percona-Server-tokudb-57.x86_64\n")])])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("开启Linux的大页内存管理")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 动态分片内存\necho "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"never"')]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sys"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kernel"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("transparent_hugepage"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("enabled\n# 开启内存碎片整理\necho "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"never"')]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sys"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kernel"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("transparent_hugepage"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("defrag\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("获取Percona MySQL的数据库密码")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("启动\nsystemctl start mysql\n\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 查看密码\ngrep "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"temporary password"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("T06"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23.818016")]),s._v("Z "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Note"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),s._v(" temporary password is generated "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" root@localhost"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" #ywu"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("ZqHL1Y8\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：修改root密码，且授权root远程访问\nalter user "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" identified by "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#.123456Aadb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngrant all on "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#.123456Aadb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ul",[n("li",[s._v("修改/etc/my.cnf(注意："),n("code",[s._v("单台节点无需开启binlog日志")]),s._v(")")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nport"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\nsocket"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndatadir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\nsocket"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock\nlog"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\npid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid\n# 没有集群，不需要binlog二级制日志\n#log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin\nexpire_logs_days"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\nsymbolic"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("links"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ncharacter_set_server"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\nbind"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\nskip"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("resolve\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld_safe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nmalloc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib64"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("libjemalloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("so"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("重启mysql，让配置生效")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("systemctl restart mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("启用tokudb引擎")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 启动tokudb引擎"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" #"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123456")]),s._v("Aadb是密码\nps"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p#"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123456")]),s._v("Aadb\n\n# 重启\nsystemctl restart mysql\n\n# 激活引擎\nps"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p#"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123456")]),s._v("Aadb\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("那么在建表的时候，就可以指定TokuDB引擎")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 创建tokudb数据表\ncreate table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("user")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id int"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" username "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" engine"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tokudb "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" charset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"四-replication集群搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-replication集群搭建"}},[s._v("#")]),s._v(" 四：Replication集群搭建")]),s._v(" "),n("h3",{attrs:{id:"一-介绍replication集群同步原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-介绍replication集群同步原理"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 介绍Replication集群同步原理")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1657),alt:"Alt text"}})]),s._v(" "),n("h3",{attrs:{id:"二-配置两个节点的集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-配置两个节点的集群"}},[s._v("#")]),s._v(" "),n("code",[s._v("(二) 配置两个节点的集群")])]),s._v(" "),n("ul",[n("li",[s._v("master(192.168.100.246)")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：创建二进制同步用户\ncreate user "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'backup_user'")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#.123456Aadb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngrant "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("reload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("replication slave on "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'backup_user'")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：修改"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf，添加如下配置\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nserver_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("\nlog_bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql_bin\nrelay_log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("relay_bin\n\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：重启MySQL\nsystemctl restart mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("slave(192.168.100.180)")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：创建二进制同步用户\ncreate user "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'backup_user'")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#.123456Aadb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngrant "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("reload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("replication slave on "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'backup_user'")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：修改"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf，添加如下配置\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nserver_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\nlog_bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql_bin\nrelay_log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("relay_bin\n\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：重启MySQL\nsystemctl restart mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("在slave节点开启同步")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：停止slave同步\nmysql### stop slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：配置slave同步\nmysql### change master to master_host"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.100.246'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'backup_user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#.123456Aadb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：启动slave同步\nmysql### start slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：查看同步情况\nmysql### show slave status\\"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("G")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("在master节点开启同步")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：停止slave同步\nmysql### stop slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：配置slave同步\nmysql### change master to master_host"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.100.180'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'backup_user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#.123456Aadb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：启动slave同步\nmysql### start slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：查看同步情况\nmysql### show slave status\\"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("G")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("此时两个MySQL节点互为主从")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1658),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("如果发现有节点同步错误"),n("code",[s._v("Slave_SQL_Running为No")]),s._v(", 那么可以在从节点做如下操作，重启同步")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("stop slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n# 跳过这条"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("，这样可能会丢失数据\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GLOBAL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL_SLAVE_SKIP_COUNTER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nstart slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"五-创建数据归档集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五-创建数据归档集群"}},[s._v("#")]),s._v(" 五：创建数据归档集群")]),s._v(" "),n("h3",{attrs:{id:"一-从pxc中将冷数据归档到tokudb的replication集群中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-从pxc中将冷数据归档到tokudb的replication集群中"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 从PXC中将冷数据归档到TokuDB的Replication集群中")])]),s._v(" "),n("ul",[n("li",[s._v("示意图如下")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1659),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("数据归档工具使用")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 安装perconna"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("toolkit\nyum install "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y perconna"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("toolkit\n\n# 查看版本\npt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("archiver "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("version\n\n# 从"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("中获取冷数据，写入到TokuDB中\npt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("archiver "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("source h"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".107")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("P")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8086")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" u"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t_user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("dest h"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".180")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("P")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" u"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("#"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123456")]),s._v("Aadb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t_user_2020_12 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("check"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("charset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("where "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'datetime<\"2020-12-01 0:0:0\"'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("progress "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("bulk"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("bulk"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("insert "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("limit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("statistics\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"六-mysql表分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六-mysql表分区"}},[s._v("#")]),s._v(" 六：MySQL表分区")]),s._v(" "),n("h3",{attrs:{id:"一-什么是表分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-什么是表分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 什么是表分区")])]),s._v(" "),n("ul",[n("li",[s._v("概念")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("将表切分为小块进行存储，存储在不同的磁盘上，提升"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IO")]),s._v("查询的速度，分区不会修改表结构，只是改变了表的存储方式\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("分区的目的")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("提升"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IO")]),s._v("查询的速度\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"二-为什么需要表分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-为什么需要表分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(二) 为什么需要表分区")])]),s._v(" "),n("ul",[n("li",[s._v("表分区的目的是将表存储到不同的磁盘上，提升IO读写能力")])]),s._v(" "),n("h3",{attrs:{id:"三-在pxc集群中创建表分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-在pxc集群中创建表分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(三) 在PXC集群中创建表分区")])]),s._v(" "),n("ul",[n("li",[s._v("PXC的同步模式中，pxc_strict_mode参数只能是"),n("code",[s._v("PERMISSIVE或者DISABLED")]),s._v("，那么需要修改为如下：")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("pxc_strict_mode"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PERMISSIVE")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("在每一个节点都必须挂载多个磁盘，用于提升IO能力")])]),s._v(" "),n("h3",{attrs:{id:"四-表分区的类型-mysql只能对主键字段进行分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-表分区的类型-mysql只能对主键字段进行分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(四) 表分区的类型（MySQL只能对主键字段进行分区）")])]),s._v(" "),n("ul",[n("li",[s._v("1：range分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("根据连续的区间值进行数据切分，字段必须是主键和整数\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("2：list分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("根据枚举值进行分区"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 字段必须是主键和整数\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("3：hash分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("对整数求模分区，字段必须是主键，字段的值可以是任何hash后为整数的字段，包括整数、日期、时间戳、字符串、二进制 \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("4：key分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("可以对任何的数据类型进行取模分区\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"四-range分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-range分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(四) range分区")])]),s._v(" "),n("ul",[n("li",[s._v("创建数据表(在每个分片都应该创建这个数据表) , 这里的 data directory可以写也可以不写，如果不写，数据将依然按照分区存储，但是存储的是MySQL的数据目录中")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# MySQL只能对主键字段进行分区，因此这里将id和birthday作为联合主键\ncreate table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("user")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nid int"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nname "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nbirthday "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DATE")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nprimary "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" birthday"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n# 由于range分区只能是整数，因此使用"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MONTH")]),s._v("函数将字段的月份提取出来作为分区的范围\npartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MONTH")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("birthday"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t# 月份小于"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("的存储在第一个分区\n\tpartition p0 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p0/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t# 月份小于"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("的存储在第二个分区\n\tpartition p1 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p1/data"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("ul",[n("li",[s._v("查看表的分区情况")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("select\n\tpartition_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition_method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition_expression"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition_description"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\ttable_rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tsubpartition_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tsubpartition_method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tsubpartition_expression\nfrom\n\tinformation_schema"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("partitions\nwhere\n\ttable_schema"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("schema")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nand\n\ttable_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"五-list分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五-list分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(五) list分区")])]),s._v(" "),n("ul",[n("li",[s._v("创建数据表(在每个分片都应该创建这个数据表)")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# MySQL只能对主键字段进行分区，因此这里将id和province_id作为联合主键\ncreate table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("area")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nid int"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nname "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nprovince_id "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INT")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nprimary "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" province_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n# 对province_id进行分区\npartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("list")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("province_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\n\tpartition p0 values "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p0/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p1 values "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p1/data"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"六-hash分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六-hash分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(六) hash分区")])]),s._v(" "),n("ul",[n("li",[s._v("创建数据表(在每个分片都应该创建这个数据表)")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# MySQL只能对主键字段进行分区，因此这里将id主键\ncreate table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("area")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nid int primary key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nname "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nprovince_id "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INT")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n# 对id进行分区，取模的除数是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\npartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" partitions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\n\tpartition p0 data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p0/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p1 data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p1/data"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"七-key分区-是hash分区的升级操作-任何主键字段都可以被key分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#七-key分区-是hash分区的升级操作-任何主键字段都可以被key分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(七) key分区: 是hash分区的升级操作，任何主键字段都可以被key分区")])]),s._v(" "),n("ul",[n("li",[s._v("创建数据表(在每个分片都应该创建这个数据表)")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("create table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("job")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tid int not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tname "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tjob "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tprimary "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("job"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("job"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" partitions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\n\tpartition p0 data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p0/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p1 data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p1/data"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"八-动态管理操作range分区表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#八-动态管理操作range分区表"}},[s._v("#")]),s._v(" "),n("code",[s._v("(八) 动态管理操作range分区表")])]),s._v(" "),n("ul",[n("li",[s._v("添加分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("alter table user add "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("partition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tpartition p3 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("删除分区："),n("code",[s._v("删除分区，会将分区上的表和数据都删除掉，比较危险")])])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("alter table user drop partition p1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("p2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("合并分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("alter table user reorganize partition s0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s1 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("into")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tpartition p0 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("拆分分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("alter table user reorganize partition p0 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("into")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tpartition s0 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition s1 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("移除表分区：只会将分区删除，数据不会删除。如果表只有一个分区，只能移除分区，无法删除分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("alter table user remove partitioning"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"九-给没有分区的表-创建新分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#九-给没有分区的表-创建新分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(九) 给没有分区的表，创建新分区")])]),s._v(" "),n("ul",[n("li",[s._v("创建表")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("create table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tid int not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tname "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\ttype_id int not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tprimary "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" type_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("给表创建list分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("alter table user partition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("list")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tpartition p0 values "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p0/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p1 values "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p1/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\t\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"十-创建子分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十-创建子分区"}},[s._v("#")]),s._v(" "),n("code",[s._v("(十) 创建子分区")])]),s._v(" "),n("ul",[n("li",[s._v("子分区就是在已有的分区上再次创建分区数据，目前只有range和list分区可以创建子分区，且子分区必须是hash或者key分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("create table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("user")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tid int not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tname "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tprovince_id not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tprimary "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("province_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("province_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsubpartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" subpartitions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tpartition p0 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p0/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p1 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p1/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p2 values less than maxvalue data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p2/data"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("创建子分区的同时给子分区取名字, 如果第一个分区有2个子分区，那么其余分区也必须只能有2个子分区")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("create table "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("user")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tid int not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tname "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tprovince_id not "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tprimary "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("province_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("province_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" subpartition by "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tpartition p0 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p0/data"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subpartition s0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" subpartition s1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p1 values less "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("than")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p1/data"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subpartition s0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" subpartition s1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tpartition p2 values less than maxvalue data directory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/p2/data"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subpartition s0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" subpartition s1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);