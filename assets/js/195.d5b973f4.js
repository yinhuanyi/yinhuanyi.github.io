(window.webpackJsonp=window.webpackJsonp||[]).push([[195],{1331:function(s,n,e){s.exports=e.p+"assets/img/2021-04-023.29.38.8357f98b.png"},1332:function(s,n,e){s.exports=e.p+"assets/img/2019-09-258.17.09.650e44c0.png"},2446:function(s,n,e){"use strict";e.r(n);var a=e(9),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"_1-前端环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-前端环境配置"}},[s._v("#")]),s._v(" 1：前端环境配置")]),s._v(" "),a("ul",[a("li",[s._v("安装node, 安装vue， 安装cnpm替代npm")]),s._v(" "),a("li",[s._v("下载前端源码")]),s._v(" "),a("li",[a("code",[s._v("online-store")]),s._v("目录是前端目录，进入到"),a("code",[s._v("online-store")]),s._v("目录，运行"),a("code",[s._v("cnpm install")]),s._v("， 安装package.json中的依赖包，会在"),a("code",[s._v("online-store")]),s._v("目录中生成一个node_modules目录，这个存放的都是Vue的第三方包")]),s._v(" "),a("li",[s._v("执行"),a("code",[s._v("cnpm run dev")]),s._v("运行vue项目")])]),s._v(" "),a("h3",{attrs:{id:"_2-django1-11升级到django2-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-django1-11升级到django2-0"}},[s._v("#")]),s._v(" 2：Django1.11升级到Django2.0")]),s._v(" "),a("ul",[a("li",[s._v("在model中的foreignkey，需要传递一个参数，on_delete")])]),s._v(" "),a("h3",{attrs:{id:"_3-在vue-shop3-6-3虚拟环境中安装drf框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-在vue-shop3-6-3虚拟环境中安装drf框架"}},[s._v("#")]),s._v(" 3：在Vue_Shop3.6.3虚拟环境中安装drf框架")]),s._v(" "),a("ul",[a("li",[s._v("安装")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pip install django==1.11\npip install djangorestframework==3.6.3\npip install markdown       # Markdown support for the browsable API.\npip install django-filter  # Filtering support\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_4-在pycharm中打开这个vue-shop目录-作为django模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-在pycharm中打开这个vue-shop目录-作为django模板"}},[s._v("#")]),s._v(" 4：在pycharm中打开这个Vue_Shop目录，作为Django模板")]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_5-配置数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置数据库"}},[s._v("#")]),s._v(" 5：配置数据库")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'Vue_Shop',\n        'USER': 'vue_shop',\n        'PASSWORD': '123456',\n        'HOST': '127.0.0.1',\n        'PORT': 3306,\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"_6-整个项目在初始化数据完毕后-安装的依赖包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-整个项目在初始化数据完毕后-安装的依赖包"}},[s._v("#")]),s._v(" 6：整个项目在初始化数据完毕后，安装的依赖包")]),s._v(" "),a("ul",[a("li",[s._v("依赖")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("backports.csv==1.0.7\ncertifi==2019.3.9\nchardet==3.0.4\ncoreapi==2.3.3\ncoreschema==0.0.4\ndefusedxml==0.5.0\ndiff-match-patch==20181111\nDjango==1.11\ndjango-crispy-forms==1.7.2\ndjango-filter==2.1.0\ndjango-formtools==2.1\ndjango-guardian==1.5.0\ndjango-import-export==1.2.0\ndjango-reversion==3.0.3\ndjangorestframework==3.6.3\net-xmlfile==1.0.1\nfuture==0.17.1\nhttplib2==0.12.1\nidna==2.8\nitypes==1.1.0\njdcal==1.4\nJinja2==2.10\nMarkdown==3.0.1\nMarkupSafe==1.1.1\nmysqlclient==1.4.2.post1\nodfpy==1.4.0\nopenpyxl==2.6.1\nPillow==5.4.1\npytz==2018.9\nPyYAML==5.1\nrequests==2.21.0\nsix==1.12.0\ntablib==0.13.0\nuritemplate==3.0.0\nurllib3==1.24.1\nxlrd==1.2.0\nxlwt==1.3.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("ul",[a("li",[s._v("INSTALLED_APPS为")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'users.apps.UsersConfig',\n    'goods.apps.GoodsConfig',\n    'trade.apps.TradeConfig',\n    'user_operation.apps.UserOperationConfig',\n    'DjangoUeditor',\n    'xadmin',\n    'crispy_forms',\n    'rest_framework',\n    'django_filters',\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"_7-创建app和创建uses-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-创建app和创建uses-model"}},[s._v("#")]),s._v(" 7：创建APP和创建uses Model")]),s._v(" "),a("ul",[a("li",[s._v("在pycharm中，选择Run manage.py task")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("startapp users\nstartapp goods\nstartapp trade\nstartapp user_operation\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("将第三方的DjangoUeditor复制到extra_apps包中")])]),s._v(" "),a("li",[a("p",[s._v("在settings文件中，将app添加")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'users.apps.UsersConfig',\n    'goods.apps.GoodsConfig',\n    'trade.apps.TradeConfig',\n    'user_operation.apps.UserOperationConfig',\n    'DjangoUeditor'\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ul",[a("li",[s._v("在users的model里扩展Django自建的用户字段和创建短信验证码这个表")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from datetime import datetime\n\nfrom django.db import models\nfrom django.contrib.auth.models import AbstractUser\n\n# 为Django自带的user扩展字段\nclass UserProfile(AbstractUser):\n    """\n    用户\n    """\n    name = models.CharField(max_length=30, null=True, blank=True, verbose_name="姓名")\n    birthday = models.DateField(null=True, blank=True, verbose_name="出生年月")\n    gender = models.CharField(max_length=6, choices=(("male", u"男"), ("female", "女")), default="female", verbose_name="性别")\n    mobile = models.CharField(null=True, blank=True, max_length=11, verbose_name="电话")\n    email = models.EmailField(max_length=100, null=True, blank=True, verbose_name="邮箱")\n\n    class Meta:\n        verbose_name = "用户"\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.username\n\n# 将用户的手机验证码保存到数据库中\nclass VerifyCode(models.Model):\n    """\n    短信验证码\n    """\n    code = models.CharField(max_length=10, verbose_name="验证码")\n    mobile = models.CharField(max_length=11, verbose_name="电话")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = "短信验证码"\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.code\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("ul",[a("li",[s._v("使用UserProfile表替换Django自带的user表("),a("code",[s._v("这里需要注意的是：如果之前已经运行了migrate生成了数据表，那么需要将所有的表删除，扩展了auth_user表后，会重新生成auth_userprofile表")]),s._v(")")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("编辑settings文件，设置将用户的认证使用users APP下的UserProfile这个model\nAUTH_USER_MODEL = 'users.UserProfile'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("在run manage.py task中执行model生成数据表, 如果migrate出现错误，那么可以直接删除掉数据库中的所有表，然后重新执行下面的命令")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("makemigrations \nmigrate\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("在Django自带的User表扩展之前，所有表名称是这样的")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 组\nauth_group\n# 组权限连接表\nauth_group_permissions\n# 权限\nauth_permission\n# 用户\nauth_user\n# 用户组连接表\nauth_user_groups\n# 用户\nauth_user_user_permissions\n# 日志\ndjango_admin_log\n# 我们在makemigrations迁移数据库时，django会自动生成django_content_type表，该表将我们创建的app下的models表进行app_label-models一一映射\ndjango_content_type\n# 迁移表，记录每次迁移\ndjango_migrations\n# 会话表\ndjango_session\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[a("img",{attrs:{src:e(1331),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("在Django自带的User表扩展之后，所有表名称是这样的")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("auth_group                         \nauth_group_permissions             \nauth_permission                    \ndjango_admin_log                   \ndjango_content_type                \ndjango_migrations                  \ndjango_session                     \nusers_userprofile                  \nusers_userprofile_groups           \nusers_userprofile_user_permissions\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"_8-创建goods-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-创建goods-model"}},[s._v("#")]),s._v(" 8：创建goods Model")]),s._v(" "),a("ul",[a("li",[s._v("1：分析商品类别的从属关系")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：分析：\n\t在生鲜食品中有：生鲜肉类、生鲜蔬菜、生鲜水产等\n\t在生鲜肉类肉类中有：牛肉、羊肉、猪肉等\n\n2：从分析上来看，商品的类别有三类，那么这样就需要构建3个model，然后使用外键的方式将这三个model关联起来\n\n3：这里通过一个model来构建一个分类树，来完成分类，让类别自己指向自己\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[s._v("具体的model设计")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from datetime import datetime\n\nfrom django.db import models\n# Create your models here.\n\nfrom DjangoUeditor.models import UEditorField\n\n# 商品类别\nclass GoodsCategory(models.Model):\n    """\n    商品类别\n    """\n    CATEGORY_TYPE = (\n        (1, "一级类目"),\n        (2, "二级类目"),\n        (3, "三级类目"),\n    )\n    # 这里的help_text是生产文档的时候，会引用到文档中\n    name = models.CharField(default="", max_length=30, verbose_name="类别名", help_text="类别名")\n    code = models.CharField(default="", max_length=30, verbose_name="类别code", help_text="类别code")\n    desc = models.TextField(default="", verbose_name="类别描述", help_text="类别描述")\n    # 这个model中想通过category_type这个字段标记不同的表，也就是不同的分类\n    category_type = models.IntegerField(choices=CATEGORY_TYPE, verbose_name="类目级别", help_text="类目级别")\n    # 自己指向自己\n    parent_category = models.ForeignKey("self", null=True, blank=True, verbose_name="父类目级别", help_text="父目录",related_name="sub_cat")\n    # 设置是否放到tab导航栏中\n    is_tab = models.BooleanField(default=False, verbose_name="是否导航", help_text="是否导航")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = "商品类别"\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.name\n\n# 定义商品的品牌\nclass GoodsCategoryBrand(models.Model):\n    """\n    品牌名\n    """\n    # 这里是指定哪个品牌属于哪个类别，因此品牌是子model，类别是父model\n    category = models.ForeignKey(GoodsCategory, related_name=\'brands_to_category\', null=True, blank=True, verbose_name="商品类目")\n    name = models.CharField(default="", max_length=30, verbose_name="品牌名", help_text="品牌名")\n    desc = models.TextField(default="", max_length=200, verbose_name="品牌描述", help_text="品牌描述")\n    # 图片上传会上传到medis/brands目录下, brands目录会自动生成，无需新建\n    image = models.ImageField(max_length=200, upload_to="brands/")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = "品牌"\n        verbose_name_plural = verbose_name\n        db_table = "goods_goodsbrand"\n\n    def __str__(self):\n        return self.name\n\n# 商品的model\nclass Goods(models.Model):\n    """\n    商品\n    """\n    # 商品属于哪个类别， 子model是商品，父model是类别\n    category = models.ForeignKey(GoodsCategory, verbose_name="商品类目")\n    goods_sn = models.CharField(max_length=50, default="", verbose_name="商品唯一货号")\n    name = models.CharField(max_length=100, verbose_name="商品名")\n    click_num = models.IntegerField(default=0, verbose_name="点击数")\n    sold_num = models.IntegerField(default=0, verbose_name="商品销售量")\n    fav_num = models.IntegerField(default=0, verbose_name="收藏数")\n    goods_num = models.IntegerField(default=0, verbose_name="库存数")\n    market_price = models.FloatField(default=0, verbose_name="市场价格")\n    shop_price = models.FloatField(default=0, verbose_name="本店价格")\n    goods_brief = models.TextField(max_length=500, verbose_name="商品简短描述")\n    # 这里是用的是第三方的extra_apps\n    goods_desc = UEditorField(verbose_name=u"内容", imagePath="goods/images/", width=1000, height=300, filePath="goods/files/", default=\'\')\n    ship_free = models.BooleanField(default=True, verbose_name="是否承担运费")\n    # 图片将会上传到media/goods/images/目录下\n    goods_front_image = models.ImageField(upload_to="goods/images/", null=True, blank=True, verbose_name="封面图")\n    is_new = models.BooleanField(default=False, verbose_name="是否新品")\n    is_hot = models.BooleanField(default=False, verbose_name="是否热销")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = \'商品\'\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.name\n\n# 设置广告，广告属于类别也属于商品\nclass IndexAd(models.Model):\n    category = models.ForeignKey(GoodsCategory, related_name=\'category\',verbose_name="商品类目")\n    goods =models.ForeignKey(Goods, related_name=\'goods\')\n\n    class Meta:\n        verbose_name = \'首页商品类别广告\'\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.goods.name\n\n# 商品图片\nclass GoodsImage(models.Model):\n    """\n    商品轮播图\n    """\n    # 图片属于商品，图片是子model，商品是父model\n    goods = models.ForeignKey(Goods, verbose_name="商品", related_name="images_to_goods")\n    image = models.ImageField(upload_to="", verbose_name="图片", null=True, blank=True)\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = \'商品图片\'\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.goods.name\n\n# 设置轮播的商品\nclass Banner(models.Model):\n    """\n    轮播的商品\n    """\n    goods = models.ForeignKey(Goods, verbose_name="商品")\n    image = models.ImageField(upload_to=\'banner\', verbose_name="轮播图片")\n    index = models.IntegerField(default=0, verbose_name="轮播顺序")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = \'轮播商品\'\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.goods.name\n\n# 设置用户热搜\nclass HotSearchWords(models.Model):\n    """\n    热搜词\n    """\n    keywords = models.CharField(default="", max_length=20, verbose_name="热搜词")\n    index = models.IntegerField(default=0, verbose_name="排序")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = \'热搜词\'\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.keywords\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br")])]),a("h3",{attrs:{id:"_9-创建trade-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-创建trade-model"}},[s._v("#")]),s._v(" 9：创建trade Model")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from datetime import datetime\n\nfrom django.db import models\n# 这个是使用一种变向的方式，通过get_user_model这个函数，可以将user这个类，也就是UserProfile这个类获取到，当然也可以直接导入\nfrom django.contrib.auth import get_user_model\n\nfrom goods.models import Goods\n# 这里拿到的其实就是也就是UserProfile这个类获取到\nUser = get_user_model()\n# Create your models here.\n\n# 创建购物车\nclass ShoppingCart(models.Model):\n    """\n    购物车\n    """\n    # 购物车是子model，User和Goods是父model\n    user = models.ForeignKey(User, verbose_name=u"用户")\n    goods = models.ForeignKey(Goods, verbose_name=u"商品")\n    nums = models.IntegerField(default=0, verbose_name="购买数量")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name=u"添加时间")\n\n    class Meta:\n        verbose_name = \'购物车\'\n        verbose_name_plural = verbose_name\n        unique_together = ("user", "goods")\n\n    def __str__(self):\n        return "%s(%d)".format(self.goods.name, self.nums)\n\n# 创建订单\nclass OrderInfo(models.Model):\n    """\n    订单\n    """\n    ORDER_STATUS = (\n        ("TRADE_SUCCESS", "成功"),\n        ("TRADE_CLOSED", "超时关闭"),\n        ("WAIT_BUYER_PAY", "交易创建"),\n        ("TRADE_FINISHED", "交易结束"),\n        ("paying", "待支付"),\n    )\n    # 订单是子model，User是父model\n    user = models.ForeignKey(User, verbose_name="用户")\n    order_sn = models.CharField(max_length=30, null=True, blank=True, unique=True, verbose_name="订单号")\n    trade_no = models.CharField(max_length=100, unique=True, null=True, blank=True, verbose_name=u"交易号")\n    pay_status = models.CharField(choices=ORDER_STATUS, default="paying", max_length=30, verbose_name="订单状态")\n    post_script = models.CharField(max_length=200, verbose_name="订单留言")\n    order_mount = models.FloatField(default=0.0, verbose_name="订单金额")\n    pay_time = models.DateTimeField(null=True, blank=True, verbose_name="支付时间")\n\n    # 用户信息\n    address = models.CharField(max_length=100, default="", verbose_name="收货地址")\n    signer_name = models.CharField(max_length=20, default="", verbose_name="签收人")\n    singer_mobile = models.CharField(max_length=11, verbose_name="联系电话")\n\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = u"订单"\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return str(self.order_sn)\n\n\n# 创建订单的商品详情\nclass OrderGoods(models.Model):\n    """\n    订单的商品详情\n    """\n    order = models.ForeignKey(OrderInfo, verbose_name="订单信息", related_name="goods")\n    goods = models.ForeignKey(Goods, verbose_name="商品")\n    goods_num = models.IntegerField(default=0, verbose_name="商品数量")\n\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = "订单商品"\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return str(self.order.order_sn)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br")])]),a("h3",{attrs:{id:"_10-创建user-operation-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-创建user-operation-model"}},[s._v("#")]),s._v(" 10：创建user_operation Model")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from datetime import datetime\n\nfrom django.db import models\nfrom django.contrib.auth import get_user_model\n\nfrom goods.models import Goods\n# Create your models here.\nUser = get_user_model()\n\n# 用户收藏\nclass UserFav(models.Model):\n    """\n    用户收藏\n    """\n    user = models.ForeignKey(User, verbose_name="用户")\n    goods = models.ForeignKey(Goods, verbose_name="商品", help_text="商品id")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name=u"添加时间")\n\n    class Meta:\n        verbose_name = \'用户收藏\'\n        verbose_name_plural = verbose_name\n        unique_together = ("user", "goods")\n\n    def __str__(self):\n        return self.user.username\n\n# 用户留言信息\nclass UserLeavingMessage(models.Model):\n    """\n    用户留言\n    """\n    MESSAGE_CHOICES = (\n        (1, "留言"),\n        (2, "投诉"),\n        (3, "询问"),\n        (4, "售后"),\n        (5, "求购")\n    )\n    user = models.ForeignKey(User, verbose_name="用户")\n    message_type = models.IntegerField(default=1, choices=MESSAGE_CHOICES, verbose_name="留言类型",\n                                      help_text=u"留言类型: 1(留言),2(投诉),3(询问),4(售后),5(求购)")\n    subject = models.CharField(max_length=100, default="", verbose_name="主题")\n    message = models.TextField(default="", verbose_name="留言内容", help_text="留言内容")\n    file = models.FileField(upload_to="message/images/", verbose_name="上传的文件", help_text="上传的文件")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n\n    class Meta:\n        verbose_name = "用户留言"\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.subject\n\n# 用户地址\nclass UserAddress(models.Model):\n    """\n    用户收货地址\n    """\n    user = models.ForeignKey(User, verbose_name="用户" )\n    province = models.CharField(max_length=100, default="", verbose_name="省份")\n    city = models.CharField(max_length=100, default="", verbose_name="城市")\n    district = models.CharField(max_length=100, default="", verbose_name="区域")\n    address = models.CharField(max_length=100, default="", verbose_name="详细地址")\n    signer_name = models.CharField(max_length=100, default="", verbose_name="签收人")\n    signer_mobile = models.CharField(max_length=11, default="", verbose_name="电话")\n    add_time = models.DateTimeField(default=datetime.now, verbose_name="添加时间")\n    \n    class Meta:\n        verbose_name = "收货地址"\n        verbose_name_plural = verbose_name\n\n    def __str__(self):\n        return self.address\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br")])]),a("h3",{attrs:{id:"_11-migrations原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-migrations原理"}},[s._v("#")]),s._v(" 11：migrations原理")]),s._v(" "),a("ul",[a("li",[s._v("migrations是Django中用来做数据表版本控制的。每次在makemigrations的时候，会在对应的APP中migrations包里面生成一个脚本文件。当执行migrate的时候，会将这个脚本文件写入到django_migrations表中。那么下次再次执行makemigrations和migrate，Django就不会再执行django_migrations表中已经记录的Python脚本，这样有效的实现了Django的数据库版本控制。"),a("code",[s._v("因此，如果在migrate的时候，报错或者表修改不生效的话，那么就可以直接在django_migrations表中删除对应的APP的记录，也可以将对应APP中的migrations里面的Python脚本文件删除，再次执行makemigrations和migrate操作即可")])])]),s._v(" "),a("h3",{attrs:{id:"_12-xadmin的安装和使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-xadmin的安装和使用"}},[s._v("#")]),s._v(" 12：xadmin的安装和使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("将xadmin的源码拷贝到extra_apps中，且在各个APP中添加adminx.py文件\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("users APP中的adminx.py文件内容")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import xadmin\nfrom xadmin import views\nfrom .models import VerifyCode\n\n\nclass BaseSetting(object):\n    enable_themes = True\n    use_bootswatch = True\n\n\nclass GlobalSettings(object):\n    site_title = "生鲜后台"\n    site_footer = "mxshop"\n    # menu_style = "accordion"\n\n\nclass VerifyCodeAdmin(object):\n    list_display = [\'code\', \'mobile\', "add_time"]\n\n\nxadmin.site.register(VerifyCode, VerifyCodeAdmin)\nxadmin.site.register(views.BaseAdminView, BaseSetting)\nxadmin.site.register(views.CommAdminView, GlobalSettings)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("ul",[a("li",[s._v("goods APP中的adminx.py文件内容")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import xadmin\nfrom .models import Goods, GoodsCategory, GoodsImage, GoodsCategoryBrand, Banner, HotSearchWords\nfrom .models import IndexAd\n\nclass GoodsAdmin(object):\n    list_display = ["name", "click_num", "sold_num", "fav_num", "goods_num", "market_price",\n                    "shop_price", "goods_brief", "goods_desc", "is_new", "is_hot", "add_time"]\n    search_fields = [\'name\', ]\n    list_editable = ["is_hot", ]\n    list_filter = ["name", "click_num", "sold_num", "fav_num", "goods_num", "market_price",\n                   "shop_price", "is_new", "is_hot", "add_time", "category__name"]\n    style_fields = {"goods_desc": "ueditor"}\n\n    class GoodsImagesInline(object):\n        model = GoodsImage\n        exclude = ["add_time"]\n        extra = 1\n        style = \'tab\'\n\n    inlines = [GoodsImagesInline]\n\n\nclass GoodsCategoryAdmin(object):\n    list_display = ["name", "category_type", "parent_category", "add_time"]\n    list_filter = ["category_type", "parent_category", "name"]\n    search_fields = [\'name\', ]\n\n\nclass GoodsBrandAdmin(object):\n    list_display = ["category", "image", "name", "desc"]\n\n    def get_context(self):\n        context = super(GoodsBrandAdmin, self).get_context()\n        if \'form\' in context:\n            context[\'form\'].fields[\'category\'].queryset = GoodsCategory.objects.filter(category_type=1)\n        return context\n\n\nclass BannerGoodsAdmin(object):\n    list_display = ["goods", "image", "index"]\n\n\nclass HotSearchAdmin(object):\n    list_display = ["keywords", "index", "add_time"]\n\n\nclass IndexAdAdmin(object):\n    list_display = ["category", "goods"]\n\n\nxadmin.site.register(Goods, GoodsAdmin)\nxadmin.site.register(GoodsCategory, GoodsCategoryAdmin)\nxadmin.site.register(Banner, BannerGoodsAdmin)\nxadmin.site.register(GoodsCategoryBrand, GoodsBrandAdmin)\n\nxadmin.site.register(HotSearchWords, HotSearchAdmin)\nxadmin.site.register(IndexAd, IndexAdAdmin)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br")])]),a("ul",[a("li",[s._v("trade APP中的adminx.py文件内容")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import xadmin\nfrom .models import ShoppingCart, OrderInfo, OrderGoods\n\nclass ShoppingCartAdmin(object):\n    list_display = ["user", "goods", "nums", ]\n\n\nclass OrderInfoAdmin(object):\n    list_display = ["user", "order_sn",  "trade_no", "pay_status", "post_script", "order_mount",\n                    "order_mount", "pay_time", "add_time"]\n\n    class OrderGoodsInline(object):\n        model = OrderGoods\n        exclude = [\'add_time\', ]\n        extra = 1\n        style = \'tab\'\n\n    inlines = [OrderGoodsInline, ]\n\n\nxadmin.site.register(ShoppingCart, ShoppingCartAdmin)\nxadmin.site.register(OrderInfo, OrderInfoAdmin)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("ul",[a("li",[s._v("user_operation APP中的adminx.py文件内容")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import xadmin\nfrom .models import UserFav, UserLeavingMessage, UserAddress\n\n\nclass UserFavAdmin(object):\n    list_display = [\'user\', \'goods\', "add_time"]\n\n\nclass UserLeavingMessageAdmin(object):\n    list_display = [\'user\', \'message_type\', "message", "add_time"]\n\n\nclass UserAddressAdmin(object):\n    list_display = ["signer_name", "signer_mobile", "district", "address"]\n\nxadmin.site.register(UserFav, UserFavAdmin)\nxadmin.site.register(UserAddress, UserAddressAdmin)\nxadmin.site.register(UserLeavingMessage, UserLeavingMessageAdmin)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ul",[a("li",[s._v("将xadmin添加到settings文件的INSTALLED_APPS中, 安装xadmin的依赖包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：pip install django-crispy-forms django-reversion  django-formtools future httplib2 six xlwt xlsxwriter\n\n2：将'xadmin'、'crispy_forms'添加到settings文件的INSTALLED_APPS中\n\n3：生成xadmin的数据表，执行makemigrations和migrate\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("在urls.py文件中将xadmin替换admin")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.conf.urls import url\nimport xadmin\n\nurlpatterns = [\n    url(r'^xadmin/', xadmin.site.urls),\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("创建后台超级用户, 运行run manage.py")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('manage.py@Mxshop ### createsuperuser\nbash -cl "/Users/yinhuanyi/.pyenv/versions/Mxshop.3.6.3/bin/python /Applications/PyCharm.app/Contents/helpers/pycharm/django_manage.py createsuperuser /Users/yinhuanyi/Documents/Mxshop"\nTracking file by folder pattern:  migrations\nUsername:  robby\n邮箱:  307443272@qqq.com\nWarning: Password input may be echoed.\nPassword:  yhy3426356\nWarning: Password input may be echoed.\nPassword (again):  yhy3426356\nSuperuser created successfully.\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("修改settings文件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("LANGUAGE_CODE = 'zh-hans'\nTIME_ZONE = 'Asia/Shanghai'\nUSE_I18N = True\nUSE_L10N = True\nUSE_TZ = False\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("配置每一个APP的后台中文显示名称, 例如配置users这个APP的名称中文显示，编辑users的apps文件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class UsersConfig(AppConfig):\n    name = 'users'\n    verbose_name = \"用户管理\"\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("登录xadmin后台管理系统")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1332),alt:"Alt text"}})]),s._v(" "),a("h3",{attrs:{id:"_13-插入测试数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-插入测试数据"}},[s._v("#")]),s._v(" 13：插入测试数据")]),s._v(" "),a("ul",[a("li",[s._v("通常的做法，数据需要基于xadmin插入进去，但是由于数据量太多，因此使用脚本方式直接将数据写入到数据库的表中")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1: 准备图片数据\n在media目录下，准备相关的图片数据，包括goods的图片，包括brands的图片\n\n2：准备数据, 数据放在db_tools的data目录下，使用脚本将数据插入\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("商品类别数据插入脚本import_category_data.py")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#独立使用django的model\nimport sys\nimport os\n\n# 将当前路径加入到Python模块搜索路径中\npwd = os.path.dirname(os.path.realpath(__file__))\nsys.path.append(pwd+"../")\nos.environ.setdefault("DJANGO_SETTINGS_MODULE", "Mxshop.settings")\nimport django\ndjango.setup()\n\n\nfrom goods.models import GoodsCategory\nfrom db_tools.data.category_data import row_data\n\n# 遍历第一层，就是生鲜食品、酒水饮料等\nfor lev1_cat in row_data:\n    lev1_intance = GoodsCategory()\n    lev1_intance.code = lev1_cat["code"]\n    lev1_intance.name = lev1_cat["name"]\n    lev1_intance.category_type = 1\n    lev1_intance.save()\n    # 遍历第二层，就是精品肉类、海鲜水产等\n    for lev2_cat in lev1_cat["sub_categorys"]:\n        lev2_intance = GoodsCategory()\n        lev2_intance.code = lev2_cat["code"]\n        lev2_intance.name = lev2_cat["name"]\n        lev2_intance.category_type = 2\n        lev2_intance.parent_category = lev1_intance\n        lev2_intance.save()\n        # 遍历第三层，就是牛肉、羊肉、猪肉等\n        for lev3_cat in lev2_cat["sub_categorys"]:\n            lev3_intance = GoodsCategory()\n            lev3_intance.code = lev3_cat["code"]\n            lev3_intance.name = lev3_cat["name"]\n            lev3_intance.category_type = 3\n            lev3_intance.parent_category = lev2_intance\n            lev3_intance.save()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("ul",[a("li",[s._v("商品数据插入脚本import_goods_data.py")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import sys\nimport os\n\npwd = os.path.dirname(os.path.realpath(__file__))\nsys.path.append(pwd+"../")\nos.environ.setdefault("DJANGO_SETTINGS_MODULE", "Mxshop.settings")\n\nimport django\ndjango.setup()\n\nfrom goods.models import Goods, GoodsCategory, GoodsImage\nfrom db_tools.data.product_data import row_data\n\nfor goods_detail in row_data:\n    # 先给good这个model填充值\n    goods = Goods()\n    goods.name = goods_detail["name"]\n    goods.market_price = float(int(goods_detail["market_price"].replace("￥", "").replace("元", "")))\n    goods.shop_price = float(int(goods_detail["sale_price"].replace("￥", "").replace("元", "")))\n    goods.goods_brief = goods_detail["desc"] if goods_detail["desc"] is not None else ""\n    goods.goods_desc = goods_detail["goods_desc"] if goods_detail["goods_desc"] is not None else ""\n    goods.goods_front_image = goods_detail["images"][0] if goods_detail["images"] else ""\n\n    category_name = goods_detail["categorys"][-1]\n    category = GoodsCategory.objects.filter(name=category_name)\n    if category:\n        goods.category = category[0]\n    goods.save()\n\n    # 再给商品的图片赋值\n    for goods_image in goods_detail["images"]:\n        goods_image_instance = GoodsImage()\n        goods_image_instance.image = goods_image\n        goods_image_instance.goods = goods\n        goods_image_instance.save()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("h3",{attrs:{id:"_14-添加图片访问路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-添加图片访问路径"}},[s._v("#")]),s._v(" 14：添加图片访问路径")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('1：在settings文件中添加配置图片访问路径\nMEDIA_URL = "/media/"\nMEDIA_ROOT = os.path.join(BASE_DIR, "media")\n\n2：在urls.py文件中，设置以media开头的URL都直接访问MEDIA_ROOT下的文件\nfrom Mxshop.settings import MEDIA_ROOT\nfrom django.views.static import serve\n\nurlpatterns = [\n    url(r\'^xadmin/\', xadmin.site.urls),\n    url(r\'^media/(?P<path>.*)$\', serve, {"document_root": MEDIA_ROOT})\n]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_13-django外键的处理方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-django外键的处理方法"}},[s._v("#")]),s._v(" 13：Django外键的处理方法")]),s._v(" "),a("ul",[a("li",[s._v("数据库在高并发的场景下使用外键约束会有锁问题并且使用外键会增加运维成本，所以很多公司都规定生产环境的数据库禁止使用外键。那么不使用外键约束的情况下使用 Django ORM 如何实现关联查询两个表呢？")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\tDjango的ForeignKey字段类型和数据库的外键并不一样。Django的ForeignKey是一种逻辑上的两个表的关联关系，在设计Model的时候，可以选择是否在数据库中生成外键\n\t在Django中，外键是是建立主表与从表的桥梁，如果一个表属于另外一个表，例如user表属于department表，那么user表中一定会有一个字段，例如dep_id指向department表中的某条记录。因此在设计user Model的时候，dep_id字段应该是这样的\n\tdep_id = models.ForeignKey(Department, null=False, blank=False, verbose_name='所属部门', related_name='user_to_departments', db_constraint=True, on_delete=models.CASCADE)\n\t默认的情况下，ForeignKey()中db_constraint=True, on_delete=models.CASCADE, 这两个参数中db_constraint指定是否在数据库中创建物理外键，on_delete表示是否级联删除，意思是当用户被删除时，如果没有用户属于department表的某条记录的时候，是否这条记录需要被删除\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("因此，如果考虑到不能使用物理外键的情况下，那么在设计ForeignKey时候，可以设置db_constraint=False, on_delete=models.SET_NULL, 这样既可以满足数据表的横向拆分，也可以满足在ORM中使用正向查询和反向查询的语法")])])])}),[],!1,null,null,null);n.default=t.exports}}]);