(window.webpackJsonp=window.webpackJsonp||[]).push([[599],{2658:function(s,n,a){"use strict";a.r(n);var e=a(9),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"一-roles角色-定义服务名详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-roles角色-定义服务名详解"}},[s._v("#")]),s._v(" （一）roles角色 定义服务名详解")]),s._v(" "),a("h3",{attrs:{id:"前言-roles角色定义-通过定义不同的角色-那么在通过ansible-playbook执行一个yaml文件的时候-就可以通过指定不同的主机安装什么角色-这里的角色就是服务-比如haproxy。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言-roles角色定义-通过定义不同的角色-那么在通过ansible-playbook执行一个yaml文件的时候-就可以通过指定不同的主机安装什么角色-这里的角色就是服务-比如haproxy。"}},[s._v("#")]),s._v(" 前言：roles角色定义，通过定义不同的角色，那么在通过ansible-playbook执行一个YAML文件的时候，就可以通过指定不同的主机安装什么角色，这里的角色就是服务，比如haproxy。")]),s._v(" "),a("ul",[a("li",[a("strong",[a("code",[s._v("定义LNMP角色集合")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@ansible-master]# tree -L 1 /etc/ansible/roles/\n/etc/ansible/roles/\n├── mysql\n├── nginx\n└── php-fpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@ansible-master]# tree -L 2 /etc/ansible/roles/\n/etc/ansible/roles/\n├── mysql\n├── nginx\n│   ├── default ：设定默认变量时使用此目录中的main.yml文件\n│   ├── files ：存放由copy或script模块等调用的文件\n│   ├── handlers：至少包含一个名为main.yml的文件，其他的文件需要在此文件中通过include进行包含\n│   ├── meta：至少包含一个名为main.yml的文件，定义当前角色的特殊设定及其依赖关系，其他的文件需要在此文件中通过include进行包含\n│   ├── tasks：至少包含一个名为main.yml的文件，其他的文件需要在此文件中通过include进行包含\n│   ├── templates：template模块查找所需的模板文件目录\n│   └── vars：至少包含一个名为main.yml的文件，其他的文件需要在此文件中通过include进行包含\n└── php-fpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("在playbook调用角色方法")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("hosts：webservers\nremote_user：root\nrolse：\n  -mysql\n  -php-fpm\n  -nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 在playbook调用角色方法2：可以传递变量给角色 ，可以在模板中使用这个变量\nhosts：webservers\nremote_user：root\nrolse：\n  -{ role: nginx, username: nginx }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("使用ansible roles安装nginx")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1： roles的目录结构所示\n[root@7 ansible]# pwd\n/etc/ansible\n[root@7 ansible]# tree\n.\n├── ansible.cfg\n├── hosts\n├── hosts.backup\n└── roles\n    └── nginx\n        ├── default\n        ├── files\n        ├── handlers\n        │   └── main.yml  - name: restart nginx \n                            service: name=nginx state=restarted\n        ├── meta\n        ├── tasks\n        │   └── main.yml  - name: install nginx package\n                            yum: name=nginx state=present \n                          - name: install config file\n                          # 自动回到templates目录下去找\n                            template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf\n                            notify: restart nginx\n                            tags: instconf\n                          - name: start nginx \n                            service: name=nginx state=started enabled=true\n        ├── templates\n        │   └── nginx.conf.j2 \n        └── vars\n            └── main.yml   username: daemon  \n\n2：# 查看nginx.yml文件\n[root@7 ansible]# cat nginx.yml \n- hosts: webservers\n  remote_user: root\n  roles: \n    - nginx\n\n3：ansible-playbook运行nginx.yml文件\nansible-playbook --check nginx.yml\nansible-playbook nginx.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("还可以在调用角色的时候进行条件判断")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# playbook内容部分\n# 指定基于字典的形式调用role，并且向模板传递参数，且进行条件判断，只有在系统版本是7的时候才调用这个role\n- hosts: webservers\n  remote_user: root\n  roles:\n    - { role: nginx, username: nginx, when: \"ansible_distribution_major_version\" == \"7\" }\n\n# 定义两个role都加条件判断\n- hosts: all\n  remote_user: root\n  roles:\n    # 使用系统的发行版本做条件判断\n    - { role: nginx, when: ansible_distribution_major_version == '7' }\n    # 使用主机名做条件判断\n    - { role: php-fpm, when: ansible_hostname == '6' }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);