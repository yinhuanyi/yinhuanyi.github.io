(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{2174:function(s,a,t){"use strict";t.r(a);var n=t(9),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-工程项目结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-工程项目结构"}},[s._v("#")]),s._v(" 一：工程项目结构")]),s._v(" "),n("h3",{attrs:{id:"一-标准化项目工程的布局"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-标准化项目工程的布局"}},[s._v("#")]),s._v(" (一) 标准化项目工程的布局")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("每个应用程序的目录名应该与你需要的可执行文件的名称匹配，例如"),n("code",[s._v("/cmd/myapp")]),s._v("，myapp就是可执行文件名称")])]),s._v(" "),n("li",[n("p",[s._v("不要在/cmd/myapp目录中放置太多代码，如果你认为代码可以导入并且在其他项目中使用，"),n("code",[s._v("那么应该将代码放在/pkg目录")]),s._v("下，如果代码不是可重用，或者不希望其他人重用，"),n("code",[s._v("应该放在/internal目录下")])])])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- internal\n  - demo  // 项目\n\t  - biz\n\t  - data\n\t  - service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("单个应用程序代码可以放在 /internal/app/目录下，"),n("code",[s._v("例如/internal/app/myapp")]),s._v("。myapp1、myapp2应用程序共享的代码可以放在 /internal/pkg/目录下，"),n("code",[s._v("例如 /internal/pkg/myprivlib")]),s._v("。例如账号服务，内部有多个子应用，那么就可以如下划分")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- internal\n\t- app // 存放单个应用\n\t\t- myapp1\n\t\t- myapp1\n\t\t- myapp3\n\t- pkg：// 存放业务工具代码和库代码\n\t\t- lib1\n\t\t- lib2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("标准的Golang项目工程划分")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- docs：存放文档\n- example：存放示例\n- mics：插件\n- pkg：需要被外部导入的包\n- third_part：第三方包\n- tool：工具\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"二-框架项目划分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-框架项目划分"}},[s._v("#")]),s._v(" (二) 框架项目划分")]),s._v(" "),n("ul",[n("li",[s._v("从代码管理角度，统一标准库，尽可能复用代码，解决代码的bug")])]),s._v(" "),n("h3",{attrs:{id:"三-单个微服务项目划分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-单个微服务项目划分"}},[s._v("#")]),s._v(" (三) 单个微服务项目划分")]),s._v(" "),n("ul",[n("li",[s._v("单个微服务可能是某个业务中的一个应用，例如账户管理后台业务")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("README")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("md\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" api ：存放proto文件\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" cmd： \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" config：配置文件\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mod\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sum\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" internal\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" test：测试数据，测试用例\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("代码的管理，例如一个账户服务，可以将所有的子应用都放在一起，内部建立一个group，区分不同的实际业务")])]),s._v(" "),n("h3",{attrs:{id:"三-微服务中app划分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-微服务中app划分"}},[s._v("#")]),s._v(" (三) 微服务中app划分")]),s._v(" "),n("ul",[n("li",[s._v("微服务中，一个app可以分为四类：interface、service、job、admin")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 对外的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BFF")]),s._v(" 服务，接受来自用户的请求，比如暴露了 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gRPC 接口\n\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 对内的微服务，仅接受来自内部其他服务或者网关的请求，比如暴露了gRPC 接口只对内服务\n\nadmin：区别于 service，更多是面向运营管理的服务，通常数据权限更高，隔离带来更好的代码级别安全\n\njob"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 流式任务处理的服务，上游一般依赖 message broker\n\ntask"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 定时任务，类似 cronjob，部署到 task 托管平台中\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("那么在这个app的cmd目录中，目录结构应该如下划分。cmd下的应用，主要代码就是启动、关闭、初始化等工作，目录划分如下")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" cmd\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" myapp1\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v("：bff层应用\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" admin：管理后台\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" service：gRPC内部服务\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" job：处理流式业务\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" task：处理任务\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("单个业务布局如下")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("README")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("md\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" api：存放proto文件\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" cmd\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" myapp1\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v("：bff层应用\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" admin：管理后台\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" service：gRPC内部服务\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" job：处理流式业务\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" task：处理任务\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" myapp2\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" config\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mod\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sum\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" internal\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" myapp1\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" service：实现了 api 定义的服务层\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" biz：业务逻辑层\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" data：业务数据访问，包含 cache、db 等封装\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" pkg：内部可以调用的包，例如密码的加解密等\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[n("img",{attrs:{src:t(681),alt:"Alt text"}})]),s._v(" "),n("h2",{attrs:{id:"二-api设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-api设计"}},[s._v("#")]),s._v(" 二：API设计")]),s._v(" "),n("h3",{attrs:{id:"一-api目录划分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-api目录划分"}},[s._v("#")]),s._v(" (一) api目录划分")]),s._v(" "),n("ul",[n("li",[s._v("api目录定义proto文件")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" api\n\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" user\n\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" v1\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" crud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("proto\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" sync"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("proto\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("proto文件的包名一般为：my.package.v1，是为 api 目录的子目录，定义service相关接口，用于提供业务使用")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(682),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("proto文件中，类型字段的默认值为零值，比如 0 或者 “”")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(683),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("FieldMask 部分更新的方案，空 FieldMask 默认应用到 “所有字段”")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(684),alt:"Alt text"}})]),s._v(" "),n("h2",{attrs:{id:"三-配置管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-配置管理"}},[s._v("#")]),s._v(" 三：配置管理")]),s._v(" "),n("h3",{attrs:{id:"一-配置管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-配置管理"}},[s._v("#")]),s._v(" (一) 配置管理")]),s._v(" "),n("ul",[n("li",[s._v("环境变量")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Region、Zone、Cluster、Environment、Color、Discovery、AppID、Host，等之类的环境信息，都是通过k8s管理平台打入到容器或者物理机，供应用读取到，然后使用\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("静态配置")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("资源需要初始化的配置信息，比如 http/gRPC server、redis、mysql 等，这类资源在线变更配置的风险非常大，变更静态配置和发布 bianry app 没有区别，应该走一次迭代发布的流程\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("动态配置")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("应用程序可能需要一些在线的开关，来控制业务的一些简单策略，会频繁的调整和使用，我们把这类是基础类型")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("int"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bool"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("等配置，用于可以动态变更业务流的收归一起\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("全局配置")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("通常，依赖的各类组件、中间件都有大量的默认配置或者指定配置，在各个项目里大量拷贝复制，容易出现意外，所以我们使用全局配置模板来定制化常用的组件，然后再特化的应用里进行局部替换\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"四-包管理和单元测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-包管理和单元测试"}},[s._v("#")]),s._v(" 四：包管理和单元测试")]),s._v(" "),n("h3",{attrs:{id:"一-包管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-包管理"}},[s._v("#")]),s._v(" (一) 包管理")]),s._v(" "),n("ul",[n("li")]),s._v(" "),n("h3",{attrs:{id:"二-单元测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-单元测试"}},[s._v("#")]),s._v(" (二) 单元测试")]),s._v(" "),n("ul",[n("li")])])}),[],!1,null,null,null);a.default=r.exports},681:function(s,a,t){s.exports=t.p+"assets/img/2022-01-0617.17.51.24e00f12.png"},682:function(s,a,t){s.exports=t.p+"assets/img/1641466181734.200a5caf.png"},683:function(s,a,t){s.exports=t.p+"assets/img/1641466285063.b3d67ae6.png"},684:function(s,a,t){s.exports=t.p+"assets/img/1641466579519.c4b04970.png"}}]);