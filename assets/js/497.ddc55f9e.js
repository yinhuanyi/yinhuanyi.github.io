(window.webpackJsonp=window.webpackJsonp||[]).push([[497],{2467:function(s,a,n){"use strict";n.r(a);var e=n(9),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"_1-python的gil全局解释器锁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-python的gil全局解释器锁"}},[s._v("#")]),s._v(" 1：Python的GIL全局解释器锁")]),s._v(" "),n("h3",{attrs:{id:"一-介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-介绍"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 介绍")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：Python中一个线程对应于C语言中一个线程\n2：gil使得同一个时刻，只有一个线程在CPU上执行字节码, 无法将多个线程运行在多个CPU上\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"_2-python的多线程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-python的多线程"}},[s._v("#")]),s._v(" 2：Python的多线程")]),s._v(" "),n("h3",{attrs:{id:"一-线程设置为daemon的意义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-线程设置为daemon的意义"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 线程设置为Daemon的意义")])]),s._v(" "),n("ul",[n("li",[s._v("线程为Daemon线程意义在于：主线程退出时，也会kill掉子线程，默认情况下，子线程为非Daemon线程，子线程不退出，主线程也不会退出，等子线程退出，主线程才会退出")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import time\nfrom threading import Thread\nimport threading\n\ndef sayhello():\n    print('sayhello')\n    time.sleep(2)\n    print('hello')\n\ndef saynihao():\n    print('saynihao')\n    time.sleep(4)\n    print(threading.enumerate())\n    print('你好')\n\nthread1 = Thread(target=sayhello, )\nthread2 = Thread(target=saynihao, )\n\nthread1.setDaemon(True)\nthread2.setDaemon(True)\n\nthread1.start()\nthread2.start()\n\nprint('End')\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h3",{attrs:{id:"二-线程设置为join的意义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-线程设置为join的意义"}},[s._v("#")]),s._v(" "),n("code",[s._v("(二) 线程设置为join的意义")])]),s._v(" "),n("ul",[n("li",[s._v("线程join的意义在于：当子线程执行完毕后，主线程才能向下执行")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("thread1.start()\nthread2.start()\n\nthread1.join()\nthread2.join()\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"三-线程的第二种写法-用的较多"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-线程的第二种写法-用的较多"}},[s._v("#")]),s._v(" "),n("code",[s._v("(三) 线程的第二种写法（用的较多）")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import time\nfrom threading import Thread\nimport threading\n\nclass MyThread(Thread):\n    def __init__(self, name):\n        super().__init__(name=name)\n        self.setDaemon(True)\n\n    def run(self):\n        time.sleep(2)\n        print(\"我是线程\")\n\nthread1 = MyThread('thread1')\nthread2 = MyThread('thread2')\n\nthread1.start()\nthread2.start()\n\nprint(\"End\")\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"_3-python的多线程之间的通信"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-python的多线程之间的通信"}},[s._v("#")]),s._v(" 3：Python的多线程之间的通信")]),s._v(" "),n("h3",{attrs:{id:"一-queue队列"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-queue队列"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) Queue队列")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("from threading import Thread\nfrom queue import Queue\n\ndef add_something(my_queue: Queue):\n\n    for i in range(1000):\n        my_queue.put(i)\n\ndef get_something1(my_queue: Queue):\n    while True:\n        item = my_queue.get()\n        print(item)\n\ndef get_something2(my_queue: Queue):\n    while True:\n        item = my_queue.get()\n        print(item)\n\nif __name__ == '__main__':\n    my_queue = Queue(maxsize=10000)\n    # my_queue = list()\n    Thread(target=add_something, args=(my_queue, )).start()\n    Thread(target=get_something1, args=(my_queue, )).start()\n    Thread(target=get_something2, args=(my_queue,)).start()\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h2",{attrs:{id:"_4-python的多线程之间的同步-lock"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-python的多线程之间的同步-lock"}},[s._v("#")]),s._v(" 4：Python的多线程之间的同步 Lock")]),s._v(" "),n("h3",{attrs:{id:"一-多线程操作同一个变量所产生的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-多线程操作同一个变量所产生的问题"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) 多线程操作同一个变量所产生的问题")])]),s._v(" "),n("ul",[n("li",[s._v("线程同步就是解决多线程场景下，多个线程操作同一个变量的问题，例如下面这两个函数，同时对a变量做加减。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("from threading import Thread\n\ndef add(a):\n    a += 1\n\ndef desc(a):\n    a -= 1\n\nif __name__ == '__main__':\n    a = 0\n    Thread(target=add, args=(a, )).start()\n    Thread(target=desc, args=(a, )).start()\n    # a输出结果为-1\n    print(a)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("ul",[n("li",[s._v("解析(可以使用dist.dist(add)分析函数的字节码执行过程)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("在两个线程函数对a变量做加减的时候，Python解释器执行过程如下\n\t\n1：对于add函数\n\tload a\n\tload 1\n\texec a+1\n\t赋值  a = a\n\n2：对于desc函数\n\tload a\n\tload 1\n\texec a-1\n\t赋值  a = a\n\t\n这两个线程函数在执行赋值的时候，CPU会进行线程切换，可以是add函数先赋值，desc函数后赋值，那么，a的最终结果将会是desc函数赋值后的结果，a就会是-1。如果这个结果说明不了问题，可以对a变量进行1000次操作\n\n结论：哪个函数最后赋值，那么就会决定a变量的最终结果，无论哪个函数最后赋值，a也不可能对于0，因此使得数据计算错误\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"二-lock锁机制解决多线程同步问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-lock锁机制解决多线程同步问题"}},[s._v("#")]),s._v(" "),n("code",[s._v("(二) Lock锁机制解决多线程同步问题")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("from threading import Thread, Lock\n\nlock = Lock()\n\ndef add(a):\n    global lock\n    lock.acquire()\n    a += 1\n    lock.release()\n\ndef desc(a):\n    lock.acquire()\n    a -= 1\n    lock.release()\n\n\nif __name__ == '__main__':\n    a = 0\n    Thread(target=add, args=(a, )).start()\n    Thread(target=desc, args=(a, )).start()\n    print(a)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("ul",[n("li",[s._v("加锁带来的问题")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：在lock.acquire()获取锁，和lock.release()释放锁的过程中都会降低CPU执行的速度，影响程序执行的过程\n\n2：锁如果用的不好，会造成死锁\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"_5-python的多线程之间的同步-condition"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-python的多线程之间的同步-condition"}},[s._v("#")]),s._v(" 5：Python的多线程之间的同步 Condition")]),s._v(" "),n("h3",{attrs:{id:"一-condition条件变量用于复杂的线程同步"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-condition条件变量用于复杂的线程同步"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) Condition条件变量用于复杂的线程同步")])])])}),[],!1,null,null,null);a.default=t.exports}}]);