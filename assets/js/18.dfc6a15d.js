(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1709:function(s,t,e){s.exports=e.p+"assets/img/2020-06-1510.35.58.e9bfb25c.png"},1710:function(s,t,e){s.exports=e.p+"assets/img/2020-06-1511.32.01.c2ffe664.png"},1711:function(s,t,e){s.exports=e.p+"assets/img/2020-06-1511.33.26.6483d619.png"},1712:function(s,t,e){s.exports=e.p+"assets/img/2020-06-1511.36.09.7928b993.png"},1713:function(s,t,e){s.exports=e.p+"assets/img/2020-06-151.51.14.089d5c87.png"},1714:function(s,t,e){s.exports=e.p+"assets/img/2020-06-151.56.58.c38a30f9.png"},1715:function(s,t,e){s.exports=e.p+"assets/img/2020-06-152.07.17.30c43221.png"},1716:function(s,t,e){s.exports=e.p+"assets/img/2020-06-152.26.47.8e01bc06.png"},1717:function(s,t,e){s.exports=e.p+"assets/img/2020-06-152.28.45.8e923ab0.png"},1718:function(s,t,e){s.exports=e.p+"assets/img/2020-06-152.35.15.1661fdaa.png"},1719:function(s,t,e){s.exports=e.p+"assets/img/2020-06-152.38.16.77d66137.png"},1720:function(s,t,e){s.exports=e.p+"assets/img/2020-06-154.34.45.8476304b.png"},1721:function(s,t,e){s.exports=e.p+"assets/img/2020-06-154.35.33.48e1fa46.png"},1722:function(s,t,e){s.exports=e.p+"assets/img/2020-06-154.36.22.d3f70c4c.png"},1723:function(s,t,e){s.exports=e.p+"assets/img/2020-06-154.43.57.375ca803.png"},1724:function(s,t,e){s.exports=e.p+"assets/img/2020-06-155.15.25.fac92944.png"},1725:function(s,t,e){s.exports=e.p+"assets/img/2020-06-155.19.30.08b9647c.png"},2672:function(s,t,e){"use strict";e.r(t);var a=e(9),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"一-jenkins搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-jenkins搭建"}},[s._v("#")]),s._v(" 一：Jenkins搭建")]),s._v(" "),a("h3",{attrs:{id:"一-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-安装"}},[s._v("#")]),s._v(" (一)：安装")]),s._v(" "),a("ul",[a("li",[s._v("0：安装JDK")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apt install openjdk-8*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("1："),a("a",{attrs:{href:"https://pkg.jenkins.io/debian-stable/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu系统下载deb安装包"),a("OutboundLink")],1)])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -\n\ndeb https://pkg.jenkins.io/debian-stable binary/\n\nsudo apt-get update\n\nsudo apt-get install jenkins\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("2：启动Jenkins, Jenkins监听在8080端口")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl start jenkins\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("3：修改依赖的源")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# apt 安装的Jenkins家目录默认是/var/lib/jenkins/\ncd /var/lib/jenkins/updates\ncp default.json default.json.back\nsed -i 's/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g' default.json && sed -i 's/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g' default.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("4：重启Jenkins服务器")])]),s._v(" "),a("li",[a("p",[s._v("5：选择Jenkins安装的插件")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：Folders\n2：Build Timeout\n3：Credentials Binding\n4：Timestamper\n5：Workspace Cleanup\n6：Pipeline\n7：Pipeline: Stage View\n8：Conditional BuildStep\n9：Git\n10：Git Parameter\n11：Localization: Chinese (Simplified)\n12：Role-based Authorization Strategy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[s._v("6：使用NGINX反向代理Jenkins")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("upstream jenkins {\n        server localhost:8080 weight=1 max_fails=3  fail_timeout=60;\n}\n\n\nserver {\n        listen 80;\n        server_name 192.168.100.220;\n        charset utf-8;\n        client_body_buffer_size 10M;\n        location / {\n            proxy_pass http://jenkins/;\n            proxy_redirect     default;\n            proxy_http_version 1.1;\n            proxy_set_header   Host  $host:$server_port;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h3",{attrs:{id:"二-给用户分配全局只读权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-给用户分配全局只读权限"}},[s._v("#")]),s._v(" (二)：给用户分配全局只读权限")]),s._v(" "),a("ul",[a("li",[s._v("必须要安装"),a("code",[s._v("Role-based Authorization Strategy")]),s._v("插件，在全局安全配置中选择 "),a("code",[s._v("Role-Based Strategy")]),s._v("的授权策略")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1709),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("此时会出现"),a("code",[s._v("Manage and Assign Roles")]),s._v("的配置")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1710),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("新建用户: 在系统管理->用户管理中新建用户")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1711),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("例如新建了一个"),a("code",[s._v("chl")]),s._v("用户， 此时"),a("code",[s._v("chl")]),s._v("登录之后，没有任何权限")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1712),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("需要给用户授权，在"),a("code",[s._v("Manage and Assign Roles")]),s._v("中，选择"),a("code",[s._v("Manage Roles")]),s._v("(默认有一个admin角色，admin角色是具有"),a("code",[s._v("所有权限")]),s._v("，再创建一个global read角色，给这个global read角色赋予所有的"),a("code",[s._v("读权限")]),s._v(")")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1713),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("给chl用户绑定"),a("code",[s._v("global read")]),s._v("角色，那么此时chl用户就具有"),a("code",[s._v("读权限")]),s._v("了")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1714),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("使用chl用户再次登录，那么此时就具备读权限了")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1715),alt:"Alt text"}})]),s._v(" "),a("h3",{attrs:{id:"三-给用户分配某个项目的权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-给用户分配某个项目的权限"}},[s._v("#")]),s._v(" (三)：给用户分配某个项目的权限")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("新建一个"),a("code",[s._v("lgq")]),s._v("用户，让这个用户只能执行"),a("code",[s._v("Basic")]),s._v("视图下的job")])]),s._v(" "),a("li",[a("p",[s._v("首先需要创建一个Global roles, 就取名为"),a("code",[s._v("read")]),s._v(", 这个"),a("code",[s._v("read")]),s._v("角色只有"),a("code",[s._v("Read")]),s._v("权限")])])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1716),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("再创建一个 "),a("code",[s._v("Item roles")]),s._v("角色，取名为"),a("code",[s._v("basic read")]),s._v("，正则匹配的job名称为"),a("code",[s._v('"west-basic.*"')]),s._v("，那么所有jenkins的job中，只要匹配到了这个正则表达式的job，这个"),a("code",[s._v("basic read")]),s._v("角色都能够看到这些job，权限截图如下：")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1717),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("在Assign Roles中，给lgq这个用户分配两个角色，"),a("code",[s._v("read")]),s._v("和"),a("code",[s._v("basic read")])])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1718),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("使用lgq用户登录，只可以看到basic的任务了")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1719),alt:"Alt text"}})]),s._v(" "),a("h3",{attrs:{id:"二-jenkins任务构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-jenkins任务构建"}},[s._v("#")]),s._v(" 二：Jenkins任务构建")]),s._v(" "),a("h3",{attrs:{id:"一-配置一个jenkins-job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-配置一个jenkins-job"}},[s._v("#")]),s._v(" (一)：配置一个jenkins job")]),s._v(" "),a("ul",[a("li",[s._v("General部分：描述")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1720),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("General部分：丢弃旧的构建")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1721),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("General部分：参数化构建过程")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1722),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("源码管理部分：Git配置")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1723),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("源码管理部分：如果当前系统没有配置秘钥的话，需要先添加认证秘钥(私钥和公钥需要在主机上通过ssh-keygen创建，然后将公钥放在gitlab上，这样Jenkins才能从gitlab clone仓库代码)")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1724),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("构建部分：命令，这里就是执行Jenkins本地的脚本")])]),s._v(" "),a("p",[a("img",{attrs:{src:e(1725),alt:"Alt text"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);