(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{1738:function(t,e,a){t.exports=a.p+"assets/img/2019-09-053.50.46.4277d1e3.png"},1739:function(t,e,a){t.exports=a.p+"assets/img/2019-09-053.53.50.17251b7e.png"},1740:function(t,e,a){t.exports=a.p+"assets/img/2019-09-053.56.34.05b83351.png"},1741:function(t,e,a){t.exports=a.p+"assets/img/2019-09-054.31.22.67971874.png"},2686:function(t,e,a){"use strict";a.r(e);var s=a(9),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"一-pushgateway介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-pushgateway介绍"}},[t._v("#")]),t._v(" 一：pushgateway介绍")]),t._v(" "),s("ul",[s("li",[t._v("启动prometheus、node_exporter、pushgateway")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('1：cd /opt/modules/prometheus-2.12.0.linux-amd64 && nohup prometheus --config.file prometheus.yml &\n\n2: nohup node_exporter --collector.textfile.directory="/opt/modules/node_exporter-0.18.1.linux-amd64/textfile_collector" --collector.systemd --collector.systemd.unit-whitelist="(docker|ssh|mariadb).service" --web.listen-address=":9100"  --web.telemetry-path="/metrics"   --log.level="info"  --log.format="logger:stderr"  &\n\n3: nohup pushgateway &\n\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h3",{attrs:{id:"一-介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-介绍"}},[t._v("#")]),t._v(" (一)介绍")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("将prometheus作为grafana的数据源，这里主要是定义变量\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("这里使用一个第三方的node_exporter dashboard")])]),t._v(" "),s("h3",{attrs:{id:"二-变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-变量"}},[t._v("#")]),t._v(" (二)变量")]),t._v(" "),s("ul",[s("li",[t._v("所有的变量都是捆绑在dashboard中,  grafana的变量有5中类型")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Interval : 一般设置时间\nQuery ： 设置查询，用的最多\nDatasource\nCustom ：还可以自定义变量\nConstant\nAd hoc filters\nText box\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("h3",{attrs:{id:"三-设置interval变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三-设置interval变量"}},[t._v("#")]),t._v(" (三)设置interval变量")]),t._v(" "),s("p",[s("img",{attrs:{src:a(1738),alt:"Alt text"}})]),t._v(" "),s("h3",{attrs:{id:"四-设置query变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四-设置query变量"}},[t._v("#")]),t._v(" (四)设置query变量")]),t._v(" "),s("ul",[s("li",[t._v("如果数据源是influxdb，那么一般是将tag值设置为变量")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# 在grafana上，可以基于某个tag的名称，获取所有的tag值，这样就可以在grafana上展示为多个图了\nSHOW TAG VALUES FROM "measurement_name" WITH KEY = "tag_key"\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("ul",[s("li",[t._v("如果数据源是prometheus，那么一般有4中方式设置变量")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("查询方法")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("label_values(instance)")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("返回label每个指标中的标签值列表")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("label_values(node_exporter_build_info,instance)")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("返回label指定metrics中的标签值列表")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("metrics(mem)")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("返回正则表达式匹配的metric列表")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("query_result(topk(1,sort_desc (max(node_filesystem_size_bytes{instance=~'$node',fstype=~\"xfs\"}) by (mountpoint))))")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("返回一个Prometheus查询结果列表")])])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(1739),alt:"Alt text"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(1740),alt:"Alt text"}})]),t._v(" "),s("h3",{attrs:{id:"五-grafana上dashboard的绘制是基于pql的-需要查询数据计算"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五-grafana上dashboard的绘制是基于pql的-需要查询数据计算"}},[t._v("#")]),t._v(" (五)grafana上dashboard的绘制是基于PQL的，需要查询数据计算")]),t._v(" "),s("p",[s("img",{attrs:{src:a(1741),alt:"Alt text"}})])])}),[],!1,null,null,null);e.default=r.exports}}]);