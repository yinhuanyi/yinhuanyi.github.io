(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{1654:function(s,a,t){s.exports=t.p+"assets/img/2021-01-0311.02.56.9f66bf71.png"},1655:function(s,a,t){s.exports=t.p+"assets/img/2021-01-0311.46.59.bafc7e33.png"},2624:function(s,a,t){"use strict";t.r(a);var r=t(9),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h2",{attrs:{id:"一-数据冷备份"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-数据冷备份"}},[s._v("#")]),s._v(" 一：数据冷备份")]),s._v(" "),r("h3",{attrs:{id:"一-数据目录中数据库目录文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-数据目录中数据库目录文件"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) 数据目录中数据库目录文件")])]),s._v(" "),r("ul",[r("li",[s._v("OPT文件，只有一个，是数据库描述文件。用来记录库的字符集、排序规则")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("例如：db"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("opt\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("FRM文件，数据表的描述文件，记录了数据表的结构信息，")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("例如：t_customer"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frm\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("数据文件：不同的数据库引擎的数据文件不一样")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：MyIsam存储引擎\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MYD")]),s._v("文件：数据文件\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MYI")]),s._v("文件：索引文件\n\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("："),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INNODB")]),s._v("存储引擎\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IBD")]),s._v("文件：数据文件\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h3",{attrs:{id:"二-数据目录中其他文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-数据目录中其他文件"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) 数据目录中其他文件")])]),s._v(" "),r("ul",[r("li",[r("p",[s._v("auto.cnf文件：存储MySQL数据库的UUID")])]),s._v(" "),r("li",[r("p",[s._v("grastate.dat文件：存储主节点同步信息")])]),s._v(" "),r("li",[r("p",[s._v("gvwstate.dat文件：存储PXC集群节点信息")])]),s._v(" "),r("li",[r("p",[s._v("ib_buffer_pool：INNODB缓冲文件")])]),s._v(" "),r("li",[r("p",[s._v("ib_logfile：INNODB事务日志(redo)")])]),s._v(" "),r("li",[r("p",[s._v("logbin：日志文件")])]),s._v(" "),r("li",[r("p",[s._v("index：日志索引文件")])]),s._v(" "),r("li",[r("p",[s._v("ibtmp： 临时表空间文件")])])]),s._v(" "),r("h3",{attrs:{id:"三-数据文件中的碎片"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三-数据文件中的碎片"}},[s._v("#")]),s._v(" "),r("code",[s._v("(三) 数据文件中的碎片")])]),s._v(" "),r("ul",[r("li",[r("p",[s._v("向数据表写入数据，数据文件的体积会增大，但是删除文件，数据体积不会减小，那么留下的空白就是"),r("code",[s._v("碎片")])])]),s._v(" "),r("li",[r("p",[s._v("对表的碎片整理的操作如下")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("alter table user engine"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("innodb"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("做碎片整理的时候，需要关闭binlog日志, 也就是注释掉，不让整理操作纪律到binlog中")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("#log_bin\n#log_slave_updates\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"四-对pxc数据库的碎片整理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四-对pxc数据库的碎片整理"}},[s._v("#")]),s._v(" "),r("code",[s._v("(四) 对PXC数据库的碎片整理")])]),s._v(" "),r("ul",[r("li",[s._v("先停止掉当前数据库")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("systemctl stop mysql\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[r("p",[s._v("编辑/etc/my.cnf文件，注释掉PXC集群的修改配置参数")])]),s._v(" "),r("li",[r("p",[s._v("重启数据库")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("systemctl start mysql\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("基于编程语言，对表进行遍历，然后执行")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("alter table 名名称 engine"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("innodb"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("再基于tar命令打包/var/lib/mysql目录下的所有文件，如果有分区，也需要打包")])]),s._v(" "),r("h2",{attrs:{id:"二-数据热备份"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-数据热备份"}},[s._v("#")]),s._v(" 二：数据热备份")]),s._v(" "),r("h3",{attrs:{id:"一-xtrabackup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-xtrabackup"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) XtraBackup")])]),s._v(" "),r("ul",[r("li",[s._v("介绍")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("XtraBackup是一种物理备份工具，通过协议连接到MySQL，然后复制底层文件，完成物理备份\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("优势")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：备份过程加读锁，数据可读，但是不可写\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：备份过程不会打断正在执行的事务\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：节约磁盘空间\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("ul",[r("li",[s._v("支持")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("对"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INNODB")]),s._v("引擎支持全量、增量备份\n对"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MYISAM")]),s._v("引擎支持全量备份\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"二-xtrabackup安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-xtrabackup安装"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) XtraBackup安装")])]),s._v(" "),r("ul",[r("li",[s._v("下载repo")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("yum install https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repo"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latest"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("noarch"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rpm\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("安装")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("yum install percona"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xtrabackup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"三-xtrabackup全量热备份使用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三-xtrabackup全量热备份使用"}},[s._v("#")]),s._v(" "),r("code",[s._v("(三) XtraBackup全量热备份使用")])]),s._v(" "),r("ul",[r("li",[s._v("命令介绍")])]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",{staticStyle:{"text-align":"center"}},[s._v("命令")]),s._v(" "),r("th",{staticStyle:{"text-align":"center"}},[s._v("描述")])])]),s._v(" "),r("tbody",[r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("xbcrypt")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("用于加密或解密备份数据")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("xbstream")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("用于压缩或者解压缩xbstream文件")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("xtrabackup")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("备份InnoDB数据表")])]),s._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"center"}},[s._v("innobackupex")]),s._v(" "),r("td",{staticStyle:{"text-align":"center"}},[s._v("是上面三种命令的perl脚本封装")])])])]),s._v(" "),r("ul",[r("li",[s._v("对数据库进行全量备份")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("innobackupex "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("defaults"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("etc")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-flags"}},[s._v("my")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("host"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".231")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup\n\n\n# 会在"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup生成一个时间目录\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ll backup\ntotal "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ndrwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("264")]),s._v(" Jan  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\ndrwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("264")]),s._v(" Jan  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("ul",[r("li",[s._v("对数据库进行流式全量备份")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("innobackupex "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("defaults"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("etc")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-flags"}},[s._v("my")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("host"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".231")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("no"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timestamp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("stream"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xbstream  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("### "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xbstream\n\n# 会生成一个backup"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xbstream文件\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("ul",[r("li",[s._v("基于xtrabackup备份的目录还原到PXC集群节点中")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：停止mysql\nsystemctl stop mysql\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：删除数据目录\nrm "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fr "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n\n# 3：删除分区目录\nrm -fr /mnt/p0/data/*\nrm -fr /mnt/p1/data/*\n\n# 4：清理备份目录的事务\ninnobackupex --apply-log --redo-only /root/backup/2021-01-03_20-18-45\n\n# 5：还原\ninnobackupex --defaults-file=/etc/my.cnf --copy-back /root/backup/2021-01-03_20-18-45\n\n# 6：授权\nchown -R mysql.mysql /var/lib/mysql\nchown -R mysql.mysql /mnt/p0/data/\nchown -R mysql.mysql /mnt/p1/data/\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("ul",[r("li",[s._v("基于xtrabackup备份的流式文件还原到PXC集群节点中")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("创建临时文件\nmkdir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("流式文件解压\nxbstream "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xbstream "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("C")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：停止mysql\nsystemctl stop mysql\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：删除数据目录\nrm "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fr "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n\n# 5：删除分区目录\nrm -fr /mnt/p0/data/*\nrm -fr /mnt/p1/data/*\n\n# 6：清理备份目录的事务\ninnobackupex --apply-log --redo-only /root/backup/2021-01-03_20-18-45\n\n# 7：还原\ninnobackupex --defaults-file=/etc/my.cnf --copy-back  /root/tmp\n\n# 8：授权\nchown -R mysql.mysql /var/lib/mysql\nchown -R mysql.mysql /mnt/p0/data/\nchown -R mysql.mysql /mnt/p1/data/\n\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br")])]),r("h3",{attrs:{id:"四-xtrabackup增量热备份使用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四-xtrabackup增量热备份使用"}},[s._v("#")]),s._v(" "),r("code",[s._v("(四) XtraBackup增量热备份使用")])]),s._v(" "),r("ul",[r("li",[s._v("基本原理")])]),s._v(" "),r("p",[r("img",{attrs:{src:t(1654),alt:"Alt text"}})]),s._v(" "),r("ul",[r("li",[s._v("基于全量备份的增量备份操作")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("innobackupex "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("defaults"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("etc")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-flags"}},[s._v("my")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("host"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".231")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("incremental"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("basedir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("incremental "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("increment\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("那么在/root/backup/increment就可以看到增量备份的数据")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("increment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"五-xtrabackup全量热备份-增量热备份还原"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#五-xtrabackup全量热备份-增量热备份还原"}},[s._v("#")]),s._v(" "),r("code",[s._v("(五) XtraBackup全量热备份+增量热备份还原")])]),s._v(" "),r("ul",[r("li",[s._v("备份还原步骤")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：整理全量备份的事务，"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("redo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only是跳过回滚事务\ninnobackupex "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("apply"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("redo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：整理第"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("个增量备份的事务，"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("redo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only是跳过回滚事务，增量备份"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("的数据就会同步到全量备份中\ninnobackupex "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("apply"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("redo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("incremental"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("increment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：整理第"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("个增量备份的事务， 这里没有加"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("redo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("only，是因为最后一个增量备份，直接回滚没有执行的事务即可，增量备份"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("的数据就会同步到全量备份\ninnobackupex "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("apply"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("incremental"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("increment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：还原全量备份目录\n# 在新的"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PXC")]),s._v("节点还原数据\ninnobackupex "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("defaults"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("copy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("back "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("03_20")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 授权\nchown "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("R")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mysql "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\nchown "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("R")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mysql "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mnt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("p0"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\nchown "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("R")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mysql "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mnt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("p1"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br")])]),r("h2",{attrs:{id:"三-误删除数据恢复方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三-误删除数据恢复方案"}},[s._v("#")]),s._v(" 三：误删除数据恢复方案")]),s._v(" "),r("h3",{attrs:{id:"一-在pxc节点中选择一个节点-让其成为另外一个mysql数据库的master节点-并且设置主从同步延时"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一-在pxc节点中选择一个节点-让其成为另外一个mysql数据库的master节点-并且设置主从同步延时"}},[s._v("#")]),s._v(" "),r("code",[s._v("(一) 在PXC节点中选择一个节点，让其成为另外一个MySQL数据库的master节点，并且设置主从同步延时")])]),s._v(" "),r("ul",[r("li",[s._v("例如下面这种模型")])]),s._v(" "),r("p",[r("img",{attrs:{src:t(1655),alt:"Alt text"}})]),s._v(" "),r("ul",[r("li",[s._v("设置主从同步延时找回数据，需要设置GTID")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# 在master节点的"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf文件中"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("加上\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ngtid_mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v("\nenforce_gtid_consistency"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n# 在slave节点的"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf文件中加上\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ngtid_mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v("\nenforce_gtid_consistency"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nrelay_log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("relay_bin\n\n\n# 在slave节点上操作启动同步\nstop slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nchange master to master_host"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nstart slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nshow slave status"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n# 在slave节点上启动延时"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 延时为"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("小时\nstop slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nchange master to master_delay"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nstart slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nshow slave status"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br")])]),r("ul",[r("li",[s._v("如果此时出现了误删除操作，那么master节点查看一下是哪个二进制日志，且是哪个gtid")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# 获取最后binlog二进制日志名称\nmysql### show master logs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n# 基于binlog二级制日志名称操作误删除的gtid，找到哪个gtid为："),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("293872034")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("238234")]),s._v("sjfh"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\nmysql### show binlog events "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node1-bin.000015"')]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("ul",[r("li",[s._v("在slave节点跳过这个gtid")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("stop slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" gtid_next"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'293872034-238234sjfh-23'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nbegin"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("commit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" gtid_next"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'automatic'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nchange master to master_delay"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nstart slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("ul",[r("li",[s._v("在master节点将数据库的表改名字")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("rename table user to user_2020_01_01\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("改名之后，直接将slave的库导入到master的库中")])]),s._v(" "),r("h3",{attrs:{id:"二-使用日志闪回的原理找回数据"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二-使用日志闪回的原理找回数据"}},[s._v("#")]),s._v(" "),r("code",[s._v("(二) 使用日志闪回的原理找回数据")])]),s._v(" "),r("ul",[r("li",[s._v("基本原理")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：恢复数据的时候，需要禁止写入\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：然后使用闪回工具解析日志文件，将日志文件的信息解析为"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("语句，找到误删除的"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("ul",[r("li",[s._v("闪回工具binlog2sql")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("git clone https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("danfengcao"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("binlog2sql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("git "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" cd binlog2sql\npip3 install "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r requirements"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);