(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{1663:function(s,a,t){s.exports=t.p+"assets/img/2021-01-019.59.25.fbea1337.png"},1664:function(s,a,t){s.exports=t.p+"assets/img/2021-01-021.18.11.c039cc31.png"},2628:function(s,a,t){"use strict";t.r(a);var n=t(9),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-配置另外一台mycat节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-配置另外一台mycat节点"}},[s._v("#")]),s._v(" 一：配置另外一台Mycat节点")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("1：在192.168.100.235上安装Java环境")])]),s._v(" "),n("li",[n("p",[s._v("2：将第一个节点的Mycat拷贝一份到192.168.100.235主机上")])]),s._v(" "),n("li",[n("p",[s._v("3：启动第二个节点的Mycat")])])]),s._v(" "),n("h2",{attrs:{id:"二-haproxy配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-haproxy配置"}},[s._v("#")]),s._v(" 二：Haproxy配置")]),s._v(" "),n("h3",{attrs:{id:"一-haproxy配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-haproxy配置"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) Haproxy配置")])]),s._v(" "),n("ul",[n("li",[s._v("监控页面配置信息配置示例")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("listen admin_stats\nbind "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4001")]),s._v("  # 监控界面的访问"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("和端口\nmode http # 访问协议\nstats uri "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin # 访问相对地址\nstats realm Global\\ statistics # 统计报告格式\nstats auth admin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("abc123456 # 登录账户信息\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("四层负载均衡配置示例")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("listen proxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mysql\nbind "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\nmode tcp\nbalance roundrobin\noption tcplog # 日志是\nserver mycat1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".178")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" check port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\nserver mycat2 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".235")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" check port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\noption tcpka # 使用keepalive检查死链\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("主配置文件")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 全局配置段\nglobal\n\t# 指定日志记录路径，这个local2是需要在"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rsyslog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf文件中指定的，指定了日志存储路径之后，需要重启rsyslog服务哦\n    log         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" local2\n    # 指定haproxy的运行环境\n    chroot      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("haproxy\n    # 指定进程的pid\n    pidfile     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("haproxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid\n    # 指定单个进程的最大并发连接数\n    maxconn     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v("\n    # 指定允许haproxy的用户\n    user        haproxy\n    # 指定允许haproxy的组\n    group       haproxy\n    # 指定haproxy以守护进程模式运行\n    daemon\n    # 设置后台运行"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("个haproxy进程，但是后台运行了"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("个进程\n    nbproc "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    # 指定Unix socket通信\n    stats socket "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("haproxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("stats\n\n# 这里是默认的选项"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("如何在listen段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("backend段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("frontend段中将这些选项按需求重新制定\ndefaults\n\t# 指定默认的模式\n    mode                    http\n    # 指定日志信息使用全局指定的日志存储路径，全局日志是存储在rsyslog服务中\n    log                     global\n    # 指定压缩类型\n    compression algo gzip\n    # 指定需要压缩的资源类型\n    compression type text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("plain\n    option                  httplog\n    option                  dontlognull\n    option http"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("close\n    # 在后端服务器中可以记录客户端的源"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("地址，在日志中加上"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("X")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("i\n    option forwardfor       except "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n    # 如果后端服务器不提供服务，那么将会重新dispatch连接\n    option                  redispatch\n    \n    retries                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    timeout http"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("s\n    timeout queue           "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("m\n    timeout connect         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("s\n    timeout client          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("m\n    timeout server          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("m\n    timeout http"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keep"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alive "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("s\n    timeout check           "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("s\n    # 指定接受"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("个并发\n    maxconn                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n\n\n# haproxy统计页面配置段\nlisten stats \n    # 指定统计页面监听的端口\n    bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33559")]),s._v("\n    # 指定统计页面运行的模式\n    mode http\n    # 指定开启统计页面功能\n    stats enable  \n    # 如果不设置"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("默认是"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("haproxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("stats\n    stats uri "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin  \n    # 指定登入是提示信息，\\表示转义空白字符\n    stats realm HAProxy\\ statistics\n    # 指定用户名和密码\n    stats auth ipfsmain"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("  \n    # 指定统计页面自动刷新的时长\n    stats refresh "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    # 如果用户认证成功，统计页面可以被访问\n    stats admin "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TRUE")]),s._v(" \n    #隐藏统计页面上HAProxy的版本信息\n    stats hide"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version\n\n# 四层负载均衡\nlisten proxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mysql\n\t# 访问的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("地址\n\tbind "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n\t# 网络协议\n\tmode tcp\n\t# 负载均衡算法\n\tbalance roundrobin\n\t# 日志格式\n\toption tcplog\n\t# 负载均衡\n\tserver mycat1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".178")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" check port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n\tserver mycat2 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".235")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" check port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8066")]),s._v(" weight "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" maxconn "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n\toption tcpka # 使用keepalive检查死链\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br")])]),n("ul",[n("li",[s._v("检查配置文件是否有错误")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("haproxy "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("haproxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("haproxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cfg\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("启动haproxy")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("systemctl start haproxy\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("访问haproxy的监控页面(http://192.168.100.178:33559/admin)")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1663),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("基于Haproxy访问Mycat")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h192"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("168.100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".178")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p123456\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"三-基于keepalived实现ip漂移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-基于keepalived实现ip漂移"}},[s._v("#")]),s._v(" 三：基于Keepalived实现IP漂移")]),s._v(" "),n("h3",{attrs:{id:"一-keepalived配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-keepalived配置"}},[s._v("#")]),s._v(" "),n("code",[s._v("(一) Keepalived配置")])]),s._v(" "),n("ul",[n("li",[s._v("设置防火墙（如果防火墙都是允许的，那么就没有必要设置）")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("firewall"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("direct "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("permanent "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rule ipv4 filter "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INPUT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("protocol vrrp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACCEPT")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("安装keepalived")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("yum install "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y keepalived \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("第一个keepalived修改keepalive配置文件(/etc/keepalived/keepalived.conf), 这里配置了一个VIP为：192.168.100.123")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("vrrp_instance "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VI_1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    # haproxy1为主\n    state "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MASTER")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ens33")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    # 检查间隔，默认"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("秒 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v("心跳包的发送周期，单位为s 组播信息发送间隔，两个节点设置必须一样\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    # 指定心跳信息传递过程中的认证方式\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASS")]),s._v("\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    # 指定"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VIP")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        # 这里最好给"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VIP")]),s._v("取一个别名，这样就能够使用ifconfig命令查看"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VIP")]),s._v("了\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" dev ens33 label ens33"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("第二个keepalived修改配置文件")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("vrrp_instance "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VI_1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    # haproxy1为主\n    state "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MASTER")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ens33")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    # 检查间隔，默认"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("秒 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v("心跳包的发送周期，单位为s 组播信息发送间隔，两个节点设置必须一样\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    # 指定心跳信息传递过程中的认证方式\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASS")]),s._v("\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    # 指定"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VIP")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        # 这里最好给"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VIP")]),s._v("取一个别名，这样就能够使用ifconfig命令查看"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VIP")]),s._v("了\n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" dev ens33 label ens33"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"二-基于keepalived连接到mycat"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-基于keepalived连接到mycat"}},[s._v("#")]),s._v(" "),n("code",[s._v("(二) 基于Keepalived连接到Mycat")])]),s._v(" "),n("ul",[n("li",[s._v("基本操作"),n("code",[s._v("mysql -uroot -h192.168.100.123 -p123456")])])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mycat2 haproxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h192"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("168.100")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p123456\nWelcome to the MariaDB monitor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  Commands end "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" or \\g"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nYour MySQL connection id is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nServer version"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".29")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mycat"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20200105164103")]),s._v(" MyCat "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OpenCloudDB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Copyright")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Oracle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MariaDB Corporation Ab and others"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\nType "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'help;'")]),s._v(" or "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\h'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" help"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Type "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\c'")]),s._v(" to clear the current input statement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\nMySQL "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"三-数据流向图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-数据流向图"}},[s._v("#")]),s._v(" "),n("code",[s._v("(三) 数据流向图")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1664),alt:"Alt text"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);