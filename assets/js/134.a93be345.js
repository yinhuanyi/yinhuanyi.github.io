(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{1637:function(s,n,a){s.exports=a.p+"assets/img/2021-12-3017.25.58.fa2198d6.png"},1638:function(s,n,a){s.exports=a.p+"assets/img/2021-12-3017.28.26.f915927e.png"},1639:function(s,n,a){s.exports=a.p+"assets/img/2021-12-3017.29.48.7ab83160.png"},1640:function(s,n,a){s.exports=a.p+"assets/img/2021-12-3017.31.41.cc0b5afe.png"},2616:function(s,n,a){"use strict";a.r(n);var t=a(9),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"一-mongodb-安装和操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-mongodb-安装和操作"}},[s._v("#")]),s._v(" （一） Mongodb 安装和操作")]),s._v(" "),t("ul",[t("li",[s._v("RPM包安装")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：创建yum仓库配置文件，编辑 /etc/yum.repos.d/mongodb.repo文件，添加\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mongodb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MongoDB Repository\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：安装mongodb-org，且mongodb-org-server、mongodb-org-mongos、mongodb-org-shell、mongodb-org-tools将一并被安装\n\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y mongodb-org\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("修改主配置文件/etc/mongod.conf")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bind_ip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0        让所有的用户都可以连接服务端, 生成环境里请自行按需修改\ndbpath "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /data/mongo     重新指定数据存储的路径\nhttpinterface "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("     打开基于web接口来监控mongodb的工作特性，且监听于28017 \nrest "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("              支持restful编程接口\nport "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("             指定mongodb-server监听的端口\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("创建数据目录，且修改权限")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -pv /data/mongo\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mongod.mongod /data/mongo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("启动mongodb，且查看数据目录是否存在数据")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl start mongod.service\n\nll /data/mongo/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("客户端连接到服务端")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("（一）：使用http接口连接服务端，查看mongodb的信息, http接口是28017\nhttp://192.168.23.9:28017\n\n（二）：查看客户端连接到服务端的帮助\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@mongodb1 data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mongo --help     ")]),s._v("\nMongoDB shell version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v(".12\nusage: mongo "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("db address"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("file names "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ending "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" .js"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n（三）：通过客户端连接到服务端\nmongo --host "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".23.9     连接到服务端，默认是连接192.168.23.9:27017/test， test为数据库名\nshow dbs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      查看数据库\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("mongodb的命令介绍")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("db.help"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                    查看库级别的命令 \ndb.stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                   查看数据库状态\ndb.version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                 查看数据库版本\ndb.serverStatus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            查看数据库服务器状态\ndb.mycoll.help"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             查看表级别的命令\ndb.getCollectionNames        显示当前库中所有的表的列表\nsh.help"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                    关于sharding的操作\nrs.help"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                    集合赋值命令\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" admin                   管理命令\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" connect                 连接操作语法\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" keys                    key shortcuts\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" misc                    misc things to know\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" mr                      mapreduce\nshow dbs                     显示数据库名称\nshow collections             显示表名称\nshow "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("                   查看已有用户\nshow profile                 显示profile信息，显示性能评估工具\nshow logs                    显示日志名信息\nshow log "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              显示指定的日志名的信息\nuse "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("db_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                进入某库，设定某库为当前库\ndb.foo.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                \ndb.foo.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       \nit                           result of the last line evaluated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" use to further iterate\nDBQuery.shellBatchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x   "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" default number of items to display on shell\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("                         quit the mongo shell\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("ul",[t("li",[s._v("DDL, DML, DCL （在mongodb中叫做CRUD操作）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("db.students.insert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dage"')]),s._v(",age:20"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  插入一条数据，默认会创建students表\nshow collections                         显示当前的表\ndb.students.stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                      显示students表的数据信息\ndb.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                       查询插入的各个字段\ndb.students.count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                      查看students表中有多少个document\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("Collection的简单查询过滤操作")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("的高级用法：比较操作：\n（一） db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$gt")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  age大于30\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ObjectId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"597b49b4072d632a342867cc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n（二）db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$gte")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  age大于等于30\n（三）db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$lt")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  age小于30\n（四）db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$lte")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  age小于等于30\n（五）db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$in")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  age在"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("的document\n（六）db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nin")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  age不在"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("的document\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("Collection的复杂查询过滤操作")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("的高级用法：组合条件：逻辑运算\n（一）db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$or")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$eq")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nin")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40,50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 或运算\n（二）"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$and")]),s._v("：与运算\n（三）"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$not")]),s._v("：非运算\n（四）"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$nor")]),s._v("：取反运算\n\nfind"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("的高级用法：元素查询： 根据document中是否存在指定的字段进行的查询\n（一）db.students.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("gender: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$exists")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  查询存在gender字段的document\n（二）"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mod")]),s._v("：取摸\n（三）"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$type")]),s._v("：返回指定字段的值类型为指定类型的document\n\nMongoDB支持的数据类型有：Double, String, Object, Array, Binary data, Undefined, Boolean, Date, Null 等\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("Collection的跟新操作（update( )方法详解：插入和修改字段的值）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("的高级用法："),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$set")]),s._v(" 更新，或插入字段的值， "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$unset")]),s._v(" 删除指定字段 ，"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rename")]),s._v(" 修改字段名 \n（一）db.students.update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$set")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     将name为yhy的这个document的age字段的值改为44\n     db.students.update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$set")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     将name为yhy的这个document的age字段的值改为50\n\n（二）db.students.update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$unset")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     删除name字段为yhy的document的age为50的字段\n\n（三）db.students.update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$rename")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Age"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     修改name字段为yhy的document的age字段名为Age字段名\n\n（四）db.students.update"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$inc")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("course: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Python"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     给name字段为yhy的document增加一个字段course且值为Python\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("ul",[t("li",[s._v("Collection的删除操作(remove( )，drop( ), dropDatabase( )方法详解)")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除字段")]),s._v("\ndb.students.remove"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除表")]),s._v("\ndb.students.drop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除当前数据库")]),s._v("\ndb.dropDatabase"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"二-mongodb-index-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-mongodb-index-介绍"}},[s._v("#")]),s._v(" （二）Mongodb index 介绍")]),s._v(" "),t("ul",[t("li",[s._v("索引操作介绍")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("db.student.ensureIndex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n给name字段创建索引, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("为指定按升序创建索引，如果你想按降序来创建索引指定为-1即可。\n实例\n\ndb.student.getIndexes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n查看索引\n\ndb.student.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".explain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n查看是否使用到了索引（由于MongoDB调优）\n\ndb.student.dropIndex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name_1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n删除索引\n\ndb.students.ensureIndex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("unique: true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n给name字段创建一个唯一键索引，那么再给students表增加一条行document，且name与之前存在的document的name值相同，那么就会报错， 如：增加一条document\ndb.students.insert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n报错的信息如下：\nWriteResult"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nInserted"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"writeError"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11000")]),s._v(",\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"errmsg"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insertDocument :: caused by :: 11000 E11000 duplicate key error index: test.students.'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name_1")]),s._v("  dup key: { : "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("yhy"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(' }"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"三-mongodb-授权认证-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三-mongodb-授权认证-介绍"}},[s._v("#")]),s._v(" （三）Mongodb 授权认证 介绍")]),s._v(" "),t("ul",[t("li",[s._v("db.createUser( )函数介绍")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：创建一个root用户，角色为userAdminAnyDatabase，因此root用户对数据库具有管理权限，但是不具备操作权限\ndb.createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(",pwd:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(", roles: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" role: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userAdminAnyDatabase"')]),s._v(", db: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("方法说明\nuser：定义用户名 \npwd：设置密码 \nroles：指定用户的角色，可以用一个空数组给新用户设定空角色； 在roles字段,可以指定内置角色和用户定义的角色。\ndb：指定用户对哪个数据库具有管理员权限\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：角色种类说明\nBuilt-In Roles（内置角色）： \n①. 数据库用户角色：read、readWrite"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n②. 数据库管理角色：dbAdmin、dbOwner、userAdmin； \n③. 集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager； \n④. 备份恢复角色：backup、restore； \n⑤. 所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase \n⑥. 超级用户角色：root \n// 这里还有几个角色间接或直接提供了系统超级用户的访问（dbOwner 、userAdmin、userAdminAnyDatabase） \n⑦. 内部角色：__system\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：角色对应的意义说明\nRead：允许用户读取指定数据库 \nreadWrite：允许用户读写指定数据库 \ndbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile \nuserAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户 \nclusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。 \nreadAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限 \nreadWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限 \nuserAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限 \ndbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。 \nroot：只在admin数据库中可用。超级账号，超级权限\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("：查看授权表\ndb.system.users.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("：此时退出MongoDB，且编辑配置文件/etc/mongod.conf, 添加\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auth")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("针对于2.6版本"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsecurity:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("针对于3.4版本"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  authorization: enabled\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("：可以在连接数据库的时候认证，也可以在登入时候认证，这里使用登入之后认证的方式\nshow dbs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" （会报错，因为没有管理授权）\ndb.auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   授权之后再查看数据库就没有问题了\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("：此时登入使用的是root用户，角色是管理角色，但是不具备对数据库的操作权限\nuse "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nshow collections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("会报错，因为没有操作权限"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("：再次创建一个用户: test，让其对test具有读写操作, 且切换用户为test\ndb.createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(",pwd:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(", roles: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" role: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"readWrite"')]),s._v(", db: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndb.auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("：再次查看test库的表，发现可以查看了\nshow collections"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("：其实，如果需要创建一个用户具有管理权限且同时具有操作权限，那么这个用户的角色必须是root\ndb.createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yhy"')]),s._v(",pwd:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(", roles: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" role: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(", db: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admn"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br")])]),t("h3",{attrs:{id:"四-mongod-的常用选项-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四-mongod-的常用选项-介绍"}},[s._v("#")]),s._v(" （四）mongod 的常用选项 介绍")]),s._v(" "),t("ul",[t("li",[s._v("在启动mongod的时候，可以指定一系列的选项，那么mongodb中，提供了一个配置文件：/etc/mongod.conf ，那么可以将这些选项都写在这个配置文件里，使得启动mongod时，mongodb会先读取这个配置文件中的选项，之后在读取命令行的选项来启动mongodb")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("①：在配置mongodb2.6的时候，常用的一些选项有 \n    fork "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("：指定mongod是否运行在后台\n    bind_ip "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IP地址：指定监听的地址，如果不指定，默认是监听本地的所有IP地址\n    port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 监听的端口：指定监听的端口\n    maxConns "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 并发连接数：指定支持的最大并发连接数\n    logappend "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("：指定是否支持日志滚动\n    auth "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ：指定是否启用认证功能\n\n②：在配置mongodb3.4的时候，常用的选项有（如果想使用mongodb的web管理页面，在/usr/lib/systemd/system/mongod.service文件中，修改：Environment"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OPTIONS=-f /etc/mongod.conf --rest"')]),s._v("）（/usr/lib/systemd/system/mongod.service这个unit file可以指定很多环境配置选项）\nsystemLog:\n  destination: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n  logAppend: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  path: /var/log/mongodb/mongod.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Where and how to store data.")]),s._v("\nstorage:\n  dbPath: /data/mongodb\n  journal:\n    enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nprocessManagement:\n  fork: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fork and run in background")]),s._v("\n  pidFilePath: /var/run/mongodb/mongod.pid  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# location of pidfile")]),s._v("\nnet:\n  port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\n  bindIp: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Listen to local interface only, comment to listen on all interfaces.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用认证")]),s._v("\nsecurity:\n  authorization: enabled\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h3",{attrs:{id:"五-mongodb-compass-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五-mongodb-compass-介绍"}},[s._v("#")]),s._v(" （五）Mongodb compass 介绍")]),s._v(" "),t("ul",[t("li",[s._v("安装 Mongodb compass")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：下载安装包：\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://downloads.mongodb.com/compass/mongodb-compass-1.6.0.x86_64.rpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：安装\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mongodb-compass-1.6.0.x86_64.rpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：启动\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEBUG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("* mongodb-compass"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"六-mongodb-复制架构-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六-mongodb-复制架构-介绍"}},[s._v("#")]),s._v(" （六）Mongodb 复制架构 介绍")]),s._v(" "),t("ul",[t("li",[s._v("MongoDB复制是将数据同步在多个服务器的过程,复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性， 并可以保证数据的安全性, 复制还允许您从硬件故障和服务中断中恢复数据")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1637),alt:"Mongodb 复制架构 介绍"}})]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("以上结构图中，客户端从主节点读取数据，在客户端写入数据到主节点时， 主节点与从节点进行数据交互保障数据的一致性\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("复制概念说明、副本集概念说明（如果实在是不理解什么是副本集，就认为一个副本集是一个集群）")])]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：在mongodb的集群中，一般会部署多个节点，且有多个节点有相同的数据。\n\n2：主节点可以进行读写操作，而从节点一般只能够进行读操作\n\n3：副本集就是服务所有的mongodb实例的同一个数据集（也就是说副本集定义了一个集群，一个已经运行的集群中如果添加了一个新的节点，那么必须指定这个新的节点加入到哪个副本集中。一个副本集就定义了一个集群，一个副本集可以最多支持12个成员，但是只有7个成员可以参与投票）\n\n4：对应MySQL而言：从节点在主节点复制数据的方式为主节点将数据操作保存在二进制日志中，而从节点就是复制主节点的二进制日志，在本地再执行一次，那么这就实现了与主节点的数据一致。而mongodb是主节点将数据操作保存在操作日志(oplog)中，从节点复制操作日志(oplog)，在本地再执行一次实现数据集一致\n\n5：从节点每隔一段时间会探测一次主节点的心跳信息，如果在一段时间中无法获得主节点的心跳信息，那么其余的从节点会重新进行一次投票选举操作，谁的优先级高就会成为下一个主节点。\n\n6：mongodb节点集群至少需要三个节点，一个主节点，两个从节点\n\n7：复制中的四种特殊的从节点分类\n    a：0优先级的节点：冷备节点，不会被选举成为主节点，但是可以参与选举过程\n    b：被隐藏的从节点：不想让客户端访问数据的节点，必须为0优先级的节点，不会显示在mongodb集群的信息中\n    c：延迟复制的从节点：必须为0优先级的节点，且复制时间落后于主节点一个固定时间，可以参与选举过程\n    d：arbiter：没有数据\n\n8：oplog：记录数据改变的操作日志，用于数据同步复制，大小固定的文件，存储在local数据库中，集群中每一个节点都有oplog。但是只有当其成为主节点的时候，才会将其数据改变的操作记录到oplog之中\n\n同步的步骤分为：\n    初始同步\n    同步之后追赶主节点\n    切分块迁移（切片）\nlocal库中存放了副本集的所有的元数据和oplog，用于存储oplog的一个叫oplog.rs的collection表，oplog.rs的大小默认与文件系统有关，但是可以自定义\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("ul",[t("li",[s._v("基于MongoDB2.6版本配置MongoDB主从复制集群架构")])]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('1：集群环境说明：mongodb1：192.168.43.10、mongodb2：192.168.43.11、mongodb3：192.168.43.12。且基于主机名相互通信/etc/hosts文件（为了集群信息同步不出现问题，先关闭认证功能anth）\n\n2：编辑mongodb1的/etc/mongod.conf文件，注释auth指令，添加如下内容\n# 指定副本集的名称\nreplSet=uplooking\n# 指定预拷贝的索引，这里只拷贝id那个系统自动生成的索引\nreplIndexPrefetch=_id_only\nnoauth=true\n\n3：将mongodb1的配置文件拷贝到mongodb2、mongodb3\nscp /etc/mongod.conf 192.168.43.11:/etc/\nscp /etc/mongod.conf 192.168.43.12:/etc/\n\n3：启动mongodb1、mongodb2、mongodb3\n\n4：登入mongodb1的shell接口\n> rs.status(); （查看集群中的节点状态）\n> rs.initiate();（初始化副本集）\n> rs.status();（再次查看集群中的节点状态）\nuplooking:PRIMARY>  （此时的提示符已经变了）\n\n5：当初始化了主节点以后，需要添加其他的从节点到mongodb集群中来\nuplooking:PRIMARY> rs.add("192.168.43.11")\nuplooking:PRIMARY> rs.add("192.168.43.12")\n\n6：添加了其他节点以后，就可以查看配置信息和副本集的状态信息\nuplooking:PRIMARY> rs.conf()  \n{\n        "_id" : "uplooking",\n        "version" : 3,\n        "members" : [\n                {\n                        "_id" : 0,\n                        "host" : "mongodb1:27017"\n                },\n                {\n                        "_id" : 1,\n                        "host" : "192.168.43.11:27017"\n                },\n                {\n                        "_id" : 2,\n                        "host" : "192.168.43.12:27017"\n                }\n        ]\n}\n\n7：再次查看状态副本集的状态信息\nuplooking:PRIMARY> rs.status()\n{\n        "set" : "uplooking",\n        "date" : ISODate("2017-10-29T16:05:55Z"),\n        "myState" : 1,\n        "members" : [\n                {\n                        "_id" : 0,\n                        "name" : "mongodb1:27017",\n                        "health" : 1,\n                        "state" : 1,\n                        "stateStr" : "PRIMARY",\n                        "uptime" : 914,\n                        "optime" : Timestamp(1509292923, 1),\n                        "optimeDate" : ISODate("2017-10-29T16:02:03Z"),\n                        "electionTime" : Timestamp(1509292619, 1),\n                        "electionDate" : ISODate("2017-10-29T15:56:59Z"),\n                        "self" : true\n                },\n                {\n                        "_id" : 1,\n                        "name" : "192.168.43.11:27017",\n                        "health" : 1,\n                        "state" : 2,\n                        "stateStr" : "SECONDARY",\n                        "uptime" : 237,\n                        "optime" : Timestamp(1509292923, 1),\n                        "optimeDate" : ISODate("2017-10-29T16:02:03Z"),\n                        "lastHeartbeat" : ISODate("2017-10-29T16:05:54Z"),\n                        "lastHeartbeatRecv" : ISODate("2017-10-29T16:05:54Z"),\n                        "pingMs" : 0,\n                        "syncingTo" : "mongodb1:27017"\n                },\n                {\n                        "_id" : 2,\n                        "name" : "192.168.43.12:27017",\n                        "health" : 1,\n                        "state" : 2,\n                        "stateStr" : "SECONDARY",\n                        "uptime" : 232,\n                        "optime" : Timestamp(1509292923, 1),\n                        "optimeDate" : ISODate("2017-10-29T16:02:03Z"),\n                        "lastHeartbeat" : ISODate("2017-10-29T16:05:55Z"),\n                        "lastHeartbeatRecv" : ISODate("2017-10-29T16:05:55Z"),\n                        "pingMs" : 0,\n                        "syncingTo" : "mongodb1:27017"\n                }\n        ],\n        "ok" : 1\n}\n\n8：此时从节点可以在shell接口查看到在主节点复制过来的数据库和表，但是不能查询表的内容，因此需要通过命令让从节点变为可用节点，在查询就可以了\nuplooking:SECONDARY> rs.slaveOk()\n\n9：主节点也可以通过命令变为从节点, 此时其他的节点通过投票将会变为主节点\nuplooking:SECONDARY> rs.stepDown()\n\n10：在新的主节点(mongodb2)中可以设置从节点的优先级让从节点变为主节点，让第一个从节点优先级为10，那么第一个从节点就会变为主节点\nuplooking:PRIMARY> config=rs.conf()    # 先使用一个config临时变量保存rs.conf（）的值，也就是当前的副本集配置\nuplooking:PRIMARY> config.members[0].priority=10  # 让第一个节点，也即是mongodb1的优先级为10\nuplooking:PRIMARY> rs.reconfig(config)   # 让副本集获得新的配置，此时，mongodb1将会成为主节点\n\n11：在主节点中，从副本集中移除一个节点，\nrs.conf() # 先查看需要删除的host\nrs.remove("192.168.43.12:27017")\n\n12：也可以将一个从节点变为arbiter仲裁节点，这里将mongodb3变为arbiter节点，必须先让mongodb3下线，然后删除数据目录，在重启，再设置为arbiter仲裁节点\nrs.addArb("192.168.43.12") \n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br")])]),t("h3",{attrs:{id:"七-mongodb-分片操作-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#七-mongodb-分片操作-介绍"}},[s._v("#")]),s._v(" （七）Mongodb 分片操作 介绍")]),s._v(" "),t("ul",[t("li",[s._v("当单个MongoDB节点的数据量过大的时候，我们通常考虑将数据切分为多个shard，也就是切分为多片。")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1638),alt:"Mongodb 分片操作 介绍"}})]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("（一）数据分片之后，整个集群中的MongoDB节点就分为了三类，一类是Router节点，实现前端路由，客户端由此接入，且让整个集群看上去像单一数据库，前端应用可以透明使用。一类是Config节点，存储了整个 元数据ClusterMetadata，其中包括 chunk信息，明确知道客户端请求的数据在哪个shard节点上。第三类，shard节点，存储真实的数据，将原有的数据集分片之后平均存储在每一个shard节点之上。\n\n（二）MongoDB的分片机制上建立在副本集概念之上的概念，因为这里每一个shard节点都将组成一个副本集，使每一个shard节点的数据具有高可用性。这里需要补充一个chunk的概念，大数据集首先是切分为多个chunk，之后再将chunk发布到各个shard节点中，就是每一个shard节点的数据都是一个一个的chunk组成的。那么chunk又是基于什么标准切分出来的呢？是这样的，一般在切分chunk的时候，会指定索引，比如age，如果在一个collection中给age这个字段创建了一个索引，那么切分chunk的时候，就以age这个索引来切分，使得1~60岁这个年龄阶段的数据能够根据不同的区间范围，切割为多个chunk，例如1~15岁为一个chunk，15~20岁一个chunk，21~30岁一个chunk，31~60岁一个chunk，每一个chunk的数量大小均等，因此整个collection就被切割成为了3个chunk，chunk信息将会保存至config节点中，而chunk数据将会保存在每一个shard节点中。\n\n（三）shard分片的衡量的标准，也就是根据哪个索引（切片键）进行切片（让经常写的数据尽量离散分散到各个shard中，让经常读的数据尽量集中到一个shard中）\n\n1：基于范围range做分片\n    例如：以年龄、时间等切片\n\n2：基于离散列表切片\n    例如：以区域、地名等数据切片\n\n3：基于hash值进行随机切片\n    例如：以热点人物（例如：鹿晗和关晓彤）做hash之后切片\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("ul",[t("li",[s._v("生产环境中MongoDB集群架构如下")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1639),alt:"MongoDB集群架构"}})]),s._v(" "),t("h3",{attrs:{id:"八-mongodb-分片操作实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#八-mongodb-分片操作实战"}},[s._v("#")]),s._v(" （八）Mongodb 分片操作实战")]),s._v(" "),t("ul",[t("li",[s._v("试验环境介绍")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1640),alt:"试验环境介绍"}})]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('1：准备四个节点mongodb1(mongos)、mongodb2(config)、mongodb3(shard1)、mongodb4(shard2)且保证可以通过主机名访问，且时间同步\n\n2：配置mongodb2(config)节点，使得mongodb2为config节点，编辑配置文件/etc/mongod.conf\n添加：configsvr = true\n同时注释：#replSet=uplooking #replIndexPrefetch=_id_only #port=27017 这3个指令\n（因为副本集与config节点不能同时工作）\n\n4：启动config server，此时默认config server监听在27019端口\nsystemctl start mongod.service\n\n\n5: 在mongodb1上操纵：mongodb1作为路由，使用mongos连接config server，先清空配置文件，再添加如下信息\nlogpath=/var/log/mongodb/mongod.log  # 指明日志路径\npidfilepath=/var/run/mongodb/mongod.pid  # 指明pid路径\nlogappend=true # 指明日志累加\nfork=true  # 指明运行于守护进程\nport=27017 # 指明端口\nconfigdb=192.168.43.11:27019 # 指明config server 的地址在哪里\n\n6：指定配置文件，启动mongos，也可以使用systemctl启动，但是需要修改下启动脚本/etc/rc.d/init.d/mongod\nmongos -f /etc/mongod.conf\n\n7：将mongodb3和mongodb4配置文件中关于副本集的指令注释，然后直接启动\nsystemctl start mongod\n\n8：mongodb3、mongodb4启动之后，在mongodb1上，通过mongo登入到mongos，将mongodb3、mongodb4作为shard添加到mongos的路由策略中\n\n9：创建支持shard机制的数据库\nsh.enableSharding("uplookingdb")\nmongos> sh.status();\n--- Sharding Status --- \n  sharding version: {\n        "_id" : 1,\n        "version" : 4,\n        "minCompatibleVersion" : 4,\n        "currentVersion" : 5,\n        "clusterId" : ObjectId("59f6caf5c93e5ff2a637a0cd")\n}\n  shards:\n        {  "_id" : "shard0000",  "host" : "192.168.43.13:27017" }\n        {  "_id" : "shard0001",  "host" : "192.168.43.12:27017" }\n  databases: # 这里会显示支持shard的数据库，分片collection放置在各个shard，而没有分片的collection放置在主shard中\n        {  "_id" : "admin",  "partitioned" : false,  "primary" : "config" }\n        {  "_id" : "test",  "partitioned" : false,  "primary" : "shard0001" }\n        {  "_id" : "uplookingdb",  "partitioned" : true,  "primary" : "shard0001" }\n\n10：在对应支持shard机制的数据库上创建支持shard的collection，{"age": 1}指明索引为age，升序排序，这样shard集群的功能就已经启动了，之后就可以调用mongodb1这个接口写数据了，但是写入mongodb1的数据不会保存在mongodb1，因为mongodb1是一个router节点，所有的数据都会保存至shard节点上。\nsh.shardCollection("uplookingdb.students", {"age": 1})\n\n11：此时mongodb1节点上会有uplookingdb库 和 students表了\nmongos> show dbs;\nadmin        (empty)\nconfig       0.016GB\nuplookingdb  0.078GB\nmongos> use uplookingdb\nswitched to db uplookingdb\nmongos> show collections;\nstudents\nsystem.indexes\n\n12：给students表创建添加数据（可以使用js的循环语法插入数据）\nmongos> for (i=1; i&lt;1000000; i++){  \ndb.students.insert({"name": "yhy"+i, "age": i%100, "student_id": i, "skill": "ok"+i, "salary": "$"+i%10000})\n }\n\n13：复制mongodb1窗口，先查看一下students表有多少行数据了，在看看此时的shard分片的状态\nmongos>db.students.find().count();  # 查看students表中有多少行数据了\n237751\nmongos> sh.status()   # 再查看一下shard的状态信息\n--- Sharding Status --- \n  sharding version: {\n        "_id" : 1,\n        "version" : 4,\n        "minCompatibleVersion" : 4,\n        "currentVersion" : 5,\n        "clusterId" : ObjectId("59f6caf5c93e5ff2a637a0cd")\n}\n  shards:  # 只是shard节点列表\n        {  "_id" : "shard0000",  "host" : "192.168.43.13:27017" }\n        {  "_id" : "shard0001",  "host" : "192.168.43.12:27017" }\n  databases:  # 这是支持shard机制的库\n        {  "_id" : "admin",  "partitioned" : false,  "primary" : "config" }\n        {  "_id" : "test",  "partitioned" : false,  "primary" : "shard0001" }\n        {  "_id" : "uplookingdb",  "partitioned" : true,  "primary" : "shard0001" }\n                uplookingdb.students  这是支持shard机制的表\n                        shard key: { "age" : 1 }  # 用表上的哪个索引作为shard的键\n                        chunks:  # 这里是显示chunk的发布情况\n                                shard0000       2  # 发布两个chunk\n                                shard0001       3  # 发布三个chunk\n                        { "age" : { "$minKey" : 1 } } --\x3e> { "age" : 1 } on : shard0000 Timestamp(2, 0) \n                        { "age" : 1 } --\x3e> { "age" : 47 } on : shard0000 Timestamp(3, 0) \n                        { "age" : 47 } --\x3e> { "age" : 72 } on : shard0001 Timestamp(3, 2) \n                        { "age" : 72 } --\x3e> { "age" : 99 } on : shard0001 Timestamp(3, 3) \n                        { "age" : 99 } --\x3e> { "age" : { "$maxKey" : 1 } } on : shard0001 Timestamp(2, 3) \n\n\n\n14：过一段时间之后，等数据在mongodb1节点插入完毕，在mongodb3，mongodb4上就会发现一部分年龄的人在mongodb3，而另外一部分在mongodb4上\ndb.students.find();\n\n\n15：再添加一个新的节点进来，在mongodb1上设置它为shard节点，此时你会发现chunk就会自动迁移，无需我们手动管理，但是chunk在shard节点中自动迁移会消耗大量的带宽以及带来I/O压力，因此，一般是现在mongodb1节点将\n\n16：如果创建一个库，且添加一张表，且并没有将库和表添加到shard机制中来，那么\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br")])]),t("ul",[t("li",[s._v("对于每一个shard节点实现副本集赋值功能，以及多个config节点，同学们一定要完成（我出去调研的时候发现，MongoDB的应用场景再某种程度上不比MySQL弱）")])])])}),[],!1,null,null,null);n.default=e.exports}}]);