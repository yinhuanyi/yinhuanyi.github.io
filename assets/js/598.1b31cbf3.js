(window.webpackJsonp=window.webpackJsonp||[]).push([[598],{2657:function(s,n,a){"use strict";a.r(n);var e=a(9),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"一-yaml文件介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-yaml文件介绍"}},[s._v("#")]),s._v(" （一）YAML文件介绍")]),s._v(" "),a("ul",[a("li",[s._v("1：YAML文件的格式介绍， YAML文件的格式与其他的高级语言中的字典嵌套类似，就是一层一层的嵌套，如：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n- hosts: webservers # 这里第一个列表指明运行同一种任务的主机组\n  remote_user: root\n  tasks:\n  - name: install httpd  # 每一个任务都应该有一个名字，用于显示哪个任务完成了\n    yum: name=httpd state=present\n  - name: distribute configuration file\n    copy: src=/root/files/httpd.conf dest=/etc/httpd/conf/\n  - name: start httpd service\n    service: name=httpd state=started\n  - name: port\n    shell: netstat -lntup | grep httpd\n\n上面这个就是一个YAML的文件格式，横杠就表示列表，冒号表示字典。任务执行的顺序一般都是列表写明\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"二-ansible-playbook介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-ansible-playbook介绍"}},[s._v("#")]),s._v(" （二）ansible-playbook介绍")]),s._v(" "),a("ul",[a("li",[a("strong",[a("code",[s._v("ansible-playbook说明")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：Playbook的实质就是运行YAML配置文件：将多个相关的任务，通过读取YAML格式的配置文件一次性完成\n\n2：playbook运行的核心元素有：\nHosts：指明运行在哪个主机上\nRemote_user：以哪个用户的身份运行任务\nTasks：任务\nVariables：变量\nTemplates：包含了模板语法的文本文件\nHandlers：由特定条件出发的任务\nRoles：\n\n3：playbook的元素\nHosts：运行指定任务的目标主机，这些主机必须是定义在hosts文件中的主机\nremote_user：在远程主机上执行任务的用户\nsudo_user：sudo到哪个用户的身份运行\ntasks：任务列表，调用模块和指明参数\n格式：\n    action动作形式：module arguments （新版本支持）\n    module模块形式：arguments （通用格式）\n    注意：shell和command模块后面加的是命令，而非key=value类的参数列表\n    （1）测试（只检测可能会发生的改变，但不真正执行操作）\n    ansible-playbook --check\n    ansible-playbook --list-hosts  列出运行任务的被管控的主机\n    ansible-playbook --check firsh.yaml  测试\n    （2）运行\n    ansible-playbook firsh.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("YAML示例文件（最好是确保webservers的主机的系统版本一样，因为配置文件的格式不一样会导致服务无法启动）")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- hosts: webservers\n  remote_user: root\n  tasks:\n  - name: install httpd\n    yum: name=httpd state=present\n  - name: distribute configure file  # 这里的src可以使用相对路径也可以使用绝对路径，相对路径表示与yaml文件在同一级目录下\n    copy: src=/root/files/httpd.conf dest=/etc/httpd/conf/\n  - name: start httpd service\n    service: name=httpd state=started\n  - name: port\n    shell: netstat -lntup|grep httpd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("handlers 详解 任务在特定条件下被触发，接收到其他任务的通知时被触发，某任务的状态在运行后为changed时，可通过notify通知给相应的handlers")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- hosts: webservers\n  remote_user: root\n  tasks:\n  - name: install httpd\n    yum: name=httpd state=present\n  - name: distribute configure file\n    copy: src=/root/files/httpd.conf dest=/etc/httpd/conf/\n    # notify的意义在于只要配置文件发生了变化，就调用handlers的restart httpd任务执行\n    notify: restart httpd\n  - name: start httpd service\n    service: name=httpd state=started\n  - name: port\n    shell: netstat -lntup | grep httpd\n  # handlers的意义和tasks的区别在于，handlers中的任务需要被tasks中的任务调用才能够陪执行\n  handlers:\n  - name: restart httpd\n    service: name=httpd state=restarted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("tags详解（用来标记指定执行的任务，在执行playbook的时候，如果指定tags所标记的任务，那么其他定义的任务将不会再执行）")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- hosts: webservers\n  remote_user: root\n  tasks:\n  - name: install httpd\n    yum: name=httpd state=present\n  - name: distribute configure file\n    copy: src=files/httpd.conf dest=/etc/httpd/conf/\n    # 在安装配置文件处加上一个tags标签，在执行playbook的时候，就可以指明运行的任务了\n    tags: distributeConfig\n    notify: restart httpd\n  - name: start httpd service\n    service: name=httpd state=started\n  - name: port\n    shell: netstat -lntup|grep httpd\n  handlers:\n  - name: restart httpd\n    service: name=httpd state=restarted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("例如：ansible-playbook -t distributeConfig  http.yaml  这里指定运行的是copy任务 （在执行tags对应的任务时，如果被notify检查到了发生改变，那么也会调用handlers中的任务进行执行的）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("variables变量 详解")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("（1）facts： 可以直接调用，有setup模块提供的\n（2）ansible-playbook命令行中自定义的变量 \n-e VARS : 指定需要传递给playbook的变量的名称\n（3）通过roles角色传递变量\n（4）Host inventory (/etc/ansible/hosts文件)：向不同的主机传递不同的变量 , 这样就不需要在ansible-playbook命令行中给变量赋值了\n（5）在playbook中定义变量\n    vars:\n    - username: testuser1\n    - groupname: testgroup1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- hosts: all\n  remote_user: root\n  vars:\n    - username: robby\n    - groupname: xkd\n  tasks:\n    - name: create group\n      group: name={{ groupname }} state=present\n    - name: create user\n      user: name={{ username }} state=present\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 在second.yaml中\n- hosts: webservers\n  remote_user: root\n  tasks:\n  - name: install {{ service }}\n  # 注意：这里的变量引用使用的是{{  }}\n    yum: name={{ service }} state=present\n\n\n# 这里是在命令行给定pkname的值\nansible-playbook -e service=memcached second.yaml \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 在/etc/ansible/hosts文件中指定变量名\n# 第一个使得不同主机使用不同值的变量\n[webservers]\n192.168.23.20 host_name=www1\n192.168.23.21 host_name=www2\n# 第二个使得不同主机使用相同的变量，直接给组定义一个变量值就是了，这里的vars表示给不同的主机名指定相同的变量，在YAML文件中引用就好了\n[webservers:vars]\nservice=httpd\n\n# 在third.yaml中引用变量名,这样就使用不同的远端主机可以使用不同变量的值了，\n- hosts: webservers\n  remote_user: root\n  tasks:\n  - name: set hostname {{ host_name }}\n    hostname: name={{ host_name }}\n  # 这里的service变量表示，所有的主机都使用一个变量名\n  - name: install {{ service }}\n    yum: name={{ service }} state=present\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("ansible template 模块使用")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：首先通过ansible在被管控的主机上安装Nginx\n\n2：再在ansible的主机上安装Nginx，拿到配置文件。且配置文件是centos 7安装Nginx的配置文件，在配置文件中有一个参数叫worker_processes，是设置Nginx的进程的数量的参数，使得模板复制过去之后，就会使得系统的CPU的数量为多少，Nginx的worker_processes进程数就是多少。\nNginx的配置文件中，worker_processes的数量是这样定义的，在模板中引用ansible_processor_vcpus变量名，这个变量名是ansible通过setup模块自带的参数，因此可以直接获取。\nworker_processes {{ ansible_processor_vcpus }};\n\n3：那么在ansible主机就可以编写YAML文件了\n- hosts: webservers\n  remote_user: root\n  tasks:\n    - name: install nginx\n      yum: name=nginx state=present\n    - name: install configure file\n      template: src=files/nginx.conf dest=/etc/nginx/nginx.conf\n      notify: restart nginx\n      tags: instconf\n    - name: start nginx service\n      service: name=nginx state=started\n  handlers:\n    - name: restart nginx\n      service: name=nginx state=restarted\n\n4：执行ansible-playbook\nansible-playbook third.yaml \n\n5：在被管控主机上检查：不同的CPU核心数的Nginx的配置文件中的worker_processes的数量不一样\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("也可以在template需要拷贝的文件中，使用运算符")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 在需要复制的文件中使用变量\nworker_processes {{ ansible_processor_vcpus-1 }};\n\n# 使用ansible-playbook中使用模板\n- hosts: webservers\n  remote_user: root\n  tasks:\n    - name: install nginx\n      yum: name=nginx state=present\n    - name: install configure file\n      template: src=files/nginx.conf dest=/etc/nginx/nginx.conf\n      notify: restart nginx\n      tags: distributeConf\n    - name: start nginx service\n      service: name=nginx state=started\n  handlers:\n    - name: restart nginx\n      service: name=nginx state=restarted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("Playbook的条件判断机制（在tasks中使用）")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('tasks:\n  - name: distribute config file to centos7\n    template: src=files/nginx.conf.centos7 dest=/etc/nginx/nginx.conf\n  # 这里指定只有在主版本号为7的时候，才会复制这个文件\n    when: ansible_distribution_major_version == "7"\n  - name: distribute config file to centos6\n    template: src=files/nginx.conf.centos6 dest=/etc/nginx/nginx.conf\n  # 这里指定只有在主版本号为6的时候，才会复制这个文件\n    when: ansible_distribution_major_version == "6"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[a("strong",[a("code",[s._v("task中使用with_items给定要迭代的元素列表")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("这就是item实现的循环，让yum安装不同的软件的时候，可以使用列表的形式，然后使用一个yum任务就安装了所有在列表中需要安装的软件\ntasks: \n  - name: install some packages\n    yum: name={{item}} state=present\n    with_items: \n      - nginx\n      - memcached\n      - php-fpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- name: add some groups\n  # 这是用列表存储变量\n  group: name={{ item }} state=present\n  with_items: \n    - group11\n    - group12\n    - group13\n- name: add some users\n  # 这是用字典存储变量\n  user: name={{ item.name }} group={{ item.group }} state=present\n  with_items:\n    - { name: 'user11',group: 'group11' }    \n    - { name: 'user12',group: 'group12' } \n    - { name: 'user13',group: 'group13' } \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"三-ansible如果管理节点过多-出现卡死"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-ansible如果管理节点过多-出现卡死"}},[s._v("#")]),s._v(" （三）ansible如果管理节点过多，出现卡死")]),s._v(" "),a("ul",[a("li",[s._v("解决方法：添加serial关键字 , serial关键字定义Ansible一次应管理多少主机，还可以将serial关键字指定为百分比，表示每次并行执行的主机数占总数的比例")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#vim test_serial.yml\n---\n- hosts: all\n  serial: 2  #每次只同时处理2个主机\n  gather_facts: False\n\n  tasks:\n    - name: task one\n      comand: hostname\n    - name: task two\n      command: hostname\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);