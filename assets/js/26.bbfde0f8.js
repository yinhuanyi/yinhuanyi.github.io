(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1014:function(s,a,n){s.exports=n.p+"assets/img/2018-08-197.50.28.38edad4d.png"},1015:function(s,a,n){s.exports=n.p+"assets/img/2018-08-198.29.26.58a75eae.png"},1016:function(s,a,n){s.exports=n.p+"assets/img/pmg.5bf07f53.png"},1017:function(s,a,n){s.exports=n.p+"assets/img/tech.013d564e.png"},1018:function(s,a,n){s.exports=n.p+"assets/img/2018-08-247.58.34.2934c451.png"},1019:function(s,a,n){s.exports=n.p+"assets/img/2018-08-249.22.51.3b88191d.png"},1020:function(s,a,n){s.exports=n.p+"assets/img/2018-08-257.24.45.0791dbcd.png"},1021:function(s,a,n){s.exports=n.p+"assets/img/2018-08-258.01.18.852b9f06.png"},1022:function(s,a,n){s.exports=n.p+"assets/img/2018-08-258.55.46.c92ab1fd.png"},1023:function(s,a,n){s.exports=n.p+"assets/img/2018-08-261.58.02.1a3a2926.png"},1024:function(s,a,n){s.exports=n.p+"assets/img/2018-08-262.54.42.313af2c9.png"},1025:function(s,a,n){s.exports=n.p+"assets/img/2018-08-262.55.41.43bfac48.png"},1026:function(s,a,n){s.exports=n.p+"assets/img/2018-08-266.51.03.bfc0601c.png"},1027:function(s,a,n){s.exports=n.p+"assets/img/2018-08-267.51.28.9f4b7e3d.png"},2402:function(s,a,n){"use strict";n.r(a);var t=n(9),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"一-开发发表评论"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-开发发表评论"}},[s._v("#")]),s._v(" （一）"),t("strong",[t("code",[s._v("开发发表评论")])])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1014),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("点击发表评论的按钮，其实就是提交ajax请求")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<script>\n    let commit = function (url, course_id, comment) {\n        $.ajax({\n            cache: false,\n            type: 'POST',\n            url: url,\n            data: {'course_id': course_id, 'comment': comment},\n            async: true,\n            dataType: 'json',\n            beforeSend: function (xhr, settings) {\n                xhr.setRequestHeader(\"X-CSRFToken\", \"{{ csrf_token }}\");\n            },\n            success: function (data) {\n\n                if (data.status == \"fail\") {\n                    if (data.msg == '您还未登入，请先登录') {\n                        window.location.href = '/login/';\n                    } else {\n\n                        alert(data.msg);\n                    }\n\n                } else if (data.status == \"success\") {\n                    // 重新刷新页面\n                    window.location.reload();\n                }\n            },\n            error: function (data) {\n                console.log('请求数据失败');\n            },\n        });\n    };\n\n    // 触发提交\n    $(\"#js-pl-submit\").on('click', function () {\n        // 获取评论\n        let comment = $(\"#js-pl-textarea\").val();\n\n\n        if(comment == \"\"){\n            alert(\"评论不能为空\");\n            return\n        }\n        // 发送ajax请求，调用commit函数\n        {#commit(\"{% url 'courses:add_comment' %}\", {{ course_id }}, comment)#}\n    });\n<\/script>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 处理用户添加课程的评论, ajax， ajax请求一般是保存到库中\nclass AddCommentView(View):\n    def post(self, request, ):\n\n        # 判断用户是否已经登入\n        if not request.user.is_authenticated():\n            error = {'status': 'fail', 'msg': '您还未登入，请先登录'}\n            # 这里将用户跳转到登录页面是在ajax中处理的，我们这只返回json对象, 如果状态是fail的，那么ajax将会跳转到导入页面\n            return HttpResponse(json.dumps(error), content_type=\"application/json\")\n\n        # 将评论存储到数据库之前，课程和内容\n        course_id = request.POST.get(\"course_id\", 0)\n        comment = request.POST.get('comment', \"\")\n\n        if course_id ### 0 and comment:\n            course_comments = CourseConments()\n            course = Course.objects.get(id=int(course_id))\n            # TODO：这里需要注意下，由于在CourseConments里面course是一个外键的约束，在存储这外键的时候，必须存储的是course实例，不能是ID，\n            # TODO：但是从CourseConments取值，可以通过filter函数指定course=course_id来取到CourseConments实例记录\n            course_comments.course = course\n            course_comments.comments = comment\n            course_comments.user = request.user\n            course_comments.save()\n            success = {'status': 'success', 'msg': '添加成功'}\n            # 这里将用户跳转到登录页面是在ajax中处理的，我们这只返回json对象, 如果状态是fail的，那么ajax将会跳转到导入页面\n            return HttpResponse(json.dumps(success), content_type=\"application/json\")\n        else:\n            error = {'status': 'fail', 'msg': '添加失败'}\n            # 这里将用户跳转到登录页面是在ajax中处理的，我们这只返回json对象, 如果状态是fail的，那么ajax将会跳转到导入页面\n            return HttpResponse(json.dumps(error), content_type=\"application/json\")\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("ul",[t("li",[s._v("编辑urls.py")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 添加课程评论的ajax请求处理\nurl(r'^add_comment/', AddCommentView.as_view(), name=\"add_comment\"),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"二-该课的同学还学过的逻辑开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-该课的同学还学过的逻辑开发"}},[s._v("#")]),s._v(" （二）"),t("strong",[t("code",[s._v("该课的同学还学过的逻辑开发")])])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1015),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("就是在CourseInfoView和CourseCommentView两个类里面，添加这个逻辑即可")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 处理\"学过这些课程的同学还学习过哪些课程\",\n        user_courses = UserCourse.objects.filter(course=course)  # 取出这个课程相关的所有的记录\n        user_ids = [user_course.user.id for user_course in user_courses]  # 获取学个这个课程的所有用户的id\n        all_user_courses = UserCourse.objects.filter(user_id__in=user_ids)  # 通过所有学过这么课程的用户的id，来获取不同的用户学习过的不同的课程记录\n        course_ids = [user_course.course.id for user_course in all_user_courses]  # 获取用户学到其他课程的所有的课程ID\n        relate_courses = Course.objects.filter(id__in=course_ids).exclude(name=course.name).order_by('-click_nums')[:3]  # 通过课程ID找出相关的课程， 且排除当前课程\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"三-使用python的mixin来判断用户是否已经登录-这个非常重要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三-使用python的mixin来判断用户是否已经登录-这个非常重要"}},[s._v("#")]),s._v(" （三）"),t("strong",[t("code",[s._v("使用Python的Mixin来判断用户是否已经登录（这个非常重要）")])])]),s._v(" "),t("ul",[t("li",[s._v("之前在很多页面，比如"),t("code",[s._v("我要学习")]),s._v("的course-video.html页面，或用户评论页面，都需要用户登录才能进入，如果判断用户没有登录，那么直接跳转到登录页面。"),t("code",[s._v("那么在这些View就可以继承一个Mixin, 这个Mixin就是用来判断用户是否登录的")])]),s._v(" "),t("li",[s._v("在apps的utils目录中，编辑一个mixin_utils.py文件，内容如下。其实这个mixin，就是在dispatch函数被调用之前，先被method_decorator装饰器装饰一下，而method_decorator装饰器又是将login_required装饰了一下，最终就是通过login_required这个函数，判断用户是否登录，如果用户没有登录，那么直接跳转到登录页面")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("from django.contrib.auth.decorators import login_required\nfrom django.utils.decorators import method_decorator\n\n# TODO： 这个mixin装饰器需要好好总结下\nclass LoginRequiredMixin(object):\n\n    @method_decorator(login_required(login_url='/users/login/'))\n    def dispatch(self, request, *args, **kwargs):\n        return super(LoginRequiredMixin, self).dispatch(request, *args, **kwargs)\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("那么在"),t("code",[s._v("CourseInfoView")]),s._v(" 和 "),t("code",[s._v("CourseCommentView")]),s._v("和"),t("code",[s._v("AddCommentView")]),s._v("等，用户必须登录才能看到的页面中，使用这个Mixin")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 首先导入\nfrom utils.mixin_utils import LoginRequiredMixin\n\n# 导入之后，直接左边继承即可\nclass CourseInfoView(LoginRequiredMixin,View):\n\nclass CourseCommentView(LoginRequiredMixin,View):\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("那么，如果用户在没有登录的情况下，点击了"),t("code",[s._v("我要学习")]),s._v("，就会直接跳转到登录页面")])])]),s._v(" "),t("h3",{attrs:{id:"四-视频播放页面的开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四-视频播放页面的开发"}},[s._v("#")]),s._v(" （四）"),t("strong",[t("code",[s._v("视频播放页面的开发")])])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1016),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("可以看到这个页面与课程章节页面以及评论页面是一样的")]),s._v(" "),t("li",[s._v("将course-play.html拷贝到templates中， 这里的页面播放器使用的一个Video.js播放插件库，(可以在百度上搜索到)，直接把这个开源的插件的js和css拷贝到页面中，如果将播放的div替代之前章节的那个div")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{% extends "base.html" %}\n{% load staticfiles %}\n{% block title %} 公开课视频 {% endblock %}\n\n\x3c!-- 面包屑部分 --\x3e\n{% block custom_bread %}\n    <section>\n        <div class="wp">\n            <div class="crumbs">\n                <ul>\n                    <li><a href="/">首页</a>></li>\n                    <li><a href="{% url \'courses:course_list\' %}">公开课</a>></li>\n                    <li>\n                        <a href="{% url \'courses:course_detail\' course.id %}">\n                            >课程详情\n                        </a>\n                    </li>\n                    <li>\n                        <a href="{% url \'courses:course_info\' course.id %}">\n                            >章节信息\n                        </a>\n                    </li>\n                    <li>\n                        <a >\n                            >{{ video.name }}\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </section>\n{% endblock %}\n\n\n{% block custom_css %}\n    <link rel="stylesheet" type="text/css" href="{% static \'css/muke/base.css\' %}"/>\n    <link rel="stylesheet" type="text/css" href="{% static \'css/muke/common-less.css\' %}"/>\n    <link rel="stylesheet" type="text/css" href="{% static \'css/muke/course/learn-less.css\' %}"/>\n    <link rel="stylesheet" type="text/css" href="{% static \'css/muke/course/common-less.css\' %}">\n    <link rel="stylesheet" type="text/css" href="{% static \'css/video-js.min.css\' %}">\n    <style>\n        .video-js .vjs-big-play-button{\n            top: 50%;\n            left: 50%;\n        }\n    </style>\n{% endblock %}\n\n{% block custom_js %}\n    <script src="{% static \'js/video.min.js\' %}" type="text/javascript"><\/script>\n{% endblock %}\n\n\n{% block content %}\n\n    <div id="main">\n    \x3c!-- 替代了章节的div --\x3e\n    <div style="width:1200px;height:675px; margin-left: 130px">\n        <video id="example_video_1" class="video-js vjs-default-skin" controls preload="none" width="1200"\n              poster="http://video-js.zencoder.com/oceans-clip.png"\n              data-setup="{}">\n            <source src="{{ video.url }}" type=\'video/mp4\'>\n        </video>\n    </div>\n\n    <div class="course-info-main clearfix w has-progress">\n\n        <div class="info-bar clearfix">\n        <div class="content-wrap clearfix">\n            <div class="content">\n                <div class="mod-tab-menu">\n                    <ul class="course-menu clearfix">\n                        <li><a class="ui-tabs-active active" id="learnOn"><span>章节</span></a></li>\n                        <li>\n                            <a id="commentOn" class="" href="{% url \'courses:course_comment\' course.id %}">\n                                <span>评论</span>\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n                <div id="notice" class="clearfix">\n                    <div class="l"### <strong>课程公告:</strong> <a  href="javascript:void(0)">Spring的文档以及相关的jar文件已上传</a> </div>\n                </div>\n\n                <div class="mod-chapters">\n                    {% for lession in lessions %}\n                        <div class="chapter chapter-active" >\n                        <h3>\n                            <span class="aui-iconfont aui-icon-move"></span>\n                            <strong><i class="state-expand"></i>{{ lession.name }}</strong>\n                        </h3>\n                        <ul class="video">\n                            {% for video in lession.get_lession_video %}\n                            <li>\n                                <a target="_blank" href="{% url \'courses:video_play\' video.id %}" class="J-media-item studyvideo">{{ video.name }} ({{ video.learn_times }}:56)\n                                    <i class="study-state"></i>\n                                </a>\n                            </li>\n                            {% endfor %}\n\n                        </ul>\n                    </div>\n                    {% endfor %}\n                </div>\n\n            </div>\n            <div class="aside r">\n                <div class="bd">\n\n                    <div class="box mb40">\n                        <h4>资料下载</h4>\n                        <ul class="downlist">\n                            {% for resource in all_resourses %}\n                            <li>\n                                <span ><i class="aui-iconfont aui-icon-file"></i>&nbsp;&nbsp;{{ resource.name }}</span>\n                                <a href="{{ MEDIA_URL }}{{ resource.download }}" class="downcode" target="_blank" download="" data-id="274" title="">下载</a>\n                            </li>\n                            {% endfor %}\n                        </ul>\n                    </div>\n                    <div class="box mb40">\n                        <h4>讲师提示</h4>\n                        <div class="teacher-info">\n                            <a href="/u/315464/courses?sort=publish" target="_blank">\n                                <img src="{{ MEDIA_URL }}{{ course.teacher.image }}" width=\'80\' height=\'80\' />\n                            </a>\n        <span class="tit">\n          <a href="/u/315464/courses?sort=publish" target="_blank">{{ course.teacher.name }}</a>\n        </span>\n                            <span class="job">{{ course.teacher.work_position }}</span>\n                        </div>\n                        <div class="course-info-tip">\n                            <dl class="first">\n                                <dt>课程须知</dt>\n                                <dd class="autowrap">{{ course.what_you_need_know }}</dd>\n                            </dl>\n                            <dl>\n                                <dt>老师告诉你能学到什么？</dt>\n                                <dd class="autowrap">{{ course.what_you_can_learn }}</dd>\n                            </dl>\n                        </div>\n                    </div>\n\n\n                    <div class="cp-other-learned  js-comp-tabs">\n                        <div class="cp-header clearfix">\n                            <h2 class="cp-tit l">学习过该课程的同学还学过：</h2>\n                        </div>\n                        <div class="cp-body">\n                            <div class="cp-tab-pannel js-comp-tab-pannel" data-pannel="course" style="display: block">\n                                \x3c!-- img 200 x 112 --\x3e\n                                <ul class="other-list">\n\n                                    {% for relate_course in relate_courses %}\n                                    <li class="curr">\n                                        <a href="{% url \'courses:course_detail\' relate_course.id %}" target="_blank">\n                                            <img src="{{ MEDIA_URL }}{{ relate_course.image }}" alt="Java入门第一季">\n                                            <span class="name autowrap">{{ relate_course.name }}</span>\n                                        </a>\n                                    </li>\n                                    {% endfor %}\n\n\n                                </ul>\n                            </div>\n                            <div class="cp-tab-pannel js-comp-tab-pannel" data-pannel="plan">\n                                <ul class="other-list">\n                                    <li class="curr">\n                                        <a href="/course/programdetail/pid/31?src=sug" target="_blank">\n                                            <img src="http://img.mukewang.com/56551e6700018b0c09600720-240-135.jpg" alt="Java工程师">\n                                            <span class="name autowrap">Java工程师</span>\n                                        </a>\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n\n                </div###    </div>\n        </div>\n        <div class="clear"></div>\n\n    </div>\n\n</div>\n    </div>\n{% endblock %}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br"),t("span",{staticClass:"line-number"},[s._v("133")]),t("br"),t("span",{staticClass:"line-number"},[s._v("134")]),t("br"),t("span",{staticClass:"line-number"},[s._v("135")]),t("br"),t("span",{staticClass:"line-number"},[s._v("136")]),t("br"),t("span",{staticClass:"line-number"},[s._v("137")]),t("br"),t("span",{staticClass:"line-number"},[s._v("138")]),t("br"),t("span",{staticClass:"line-number"},[s._v("139")]),t("br"),t("span",{staticClass:"line-number"},[s._v("140")]),t("br"),t("span",{staticClass:"line-number"},[s._v("141")]),t("br"),t("span",{staticClass:"line-number"},[s._v("142")]),t("br"),t("span",{staticClass:"line-number"},[s._v("143")]),t("br"),t("span",{staticClass:"line-number"},[s._v("144")]),t("br"),t("span",{staticClass:"line-number"},[s._v("145")]),t("br"),t("span",{staticClass:"line-number"},[s._v("146")]),t("br"),t("span",{staticClass:"line-number"},[s._v("147")]),t("br"),t("span",{staticClass:"line-number"},[s._v("148")]),t("br"),t("span",{staticClass:"line-number"},[s._v("149")]),t("br"),t("span",{staticClass:"line-number"},[s._v("150")]),t("br"),t("span",{staticClass:"line-number"},[s._v("151")]),t("br"),t("span",{staticClass:"line-number"},[s._v("152")]),t("br"),t("span",{staticClass:"line-number"},[s._v("153")]),t("br"),t("span",{staticClass:"line-number"},[s._v("154")]),t("br"),t("span",{staticClass:"line-number"},[s._v("155")]),t("br"),t("span",{staticClass:"line-number"},[s._v("156")]),t("br"),t("span",{staticClass:"line-number"},[s._v("157")]),t("br"),t("span",{staticClass:"line-number"},[s._v("158")]),t("br"),t("span",{staticClass:"line-number"},[s._v("159")]),t("br"),t("span",{staticClass:"line-number"},[s._v("160")]),t("br"),t("span",{staticClass:"line-number"},[s._v("161")]),t("br"),t("span",{staticClass:"line-number"},[s._v("162")]),t("br"),t("span",{staticClass:"line-number"},[s._v("163")]),t("br"),t("span",{staticClass:"line-number"},[s._v("164")]),t("br"),t("span",{staticClass:"line-number"},[s._v("165")]),t("br"),t("span",{staticClass:"line-number"},[s._v("166")]),t("br"),t("span",{staticClass:"line-number"},[s._v("167")]),t("br"),t("span",{staticClass:"line-number"},[s._v("168")]),t("br"),t("span",{staticClass:"line-number"},[s._v("169")]),t("br"),t("span",{staticClass:"line-number"},[s._v("170")]),t("br"),t("span",{staticClass:"line-number"},[s._v("171")]),t("br"),t("span",{staticClass:"line-number"},[s._v("172")]),t("br"),t("span",{staticClass:"line-number"},[s._v("173")]),t("br"),t("span",{staticClass:"line-number"},[s._v("174")]),t("br"),t("span",{staticClass:"line-number"},[s._v("175")]),t("br"),t("span",{staticClass:"line-number"},[s._v("176")]),t("br"),t("span",{staticClass:"line-number"},[s._v("177")]),t("br"),t("span",{staticClass:"line-number"},[s._v("178")]),t("br"),t("span",{staticClass:"line-number"},[s._v("179")]),t("br"),t("span",{staticClass:"line-number"},[s._v("180")]),t("br"),t("span",{staticClass:"line-number"},[s._v("181")]),t("br"),t("span",{staticClass:"line-number"},[s._v("182")]),t("br"),t("span",{staticClass:"line-number"},[s._v("183")]),t("br"),t("span",{staticClass:"line-number"},[s._v("184")]),t("br"),t("span",{staticClass:"line-number"},[s._v("185")]),t("br"),t("span",{staticClass:"line-number"},[s._v("186")]),t("br"),t("span",{staticClass:"line-number"},[s._v("187")]),t("br")])]),t("ul",[t("li",[s._v("编辑urls.py")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 视频播放\nurl(r'^video/(?P<video_id>\\d+)/', VideoPlayView.as_view(), name=\"video_play\"),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# 处理点击视频之后播放的请求\nclass VideoPlayView(LoginRequiredMixin,View):\n    def get(self, request, video_id):\n        video = Video.objects.get(id=int(video_id)) # 获取video记录\n        course = video.lession.course # 获取这个视频的课程记录\n        lessions = course.get_course_lession()\n        all_resourses = course.get_course_resource()\n        # 每次用户点击了这个课程开始学习的时候，让UserCourse这个model保存用户和课程\n        # 首先看看是否在UserCourse里面已经将用户和课程关联起来了，如果关联起来，就不要继续保存了\n        user_course = UserCourse.objects.filter(user=request.user, course=course)\n        if not user_course:\n            user_course = UserCourse()\n            user_course.user = request.user\n            user_course.course = course\n            user_course.save()\n            \n        # 处理"学过这些课程的同学还学习过哪些课程",\n        user_courses = UserCourse.objects.filter(course=course) # 取出这个课程相关的所有的记录\n        user_ids = [user_course.user.id for user_course in user_courses] # 获取学个这个课程的所有用户的id\n        all_user_courses = UserCourse.objects.filter(user_id__in=user_ids) # 通过所有学过这么课程的用户的id，来获取不同的用户学习过的不同的课程记录\n        course_ids = [user_course.course.id for user_course in all_user_courses] # 获取用户学到其他课程的所有的课程ID\n        relate_courses = Course.objects.filter(id__in=course_ids).order_by("-click_nums")[:5]  # 通过课程ID找出相关的课程\n        \n        return  render(request, \'course-play.html\', {\n            "lessions": lessions,\n            "all_resourses": all_resourses,\n            "course": course,\n            "relate_courses":relate_courses,\n            "video": video,\n\n        })\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("ul",[t("li",[s._v("在course-video.html页面，给视频播放一个跳转入口，")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<li>\n    <a target="_blank" href="{% url \'courses:video_play\' video.id %}" class="J-media-item studyvideo">{{ video.name }} ({{ video.learn_times }})\n        <i class="study-state"></i>\n    </a>\n</li>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("视频文件使用的是七牛云的对象存储，也可以使用腾讯的对象存储，或自建对象存储。直接将视频的连接拷贝到video的url即可播放")])]),s._v(" "),t("h3",{attrs:{id:"五-授课讲师列表页面的开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五-授课讲师列表页面的开发"}},[s._v("#")]),s._v(" （五）"),t("strong",[t("code",[s._v("授课讲师列表页面的开发")])])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1017),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("将 "),t("code",[s._v("teachers-list.html")]),s._v("拷贝到templates中，且继承与base.html页面")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{% extends "base.html" %}\n{% load staticfiles %}\n{% block title %} 授课教师 {% endblock %}\n\n\n\x3c!-- 面包屑部分 --\x3e\n{% block custom_bread %}\n    <section>\n        <div class="wp">\n            <div class="crumbs">\n                <ul>\n                    <li><a href="/">首页</a>></li>\n                    <li><a href="{% url \'courses:course_list\' %}">授课讲师</a>></li>\n\n                </ul>\n            </div>\n        </div>\n    </section>\n{% endblock %}\n\n\n\n{% block content %}\n    <section>\n        <div class="wp butler_list_box list">\n\n            \x3c!-- 左边的布局 --\x3e\n            <div class=\'left\'>\n                <div class="butler_list layout">\n                    <div class="head">\n                        <ul class="fl tab_header">\n                            <li {% ifequal sort \'hot\' %} class="" {% else %} class="active" {% endifequal %}><a href="?sort=">全部</a></li>\n                            <li {% ifequal sort \'hot\' %} class="active" {% else %} class="" {% endifequal %} ><a href="?sort=hot">人气 &#8595;</a></li>\n                        </ul>\n                        <div class="fr butler-num">共<span class="key">{{ org_nums }}</span>人&nbsp;&nbsp;&nbsp;\n                        </div>\n                    </div>\n                    {% for teacher in all_teachers.object_list %}\n                        <dl class="des">\n                            <dt>\n{#                                <a href="{% url \'org:teacher_detail\' teacher.id %}">#}\n                                <a href="">\n                                    <div class="picpic">\n                                        <img width="100" height="100" class="scrollLoading"\n                                             data-url="{{ MEDIA_URL }}{{ teacher.image }}"\n                                             src="{{ MEDIA_URL }}{{ teacher.image }}"/>\n                                    </div>\n                                </a>\n                                <div class="btn">\n                                    <div class="fr btn2 bdsharebuttonbox" data-url="/diary/hk_detail/10/">\n                                        <span class="fl"><a style="color: white" href=""### 给我点赞哦</a></span>\n                                    </div>\n                                </div>\n                            </dt>\n                            <dd>\n{#                                <a href="{% url \'org:teacher_detail\' teacher.id %}">#}\n                                <a href="">\n                                    <h1>{{ teacher.name }}<span class="key picbig">金牌讲师</span></h1>\n                                </a>\n                                <ul class="cont">\n                                    <li>工作年限：<span>{{ teacher.work_years }}</span></li>\n                                    <li>工作职位：<span>{{ teacher.work_position }}</span></li>\n                                    <li>就职公司：<span>{{ teacher.work_company }}&nbsp;</span></li>\n                                    <li>经典课程：<span>{{ teacher }}</span></li>\n                                    <li>年龄：<span>{{ teacher.age }}</span></li>\n                                    <li>教学特点：<span>{{ teacher.desc }}</span></li>\n                                </ul>\n                            </dd>\n{#                            <a class="buy buyservice" href="{% url \'org:teacher_detail\' teacher.id %}"><br/>查看<br/>详情</a>#}\n                            <a class="buy buyservice" href=""><br/>查看<br/>详情</a>\n                        </dl>\n                    {% endfor %}\n\n\n                </div>\n\n                <div class="pageturn">\n\n                    \x3c!-- 显示前一页 --\x3e\n                    {% if all_teachers.has_previous %}\n\n                        <li class="long" style="list-style: none">\n                            <a href="?{{ all_teachers.previous_page_number.querystring }}">上一页</a>\n                        </li>\n                    {% endif %}\n\n                    \x3c!-- 显示中间的页面 --\x3e\n                    {% for page in all_teachers.pages %}\n                        {% if page %}\n                            {% ifequal page all_teachers.number %}\n                                <li class="active" style="list-style: none">\n                                    <a>{{ page }}</a>\n                                </li>\n                            {% else %}\n                                <li  class="page" style="list-style: none">\n                                    <a href="?{{ page.querystring }}" >{{ page }}</a>\n                                </li>\n                            {% endifequal %}\n                        {% else %}\n                            <li class="none" style="list-style: none">\n                                <a href="">...</a>\n                            </li>\n                        {% endif %}\n                    {% endfor %}\n\n                    \x3c!-- 显示末尾页面 --\x3e\n                    {% if all_teachers.has_next %}\n                        <li class="long" style="list-style: none">\n                            <a  href="?{{ all_teachers.next_page_number.querystring }}" >下一页</a>\n                        </li>\n\n                    {% endif %}\n\n                </div>\n\n\n            </div>\n\n\n            \x3c!-- 右边的布局 --\x3e\n            <div class="right layout">\n                <div class="head">讲师排行榜</div>\n                {% for teacher in sorted_teachers %}\n                <dl class="des">\n                    <span class="num fl">{{ forloop.counter }}</span>\n{#                    <a href="{% url \'org:teacher_detail\' teacher.id %}">#}\n                    <a href="">\n                        <dt>\n                            <img width="50" height="50" class="scrollLoading" data-url="{{ MEDIA_URL }}{{ teacher.image }}"\n                                 src="{{ MEDIA_URL }}{{ teacher.image }}"/>\n                        </dt>\n                    </a>\n                    <dd>\n{#                        <a href="{% url \'org:teacher_detail\' teacher.id %}">#}\n                        <a href="">\n                            <h1 title="欧阳锋">{{ teacher.name }}</h1>\n                        </a>\n                        <p>工龄：<span>{{ teacher.work_years }}年</span></p>\n                    </dd>\n                </dl>\n                {% endfor %}\n            </div>\n        </div>\n    </section>\n{% endblock %}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br"),t("span",{staticClass:"line-number"},[s._v("133")]),t("br"),t("span",{staticClass:"line-number"},[s._v("134")]),t("br"),t("span",{staticClass:"line-number"},[s._v("135")]),t("br"),t("span",{staticClass:"line-number"},[s._v("136")]),t("br"),t("span",{staticClass:"line-number"},[s._v("137")]),t("br"),t("span",{staticClass:"line-number"},[s._v("138")]),t("br"),t("span",{staticClass:"line-number"},[s._v("139")]),t("br"),t("span",{staticClass:"line-number"},[s._v("140")]),t("br"),t("span",{staticClass:"line-number"},[s._v("141")]),t("br"),t("span",{staticClass:"line-number"},[s._v("142")]),t("br"),t("span",{staticClass:"line-number"},[s._v("143")]),t("br"),t("span",{staticClass:"line-number"},[s._v("144")]),t("br"),t("span",{staticClass:"line-number"},[s._v("145")]),t("br")])]),t("ul",[t("li",[s._v("配置settings下的urls.py文件， 由于之前设置app的时候，是将teacher和organization合并到一个organization这个APP里面的，所以这里处理路由的时候，直接将二级路由写在organization.urls里面，")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("url(r'^teacher/', include('organization.urls',namespace=\"courses\")),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("编辑organization下的urls.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("url(r'^teacher/list/', TeacherListView.as_view(), name='teacher_list'),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# 处理老师列表页的请求\nclass TeacherListView(View):\n    def get(self, request):\n        all_teachers = Teacher.objects.all()\n\n        # todo：实现讲师基于关键字搜索的功能（需求掌握ES的搜索）\n        search_keywords = request.GET.get("keywords", "")\n        if search_keywords:\n            all_teachers = all_teachers.filter(\n                Q(name__icontains=search_keywords) | Q(desc__icontains=search_keywords) | Q(\n                    work_position__icontains=search_keywords))\n\n        # 解决人气排序\n        sort = request.GET.get(\'sort\', \'\')\n        all_teachers = all_teachers.order_by("-click_nums") if sort == "hot" else all_teachers.order_by("add_time")\n\n        # 解决讲师排行榜\n        sorted_teachers = all_teachers.order_by("-work_years")[:3]\n\n        # 对课程机构进行分页\n        try:  # 默认是第一页\n            page = request.GET.get(\'page\', 1)\n        except PageNotAnInteger:\n            page = 1\n\n        p = Paginator(all_teachers, per_page=2, request=request)  # 通过所有机构的记录创建分页器\n\n        teachers = p.page(page)  # 翻页器默认从第一页显示\n\n        # 获取机构的数量\n        org_nums = all_teachers.count()\n\n\n        return  render(request, \'teachers-list.html\', {\n            "all_teachers":teachers,\n            "org_nums": org_nums,\n            "sort": sort,\n            "sorted_teachers": sorted_teachers,\n        })\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("ul",[t("li",[s._v("在前端的base.html页面加入讲师列表页面的路口url")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<li {% if request.path|slice:'12' == '/org/teacher' %} class=\"active\" {% endif %}>\n\t<a href=\"{% url 'teacher:teacher_list' %}\">授课教师</a>\n</li>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"六-授课讲师详情页面的开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六-授课讲师详情页面的开发"}},[s._v("#")]),s._v(" （六）"),t("strong",[t("code",[s._v("授课讲师详情页面的开发")])])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1018),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("将"),t("code",[s._v("teacher-detail.html")]),s._v(" 拷贝到templates模板中，且继承与base.html页面")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{% extends "base.html" %}\n{% load staticfiles %}\n{% block title %} 授课教师 {% endblock %}\n\n\n\x3c!-- 面包屑部分 --\x3e\n{% block custom_bread %}\n    <section>\n        <div class="wp">\n            <div class="crumbs">\n                <ul>\n                    <li><a href="/">首页</a>></li>\n                    <li><a href="{% url \'courses:course_list\' %}">授课讲师</a>></li>\n\n                </ul>\n            </div>\n        </div>\n    </section>\n{% endblock %}\n\n\n\n{% block content %}\n    <section>\n        <div class="wp butler_list_box list">\n\n            \x3c!-- 左边的布局 --\x3e\n            <div class=\'left\'>\n                <div class="butler_list layout">\n                    <div class="head">\n                        <ul class="fl tab_header">\n                            <li {% ifequal sort \'hot\' %} class="" {% else %} class="active" {% endifequal %}><a href="?sort=">全部</a></li>\n                            <li {% ifequal sort \'hot\' %} class="active" {% else %} class="" {% endifequal %} ><a href="?sort=hot">人气 &#8595;</a></li>\n                        </ul>\n                        <div class="fr butler-num">共<span class="key">{{ org_nums }}</span>人&nbsp;&nbsp;&nbsp;\n                        </div>\n                    </div>\n                    {% for teacher in all_teachers.object_list %}\n                        <dl class="des">\n                            <dt>\n                                <a href="{% url \'org:teacher_detail\' teacher.id %}">\n                                \n                                    <div class="picpic">\n                                        <img width="100" height="100" class="scrollLoading"\n                                             data-url="{{ MEDIA_URL }}{{ teacher.image }}"\n                                             src="{{ MEDIA_URL }}{{ teacher.image }}"/>\n                                    </div>\n                                </a>\n                                <div class="btn">\n                                    <div class="fr btn2 bdsharebuttonbox" data-url="/diary/hk_detail/10/">\n                                        <span class="fl"><a style="color: white" href=""### 给我点赞哦</a></span>\n                                    </div>\n                                </div>\n                            </dt>\n                            <dd>\n                                <a href="{% url \'org:teacher_detail\' teacher.id %}">\n                                \n                                    <h1>{{ teacher.name }}<span class="key picbig">金牌讲师</span></h1>\n                                </a>\n                                <ul class="cont">\n                                    <li>工作年限：<span>{{ teacher.work_years }}</span></li>\n                                    <li>工作职位：<span>{{ teacher.work_position }}</span></li>\n                                    <li>就职公司：<span>{{ teacher.work_company }}&nbsp;</span></li>\n                                    <li>经典课程：<span>{{ teacher }}</span></li>\n                                    <li>年龄：<span>{{ teacher.age }}</span></li>\n                                    <li>教学特点：<span>{{ teacher.desc }}</span></li>\n                                </ul>\n                            </dd>\n                            <a class="buy buyservice" href="{% url \'org:teacher_detail\' teacher.id %}"><br/>查看<br/>详情</a>\n                            \n                        </dl>\n                    {% endfor %}\n\n\n                </div>\n\n                <div class="pageturn">\n\n                    \x3c!-- 显示前一页 --\x3e\n                    {% if all_teachers.has_previous %}\n\n                        <li class="long" style="list-style: none">\n                            <a href="?{{ all_teachers.previous_page_number.querystring }}">上一页</a>\n                        </li>\n                    {% endif %}\n\n                    \x3c!-- 显示中间的页面 --\x3e\n                    {% for page in all_teachers.pages %}\n                        {% if page %}\n                            {% ifequal page all_teachers.number %}\n                                <li class="active" style="list-style: none">\n                                    <a>{{ page }}</a>\n                                </li>\n                            {% else %}\n                                <li  class="page" style="list-style: none">\n                                    <a href="?{{ page.querystring }}" >{{ page }}</a>\n                                </li>\n                            {% endifequal %}\n                        {% else %}\n                            <li class="none" style="list-style: none">\n                                <a href="">...</a>\n                            </li>\n                        {% endif %}\n                    {% endfor %}\n\n                    \x3c!-- 显示末尾页面 --\x3e\n                    {% if all_teachers.has_next %}\n                        <li class="long" style="list-style: none">\n                            <a  href="?{{ all_teachers.next_page_number.querystring }}" >下一页</a>\n                        </li>\n\n                    {% endif %}\n\n                </div>\n\n\n            </div>\n\n\n            \x3c!-- 右边的布局 --\x3e\n            <div class="right layout">\n                <div class="head">讲师排行榜</div>\n                {% for teacher in sorted_teachers %}\n                <dl class="des">\n                    <span class="num fl">{{ forloop.counter }}</span>\n{#                    <a href="{% url \'org:teacher_detail\' teacher.id %}">#}\n                    <a href="">\n                        <dt>\n                            <img width="50" height="50" class="scrollLoading" data-url="{{ MEDIA_URL }}{{ teacher.image }}"\n                                 src="{{ MEDIA_URL }}{{ teacher.image }}"/>\n                        </dt>\n                    </a>\n                    <dd>\n{#                        <a href="{% url \'org:teacher_detail\' teacher.id %}">#}\n                        <a href="">\n                            <h1 title="欧阳锋">{{ teacher.name }}</h1>\n                        </a>\n                        <p>工龄：<span>{{ teacher.work_years }}年</span></p>\n                    </dd>\n                </dl>\n                {% endfor %}\n            </div>\n        </div>\n    </section>\n{% endblock %}\n\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br"),t("span",{staticClass:"line-number"},[s._v("133")]),t("br"),t("span",{staticClass:"line-number"},[s._v("134")]),t("br"),t("span",{staticClass:"line-number"},[s._v("135")]),t("br"),t("span",{staticClass:"line-number"},[s._v("136")]),t("br"),t("span",{staticClass:"line-number"},[s._v("137")]),t("br"),t("span",{staticClass:"line-number"},[s._v("138")]),t("br"),t("span",{staticClass:"line-number"},[s._v("139")]),t("br"),t("span",{staticClass:"line-number"},[s._v("140")]),t("br"),t("span",{staticClass:"line-number"},[s._v("141")]),t("br"),t("span",{staticClass:"line-number"},[s._v("142")]),t("br"),t("span",{staticClass:"line-number"},[s._v("143")]),t("br"),t("span",{staticClass:"line-number"},[s._v("144")]),t("br"),t("span",{staticClass:"line-number"},[s._v("145")]),t("br"),t("span",{staticClass:"line-number"},[s._v("146")]),t("br"),t("span",{staticClass:"line-number"},[s._v("147")]),t("br")])]),t("ul",[t("li",[s._v("配置urls.py")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("url(r'^teacher/detail/(?P<teacher_id>\\d+)/', TeacherDetailView.as_view(), name='teacher_detail'),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('class TeacherDetailView(View):\n    def get(self, request, teacher_id):\n\n        teacher = Teacher.objects.get(id=int(teacher_id))\n        all_teachers = Teacher.objects.all().order_by("-click_nums")[:3]\n        all_courses = Course.objects.filter(teacher=teacher)\n\n        # 每次点击了老师详情页，点击数加一\n        teacher.click_nums += 1\n        teacher.save()\n\n        # 显示页面重新刷新后的收藏和已收藏逻辑\n        has_teacher_faved = False\n        has_org_faved = False\n        if UserFavorite.objects.filter(fav_id=teacher.id, fav_type=3):\n            has_teacher_faved = True\n        if UserFavorite.objects.filter(fav_id=teacher.org.id, fav_type=2):\n            has_org_faved = True\n\n\n        return  render(request, \'teacher-detail.html\', {\n            "teacher": teacher,\n            "teacher_id": teacher_id,\n            "all_teachers": all_teachers,\n            "all_courses": all_courses,\n            "has_teacher_faved": has_teacher_faved,\n            "has_org_faved": has_org_faved,\n        })\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("ul",[t("li",[s._v("在"),t("code",[s._v("teachers-list.html")]),s._v("文件中，给"),t("code",[s._v("teacher-detail.html")]),s._v("页面配置跳转")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<a href="{% url \'org:teacher_detail\' teacher.id %}">\n    <div class="picpic">\n        <img width="100" height="100" class="scrollLoading"\n             data-url="{{ MEDIA_URL }}{{ teacher.image }}"\n             src="{{ MEDIA_URL }}{{ teacher.image }}"/>\n    </div>\n</a>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("这个页面也有一个收藏按钮")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("左边收藏的是老师，右边收藏的是机构\n这里的特别之处在于：点击左边或者右边的收藏按钮并不会刷新页面，而是给收藏按钮动态的增加或删除样式，和改变按钮的文字。如何判断取决于View返回的json值\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:n(1019),alt:"Alt text"}})]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("add_fav")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("current_elem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fav_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fav_type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ajax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'POST'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{% url 'org:add_fav' %}\"")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fav_id'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" fav_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fav_type'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" fav_type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这里没有form表达提交，因此，不需要序列号")]),s._v("\n            async"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            dataType"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'json'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("beforeSend")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("xhr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" settings")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                xhr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setRequestHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-CSRFToken"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ csrf_token }}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("success")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fail"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'您还未登入，请先登录'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("href "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/login/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"收藏"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            current_elem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("removeClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fav"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n                        current_elem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("text")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"已收藏"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            current_elem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fav"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    current_elem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("text")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'请求数据失败'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" 左边的收藏按钮：收藏老师 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#leftadd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'click'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_fav")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" teacher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" 右边的收藏按钮：收藏机构 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#rightadd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'click'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_fav")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" teacher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])]),t("h3",{attrs:{id:"七-对templates目录的重构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#七-对templates目录的重构"}},[s._v("#")]),s._v(" （七）"),t("strong",[t("code",[s._v("对templates目录的重构")])])]),s._v(" "),t("ul",[t("li",[s._v("之前所有的HTML页面都写在templates目录下，那么会使得这个目录越来越臃肿，因此：可以在templates目录下，创建多个目录，分别以APP的名称命名， 将对应的APP使用到的HTML拖入对应的APP之下，最后，在views.py文件中，将返回前端的HTML页面的路径修改。如果某个HTML页面继承于某个页面，那么也需要在HTML页面中修改被继承的页面的HTML页面的地址")]),s._v(" "),t("li",[t("strong",[s._v("重构之前")]),s._v(" "),t("img",{attrs:{src:n(1020),alt:"Alt text"}})]),s._v(" "),t("li",[t("strong",[s._v("修改之后")]),s._v(" "),t("img",{attrs:{src:n(1021),alt:"Alt text"}})]),s._v(" "),t("li",[s._v("在views.py文件的修改示例， 不再是一个"),t("code",[s._v("register.html")]),s._v("，而是"),t("code",[s._v("users/register.html")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("render(request, \"users/register.html\", {'register_form': register_form})\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"八-目前所有的页面-除了org的几个页面以外-都是继承于base-html页面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#八-目前所有的页面-除了org的几个页面以外-都是继承于base-html页面"}},[s._v("#")]),s._v(" （八）"),t("strong",[t("code",[s._v("目前所有的页面，除了org的几个页面以外，都是继承于base.html页面")])])]),s._v(" "),t("ul",[t("li",[s._v("让index.html页面继承于base.html页面, index.html页面，除了content部分与base.html不一样以外，还有一个就是有一个js文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{% block custom_js %}\n    <script type="text/javascript" src="{% static \'js/index.js\' %}"><\/script>\n{% endblock %}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"九-导航栏中-导航条的开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#九-导航栏中-导航条的开发"}},[s._v("#")]),s._v(" （九）"),t("strong",[t("code",[s._v("导航栏中，导航条的开发")])])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1022),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("首先需要需要处理的就是导航条的开发，因为现在"),t("code",[s._v("首要、公开课、授课讲师、授课机构")]),s._v("的页面逻辑功能都已经做好了，那么现在就是实现点击了公共课，公开课变绿，这样的功能。"),t("code",[s._v("这种实现方式有两种")])]),s._v(" "),t("li",[s._v("第一种是通过views将一个变量传递到前端，前端判断这个变量的值，举个例子")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("实现方式：\n\t当用户点击授课讲师的时候，在TeacherListView中，返回一个变量，例如:\n\tnav = 'teacher' \n\t那么前端页面就可以判断nav这个变量的值是否为teacher，来决定是否将 授课讲师 的按钮显示为绿色，\n\t如果传递到前端的nav变量的值是 'org'， 那么说明用户点击的是 授课机构，那么授课讲师按钮就不会变为绿色，而授课机构的按钮就会变为绿色\n\n\n缺点：\n\t如果用户点击了授课讲师页面的讲师详情页，那么讲师详情页面也需要将nav这个变量返回给前端页面。我们现在有好几十个页面，每一个页面都返回同一个变量，这样是重复的做法，不推荐\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("第二种是通过，页面的url来判断，用户访问到了哪个APP。例如：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("当用户点击"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("公共课"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("的时候，url是：http://0.0.0.0:12345/course/list/ ， 那么就可以取到url中的course，如果是course，就让公共课变绿。\n\n那代码就可以这么改：使用的是Django的模板语法\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wp"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ul"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("li "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request.path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),s._v(" %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endif %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{% url 'index' %}\"")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("首页"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/li"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("li "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request.path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("slice:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'7'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/course'")]),s._v(" %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endif %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{% url 'courses:course_list' %}\"")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("公开课"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/li"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("li "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request.path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("slice:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/teacher'")]),s._v(" %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endif %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{% url 'teacher:teacher_list' %}\"")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("授课教师"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/li"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("li "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request.path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("slice:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/org'")]),s._v(" %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"active"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endif %"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{% url 'org:org_list' %}\"")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("授课机构"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/li"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/ul"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/div"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"十-导航栏中-搜索功能的开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十-导航栏中-搜索功能的开发"}},[s._v("#")]),s._v(" （十）"),t("strong",[t("code",[s._v("导航栏中，搜索功能的开发")])])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1023),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("这个功能是这样的：当用户在搜索栏中选择"),t("code",[s._v("公共课")]),s._v("，且在对应的input框中输入了关键字，在View中，首先通过关键字的like查询课程名，如果匹配到了对应的课程，那么将课程返回即可")]),s._v(" "),t("li",[s._v("这个搜索功能是在前端的"),t("code",[s._v("base.html")]),s._v("页面中完成的，调用的是"),t("code",[s._v('<script src="{% static \'js/deco-common.js\' %}" type="text/javascript"><\/script>')]),s._v("这个js文件中的"),t("code",[s._v("search_click")]),s._v("这个js函数")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// todo:顶部搜索栏搜索方法")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("search_click")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#jsSelectOption'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("attr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data-value'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        keywords "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#search_keywords'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("val")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        request_url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keywords "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果js获取到input框中关键字为空，直接return, return表示不会向后台提交请求")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"course"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果keywords不为空，那么拼接url，这里的js是在js文件中，因此无法使用Django的模板语言引用url")]),s._v("\n        request_url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/course/list?keywords="')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("keywords\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"teacher"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        request_url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/teacher/teacher/list?keywords="')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("keywords\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        request_url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/org/list?keywords="')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("keywords\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这样是直接浏览器发送get请求，类似一个a标签的href属性")]),s._v("\n    window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("href "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request_url\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("ul",[t("li",[s._v("那么在views.py文件就需要在排序之前，先将需要返回的记录对象过滤。这里使用到了Django的模板语法，"),t("code",[s._v("name__icontains=search_keywords")]),s._v(" 表示：只要name字段模糊匹配到关键字的都返回，icontains表示不区分大小写。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("search_keywords "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request.GET.get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keywords"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" search_keywords:\n\t\tall_courses "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" all_courses.filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name__icontains"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("search_keywords"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("Q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("desc__icontains"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("search_keywords"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("Q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("detail__icontains"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("search_keywords"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("那么在"),t("code",[s._v("课程列表页，讲师列表页，机构列表页")]),s._v("都是一样的处理逻辑")])]),s._v(" "),t("h3",{attrs:{id:"十一-用户个人中心页面的开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十一-用户个人中心页面的开发"}},[s._v("#")]),s._v(" （十一）"),t("strong",[t("code",[s._v("用户个人中心页面的开发")])])]),s._v(" "),t("ul",[t("li",[s._v("当用户将鼠标放在用户的头像，就会出现个人中心的下拉框\n"),t("img",{attrs:{src:n(1024),alt:"Alt text"}})]),s._v(" "),t("li",[s._v("点击"),t("code",[s._v("进入个人中心")]),s._v("，就来到了用户个人中心页面\n"),t("img",{attrs:{src:n(1025),alt:"Alt text"}})]),s._v(" "),t("li",[s._v("将"),t("code",[s._v("usercenter-base.html，usercenter-fav-course.html，usercenter-fav-org.html，usercenter-fav-teacher.html，usercenter-home.html，usercenter-info.html，usercenter-message.html，usercenter-mycourse.html")]),s._v(", 这9个HTML文件拷贝到templates/users目录下")]),s._v(" "),t("li",[s._v("因为这几个页面与base.html页面不一样，只有上面的那个灰色的头部条，那么可以让其他页面继承于"),t("code",[s._v("usercenter-base.html")]),s._v(", 下面是usercenter-info.html的内容")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{% extends \'usercenter-base.html\' %}\n\n{% block title %}\n    个人信息\n{% endblock %}\n\n{% block custom_bread %}\n<section>\n\t<div class="wp">\n\t\t<ul  class="crumbs">\n\t\t\t<li><a href="{% url \'index\' %}">首页</a>></li>\n\t\t\t<li><a href="{% url \'users:user_info\' %}">个人中心</a>></li>\n            <li><a>个人资料</a>></li>\n\n\t\t</ul>\n\t</div>\n</section>\n{% endblock %}\n{% block right_content %}\n    <div class="right">\n\t\t<div class="personal_des ">\n\t\t\t<div class="head" style="border:1px solid #eaeaea;">\n\t\t\t\t<h1>个人信息</h1>\n\t\t\t</div>\n\t\t\t<div class="inforcon">\n\t\t\t\t<div class="left" style="width:242px;">\n                    <iframe id=\'frameFile\' name=\'frameFile\' style=\'display: none;\'></iframe>\n                    \x3c!-- 用户上传的头像文件是通过form表单上传的 --\x3e\n                    \x3c!-- todo: enctype="multipart/form-data" 属性指定上传的是文件类型 --\x3e\n                    \x3c!-- todo:  target=\'frameFile\' 属性指定在iframe中打开这个上传的接口--\x3e\n                    <form class="clearfix" id="jsAvatarForm" enctype="multipart/form-data" autocomplete="off" method="post" action="{% url \'users:image_upload\' %}" target=\'frameFile\'>\n                        <label class="changearea" for="avatarUp">\n                            <span id="avatardiv" class="pic">\n                                <img width="100" height="100" class="js-img-show" id="avatarShow" src="{{ MEDIA_URL }}{{ request.user.image }}"/>\n                            </span>\n                            <span class="fl upload-inp-box" style="margin-left:70px;">\n                                <span class="button btn-green btn-w100" id="jsAvatarBtn">修改头像</span>\n                                <input type="file" name="avatar_url" id="avatarUp" class="js-img-up"/>\n                            </span>\n                        </label>\n                        <input type=\'hidden\' name=\'csrfmiddlewaretoken\' value=\'sJcSi17mvC0dE06Qj4LH2i17uic2JOgy\' />\n                        {% csrf_token %}\n                    </form>\n                    <div style="border-top:1px solid #eaeaea;margin-top:30px;">\n                        <a class="button btn-green btn-w100" id="jsUserResetPwd" style="margin:80px auto;width:100px;">修改密码</a>\n                    </div>\n\t\t\t\t</div>\n\t\t\t\t<form class="perinform" id="jsEditUserForm" autocomplete="off">\n\t\t\t\t\t<ul class="right">\n\t\t\t\t\t\t<li>昵&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：\n\t\t\t\t\t\t  \x3c!-- 这里的request.user等价于Userprofile那么model --\x3e\n                           <input type="text" name="nick_name" id="nick_name" value="{{ request.user.nick_name }}" maxlength="10">\n                            <i class="error-tips"></i>\n                        </li>\n\t\t\t\t\t\t<li>生&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日：\n                           <input type="text"  name="birday" value="{{ request.user.birday|date:\'Y-m-d\' }}" id="birth_day" readonly="readonly"/>\n                            <i class="error-tips"></i>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别：\n\t\t\t\t\t\t\t<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio"  name="gender" value="male" {% if request.user.gender == \'male\' %} checked="checked" {% endif %}>男</label>\n\t\t\t\t\t\t\t<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="gender" value="female"  {% if request.user.gender == \'female\' %} checked="checked" {% endif %}>女</label>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="p_infor_city">地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;址：\n                            \x3c!-- 如果这里的值是空的话，在前端页面不会显示Non，显示的是空 --\x3e\n                            <input type="text" name="address" value="{{ request.user.address|default_if_none:\'\' }}" id="nick_name" placeholder="请输入你的地址" maxlength="10">\n\t\t\t\t\t\t    <i class="error-tips"></i>\n                        </li>\n\t\t\t\t\t\t<li>手&nbsp;&nbsp;机&nbsp;&nbsp;号：\n                            <input type="text" name="mobile" value="{{ request.user.mobile }}" id="mobile" placeholder="请输入你的手机号码" maxlength="10">\n                        </li>\n                        <li>邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;箱：\n                        \t<input class="borderno" type="text" name="email" readonly="readonly" value="{{ request.user.email }}"/>\n                            <span class="green changeemai_btn">[修改]</span>\n                    \t</li>\n\t\t\t\t\t\t<li class="button heibtn">\n\t\t\t\t\t\t\t<input type="button" id="jsEditUserBtn" value="保存">\n                            <input type="hidden" name="uid" value="1" />\n\t\t\t\t\t\t</li>\n                    <input type=\'hidden\' name=\'csrfmiddlewaretoken\' value=\'sJcSi17mvC0dE06Qj4LH2i17uic2JOgy\' />\n\t\t\t\t\t</ul>\n                    {% csrf_token %}\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{% endblock %}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br")])]),t("ul",[t("li",[s._v("编辑users目录下的urls.py文件, 添加二级路由")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 用户中心个人信息\nurl(r'^info/', UserinfoView.as_view(), name=\"user_info\"),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# TODO：处理用户个人信息的请求， 最后以及个人信息的post表单提交的修改\nclass UserinfoView(LoginRequiredMixin,View):\n    # 处理用户个人信息的请求\n    def get(self, request):\n        return render(request, '/users/usercenter-info.html', {\n\n        })\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("在base.html里面，给一个链接")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<a class="personcenter fl" href="{% url \'users:user_info\' %}" >进入个人中心</a>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"十二-用户个人中心页面中开发修改头像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十二-用户个人中心页面中开发修改头像"}},[s._v("#")]),s._v(" （十二）"),t("strong",[t("code",[s._v("用户个人中心页面中开发修改头像")])])]),s._v(" "),t("ul",[t("li",[s._v("编辑urls.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 处理用户上传的头像文件\nurl(r'^image/upload/', UploadImageView.as_view(), name=\"image_upload\"),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("编辑forms.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#  TODO：这里再次引入了model form, 可以把任何一个model form认为是一个model类，且具有form验证的功能\nclass UploadImageForm(forms.ModelForm):\n    class Meta:\n        model = UserProfile\n        fields = ["image", ]\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 处理个人用户信息的头像上传逻辑\nclass UploadImageView(LoginRequiredMixin,View):\n    def post(self, request):\n        #TODO: 这里需要注意了，与之前验证用户提交的表达信息不一样，如果要验证用户上传的文件，必须验证request.FILES这个参数，其他的表单参数都封装在了request.POST，但是request.FILES这个参数是单独上传的\n        image_form = UploadImageForm(request.POST, request.FILES)\n        if image_form.is_valid(): # 首先判断用户上传的文件是否是合法的，这个合法验证是form验证的\n            # 获取到用户传递的值，只要一直通过的数据都会放在cleaned_data这个字典中\n            image = image_form.files.get('avatar_url', \"\")\n            # 保存到Userprofile的image字段中\n            request.user.image = image\n            request.user.save()\n\n            msg = {'status': 'success',}\n\n            return HttpResponse(json.dumps(msg), content_type=\"application/json\")\n\n        else:\n            msg = {'status': 'fail', }\n            return HttpResponse(json.dumps(msg), content_type=\"application/json\")\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("ul",[t("li",[s._v("编辑usercenter-info.html文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('\x3c!-- 用户上传的头像文件是通过form表单上传的 --\x3e\n\x3c!-- todo: enctype="multipart/form-data" 属性指定上传的是文件类型 --\x3e\n\x3c!-- todo:  target=\'frameFile\' 属性指定在iframe中打开这个上传的接口--\x3e\n<form class="clearfix" id="jsAvatarForm" enctype="multipart/form-data" autocomplete="off" method="post" action="{% url \'users:image_upload\' %}" target=\'frameFile\'>\n    <label class="changearea" for="avatarUp">\n        <span id="avatardiv" class="pic">\n            <img width="100" height="100" class="js-img-show" id="avatarShow" src="{{ MEDIA_URL }}{{ request.user.image }}"/>\n        </span>\n        <span class="fl upload-inp-box" style="margin-left:70px;">\n            <span class="button btn-green btn-w100" id="jsAvatarBtn">修改头像</span>\n            \x3c!-- 这里上传文件的时候，type不再是submit，而是file，因为是提交的文件 --\x3e\n            <input type="file" name="avatar_url" id="avatarUp" class="js-img-up"/>\n        </span>\n    </label>\n    {% csrf_token %}\n</form>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[s._v("其实在views.py文件中，可以简化下，就是使用"),t("code",[s._v("UploadImageForm1")]),s._v("的modelform功能，那么代码就可以修改为这样， 如果用户上传数据正确，image_form直接save保存即可")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 处理个人用户信息的头像上传逻辑\nclass UploadImageView(LoginRequiredMixin,View):\n    def post(self, request):\n        image_form = UploadImageForm(request.POST, request.FILES, instance=request.user)\n        if image_form.is_valid(): \n            image_form.save()\n            msg = {'status': 'success',}\n            return HttpResponse(json.dumps(msg), content_type=\"application/json\")\n        else:\n            msg = {'status': 'fail', }\n            return HttpResponse(json.dumps(msg), content_type=\"application/json\")\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("这个修改头像的前端提交是通过form表单提交的，那么当后台修改成功之后，返回的json对象无法被前端页面使用到，因此，这里最好是使用ajax的方式，发送post请求，提交到后台")])]),s._v(" "),t("h3",{attrs:{id:"十三-用户个人中心页面中开发-修改密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十三-用户个人中心页面中开发-修改密码"}},[s._v("#")]),s._v(" （十三）"),t("strong",[t("code",[s._v("用户个人中心页面中开发 修改密码")])])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("点击修改密码会出现一个弹窗")]),s._v(" "),t("img",{attrs:{src:n(1026),alt:"Alt text"}})]),s._v(" "),t("li",[s._v("编辑urls.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 用户在个人中心修改密码逻辑，这个提交在usercenter-base.html中，不再usercenter-info.html中， 所以这个URL应该配置在usercenter-base.html里面, 而且这个HTML中的form是ajax的提交\n# ajax的js代码写在deco-user.js里面\nurl(r'^update/pwd/', UpdatePwdView.as_view(), name=\"update_pwd\"),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# 用户在个人中心修改密码\nclass UpdatePwdView(View):\n    def post(self, request): # 修改密码的post处理\n        modify_pwd_form = ModifyPwdForm(request.POST)\n        if modify_pwd_form.is_valid():\n            pwd1 = request.POST.get(\'password1\', "")\n            pwd2 = request.POST.get(\'password2\', "")\n\n            if pwd1 != pwd2:\n                msg = {\'status\': \'fail\', "msg": "请确保两次输入的密码相同",}\n                return HttpResponse(json.dumps(msg), content_type="application/json")\n            user = request.user\n            user.password = make_password(pwd1)\n            user.save()\n\n            msg = {\'status\': \'success\', }\n            return HttpResponse(json.dumps(msg), content_type="application/json")\n\n        else: # 如果用户填写的密码不合法，直接将error作为json返回\n            msg = {"msg": "请按照要求填写新密码"}\n            return HttpResponse(json.dumps(msg), content_type="application/json")\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("ul",[t("li",[s._v("最后点击提交按钮的时候，是通过ajax提交的")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// todo: 点击修改密码按钮，修改用户密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("changeUserPwd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("$btn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ajax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            dataType"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'json'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/users/update/pwd/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这里是js，因此不能使用模板语言")]),s._v("\n            data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#jsResetPwdForm'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("serialize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这里的data是form表达的数据")]),s._v("\n            async"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("success")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果返回的信息中有password1这个属性，说明是第一个密码错误")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    Dml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("showValidateError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#pwd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果返回的信息中有password2这个属性，说明是第二个密码错误")]),s._v("\n                    Dml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("showValidateError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#repwd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果是返回的status为success，那么密码成功")]),s._v("\n                    Dml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("showTipsDialog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'提交成功'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        h2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'修改密码成功，请重新登录!'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    Dml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("winReload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    Dml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("showValidateError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#pwd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    Dml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("showValidateError")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#repwd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"十四-在用户个人中心页面中开发-修改邮箱"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十四-在用户个人中心页面中开发-修改邮箱"}},[s._v("#")]),s._v(" （十四）"),t("strong",[t("code",[s._v("在用户个人中心页面中开发 修改邮箱")])])]),s._v(" "),t("ul",[t("li",[s._v("当用户点击修改邮箱按钮，会弹出这个弹窗。当用户填写好邮箱，点击获取验证码的时候，就会给用户的新邮箱发送一个验证码，当用户点击完成按钮的时候，后台会查询是否用户的邮箱与验证码匹配\n"),t("img",{attrs:{src:n(1027),alt:"Alt text"}})]),s._v(" "),t("li",[t("strong",[s._v("当用户点击"),t("code",[s._v("获取验证码")]),s._v("按钮的时候")])]),s._v(" "),t("li",[s._v("编辑urls.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 用户中心发送邮箱验证码\nurl(r'^sendmail_code/', SendEmailCodeView.as_view(), name=\"sendmail_code\"),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 用户点击获取验证码的逻辑， 用户必须是登入才能发送验证码\nclass SendEmailCodeView(LoginRequiredMixin,View):\n    def get(self, request):\n        email = request.GET.get(\"email\", \"\")\n\n        # 首先判断是否邮箱已经被注册\n        if UserProfile.objects.filter(email=email):\n            msg = {'status': 'fail','msg': '此邮箱已经被注册'}\n            return HttpResponse(json.dumps(msg), content_type='application/json')\n        else:\n            # 向邮箱发送邮件\n            send_register_email(email, \"update_email\")\n            msg = {\"status\": \"success\", 'msg': '认证邮件已发送到您的邮箱，请查收'}\n            return HttpResponse(json.dumps(msg), content_type='application/json')\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("当用户点击"),t("code",[s._v("完成按钮")]),s._v("的时候")])]),s._v(" "),t("li",[s._v("编辑urls.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 用户中心获取了验证码之后，点击了完成，处理验证码的正确性，且修改邮箱\nurl(r'^update_email/', UpdateEmailView.as_view(), name=\"update_email\"),\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("编辑views.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 获取验证码，修改邮箱\nclass UpdateEmailView(LoginRequiredMixin,View):\n    def post(self, request):\n        email = request.POST.get('email', '')\n        email_code = request.POST.get('email_code', '')\n\n        # 看看验证码是否存在\n        existed_records = EmailVerifyRecord.objects.filter(email=email,code=email_code, send_type='update_email')\n        if existed_records:\n            user = request.user\n            user.email = email\n            user.save()\n            \n            msg = {\"status\": \"success\", 'msg': '邮箱修改成功'}\n            return HttpResponse(json.dumps(msg), content_type='application/json')\n        else:\n            msg = {\"status\": \"fail\", 'msg': '验证码错误，请重新获取验证码'}\n            return HttpResponse(json.dumps(msg), content_type='application/json')\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"十五-在用户个人中心页面中开发-保存按钮"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十五-在用户个人中心页面中开发-保存按钮"}},[s._v("#")]),s._v(" （十五）"),t("strong",[t("code",[s._v("在用户个人中心页面中开发 保存按钮")])])]),s._v(" "),t("ul",[t("li",[s._v("当用户点击了保存按钮，通过ajax将input框中的信息提交到view中，因此在UserinfoView这个view中，写一个post方法")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# TODO：处理用户个人信息的请求， 最后以及个人信息的post表单提交的修改\nclass UserinfoView(LoginRequiredMixin,View):\n    # 处理用户个人信息的请求\n    def get(self, request):\n        return render(request, \'users/usercenter-info.html\', {\n\n        })\n\n    # 处理用户个人信息的修改\n    def post(self, request): # 使用model form对用户的表单提交进行判断\n\n        # todo : 这里传递了一个instance参数，目的是将这个user实例，绑定到这个model form之上, 如果数据验证通过，可以直接保存\n        user_info_form = UserInfoForm(request.POST, instance=request.user)\n        if user_info_form.is_valid():\n            user_info_form.save()\n\n            msg = {"status": "success"}\n            return HttpResponse(json.dumps(msg), content_type="application/json")\n        else:\n            msg = user_info_form.errors\n            return HttpResponse(json.dumps(msg), content_type="application/json")\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("编辑forms.py文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# # 引入form验证用户的信息上传\n# # TODO：这里再次引入了model form, 可以把任何一个model form认为是一个model类，且具有form验证的功能\nclass UserInfoForm(forms.ModelForm):\n\n    class Meta:\n        model = UserProfile\n        fields = ["nick_name", "birthday", "gender", "address", "mobile"]\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("点击保存的ajax")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("function saveUserInfo($btn){\n    var _self = $btn,\n            $jsEditUserForm = $('#jsEditUserForm')\n            verify = verifySubmit(\n            [\n                {id: '#nick_name', tips: Dml.Msg.epNickName, require: true}\n            ]\n        );\n        if(!verify){\n           return;\n        }\n        $.ajax({\n            cache: false,\n            type: 'post',\n            dataType:'json',\n            url:\"/users/info/\",\n            data:$jsEditUserForm.serialize(),\n            async: true,\n            beforeSend:function(XMLHttpRequest){\n                _self.val(\"保存中...\");\n                _self.attr('disabled',true);\n            },\n            success: function(data) {\n                if(data.nick_name){\n                    _showValidateError($('#nick_name'), \"昵称填写有误\");\n                }else if(data.birday){\n                   _showValidateError($('#birth_day'), \"生日填写有误\");\n                }else if(data.address){\n                   _showValidateError($('#address'), \"地址填写有误\");\n                }else if(data.status == \"failure\"){\n                     Dml.fun.showTipsDialog({\n                        title: '保存失败',\n                        h2: data.msg\n                    });\n                }else if(data.status == \"success\"){\n                    Dml.fun.showTipsDialog({\n                        title: '保存成功',\n                        h2: '个人信息修改成功！',\n                    });\n                    setTimeout(function(){window.location.href = window.location.reload();},1000);\n                }\n            },\n\n            error: function(data){\n                alert(\"保存失败\")\n            },\n\n            complete: function(XMLHttpRequest){\n                _self.val(\"保存\");\n                _self.removeAttr(\"disabled\");\n            }\n        });\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br")])]),t("ul",[t("li",[s._v("页面显示的HTML ， 这里可以将后台取到的日期，使用Django模板转化格式"),t("code",[s._v("request.user.birthday|date:'Y-m-d'")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<li>生&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日：\n    <input type="text"  name="birthday" value="{{ request.user.birthday|date:\'Y-m-d\' }}" id="birth_day" readonly="readonly"/>\n    <i class="error-tips"></i>\n</li>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("前端页面中提交的birthday其实是一个字符串"),t("code",[s._v("1999-10-12")]),s._v(", 提交到后台的时候，通过form进行验证，会自动将字符串转化为Django的DateField类型的数据，再存储在数据库中")])])])}),[],!1,null,null,null);a.default=e.exports}}]);