(window.webpackJsonp=window.webpackJsonp||[]).push([[406],{2303:function(s,n,e){"use strict";e.r(n);var a=e(9),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"上下文管理器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上下文管理器"}},[s._v("#")]),s._v(" 上下文管理器")]),s._v(" "),e("h3",{attrs:{id:"一-什么是上下文管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-什么是上下文管理"}},[s._v("#")]),s._v(" (一) 什么是上下文管理")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Python中对上下文的管理使用with语句：with CLASS as INSTANCE:\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"二-如果实现上下文管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-如果实现上下文管理"}},[s._v("#")]),s._v(" (二) 如果实现上下文管理")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("class XKD:\n    def __init__(self):   # 第一步：进入上下文之前会调用初始化方法\n        print('init')\n        self.name = 'Robby'\n        self.age = 27\n\n    def __enter__(self):   # 第二步：进入上下文会调用这个方法，return返回的结果会通过as关键字赋值给后面的变量\n        print('enter')\n        return self\n\n    # exc_type： 异常类型， exc_val：异常的值， exc_tb：异常回溯信息\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        print('exit')      # 第四步：执行完毕语句块后，会调用__exit__方法退出上下文\n\n\nwith XKD() as xkd:\n    print(xkd)              # 第三步：调用了__enter__后，会执行上下文的语句块\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"三-with-语句的上下文管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-with-语句的上下文管理"}},[s._v("#")]),s._v(" (三) with 语句的上下文管理")]),s._v(" "),e("ul",[e("li",[s._v("示例1")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("class XKD:\n    def __init__(self):\n        print('init')\n        self.name = 'Robby'\n        self.age = 27\n\n    def __enter__(self):   \n        print('enter')\n        return self\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        print('exit')      \n\n# 即使在上下文语句中出现异常，那么退出上下文的时候，也会执行__exit__方法\nwith XKD() as xkd:\n    raise Exception('自定义抛出一个异常')  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("ul",[e("li",[s._v("示例2")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("class Data:\n    def __init__(self):\n        self.influxdb_client_1 = InfluxDBClient(host='1.1.1.1', port=8086, database='database1', )\n        self.influxdb_client_2 = InfluxDBClient(host='2.2.2.2', port=8086, database='database1', )\n\n    def __enter__(self):\n        return self\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        self.influxdb_client_1.close()\n        self.influxdb_client_2.close()\n\n\n    def get_metrics(self, server_name):\n        print('从influxdb中查询到所有的metrics')\n        return '将所有的metrics返回'\n\n# 使用上下文管理查询数据的过程, 即使中间抛出异常，也会执行__exit__方法，关闭数据库连接\nwith Data() as data:\n    data.get_metrics(server1)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("h3",{attrs:{id:"四-contextlib模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-contextlib模块"}},[s._v("#")]),s._v(" (四) contextlib模块")]),s._v(" "),e("ul",[e("li",[s._v("让普通函数也可以使用上下文管理, 前提条件是add函数必须是生成器函数，且只有yield语句")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("from contextlib import contextmanager\n\ndef add(x, y):\n    print('__enter__')   # 第一步：调用__enter__\n    yield x + y          # 第二步：返回__enter__函数的返回值给obj对象\n    print('__exit__')    # 第四步：调用__exit__\n\n\nwith add(1,2) as obj:\n    print(obj)           # 第三步：执行上下文语句块\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h3",{attrs:{id:"五-functools-total-ordering装饰器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五-functools-total-ordering装饰器"}},[s._v("#")]),s._v(" (五) functools.total_ordering装饰器")]),s._v(" "),e("ul",[e("li",[s._v("total_ordering装饰器，让实例比较大小很方便")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("from functools import total_ordering\n\nclass XKD:\n    def __init__(self, price):\n        self.__price = price\n\n    @property\n    def price(self):\n        return self.__price\n\n    # 如果需要比较大小，必须实现'< > <= >='一个其中的一个\n    def __lt__(self, other):\n        return self.__price < other.__price\n\n\nxkd1 = XKD(100)\nxkd2 = XKD(200)\nprint(xkd1 <= xkd2)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);