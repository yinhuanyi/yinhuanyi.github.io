(window.webpackJsonp=window.webpackJsonp||[]).push([[306],{1630:function(s,a,e){s.exports=e.p+"assets/img/2020-03-2310.07.15.68a2c17c.png"},2611:function(s,a,e){"use strict";e.r(a);var n=e(9),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-架构简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-架构简介"}},[s._v("#")]),s._v(" 一："),n("code",[s._v("架构简介")])]),s._v(" "),n("p",[n("img",{attrs:{src:e(1630),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("Pipeline")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：队列管理\n2：插件的生命周期管理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("Logstash Event")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：内部流转的数据表现形式\n2：原始数据在input被转换为Event，在output event被转换为目标格式数据\n3：在配置文件中可以对Event中的属性进行增删改查\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"二-queue的分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-queue的分类"}},[s._v("#")]),s._v(" 二："),n("code",[s._v("Queue的分类")])]),s._v(" "),n("ul",[n("li",[s._v("In Memory")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("无法处理进程crash，机器宕机，会导致数据丢失\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("Persistent Queue In Disk")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("可处理进程Crash等情况，保证数据不丢失\n保证数据至少消费一次\n充当缓冲区，可以替代Kafka等消息队列的作用\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"三-相关配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-相关配置"}},[s._v("#")]),s._v(" 三："),n("code",[s._v("相关配置")])]),s._v(" "),n("ul",[n("li",[s._v("pipeline.workers")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("pipeline线程数，即filter_output的处理线程数，默认是cpu核心数\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("pipeline.batch.size")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Batch 一次批量获取的待处理文件数，默认是125个，可以根据输出进行调整，越大会占用越多的heap空间，可以通过jvm.options调整\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("pipeline.batch.delay")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Batch 等待的时间，单位是ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"四-logstash的配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-logstash的配置文件"}},[s._v("#")]),s._v(" 四："),n("code",[s._v("logstash的配置文件")])]),s._v(" "),n("ul",[n("li",[s._v("logstash设置的相关配置文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：logstash.yml：例如 node.name, path.data, pipeline.workers, queue.type，其中的配置可以被命令行参数的相关参数覆盖\n\t其中常用的配置项有：\n\t①：node.name:节点名称\n\t②：path.data：持久化存储数据的文件夹，默认是logstash 家目录下面的data\n\t③：path.config：设定pipeline配置文件的目录\n\t④：path.log：设定pipeline日志文件的目录\n\t⑤：pipeline.workers：设定pipeline的线程数(filter+output), 优化的常用项\n\t⑥：pipeline.batch.size/delay：设定批量数据的数目和延时\n\t⑦：queue.type：设定队列类型，默认是memory\n\t⑧：queue.max_bytes：队列总容量，默认是1G\n\n2：jvm.options：修改jvm的相关参数，比如修改 heap size\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("pipeline配置文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("一般在conf.d目录下，以.conf结尾的pipeline文件\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"五-pipeline中的配置语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五-pipeline中的配置语法"}},[s._v("#")]),s._v(" 五："),n("code",[s._v("pipeline中的配置语法")])]),s._v(" "),n("ul",[n("li",[s._v("pipeline中的数据类型")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('1：布尔类型 Boolean\n\tisFailed =### true\n\n2：数值类型 Number\n\tport =### 33\n\n3：字符串类型 String\n\tname =### "Hello World"\n\n4：数组类型 Array\n\tpath =### ["/var/log/messages", "/var/log/*.log"]\n\tusers =### [{id=>1, name=>bob}, {id=2, name=>jane}]\n\n5：哈希类型Hash\n\tmatch =### {\n\t\t"field1"=>"value1"\n\t\t"field2"=>"value2"\n\t}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("pipeline中，可以引用Logstash Event的属性字段，主要有如下两种方式：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('1：直接引用字段值\n\t例如：[field1] 就可以引用field1的值value1\n\t\n2：在字符串中引用字段的值，可以使用sprintf方式引用\n\t例如：user_agent =### "user_agent is %{[user_agent]}"\n\t例如：index =### "%{[type]}-%{+YYYY.MM.dd}"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"六-pipeline中的插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六-pipeline中的插件"}},[s._v("#")]),s._v(" 六："),n("code",[s._v("pipeline中的插件")])]),s._v(" "),n("h3",{attrs:{id:"一-常用的input类型的plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-常用的input类型的plugin"}},[s._v("#")]),s._v(" (一)：常用的Input类型的Plugin")]),s._v(" "),n("ul",[n("li",[s._v("file插件：读取文件日志")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('path: 类型为数组，指定读取的文件路径，基于glob匹配语法\n\t例如：path =### ["/var/log/*log", "/var/log/message"]\n\t\nexclue 类型为数组，排除不想监听的文件规则，基于glob匹配语法\n\t例如：exclude =### "/var/log/*.gz"\n\nstart_position 类型为字符串，begging 还是 end，是否从头读取文件\n\nstart_interval 类型为数值，单位秒，定时检查文件是否有更新，默认是1秒\n\ndiscover_interval 类型为数值，单位秒，定时检查是否有新文件待读取，默认是15秒\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ul",[n("li",[s._v("codec插件：multiline匹配java异常日志")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('codec =### multiline{\n    # "^%{TIMESTAMP_ISO8601}"\n\tpattern =### "^2020"  # 正则表达式的pattern\n\tnegate =### true      # 使用正则表达式匹配\n\twhat =### "previous"  # 未匹配的内容向前合并\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"二-常用的filter类型的plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-常用的filter类型的plugin"}},[s._v("#")]),s._v(" (二)：常用的Filter类型的Plugin")]),s._v(" "),n("ul",[n("li",[s._v("常用插件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("date：日期解析\ngrok：正则匹配解析\ndissect：分隔符解析\nmutate: 对字段做处理\njson: 按照json解析字段内容到指定字段中\ngeoip：添加地理位置数据\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("grok, 正则表达式解析 (可以引用的正则匹配 https://github.com/logstash-plugins/logstash-patterns-core/blob/master/patterns/grok-patterns)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('filter {\n      grok {\n        # 指定匹配的正则表达式\n        match =### { "message" => "%{NGINXACCESS}" }\n        # 覆盖掉message字段，只使用解析字段，适合NGINX日志使用\n        overwrite =### ["message"]\n      }\n }\n\n\n\nNGINXACCESS %{IPORHOST:remote_addr} - (%{USERNAME:user}|-) \\[%{HTTPDATE:log_timestamp}\\] %{HOSTNAME:http_host} %{WORD:request_method} \\"%{URIPATH1:uri}\\" \\"%{URIPARM1:param}\\" %{BASE10NUM:http_status} (?:%{BASE10NUM:body_bytes_sent}|-) \\"(?:%{URI1:http_referrer}|-)\\" (%{BASE10NUM:upstream_status}|-) (?:%{HOSTPORT:upstream_addr}|-) (%{BASE16FLOAT:upstream_response_time}|-) (%{BASE16FLOAT:request_time}|-) (?:%{QUOTEDSTRING:user_agent}|-) \\"(%{IPV4:client_ip}|-)\\" \\"(%{WORD:x_forword_for}|-)\\"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("ul",[n("li",[s._v("dissect：使用分隔符解析字段(比使用grok正则表达式解析速度快)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 日志为： apr 01 2020，匹配到为：{"ts": "2020 apr 01"}\nfilter {\n      dissect {\n        # 指定匹配的正则表达式\n        match =### { "message" => "%{ts/2} %{+ts/3} %{+ts/1}" }\n        overwrite =### ["message"]\n      }\n }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("mutate：实现字段类型的转换, 支持的类型为 integer, float, string ,boolean")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('filter{\n\tmutate{\n\t\tconvert =### {\n\t\t\t"age" =### "integer"\n\t\t}\n\t}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"三-常用的output类型的plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-常用的output类型的plugin"}},[s._v("#")]),s._v(" (三)：常用的Output类型的Plugin")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"四-logstash启动-自动加载配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-logstash启动-自动加载配置"}},[s._v("#")]),s._v(" (四)：logstash启动： 自动加载配置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# -r表示，修改logstash.conf 文件的时候，logstash会自动加载\nbin/logstash -f logstash.conf -r\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("logstash也可以使用x-pack监控，编辑logstash.yml")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('xpack.monitoring.enabled: true\nxpack.monitoring.elasticsearch.hosts: ["http://172.16.18.202:9200", "http://172.16.18.203:9200", "http://172.16.18.204:9200"]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);