(window.webpackJsonp=window.webpackJsonp||[]).push([[443],{2363:function(s,n,e){"use strict";e.r(n);var a=e(9),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"redis的使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis的使用"}},[s._v("#")]),s._v(" Redis的使用")]),s._v(" "),e("h3",{attrs:{id:"一-redis-操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-redis-操作"}},[s._v("#")]),s._v(" (一) Redis 操作")]),s._v(" "),e("ul",[e("li",[s._v("概念")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：Redis运行过程，也就是读写过程都是基于内存实现的key/value存储。对比与memcached而言，会基于异步方式(快照)同步到文件系统，实现数据的持久性存储。单一进程响应用户的所有的请求，具有主从架构。\n\n2：单台服务器可以响应的100万级别的QPS\n\n3：监听于TCP的6379端口\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("安装")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install -y redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("/etc/redis.conf配置文件简要介绍")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：指明Redis绑定的IP地址\nbind 0.0.0.0\n\n2：指明监听TCP的端口\nport 6379\n\n3：开启tcp-backlog，避免在高并发过程中，Redis响应速度慢\ntcp-backlog 511\n\n4：设置密码\nrequirepass 123456\n\n5：开启Unixsocket功能，如果客户端和服务端都是本机，将在内存中直接实现C/S数据交换，不会经过TCP拆包和封包处理\nunixsocket /tmp/redis.sock\nunixsocketperm 700\n\n6：默认的快照速率\nsave 900 1  （表示：如果在900秒内有1条数据发生变化，那么执行快照操作）\nsave 300 10 （表示：如果在300秒内有10条数据发生变化，那么执行快照操作）\nsave 60 10000 （表示：如果在60秒内有10000条数据发生变化，那么执行快照操作）\n\n7：指定redis可以使用的数据库有多少个，默认是16个\ndatabases 16\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("ul",[e("li",[s._v("启动Redis")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl start redis.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("连接redis")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：方式一\nredis-cli -h 192.168.23.10 -p 6379 （无密码登入，会报错，(error) NOAUTH Authentication required. 可以在redis的shell接口中 auth 123456，完成授权）\n\n2：方式二\nredis-cli -h 192.168.23.10 -p 6379 -a 123456 （有密码读入，已经被授权）\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("选择数据库")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("由于在配置文件中默认定义使用16个database，因此每次登入Redis时，可以选择使用哪个数据库\nselect 0：表示使用0号数据库\nselect 1：表示使用1号数据库\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("清空数据库")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 注意：想清楚再执行\nflushdb ：清空当前数据库\nflushall ：清空所有的库\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("在Redis中的命令和命令组")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：命令组与命令的联系\n一个命令组中包含多个命令，可以使用 help @命令组，查看某个命令组中有多少命令，已经这些命令如何使用\nhelp @string\nhelp @server\n\n2：也可以查看特定命令的用法\nhelp LLEN\nhelp STRLEN\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"二-redis常用命令介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-redis常用命令介绍"}},[s._v("#")]),s._v(" (二) Redis常用命令介绍")]),s._v(" "),e("ul",[e("li",[s._v("Redis常用命令")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('1：赋值与取值 (set key value [EX seconds] [PX milliseconds] [NX|XX])\nset robby ops       \nget robby  \n\nEX：表示超时时长\nNX：如果一个键不存在则创建，存在不创建\nXX：如果一个键存在则创建，不存在不创建\n\n2：判断一个键值是否存在, 如果存在返回整数类型1 ，否则返回0\nexists robby  \n\n3：追加值\nappend robby " java"      \n\n4：删除键\ndel key [key.....]\ndel robby\n\n5：设置一个整数值，让数值增加\nset number 1\nincr number （加1）\ndecr number （减1）\n\n6：使用keys命令搜索已经设置的key\nkeys 正则表达式\n    ?    匹配一个字符\n    *    匹配任意个（包括0个）字符\n    []    匹配括号间的任一个字符，可以使用 "-" 符号表示一个范围，如 a[b-d] 可以匹配 "ab","ac","ad"\n    \\x    匹配字符x，用于转义符号，如果要匹配 "?" 就需要使用 \\?\n\n例如：keys * ：查看有哪些key\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("ul",[e("li",[s._v("Redis中的5种数据类型")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Redis的数据类型指的是key-value中value的数据类型，还记得Redis作为ELK的消息中间件吗？使用的是Redis的list数据类型\n\nRedis的数据类型有5中，也就是说，value的结构有五种\n1：string\n    例如：\n    set uplooking ops\n\n\n2：list：value就是一个string数组，操作这组string时，可以像对待栈一样使用pop和push操作，但是这个栈两端都能进行操作；也可以像对待数组一样使用一个index参数来操作。list的操杂，主要分为两类：L开头的和R开头的，L代表LEFT或者LIST，进行一些从列表左端进行的操作，或者一些与端无关的操作；R代表RIGHT，进行一些从列表右端进行的操作\n    例如：\n    使用help @list可以查看帮助\n    lpush uplooking java （给uplooking键对应的列表添加一个值）\n    lindex uplooking 0 （通过索引从uplooking中取值）\n    lpush uplooking ops （从左边插入值）\n    rpush uplooking c++  （从右边插入值）\n    lpop uplooking （从左边pop一个值）\n    rpop uplooking （从右边pop一个值）\n    lset uplooking 0 Python （将索引为0对应的值改为Python）\n\n\n3：set：用于存储一组不重复的值，也可以进行一些集合的操作，就像数学上的集合，它是无序的，且可以就交集、并集、补集运算\n    例如：\n    sadd home laoge dage zhongge xiaoge xiaoxiaoge （创建一个home集合，集合中有五个元素）\n    sismember home dage （查看home集合中是否有dage元素）\n    sadd home1 dage xiaoge niubi haoniubi （再创建一个集合）\n    sinter home home1 （求home和home1两个集合的交集）\n    sunion home home1 （求home和home1两个集合的并集）\n    smembers home （查看集合中所有的元素）\n    spop home1 （在home1集合中随机删除一个元素）\n\n\n4：sorted set：类似set，但是sorted set里每个元素都有一个score，这个score可用于排序和排名\n    例如：\n    del home home1 （删除之前的两个set）\n    help @sorted_set\n    zadd home1 1 niubi 2 haoniubi （创建一个有序集合，给两个元素）\n\n    \n5：hash：hash结构，其实就是value本身就是一组key-value对，不过redis将这里的key称为field，也就是value是一组field-value对\n    例如：\n    help @hash\n    hset home2 class ops （设置值）\n    hget home2 class （取值）\n    hdel home2 class （删除值）\n    hkeys home2 (查看home2中所有的field)\n    hvals home2 (查看home2中所有的value)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br")])]),e("blockquote",[e("p",[s._v("*"),e("em",[e("code",[s._v("3：Redis 事务")]),s._v("(20:31)")])])]),s._v(" "),e("p",[s._v("这里的事务与MySQL的事务类似：多个操作要么一次性执行完毕，要么都不执行")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("使用multi开启一个事务")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("multi (开启一个事务日志)\nset name yhy\nset age 25\nset address changsha\nexec （提交，执行）\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"三-redis-客户端相关命令介绍-操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-redis-客户端相关命令介绍-操作"}},[s._v("#")]),s._v(" (三) Redis 客户端相关命令介绍 操作")]),s._v(" "),e("ul",[e("li",[s._v("客户端相关命令介绍")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  AUTH password\n  summary: Authenticate to the server\n  since: 1.0.0\n\n  ECHO message\n  summary: Echo the given string\n  since: 1.0.0\n\n  PING [message]\n  summary: Ping the server\n  since: 1.0.0\n\n  QUIT -\n  summary: Close the connection\n  since: 1.0.0\n\n  SELECT index\n  summary: Change the selected database for the current connection\n  since: 1.0.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("ul",[e("li",[s._v("服务器端相关的命令介绍")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("help @server\nclient setname yhy_client (设置客户端名为yhy_client)\nclient getname (查看当前的客户端的名称)\ninfo （查看服务器端的各个参数）\nconfig get bind （拿到bind指令的值）\nconfig set bind \ndbsize (查看当前数据库的键值对数量)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"四-redis持久化实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-redis持久化实现"}},[s._v("#")]),s._v(" (四) Redis持久化实现")]),s._v(" "),e("ul",[e("li",[s._v("概念")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1: RDB持久化方式会在一个特定的间隔保存那个时间点的一个数据快照。\n2: AOF持久化方式则会记录每一个服务器收到的写操作。\n3: Redis的持久化是可以禁用的，就是说你可以让数据的生命周期只存在于服务器的运行时间里。\n4: 两种方式的持久化是可以同时存在的，但是当Redis重启时，AOF文件会被优先用于重建数据。\n5: \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：RDB \n    基于snapshot实现持久化存储，数据文件叫dump.rdb, 存在于Redis数据存储目录中，默认RDB持久化是开启的\n    save 900 1\n    save 300 10\n    save 60 10000\n\n2：AOF\n    记录每一次的写操作于文件中，实现数据持久化，默认是不开启的，\n    可以修改配置文件： appendonly yes  开启AOF持久化 \n\n3：如果两种持久化策略都开启，那么还原缓存数据的时候，redis会优先载入AOF备份文件\n   在Redis数据目录中，两种策略的持久化文件为：\n    appendonly.aof\n\tdump.rdb\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"五-redis-主从复制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五-redis-主从复制"}},[s._v("#")]),s._v(" (五) Redis 主从复制")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("准备环境：主-192.168.23.10， 从-192.168.23.11， 从-192.168.23.12")])]),s._v(" "),e("li",[e("p",[s._v("主从复制概念")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("一主可以有多从，支持链式连级\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("一主多从")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：修改从服务器的配置文件/etc/redis.conf\nbind 0.0.0.0\n\nport 6379\n\nslaveof 192.168.23.10 6379\n\nmasterauth 123456\n\nrequirepass 123456\n\n\n2：先连接至Redis服务端，通过命令设置主从，但是也需要想编辑/etc/redis.conf配置文件\nbind 0.0.0.0\nport 6379\nmasterauth 123456\nrequirepass 123456\n\n同步的时候在命令行输入：slaveof 192.168.23.10 6379\n\n\n3：登入主节点，使用info replication查看从节点信息\n127.0.0.1:6379> info replication\n# Replication\nrole:master\nconnected_slaves:2\nslave0:ip=192.168.23.11,port=6379,state=online,offset=7715,lag=0\nslave1:ip=192.168.23.12,port=6379,state=online,offset=7715,lag=1\nmaster_repl_offset:7715\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:2\nrepl_backlog_histlen:7714\n\n4：登入从节点，执行keys * 命令，看看是否可以查看到主节点的keys\nkeys *\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("h3",{attrs:{id:"六-redis的sentinel机制-sentinel节点ip为-192-168-23-10"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六-redis的sentinel机制-sentinel节点ip为-192-168-23-10"}},[s._v("#")]),s._v(" (六) Redis的sentinel机制（sentinel节点IP为：192.168.23.10）")]),s._v(" "),e("ul",[e("li",[s._v("概念")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\t万一主节点打击，主从模型将会停止工作，为了解决这个问题，Redis提供了一个sentinel（哨兵），以此来实现主从切换的功能，一旦主节点宕机了，sentinel将会在从节点中挑一个作为主节点, 与zookeeper类似\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("编辑/etc/redis-sentinel.conf文件")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1: mymaster指定主节点的主机名（可以随便取一个名），127.0.0.1 6379：指明主节点的IP和端口，2：表示一个节点要成为主节点必须拥有的票数，这里默认是2，因此最好启动2个以上centinel进程。这个指令可以写多个，表明sentinel可以监控多个Redis主从架构。这里改为1，启动centinel进程演示\nsentinel monitor mymaster 192.168.23.10 6379 1\n\n2：指明主节点多少秒联系不上，认定主服务器宕机，默认30000毫秒\nsentinel down-after-milliseconds mymaster 3000\n\n3：从新指定主服务器后，允许几台从服务器去主服务器同步数据\nsentinel parallel-syncs mymaster 1\n\n4：指定故障转移的超时时长，如果180000毫秒，无法在从服务器选择主服务器，则故障转移失败\nsentinel failover-timeout mymaster 18000\n\n5: 指定与master通信的密码\nsentinel auth-pass mymaster 123456\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("ul",[e("li",[s._v("启动systemctl")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl start redis-sentinel.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("登入Sentinel，查看主从状态")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("redis-cli  -p 26379\n\n127.0.0.1:26379> info Sentinel\n# Sentinel\nsentinel_masters:1\nsentinel_tilt:0\nsentinel_running_scripts:0\nsentinel_scripts_queue_length:0\nsentinel_simulate_failure_flags:0\nmaster0:name=mymaster,status=ok,address=192.168.23.10:6379,slaves=2,sentinels=1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("ul",[e("li",[s._v("停止Redis的master节点，登入sentinel查看节点信息（此时的主节点已经是192.168.23.12了）")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl stop redis.service\n\n[root@7 ~]# redis-cli -p 26379          \n127.0.0.1:26379> info sentinel \n# Sentinel\nsentinel_masters:1\nsentinel_tilt:0\nsentinel_running_scripts:0\nsentinel_scripts_queue_length:0\nsentinel_simulate_failure_flags:0\nmaster0:name=mymaster,status=ok,address=192.168.23.12:6379,slaves=2,sentinels=1\n\n127.0.0.1:26379> sentinel masters\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);