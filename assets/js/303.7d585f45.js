(window.webpackJsonp=window.webpackJsonp||[]).push([[303],{1594:function(s,a,n){s.exports=n.p+"assets/img/2019-09-021.42.09.62ba609b.png"},2600:function(s,a,n){"use strict";n.r(a);var e=n(9),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"一-结构化streaming概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-结构化streaming概念"}},[s._v("#")]),s._v(" 一：结构化Streaming概念")]),s._v(" "),e("h3",{attrs:{id:"一-概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-概念"}},[s._v("#")]),s._v(" (一)概念")]),s._v(" "),e("p",[e("img",{attrs:{src:n(1594),alt:"Alt text"}})]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\tStructured Streaming将实时流抽象成一张无边界的表（Unbounded Table），输入的每一条数据(new data)当成输入表的一个新行(new rows)，同时将流式计算的结果映射为另外一张表，完全以结构化的方式去操作流式数据\n\t输入的流数据是以batch为单位被处理，每个batch会触发一次流式计算(如sql查询，开发人员预先定义好的)，计算结果被更新到Result Table。每个batch代表一个触发间隔，默认设置为1秒，这样每1秒从输入源读取数据到Input Table，然后触发Query计算，将结果写入Result Table。\n\tResult Table中的信息会被输出到外部数据源中，如文件、kafka、关系数据库中，在测试阶段最简单的方式可输出到控制台上。一共有三种Output模式：\n\t1、Complete模式： 每次触发都会将整个结果表集合后的数据全部输出。\n\t2、Append模式：仅仅从上次触发计算到当前新增的行会被输出。\n\t3、Update模式：仅仅是自上次触发之后结果表有变更的行输出。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"二-编程模型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-编程模型"}},[s._v("#")]),s._v(" 二：编程模型")]),s._v(" "),e("ul",[e("li",[s._v("在spark-shell中运行，基于socket数据流的**"),e("code",[s._v("Complete输出")]),s._v("**模式")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import org.apache.spark.sql.SparkSession\n    val spark = SparkSession\n        .builder()\n        .master("local[2]")\n        .appName("HDFS")\n        .getOrCreate()\n\n    import spark.implicits._\n\n    // 读取socket流\n    val lines = spark.readStream\n        .format("socket")\n        .option("host", "node3")\n        .option("port", 9999)\n        .load()\n\n    // 将DataFrame转换为DataSet进行处理\n    val words = lines.as[String]\n        .flatMap(x =### x.split(" "))\n        .groupBy("value")\n        .count()\n\n    words.writeStream.outputMode("complete").format("console").start()\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("ul",[e("li",[s._v("输出结果")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1: 输入asdfasdf时候，输出结果为：\n+--------+-----+                                                                \n|   value|count|\n+--------+-----+\n|asdfasdf|    1|\n+--------+-----+\n\n2：输入3个asdfasdf时，输出结果为：\n+--------+-----+                                                                \n|   value|count|\n+--------+-----+\n|asdfasdf|    4|\n+--------+-----+\n\n3：输入hive sql mysql mysql时，输出结果为：\n+--------+-----+                                                                \n|   value|count|\n+--------+-----+\n|asdfasdf|    4|\n|   mysql|    2|\n|     sql|    1|\n|    hive|    1|\n+--------+-----+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("ul",[e("li",[s._v("在spark-shell中运行，基于socket数据流的**"),e("code",[s._v("Update输出")]),s._v("**模式")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import org.apache.spark.sql.SparkSession\n    val spark = SparkSession\n        .builder()\n        .master("local[2]")\n        .appName("HDFS")\n        .getOrCreate()\n\n    import spark.implicits._\n\n    // 读取socket流\n    val lines = spark.readStream\n        .format("socket")\n        .option("host", "node3")\n        .option("port", 9999)\n        .load()\n\n    // 将DataFrame转换为DataSet进行处理\n    val words = lines.as[String]\n        .flatMap(x =### x.split(" "))\n        .groupBy("value")\n        .count()\n\n    words.writeStream.outputMode("update").format("console").start()\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("ul",[e("li",[s._v("输出结果(将历史和现在数据更新)")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：输入hive mysql mysql hbase时，输出结果为：\n+-----+-----+                                                                   \n|value|count|\n+-----+-----+\n|hbase|    1|\n|mysql|    2|\n| hive|    1|\n+-----+-----+\n\n2：输入mysql django django python时，输出结果为：\n+------+-----+                                                                  \n| value|count|\n+------+-----+\n| mysql|    3|\n|django|    2|\n|python|    1|\n+------+-----+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("ul",[e("li",[s._v("在IDEA上运行代码")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('object StructureStreamingSocketTest extends App {\n\n    val spark = SparkSession\n        .builder()\n        .master("local[2]")\n        .appName("HDFS")\n        .getOrCreate()\n\n    import spark.implicits._\n\n    // 读取socket流\n    val lines = spark.readStream\n        .format("socket")\n        .option("host", "node3")\n        .option("port", 9999)\n        .load()\n\n    // 将DataFrame转换为DataSet进行处理\n    val words = lines.as[String]\n        .flatMap(x =### x.split(" "))\n        .groupBy("value")\n        .count()\n\n    val query = words.writeStream.\n        outputMode("complete")\n        .format("console").start()\n\n    query.awaitTermination()\n\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("ul",[e("li",[s._v("输出结果")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("+---------+-----+\n|    value|count|\n+---------+-----+\n|    nihao|    1|\n|     asdf|    6|\n|nihaoasdf|    1|\n+---------+-----+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"三-structure-streaming与kafka集成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-structure-streaming与kafka集成"}},[s._v("#")]),s._v(" 三：Structure Streaming与Kafka集成")]),s._v(" "),e("h3",{attrs:{id:"一-在idea中运行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-在idea中运行"}},[s._v("#")]),s._v(" (一)在IDEA中运行")]),s._v(" "),e("ul",[e("li",[s._v("将kafka作为Source")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('// 调整IDEA控制台的日志级别\nimport org.apache.log4j.{Level, Logger}\n\nobject StructureStreamingKafka extends  App {\n\n\t// 调整IDEA控制台的日志级别\n\tLogger.getLogger("org").setLevel(Level.WARN)\n\t\n    val spark = SparkSession\n        .builder()\n        .master("local[2]")\n        .appName("structure streaming")\n        .getOrCreate()\n\n    // 从kafka获取数据\n    val df = spark.readStream\n        .format("kafka")\n        .option("kafka.bootstrap.servers", "node1:9092,node2:9092,node3:9092")\n        .option("subscribe", "weblogs")\n        .option("startingOffsets", "latest")\n        .load()\n\n    import spark.implicits._\n\n    // 将DataFrame转换为Dataset， 且只取value值\n    val lines = df.selectExpr("CAST(value AS STRING)").as[String]\n\n    val words = lines.flatMap(x=### x.split(" "))\n        .groupBy("value")\n        .count()\n\n    val query = words.writeStream\n        .outputMode("complete")\n        .format("console")\n        .start()\n        \n\t// 查询终止必须要有\n    query.awaitTermination()\n    \n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br")])]),e("ul",[e("li",[s._v("输出结果")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n  * +-----+-----+\n  * |value|count|\n  * +-----+-----+\n  * | hell|    1|\n  * |hello|    1|\n  * |nihao|    2|\n  * +-----+-----+*/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"二-在spark-shell中运行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-在spark-shell中运行"}},[s._v("#")]),s._v(" (二)在Spark-shell中运行")]),s._v(" "),e("ul",[e("li",[s._v("如果这段代码要放在spark-shell上面跑，那么需要将kafka的一些包拷贝到spark中")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 这两个包从kafka中拷贝\nkafka_2.11-2.1.1.jar \nkafka-clients-2.1.1.jar\n\n# 这两个包从IDEA中的maven仓库中拷贝\nspark-sql-kafka-0-10_2.11-2.2.0.jar  \nspark-streaming-kafka-0-10_2.11-2.2.0.jar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import org.apache.spark.sql.SparkSession\nval spark = SparkSession\n        .builder()\n        .master("local[2]")\n        .appName("structure streaming")\n        .getOrCreate()\n\n    // 从kafka获取数据\n    val df = spark.readStream\n        .format("kafka")\n        .option("kafka.bootstrap.servers", "node1:9092,node2:9092,node3:9092")\n        .option("subscribe", "weblogs")\n        .option("startingOffsets", "latest")\n        .load()\n\n    import spark.implicits._\n\n    // 将DataFrame转换为Dataset， 且只取value值\n    val lines = df.selectExpr("CAST(value AS STRING)").as[String]\n\n    val words = lines.flatMap(x=### x.split(" "))\n        .groupBy("value")\n        .count()\n\n    val query = words.writeStream\n        .outputMode("complete")\n        .format("console")\n        .start()\n\n    query.awaitTermination()\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("h2",{attrs:{id:"四-structure-streaming与mysql集成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-structure-streaming与mysql集成"}},[s._v("#")]),s._v(" 四：Structure Streaming与MySQL集成")]),s._v(" "),e("h3",{attrs:{id:"一"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一"}},[s._v("#")]),s._v(" (一)")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);