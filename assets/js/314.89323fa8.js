(window.webpackJsonp=window.webpackJsonp||[]).push([[314],{1726:function(s,n,a){s.exports=a.p+"assets/img/2020-12-193.01.49.abfcbd8d.png"},2673:function(s,n,a){"use strict";a.r(n);var e=a(9),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"一-基本模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-基本模块"}},[s._v("#")]),s._v(" 一："),e("code",[s._v("基本模块")])]),s._v(" "),e("h3",{attrs:{id:"一-sub-status模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-sub-status模块"}},[s._v("#")]),s._v(" (一) sub_status模块")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("--with-http_stub_status_module")]),s._v("模块，配置NGINX的连接状态")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("location /status {\n    stub_status;\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("请求www.yhyblog.cn/status")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Active connections: 2 \nserver accepts handled requests\n 50626 50626 383521 \nReading: 0 Writing: 1 Waiting: 1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"二-nginx请求限制模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-nginx请求限制模块"}},[s._v("#")]),s._v(" (二) NGINX请求限制模块")]),s._v(" "),e("ul",[e("li",[s._v("limit_conn_module：连接频率限制，用的不多")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("基本语法：\nlimit_conn_zone key zone=name:size;  可以作用在http中\nlimit_conn zone number;              可以作用在http、server、location中\n\n\nkey是指限制什么，例如IP，域名等\nzone=name是给这个连接限制取一个名字，方便调用\nsize是指这个zone的大小\n\nzone指的是之前所说的控制连接限制的名称\nnumber是运行并发连接的个数\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("ul",[e("li",[s._v("limit_req_module：请求频率限制")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("基本语法： \nlimit_req_zone key zone=name:size rate=rate;  可以作用在http中\nlimit_req zone=name [burst=number][nodelay];  可以作用在http、server、location中\n\n\nkey是指限制什么，例如IP，域名等\nzone=name是给这个连接限制取一个名字，方便调用\nsize是指这个zone的大小\nrate是指速率\nzone指的是之前所说的控制频率限制的名称\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("ul",[e("li",[s._v("下面举个例子")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 这个连接限制不常用\nlimit_conn_zone $binary_remote_addr zone=conn_zone:1m;\n# 同一个IP，一分钟之内只能有一个请求,这里是用的是二进制IP，目的是节约存储空间，设置的空间大小是1m\n# 这里可以精确到请求方法$request_method\nlimit_req_zone  $binary_remote_addr zone=req_zone:1m rate=1r/m;\nserver {\n        listen       80;\n        server_name www.yhyblog.cn;\n        location /status {\n            stub_status;\n        }\n\n        location / {\n            #rewrite .* https://bbs.yhyblog.cn  permanent;\n            root /app/document;\n            index index.html index.html;\n            autoindex on;\n            autoindex_exact_size on;\n            autoindex_localtime off;\n            charset utf-8;\n            autoindex_format html;\n\t\t\t\n            #limit_conn conn_zone 1;\n            # 使用请求限制，1分钟只能一次请求，后面3次请求会延时，其他的直接报错\n            #limit_req zone=req_zone burst=3 nodelay;\n            #limit_req zone=req_zone burst=3;\n            # 使用请求限制，超出的请求直接报错\n            limit_req zone=req_zone;\n\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br")])]),e("h3",{attrs:{id:"三-nginx黑白名单访问控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-nginx黑白名单访问控制"}},[s._v("#")]),s._v(" (三) NGINX黑白名单访问控制")]),s._v(" "),e("ul",[e("li",[s._v("基于IP的访问控制：http_access_module")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("allow address | CIDR | unix | all; 可以作用在http、server、location、limit_except中\ndeny address | CIDR | unix | all; 可以作用在http、server、location、limit_except中\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\t# 对于单个IP写黑名单\n    location ~ /admin.html {\n        root   /app/web;\n        index  index.html index.htm;\n        deny 120.229.32.136;\n        allow all;\n    }\n\t# 对于单个IP或网段写白名单\n    location ~ /admin.html {\n        root   /app/web;\n        index  index.html index.htm;\n        #allow 120.229.32.0/24;\n        allow 120.229.32.136;\n        deny all;\n    }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("ul",[e("li",[s._v("NGINX "),e("code",[s._v("http_access_module")]),s._v("的局限性")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(1726),alt:"Alt text"}})]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("NGINX内置变量remote_addr获取到的IP地址是IP2的地址，无法获取到IP1的地址\n在这种情况下，如果想获取到IP1的地址，那么就需要通过http_x_forwarded_for变量获取\nhttp_x_forwarded_for=Client IP, Proxy1 IP, Proxy2 IP\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("解决无法获取到客户端真实IP的方案有：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：采用别的HTTP头部控制访问，例如http_x_forwarded_for变量\n2：结合geo模块\n3：通过自定义的HTTP头部信息做控制\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"三-nginx-basic-访问控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-nginx-basic-访问控制"}},[s._v("#")]),s._v(" (三) NGINX basic 访问控制")]),s._v(" "),e("ul",[e("li",[s._v("基于用户的信任登录：http_auth_basic_module ，这个模块可以配置用户名和密码，但是并不实用，实用的解决方式是")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：Nginx 结合LUA实现高效验证\n2：Nginx 结合LDAP进行认证，利用nginx-auth-ldap模块\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);