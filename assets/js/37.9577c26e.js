(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{2087:function(s,t,a){s.exports=a.p+"assets/img/2020-11-091.54.48.d67f28f1.png"},2088:function(s,t,a){s.exports=a.p+"assets/img/2020-11-098.58.38.1a0ec363.png"},2089:function(s,t,a){s.exports=a.p+"assets/img/2020-11-099.08.40.d333d06d.png"},2090:function(s,t,a){s.exports=a.p+"assets/img/2020-11-1011.50.14.befd9319.png"},2091:function(s,t,a){s.exports=a.p+"assets/img/2020-11-1012.01.15.a85cc562.png"},2092:function(s,t,a){s.exports=a.p+"assets/img/2020-11-1110.59.22.716fbfcf.png"},2093:function(s,t,a){s.exports=a.p+"assets/img/2020-11-1111.13.21.52fc2f1c.png"},2094:function(s,t,a){s.exports=a.p+"assets/img/0fd4e4dc6a2fcedfa51885eedc24e0c2.1bf87b22.jpg"},2095:function(s,t,a){s.exports=a.p+"assets/img/2020-11-1312.53.04.9cac1a29.png"},2096:function(s,t,a){s.exports=a.p+"assets/img/2020-11-131.13.40.2fbf0330.png"},2097:function(s,t,a){s.exports=a.p+"assets/img/2020-11-1511.08.01.80443280.png"},2098:function(s,t,a){s.exports=a.p+"assets/img/2021-02-012.18.54.07fafbb2.png"},2773:function(s,t,a){"use strict";a.r(t);var n=a(9),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("img",{attrs:{src:a(2087),alt:"Alt text"}})]),s._v(" "),n("h2",{attrs:{id:"一-显形-不可见-的网络包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-显形-不可见-的网络包"}},[s._v("#")]),s._v(" 一：显形“不可见”的网络包")]),s._v(" "),n("h3",{attrs:{id:"一-tcpdump-和-wireshark-有什么区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-tcpdump-和-wireshark-有什么区别"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（一）tcpdump 和 Wireshark 有什么区别？")])])]),s._v(" "),n("ul",[n("li",[s._v("tcpdump 和 Wireshark 就是最常用的网络抓包和分析工具，更是分析网络性能必不可少的利器。")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" tcpdump 仅支持命令行格式使用，常用在 Linux 服务器中抓取和分析网络包。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Wireshark 除了可以抓包外，还提供了可视化分析网络包的图形页面。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 所以，这两者实际上是搭配使用的，先用 tcpdump 命令在 Linux 服务器上抓包，接着把抓包的文件拖出到 Windows 电脑后，用 Wireshark 可视化分析。当然，如果你是在 Windows 上抓包，只需要用 Wireshark 工具就可以。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("tcpdump 在 Linux 下如何抓包？ 下面介绍一些常用的tcpdump使用方式")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("  假设我们抓取ping的数据包\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ping "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" eth0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PING")]),s._v(" www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shifen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("com")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" eth0"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" icmp_seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ttl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.57")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" icmp_seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" ttl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.59")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" icmp_seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" ttl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.63")]),s._v(" ms\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shifen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com ping statistics "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" packet loss"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2013")]),s._v("ms\nrtt min"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("avg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("max"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mdev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.571")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.599")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.634")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.026")]),s._v(" ms\n\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("在本机上基于tcpdump抓包")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i 是指定抓包的网卡，icmp是包的协议，host是抓取对应的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("，"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn表示不解析"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("地址和端口号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth0 icmp and host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\ntcpdump"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" verbose output suppressed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" use "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v or "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full protocol decode\nlistening on eth0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("type "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EN10MB")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" capture size "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v(" bytes\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.943442")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15933")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.950997")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo reply"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15933")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.945234")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15933")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.952785")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo reply"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15933")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("41.957468")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15933")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("41.965044")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo reply"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15933")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.353799")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.138")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".69")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".17")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4960")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.353876")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.138")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".69")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".17")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo reply"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4960")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.697497")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("117.135")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".34")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29250")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.697577")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("117.135")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".34")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo reply"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29250")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("ul",[n("li",[s._v("tcpdump截获的数据包格式为")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("时间戳\t\t\t协议 源地址"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("端口      目标地址"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("端口     网络包详细信息            \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.943442")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".157")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".35")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" echo request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15933")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"二-tcpdump命令行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-tcpdump命令行"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（二）tcpdump命令行")])])]),s._v(" "),n("ul",[n("li",[s._v("选择类")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[s._v("选项")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("示例")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("-i")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump -i eth0")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("指定网络接口，默认是0接口，any表示所有网卡")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("-nn")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump -nn")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("不解析IP地址和端口号的名称")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("-c")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump -c 5")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("限制要抓取的网络包的个数")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("-w")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump -w file.pcap")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("将抓包数据保存到文件中，文件名称以.pcap结尾")])])])]),s._v(" "),n("ul",[n("li",[s._v("过滤类")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[s._v("选项")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("示例")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("host、src host、dest host")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump src host 172.18.157.35 -nn")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("指定IP过滤")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("port、src port、dest port")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump src port 80 -nn")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("指定端口过滤")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("ip、ip6、arp、tcp、udp、icmp")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump tcp -nn")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("指定协议过滤")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("and、or、not")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("tcpdump host 172.18.157.35 and port 80")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("逻辑表达式")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("tcp[tcpflages]")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v('tcpdump -nn "tcp[tcpflags] & tcp-syn !=0"')]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("指定syn状态的TCP包")])])])]),s._v(" "),n("h3",{attrs:{id:"三-tcpdump命令行保存到文件中-在wireshark中分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-tcpdump命令行保存到文件中-在wireshark中分析"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（三）tcpdump命令行保存到文件中，在wireshark中分析")])])]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("tcpdump -i eth0 icmp and src host 172.18.157.35 -nn -w ping.pcap")])])]),s._v(" "),n("li",[n("p",[s._v("使用wireshark将ping.pcap文件打开，在其下面的网络包详情中，可以更清楚的看到，这个网络包在协议栈各层的详细信息。比如")])])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2088),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 可以在数据链路层，看到 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAC")]),s._v(" 包头信息，如源 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAC")]),s._v(" 地址和目标 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAC")]),s._v(" 地址等字段\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 可以在 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" 层，看到 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" 包头信息，如源 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" 地址和目标 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" 地址、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TTL")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" 包长度、协议等 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" 协议各个字段的数值和含义\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 可以在 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" 层，看到 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" 包头信息，比如 Type、Code 等 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ICMP")]),s._v(" 协议各个字段的数值和含义\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("从 ping 的例子中，我们可以看到网络分层就像有序的分工，每一层都有自己的责任范围和信息，上层协议完成工作后就交给下一层，最终形成一个完整的网络包。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2089),alt:"Alt text"}})]),s._v(" "),n("h2",{attrs:{id:"二-解密tcp三次握手和四次挥手"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-解密tcp三次握手和四次挥手"}},[s._v("#")]),s._v(" 二：解密TCP三次握手和四次挥手")]),s._v(" "),n("h3",{attrs:{id:"一-本次例子在ecs主机上-请求百度首页-使用tcpdump抓包查看tcp请求流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-本次例子在ecs主机上-请求百度首页-使用tcpdump抓包查看tcp请求流程"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（一）本次例子在ECS主机上，请求百度首页，使用tcpdump抓包查看TCP请求流程")])])]),s._v(" "),n("ul",[n("li",[s._v("抓包命令")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any tcp and host www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com and port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcap\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("同时请求百度首页")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("curl www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("将baidu.pcap文件，在wireshark中打开，可以看到")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2090),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 最开始的 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 个包就是 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 三次握手建立连接的包\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：中间"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("个包是 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" 请求和响应的包\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：而最后的 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 个包则是 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 断开连接的挥手包\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"二-wireshark-时序图的显示方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-wireshark-时序图的显示方式"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（二）Wireshark 时序图的显示方式")])])]),s._v(" "),n("ul",[n("li",[s._v("Wireshark 可以用时序图的方式显示数据包交互的过程, 从菜单栏中，点击 统计 (Statistics) -### 流量图 (Flow Graph)，然后，在弹出的界面中的「流量类型」选择 「TCP Flows」，你可以更清晰的看到，整个过程中 TCP 流的执行过程")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2091),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("我们都知道 HTTP 是基于 TCP 协议进行传输的，那么：")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 最开始的 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 个包就是 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 三次握手建立连接的包\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 中间是 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" 请求和响应的包\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 而最后的 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 个包则是 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 断开连接的挥手包\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("这里的【流量图】中显示的seq序列号是从0开始的，这是Wireshark做了优化。可以选择任意一个流量包，点击右键，选择【协议首选项】，取消【Relative Seq】，那么流量图就会显示真实的seq序列号的值")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2092),alt:"Alt text"}})]),s._v(" "),n("p",[n("img",{attrs:{src:a(2093),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("从上图可以看到，"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("和"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("表示的是控制位，而Seq表示的是初始化的序列号，Ack表示应答号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("这里要注意"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("和Ack的区别，"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("是控制位，Ack是应答号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("可见，客户端和服务端的序列号实际上是不同的，序列号是一个随机值。这其实跟我们书上看到的 TCP 三次握手和四次挥手很类似，作为对比，你通常看到的 TCP 三次握手和四次挥手的流程，基本是这样的：")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2094),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("三次握手")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 客户端会随机初始化序号（client_isn），将此序号置于 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 首部的「序号」字段中，同时把 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 标志位置为 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ，表示 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 报文。接着把第一个 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 报文发送给服务端，表示向服务端发起连接，该报文不包含应用层数据，之后客户端处于 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SENT")]),s._v(" 状态。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 服务端收到客户端的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 报文后，首先服务端也随机初始化自己的序号（server_isn），将此序号填入 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 首部的「序号」字段中，其次把 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 首部的「确认应答号」字段填入 client_isn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 接着把 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 和 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 标志位置为 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("。最后把该报文发给客户端，该报文也不包含应用层数据，之后服务端处于 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RCVD")]),s._v(" 状态。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 客户端收到服务端报文后，还要向服务端回应最后一个应答报文，首先该应答报文 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 首部 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 标志位置为 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ，【序列号】是第二次握手的应答号，也就是第一次握手的序列号"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，其次「应答号」是第二次握手的序列号，最后把报文发送给服务端，这次报文可以携带客户到服务器的数据，之后客户端处于 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ESTABLISHED")]),s._v(" 状态。\n\n第一次和第二次握手不能携带数据，第三次握手可以携带数据\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("为什么是三次握手")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：如果客户端发送第一次握手的数据包，很久之后才到达服务器端，此时可能客户端已经关闭了，当服务器端收到第一次握手的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("报文的时候，会回复一个"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("报文，此时客户端收到报文后，会根据自己的上下文环境，给服务器端发送一个"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("的报文，close服务器端的连接状态。如果是两次连接，那么服务器端的连接状态不会关闭，以至于消耗服务器端的资源\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：需要确认序列号，当客户端发送seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("报文到服务器端，服务器会发送一个seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10101")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Ack"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v("到客户端，表明服务器收到报文，客户端又会回复一个seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v("，Ack"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10102")]),s._v("的报文到服务器端，表明客户端收到报文\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("四次握手")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 客户端打算关闭连接，此时会发送一个 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v(" 首部 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("的报文，seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101010")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Ack"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 之后客户端进入 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN_WAIT_1")]),s._v(" 状态。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 服务器端收到报文后，向客户端发送一个"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Ack"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101011")]),s._v("的应答报文，服务端进入 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLOSED_WAIT")]),s._v(" 状态。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 客户端收到报文后进入"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN_WAIT_2")]),s._v(" 状态，当服务器端处理完最后数据后，向客户端发送一个"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111001")]),s._v("、Ack"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101011")]),s._v("的报文，服务端进入 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LAST_ACK")]),s._v(" 状态\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：客户端收到报文后，回一个 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("，seq"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101011")]),s._v("、Ack"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111002")]),s._v("报文，之后进入 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TIME_WAIT")]),s._v(" 状态。服务器端收到报文就进入"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLOSE")]),s._v(" 状态，客户端在经过 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("MSL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("最大分段生存期"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 一段时间后，自动进入 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLOSE")]),s._v(" 状态\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("为什么要四次握手")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：关闭连接时，客户端向服务端发送 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN")]),s._v(" 时，仅仅表示客户端不再发送数据了但是还能接收数据。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：服务器收到客户端的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN")]),s._v(" 报文时，先回一个 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 应答报文，而服务端可能还有数据需要处理和发送，等服务端不再发送数据时，才发送 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN")]),s._v(" 报文给客户端来表示同意现在关闭连接。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("为何一定要等2MSL？")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("如果不等，释放的端口可能会重连刚断开的服务器端口，这样依然存活在网络里的老的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("报文可能与新"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("连接报文冲突，造成数据冲突，为避免此种情况，需要耐心等待网络老的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("连接的活跃报文全部死翘翘，"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("MSL时间可以满足这个需求（尽管非常保守）！\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"三-tcp-三次握手异常情况实战分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-tcp-三次握手异常情况实战分析"}},[s._v("#")]),s._v(" 三：TCP 三次握手异常情况实战分析")]),s._v(" "),n("h3",{attrs:{id:"一-tcp-第一次握手-syn-丢包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-tcp-第一次握手-syn-丢包"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（一）TCP 第一次握手 SYN 丢包")])])]),s._v(" "),n("ul",[n("li",[s._v("在服务器上tcpdump抓包，同时发起一个curl请求")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any tcp and host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),s._v(" and port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w syn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcap\ntcpdump"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" listening on any"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("type "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LINUX_SLL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Linux cooked"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" capture size "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v(" bytes\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("C7")]),s._v(" packets captured\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" packets received by filter\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets dropped by kernel\n\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# curl "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),s._v("\ncurl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed connect to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Connection timed out\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("在wireshark上显示")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2095),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：第"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("个数据包是"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("的第一次握手，标志位为"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：从第"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("个数据包开始到第"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("个数据包，是客户端没有收到"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("报文状态下，发起的重传，一共重传了"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("次，且每一次"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RTO")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Retransmission Timeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("的时间不同\n\t第一次是在 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 秒超时重传\n\t第二次是在 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 秒超时重传\n\t第三次是在 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 秒超时重传\n\t第四次是在 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 秒超时重传\n\t第五次是在 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" 秒超时重传\n\t第五次是在 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" 秒超时重传\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 可以发现，每次超时时间 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RTO")]),s._v(" 是指数（翻倍）上涨的，当超过最大重传次数后，客户端不再发送 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 包。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 在 Linux 中，第一次握手的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 超时重传次数，是如下内核参数指定的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 默认是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("次\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("proc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sys"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ipv4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp_syn_retries\n\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("：如果将"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("proc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sys"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ipv4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp_syn_retries修改为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("次，那么"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("包只会进行"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("次重传\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("ul",[n("li",[s._v("客户端SYN包重传示意图")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2096),alt:"Alt text"}})]),s._v(" "),n("h3",{attrs:{id:"二-tcp-第二次握手-syn、ack-丢包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-tcp-第二次握手-syn、ack-丢包"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（二）TCP 第二次握手 SYN、ACK 丢包")])])]),s._v(" "),n("ul",[n("li",[s._v("为了模拟客户端收不到服务端第二次握手 SYN、ACK 包，客户端加上防火墙限制，直接粗暴的把来自服务端的数据都丢弃，防火墙的配置如下：")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 拒绝百度的包\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# iptables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INPUT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s www"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DROP")]),s._v("\n\n# 查看防火墙规则\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# iptables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vnL\nChain "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INPUT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACCEPT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" packets"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("652")]),s._v(" bytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     source               destination         \n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DROP")]),s._v("       all  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           \n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DROP")]),s._v("       all  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".38")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n    \n# 删除第"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("条防火墙规则（也是就"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".38")]),s._v("）\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# iptables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INPUT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n# 再次查看\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# iptables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vnL      \nChain "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INPUT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACCEPT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" packets"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("652")]),s._v(" bytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     source               destination         \n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DROP")]),s._v("       all  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("抓包")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any and host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v(" and port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w ack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcap\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# curl "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),s._v("\ncurl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed connect to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".177")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".39")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Connection timed out\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("wireshark流量图显示")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2097),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("解释说明")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("：客户端发起 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 后，由于防火墙屏蔽了服务端的所有数据包，所以 curl 是无法收到服务端的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 包，当发生超时后，就会重传 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 包\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("：服务端收到客户的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 包后，就会回 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 包，但是客户端一直没有回 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("，服务端在超时后，重传了 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 包，接着一会，客户端超时重传的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 包又抵达了服务端，服务端收到后，超时定时器就重新计时，然后回了 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 包，所以相当于服务端的超时定时器只触发了一次，又被重置了。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("：最后，客户端 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 超时重传次数达到了 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 次（tcp_syn_retries 默认值 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 次），就不再继续发送 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 包了。\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("：所以，我们可以发现，当第二次握手的 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 丢包时，客户端会超时重发 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v(" 包，服务端也会超时重传 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" 包。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("因为我们的iptables规则写在INPUT链上，因此可以使用tcpdump抓包，如果写在OUTPUT链上，那么就无法抓到包，网络包进出入主机的顺序如下")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("进来的顺序 Wire "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("### "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NIC")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" netfilter"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iptables\n出去的顺序 iptables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("### tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NIC")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Wire\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("第二次握手，SYN、ACK报文的重传次数为")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("proc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sys"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ipv4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp_synack_retries\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"三-tcp-第三次握手-ack-丢包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-tcp-第三次握手-ack-丢包"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（三）TCP 第三次握手 ACK 丢包")])])]),s._v(" "),n("ul",[n("li",[s._v("为了模拟 TCP 第三次握手 ACK 包丢，我的实验方法是在服务端配置防火墙，屏蔽客户端 TCP 报文中标志位是 ACK 的包，也就是当服务端收到客户端的 TCP ACK 的报文时就会丢弃，iptables 配置命令如下：")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 服务器端丢弃第三次握手的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("包\niptables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INPUT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".37")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p tcp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flag "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RST")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URG")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PSH")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DROP")]),s._v("\n\n# 也可以写成\niptables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INPUT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".37")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p tcp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flag "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("j "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DROP")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("接着，在客户端执行如下 tcpdump 命令：")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any tcp and host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".36")]),s._v(" and port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w ack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcap\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("然后，客户端向服务端发起 telnet，因为 telnet 命令是会发起 TCP 连接，所以用此命令做测试：")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("telnet \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"四-tcpdump工具全面解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-tcpdump工具全面解析"}},[s._v("#")]),s._v(" 四：tcpdump工具全面解析")]),s._v(" "),n("h3",{attrs:{id:"一-常用过滤表达式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-常用过滤表达式"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（一）常用过滤表达式")])])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("\t过滤表达式大体可以分成三种过滤条件，“类型”、“方向”、“协议”、逻辑运算和其他关键字，这五种条件的搭配组合就构成了我们的过滤表达式\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("【类型】关键字")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("关于类型的关键字，主要包括host，net，port\n例如"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\nhost "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".114")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".211")]),s._v("，指定主机 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".114")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".211")]),s._v("\nnet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.11")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" 指明"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.11")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("是一个网络地址\nport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" 指明端口号是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("\n\n示例"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any tcp and host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".40")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".224")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("【方向】关键字")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("关于传输方向的关键字，主要包括src，dst，dst or src，dst and src\n举例"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\nsrc "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".114")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".211")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("指明ip包中源地址是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".114")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".211")]),s._v("\ndst net "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.11")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" 指明目的网络地址是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.11")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n\n示例：\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any tcp and src "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".40")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".224")]),s._v(" and dst "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".249")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("【协议】关键字")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("关于协议的关键字，主要包括 ether，ip，ip6，arp，rarp，tcp，udp 等类型。\n如果没有指定任何协议，则tcpdump将会监听所有协议的信息包。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("【三种逻辑运算符】关键字")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[s._v("逻辑运算")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("表示方法")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("与")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v('"and"&&"')])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("或")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v('"or"或"')])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("非")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v('"not"或"!"')])])])]),s._v(" "),n("ul",[n("li",[s._v("【其他】关键字")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("tcpdump还在其他几种关键字：gateway、broadcast、less、greater\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("一些使用的基本示例")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("只想查目标机器端口是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("的网络包，其他端口的我不关注："),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c是在收到指定的包的数目后，tcpdump就会停止\nsudo tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dst port 21 or dst port 80'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 想要截获主机"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v(" 和主机"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".249")]),s._v("或 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".248")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("的通信，使用命令")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("注意括号的使用"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：\nsudo tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'host 172.16.0.11 and (210.45.123.249 or210.45.123.248)'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("想获取使用ftp端口和ftp数据端口的网络包\nsudo tcpdump "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'port ftp or ftp-data'")]),s._v("\n这里 ftp、ftp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data到底对应哪个端口？ linux系统下 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("services这个文件里面，就存储着所有知名服务和传输层端口的对应关系。如果你直接把"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("services里的ftp对应的端口值从21改为了3333，那么tcpdump就会去抓端口含有3333的网络包了。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 如果想要获取主机"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("除了和主机"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".249")]),s._v("之外所有主机通信的ip包，使用命令：\nsudo tcpdump ip ‘host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v(" and "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("210.45")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".123")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".249")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("’")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 抓"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v("的"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("端口和"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("和"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("以外的其他端口的包\nsudo tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth0 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'host 172.16.0.11 and! port 80 and ! port 25 and ! port 110'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"二-高级包头过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-高级包头过滤"}},[s._v("#")]),s._v(" "),n("strong",[n("code",[s._v("（二）高级包头过滤")])])]),s._v(" "),n("ul",[n("li",[s._v("首先了解如何从包头过滤信息，proto表示协议的意思，ip[0]，表示取IP报文的第一个字节")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("proto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 过滤从x字节开始的y字节数。比如ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("过滤出"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("字节（第一字节从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("开始排）\nproto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" z "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" proto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("和z的与操作为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nproto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" z "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" proto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("和z的与操作不为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nproto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" z "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" z "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" proto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("和z的与操作为z\nproto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" z "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" proto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("等于z\n\n操作符 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("IP包头格式")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(2098),alt:"Alt text"}})]),s._v(" "),n("ul",[n("li",[s._v("在判断IP包头的时候，需要先判断是否包头设置了选项")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("一般而言，"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("头部是20字节大小")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("由上图可知"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，但是如果"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("头部设置了选项，那么"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("报文的数据就不能从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("字节处读取，"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("头部有一个字段可以判断"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("头部的长度：【首部长度】。因此在数据抓包的时候，可以抓取第一个字节，看看是不是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("01000101")]),s._v("。由"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("报文头可以知道，【版本】"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 【首部长度】"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("bit "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("Byte\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("01000101")]),s._v("可以拆解为："),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0100")]),s._v(" 和 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0101")]),s._v("， 那么如果需要判断是否"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("报文添加了选项，可以这样抓包：抓取没有选项的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("报文\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ip[0] & 15 = 5'")]),s._v(" and src "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".40")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".224")]),s._v(" and dst "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".249")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("分片标记")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("当发送端的MTU大于到目的路径链路上的MTU时就会被分片，分片信息在IP头的第7和第8字节，【标志】和【片偏移】\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("抓取大于X字节的IP包，包的大小在第3，4个字节")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("\t抓取"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("报文大于"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("字节的包：\n\ttcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ip[2:2] ### 600'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("抓取不同阶段的TCP数据包")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# 只抓"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("包"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 第"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("字节是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("00000010")]),s._v("，十进制就是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[13] = 2'")]),s._v("  and src "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".40")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".224")]),s._v(" and dst "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".249")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\n\n# 抓"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("包，第"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("字节是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("00010010")]),s._v("，十进制就是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[13] = 18'")]),s._v(" and src "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".40")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".224")]),s._v(" and dst "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".201")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".249")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\n\n# 抓"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("或者"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("，\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth1 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[13] & 2 = 2'")]),s._v("\n\n# 抓"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PSH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("，这里是抓有数据的包，\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth1 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[13] = 24'")]),s._v("\n\n# 抓所有包含"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FIN")]),s._v("标记的包\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth1 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[13] & 1 = 1'")]),s._v("\n\n# 抓"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RST")]),s._v("（勾搭没成功，伟大的greatwall对她认为有敏感信息的连接发"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RST")]),s._v("包，典型的棒打鸳鸯）\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth1 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[13] & 4 = 4'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("标记值：\ntcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("syn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rst"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urg\n这样上面按照"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("标记位抓包的就可以写直观的表达式了：\n\n只抓"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),s._v("包\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth1 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[tcpflags] = tcp-syn'")]),s._v("\n抓"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACK")]),s._v("\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i eth1 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[tcpflags] & tcp-syn != 0 and tcp[tcpflags] & tcp-ack != 0'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("ul",[n("li",[s._v("获取HTTP请求的数据包")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 表示获取所有长度大小"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),s._v("表示显示内容，不显示"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("头部信息\n# "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("和"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("都是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("个字节，那么需要分析"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v("的请求，就可以这样"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 下面是抓取"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POST")]),s._v("请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x4745")]),s._v("是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("进制的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GE")]),s._v("，"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x504f")]),s._v("是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("进制的"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PO")]),s._v("\ntcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),s._v(" tcp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x4745")]),s._v(" or tcp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x504f")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\n\n\n返回结果如下：\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("03.722050")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.22")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".22")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".59996")]),s._v(" ### "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.102")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Flags "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("P")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" seq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3479321590")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3479322147")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ack "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("573852493")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" win "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1026")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("557")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("U")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?.")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\nf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v('"'),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("KMP"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("business"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lotus"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\nHost"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.102")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\nConnection"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" keep"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alive\nAccept"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*; q=0.01\nX-Requested-With: XMLHttpRequest\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36\nReferer: http://10.102.0.14:8000/business/lotus/\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8\nCookie: csrftoken=ASVw09C2r0cumRaaVk64vaWQv3gF6k6xe0c48RHyDjHMDi8JxLV5Ndhez7oLcq9n; sessionid=4vi0ml2ggi0mh7gzikzj4ignep9jl7ia\n")])])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("获取flag为push的请求")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("tcpdump "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i any "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tcp[tcpflags] & tcp-push != 0'")]),s._v(" and  host "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nn\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);