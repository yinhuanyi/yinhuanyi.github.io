(window.webpackJsonp=window.webpackJsonp||[]).push([[515],{2490:function(s,n,e){"use strict";e.r(n);var t=e(9),a=Object(t.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"一-命令查看当前进程活动的线程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-命令查看当前进程活动的线程"}},[s._v("#")]),s._v(" 一：命令查看当前进程活动的线程")]),s._v(" "),e("ul",[e("li",[s._v("例如进程PID为3497使用Top命令查看")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("top -H p 3497\n\ntop - 19:33:52 up 10 days, 23:21,  1 user,  load average: 0.50, 0.32, 0.28\nThreads:  26 total,   0 running,  26 sleeping,   0 stopped,   0 zombie\n%Cpu(s):  1.0 us,  0.7 sy,  0.0 ni, 98.0 id,  0.2 wa,  0.0 hi,  0.0 si,  0.0 st\nKiB Mem : 16267060 total, 10750904 free,  1180464 used,  4335692 buff/cache\nKiB Swap:        0 total,        0 free,        0 used. 14420560 avail Mem\n\n  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND\n 3556 root      20   0  501020 347396  41208 S  1.0  2.1 310:25.00 kube-apiserver\n11730 root      20   0  501020 347396  41208 S  1.0  2.1  40:16.75 kube-apiserver\n 3885 root      20   0  501020 347396  41208 S  0.7  2.1  70:03.48 kube-apiserver\n 3887 root      20   0  501020 347396  41208 S  0.7  2.1  69:03.80 kube-apiserver\n 2714 root      20   0  501020 347396  41208 S  0.7  2.1  48:15.50 kube-apiserver\n 3557 root      20   0  501020 347396  41208 S  0.3  2.1  66:09.79 kube-apiserver\n 3558 root      20   0  501020 347396  41208 S  0.3  2.1  61:42.05 kube-apiserver\n 3686 root      20   0  501020 347396  41208 S  0.3  2.1  58:54.66 kube-apiserver\n 3691 root      20   0  501020 347396  41208 S  0.3  2.1  67:32.06 kube-apiserver\n 3772 root      20   0  501020 347396  41208 S  0.3  2.1  66:51.08 kube-apiserver\n 3886 root      20   0  501020 347396  41208 S  0.3  2.1  58:25.87 kube-apiserver\n 3893 root      20   0  501020 347396  41208 S  0.3  2.1  56:45.43 kube-apiserver\n 3896 root      20   0  501020 347396  41208 S  0.3  2.1  59:57.29 kube-apiserver\n 3497 root      20   0  501020 347396  41208 S  0.0  2.1   0:00.13 kube-apiserver\n 3559 root      20   0  501020 347396  41208 S  0.0  2.1  51:13.75 kube-apiserver\n 3685 root      20   0  501020 347396  41208 S  0.0  2.1   0:00.00 kube-apiserver\n 3687 root      20   0  501020 347396  41208 S  0.0  2.1  65:27.79 kube-apiserver\n 3771 root      20   0  501020 347396  41208 S  0.0  2.1  13:34.54 kube-apiserver\n 3775 root      20   0  501020 347396  41208 S  0.0  2.1   0:00.00 kube-apiserver\n 3776 root      20   0  501020 347396  41208 S  0.0  2.1  52:18.98 kube-apiserver\n 3884 root      20   0  501020 347396  41208 S  0.0  2.1  59:58.05 kube-apiserver\n 3888 root      20   0  501020 347396  41208 S  0.0  2.1  70:06.28 kube-apiserver\n 3892 root      20   0  501020 347396  41208 S  0.0  2.1  65:57.78 kube-apiserver\n31843 root      20   0  501020 347396  41208 S  0.0  2.1  67:32.26 kube-apiserver\n11729 root      20   0  501020 347396  41208 S  0.0  2.1  55:04.16 kube-apiserver\n 2715 root      20   0  501020 347396  41208 S  0.0  2.1   0:00.00 kube-apiserver\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br")])]),e("ul",[e("li",[s._v("例如进程PID为3497使用ps命令查看")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 查看进程3497的所有线程\nps huH p 3497\n\n# 查看线程个数\nps huH p 3497 | wc -l\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"二-find-命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-find-命令"}},[s._v("#")]),s._v(" 二：find 命令")]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("(一)：基本语法格式")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("find [路径] [选项] [操作]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("find的选项")])]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[s._v("选项")]),s._v(" "),e("th",{staticStyle:{"text-align":"center"}},[s._v("含义")])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-name")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("根据文件名称查找")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-perm")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("根据文件权限查找")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-prune")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("该选项可以排除某些查找目录")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-user")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("根据文件属主查找")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-group")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("根据文件属组查找")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-mtime -n | +n")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("根据文件更改时间查找")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-nogroup")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("查找无有效属组的文件")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-nouser")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("查找无有效属主的文件")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-newer file1 ! file2")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("查找更改时间比file1新但是比file2旧")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-type")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("按文件类型查找")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-size -n +n")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("按文件大小查找")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-mindepth n")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("从n级子目录开始搜索")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("-maxdepth n")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("最多搜索到n级子目录")])])])]),s._v(" "),e("ul",[e("li",[s._v("示例")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 搜索以.conf结尾的文件\nfind /etc -name "*.conf"\n\n# 指定文件类型搜索\nfind /etc -type f \n\n# 指定文件大小查找, 大于1M\nfind /etc -size +1M\n\n# 指定文件大小查找, 小于1M\nfind /etc -size -1M\n\n# 指定修改时间查找，3天以内修改的文件\nfind /etc -mtime -3\n\n# 指定修改时间查找，3天之前修改的文件\n# 如果修改文件内容，mtime和ctime都会改变，如果修改文件权限，mtime不变，而ctime会改变\nfind /etc -mtime +3\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("ul",[e("li",[s._v("手动删除API server的日志")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("du --max-depth=1 -h  # 找出哪个目录日志最多\n\nsudo find ./ -name 'livetv-channel-info-201806*' -type f -exec rm -f {} \\;  # 批量删除\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"三-rsync-命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-rsync-命令"}},[s._v("#")]),s._v(" 三：rsync 命令")]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("(一)：基本语法格式")])])]),s._v(" "),e("ul",[e("li",[s._v("概念介绍")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('1：增量备份\n\trsync是可以实现增量备份的工具，配合inotify或sersync，可以实现触发式的实时同步\n\n2：远程拷贝\n\trsync可以实现scp的远程拷贝(rsync不支持远程到远程的拷贝，但scp支持)、cp的本地拷贝、rm删除和"ls -l"显示文件列表等功能。但需要注意的是，rsync的最终目的或者说其原始目的是实现两端主机的文件同步，因此实现的scp/cp/rm等功能仅仅只是同步的辅助手段\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("rsync同步说明")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\trsync的目的是实现本地主机和远程主机上的文件同步(有推拉两种方式)，也可以实现本地不同路径下文件的同步，但不能实现远程路径1到远程路径2之间的同步(scp可以实现)。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("rsync三种工作方式")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("(1) 本地文件系统上实现同步\n\trsync [OPTION...] SRC... [DEST]\n\n(2) 本地主机使用远程shell和远程主机通信\n\tPull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]\n\tPush: rsync [OPTION...] SRC... [USER@]HOST:DEST\n\n(3) 本地主机通过网络套接字连接远程主机上的rsync daemon\n\tPull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]\n          rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]\n    Push: rsync [OPTION...] SRC... [USER@]HOST::DEST\n          rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("简单的rsync同步示例")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("rsync /etc/fstab /tmp                # 在本地同步\n\nrsync -r /etc 172.16.10.5:/tmp       # 将本地/etc目录拷贝到远程主机的/tmp下，以保证远程/tmp目录和本地/etc保持同步\n\nrsync -r 172.16.10.5:/etc /tmp       # 将远程主机的/etc目录拷贝到本地/tmp下，以保证本地/tmp目录和远程/etc保持同步\n\nrsync /etc/                          # 列出本地/etc/目录下的文件列表\n\nrsync 172.16.10.5:/tmp/              # 列出远程主机上/tmp/目录下的文件列表\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ul",[e("li",[s._v("注意点")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("使用rsync一定要注意的一点是，源路径如果是一个目录的话，带上尾随斜线和不带尾随斜线是不一样的，不带尾随斜线表示的是整个目录包括目录本身，带上尾随斜线表示的是目录中的文件，不包括目录本身\n\nrsync -a /etc /tmp\nrsync -a /etc/ /tmp\n\n第一个命令会在/tmp目录下创建etc目录，而第二个命令不会在/tmp目录下创建etc目录，源路径/etc/中的所有文件都直接放在/tmp目录下\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("blockquote",[e("p",[e("code",[s._v("(二)：选项说明和示例")])])]),s._v(" "),e("ul",[e("li",[s._v('rsync选项说明(虽然选项非常多，但最常用的选项组合是"avz"，即压缩和显示部分信息，并以归档模式传输)')])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('-v：显示rsync过程中详细信息。可以使用"-vvvv"获取更详细信息。\n-P：显示文件传输的进度信息。(实际上"-P"="--partial --progress"，其中的"--progress"才是显示进度信息的)。\n-n --dry-run  ：仅测试传输，而不实际传输。常和"-vvvv"配合使用来查看rsync是如何工作的。\n-a --archive  ：归档模式，表示递归传输并保持文件属性。等同于"-rtopgDl"。\n-r --recursive：递归到目录中去。\n-t --times：保持mtime属性。强烈建议任何时候都加上"-t"，否则目标文件mtime会设置为系统时间，导致下次更新\n          ：检查出mtime不同从而导致增量传输无效。\n-o --owner：保持owner属性(属主)。\n-g --group：保持group属性(属组)。\n-p --perms：保持perms属性(权限，不包括特殊权限)。\n-D        ：是"--device --specials"选项的组合，即也拷贝设备文件和特殊文件。\n-l --links：如果文件是软链接文件，则拷贝软链接本身而非软链接所指向的对象。\n-z        ：传输时进行压缩提高效率。\n-R --relative：使用相对路径。意味着将命令行中指定的全路径而非路径最尾部的文件名发送给服务端，包括它们的属性。用法见下文示例。\n--size-only ：默认算法是检查文件大小和mtime不同的文件，使用此选项将只检查文件大小。\n-u --update ：仅在源mtime比目标已存在文件的mtime新时才拷贝。注意，该选项是接收端判断的，不会影响删除行为。\n-d --dirs   ：以不递归的方式拷贝目录本身。默认递归时，如果源为"dir1/file1"，则不会拷贝dir1目录，使用该选项将拷贝dir1但不拷贝file1。\n--max-size  ：限制rsync传输的最大文件大小。可以使用单位后缀，还可以是一个小数值(例如："--max-size=1.5m")\n--min-size  ：限制rsync传输的最小文件大小。这可以用于禁止传输小文件或那些垃圾文件。\n--exclude   ：指定排除规则来排除不需要传输的文件。\n--delete    ：以SRC为主，对DEST进行同步。多则删之，少则补之。注意"--delete"是在接收端执行的，所以它是在\n            ：exclude/include规则生效之后才执行的。\n-b --backup ：对目标上已存在的文件做一个备份，备份的文件名后默认使用"~"做后缀。\n--backup-dir：指定备份文件的保存路径。不指定时默认和待备份文件保存在同一目录下。\n-e          ：指定所要使用的远程shell程序，默认为ssh。\n--port      ：连接daemon时使用的端口号，默认为873端口。\n--password-file：daemon模式时的密码文件，可以从中读取密码实现非交互式。注意，这不是远程shell认证的密码，而是rsync模块认证的密码。\n-W --whole-file：rsync将不再使用增量传输，而是全量传输。在网络带宽高于磁盘带宽时，该选项比增量传输更高效。\n--existing  ：要求只更新目标端已存在的文件，目标端还不存在的文件不传输。注意，使用相对路径时如果上层目录不存在也不会传输。\n--ignore-existing：要求只更新目标端不存在的文件。和"--existing"结合使用有特殊功能，见下文示例。\n--remove-source-files：要求删除源端已经成功传输的文件。\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("ul",[e("li",[s._v("拷贝本地文件到远程指定的目录")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('rsync -e "ssh -p 22 -o StrictHostKeyChecking=no" /etc/fstab 172.16.10.5:/tmp\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v('使用"'),e("code",[s._v("--existing")]),s._v('"选项，只更新目标端已存在的文件（只更新/tmp/a/目录和/tmp/b目录都有的文件）')])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("rsync -r -v --existing /tmp/a/ /tmp/b \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v('使用"'),e("code",[s._v("--ignore-existing")]),s._v('"选项，只更新目标端不存在的文件（只更新/tmp/a/目录下有，而/tmp/b目录下没有的文件）')])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("rsync -r -v --ignore-existing /tmp/a/ /tmp/b\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("使用"),e("code",[s._v("--exclude")]),s._v("排除规则")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('当前目录结构\nroot@jenkins:~# tree\n├── audit\n│   └── test.txt\n├── log\n│   └── test.sh\n\n\n①：将audit、log目录下的文件拷贝到/tmp目录下，且不拷贝所有的以.txt结尾的文件\nroot@jenkins:~# rsync -avz --exclude="*.txt" /root/log /root/audit /tmp\nsending incremental file list\naudit/\nlog/\nlog/test.sh\n\nsent 1,495 bytes  received 43 bytes  3,076.00 bytes/sec\ntotal size is 3,178  speedup is 2.07\n\n\n②：如果不拷贝以.txt和.sh结尾的文件\nroot@jenkins:~# rsync -avz --exclude="*.txt" --exclude="*.sh" log audit /tmp\nsending incremental file list\naudit/\nlog/\n\nsent 84 bytes  received 20 bytes  208.00 bytes/sec\ntotal size is 0  speedup is 0.00\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("ul",[e("li",[s._v("关于rsync规则的理解")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('关于规则，最重要的一点是它的作用时间。\n\t当发送端敲出rsync命令后，rsync将立即扫描命令行中给定的文件和目录(扫描过程中还会按照目录进行排序，将同一个目录的文件放在相邻的位置)，这称为拷贝树(copy tree)，扫描完成后将待传输的文件或目录记录到文件列表中，然后将文件列表传输给接收端。而筛选规则的作用时刻是在扫描拷贝树时，所以会根据规则来匹配并决定文件是否记录到文件列表中(严格地说是会记录到文件列表中的，只不过排除的文件会被标记为hide隐藏起来)，只有记录到了文件列表中的文件或目录才是真正需要传输的内容。换句话说，筛选规则的生效时间在rsync整个同步过程中是非常靠前的，它会影响很多选项的操作对象，最典型的如"--delete"。也许，你看完这一整篇文章都没感觉到这一点的重要性，但如果你阅读rsync的man文档或者学习rsync的原理，你一定会深有体会。\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("在写rsync的匹配规则的时候，可以先使用"),e("code",[s._v("dry run")]),s._v("模式先测试，其中"),e("code",[s._v("-n")]),s._v("表示dry run，"),e("code",[s._v("-i")]),s._v(" 表示输出文件传输的路径")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\nroot@jenkins:~# rsync -nr -i --exclude='*.sh'  log audit gitlab:/tmp/\ncd+++++++++ audit/\n<f+++++++++ audit/test.txt\ncd+++++++++ log/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("使用"),e("code",[s._v("--delete")]),s._v("完成"),e("code",[s._v("多则删之，少则补之")]),s._v("的同步策略，也就是"),e("code",[s._v("无差异同步")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("root@jenkins:~# rsync -avz --delete audit gitlab:/root/\nsending incremental file list\ndeleting audit/monitor.txt\naudit/\n\nsent 92 bytes  received 41 bytes  266.00 bytes/sec\ntotal size is 115  speedup is 0.86\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ul",[e("li",[s._v("将"),e("code",[s._v("--delete")]),s._v("与"),e("code",[s._v("--exclude")]),s._v("一起使用，被排除的文件不会删除, 这里的linux.txt文件不会被删除")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("root@jenkins:~# rsync -avz --delete --exclude='linux.txt'  audit gitlab:/root/\nsending incremental file list\ndeleting audit/monitor.txt\naudit/\n\nsent 107 bytes  received 41 bytes  98.67 bytes/sec\ntotal size is 115  speedup is 0.78\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("blockquote",[e("p",[e("code",[s._v("(三)：rsync daemon")]),s._v("通信方式")])]),s._v(" "),e("ul",[e("li",[s._v("rsync daemon的通信方式和传输通道与远程shell不同")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\t远程shell连接的两端是通过管道完成通信和数据传输的，即使连接的一端是远程主机，当连接到目标端时，将在目标端上根据远程shell进程fork出rsync进程使其成为rsync server。而rsync daemon是事先在server端上运行好的rsync后台进程(根据启动选项，也可以设置为非后台进程)，它监听套接字等待client端的连接，连接建立后所有通信方式都是通过套接字完成的。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("p",[s._v("默认"),e("code",[s._v("rsync --daemon")]),s._v("读取的配置文件为/etc/rsyncd.conf，有些版本的系统上可能该文件默认不存在。rsyncd.conf的配置见man rsyncd.conf")])]),s._v(" "),e("li",[e("p",[s._v("/etc/rsyncd.conf配置如下")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cat /etc/rsyncd.conf\n# /etc/rsyncd: configuration file for rsync daemon mode\n \n# See rsyncd.conf man page for more options.\n \n# configuration example:\n \n# uid = nobody\n# gid = nobody\n# use chroot = yes\n# max connections = 4\n# pid file = /var/run/rsyncd.pid\n# exclude = lost+found/\n# transfer logging = yes\n# timeout = 900\n# ignore nonreadable = yes\n# dont compress   = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2\n \n# [ftp1]\n#        path = /home/ftp\n#        comment = ftp export area\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("ul",[e("li",[s._v("对配置基本解释说明")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\t在上述示例配置文件中，先定义了一些全局选项，然后定义了[ftp1]，这个用中括号包围的"[ftp1]"就是rsync中所谓的模块，ftp1为模块ID，必须保证唯一，每个模块中必须定义一项"path"，path定义的是该模块代表的路径，例如此示例文件中，如果想请求ftp1模块，则在客户端使用"rsync user@host::ftp1"，这表示访问user@host上的/home/ftp目录，如果要访问/home/ftp目录下的子目录www，则"rsync user@host::ftp1/www"。\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("基本配置示例")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('####### 全局配置参数 ##########\nport=888    # 指定rsync端口。默认873\nuid = rsync # rsync服务的运行用户，默认是nobody，文件传输成功后属主将是这个uid\ngid = rsync # rsync服务的运行组，默认是nobody，文件传输成功后属组将是这个gid\nuse chroot = no # rsync daemon在传输前是否切换到指定的path目录下，并将其监禁在内\nmax connections = 200 # 指定最大连接数量，0表示没有限制\ntimeout = 300         # 确保rsync服务器不会永远等待一个崩溃的客户端，0表示永远等待\nmotd file = /var/rsyncd/rsync.motd   # 客户端连接过来显示的消息\npid file = /var/run/rsyncd.pid       # 指定rsync daemon的pid文件\nlock file = /var/run/rsync.lock      # 指定锁文件\nlog file = /var/log/rsyncd.log       # 指定rsync的日志文件，而不把日志发送给syslog\ndont compress = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2  # 指定哪些文件不用进行压缩传输\n \n###########下面指定模块，并设定模块配置参数，可以创建多个模块###########\n[longshuai]        # 模块ID\npath = /longshuai/ # 指定该模块的路径，该参数必须指定。启动rsync服务前该目录必须存在。rsync请求访问模块本质就是访问该路径。\nignore errors      # 忽略某些IO错误信息\nread only = false  # 指定该模块是否可读写，即能否上传文件，false表示可读写，true表示可读不可写。所有模块默认不可上传\nwrite only = false # 指定该模式是否支持下载，设置为true表示客户端不能下载。所有模块默认可下载\nlist = false       # 客户端请求显示模块列表时，该模块是否显示出来，设置为false则该模块为隐藏模块。默认true\nhosts allow = 10.0.0.0/24 # 指定允许连接到该模块的机器，多个ip用空格隔开或者设置区间\nhosts deny = 0.0.0.0/32   # 指定不允许连接到该模块的机器\nauth users = rsync_backup # 指定连接到该模块的用户列表，只有列表里的用户才能连接到模块，用户名和对应密码保存在secrts file中，\n                          # 这里使用的不是系统用户，而是虚拟用户。不设置时，默认所有用户都能连接，但使用的是匿名连接\nsecrets file = /etc/rsyncd.passwd # 保存auth users用户列表的用户名和密码，每行包含一个username:passwd。由于"strict modes"\n                                  # 默认为true，所以此文件要求非rsync daemon用户不可读写。只有启用了auth users该选项才有效。\n[xiaofang]    # 以下定义的是第二个模块\npath=/xiaofang/\nread only = false\nignore errors\ncomment = anyone can access\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])])])}),[],!1,null,null,null);n.default=a.exports}}]);