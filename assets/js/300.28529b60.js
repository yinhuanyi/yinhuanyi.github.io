(window.webpackJsonp=window.webpackJsonp||[]).push([[300],{1559:function(s,e,a){s.exports=a.p+"assets/img/2019-08-2412.24.31.f4460628.png"},2587:function(s,e,a){"use strict";a.r(e);var n=a(9),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-hive基本概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-hive基本概念"}},[s._v("#")]),s._v(" 一：Hive基本概念")]),s._v(" "),n("h3",{attrs:{id:"一-概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-概念"}},[s._v("#")]),s._v(" (一)概念")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\tHive是FB开源，解决结构化日志的数据统计，Hive是Hadoop的一个数据仓库工具，将结构化日志映射为一张表，且提供SQL查询功能。具有HQL查询功能，使用HDFS存储\n\tHive本质是将HQL转换为MapReduce程序，适合离线数据分析\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"二-hive基础架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-hive基础架构"}},[s._v("#")]),s._v(" 二：Hive基础架构")]),s._v(" "),n("h3",{attrs:{id:"一-原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-原理"}},[s._v("#")]),s._v(" (一)原理")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1559),alt:"Alt text"}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("基于用户输入的CLI或java程序，将调用diver，将SQL转换为MapReduce程序，再从Meta Store中查找元数据，访问HDFS中的数据。这里的Meta Store使用的是MySQL数据库\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"三-hive的安装与配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-hive的安装与配置"}},[s._v("#")]),s._v(" 三：Hive的安装与配置")]),s._v(" "),n("ul",[n("li",[s._v("将hive放在第3个节点上")])]),s._v(" "),n("h3",{attrs:{id:"一-下载安装hive-0-13-1-cdh5-3-5-tar-gz"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-下载安装hive-0-13-1-cdh5-3-5-tar-gz"}},[s._v("#")]),s._v(" (一)下载安装hive-0.13.1-cdh5.3.5.tar.gz")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"二-添加环境变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-添加环境变量"}},[s._v("#")]),s._v(" (二)添加环境变量")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vi /etc/profile.d/hive.sh \nexport PATH=/opt/modules/hive-0.13.1-cdh5.3.5/bin:$PATH\n. /etc/profile.d/hive.sh \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"三-hive配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-hive配置"}},[s._v("#")]),s._v(" (三)Hive配置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：创建logs目录\n[root@node3 hive-0.13.1-cdh5.3.5]# mkdir logs\n\n2: vi hive-log4j.properties\nhive.log.dir=/opt/modules/hive-0.13.1-cdh5.3.5/logs\n\n3: vi hive-env.sh\nHADOOP_HOME=/opt/modules/hadoop-2.5.0-cdh5.3.5\nexport HIVE_CONF_DIR=/opt/modules/hive-0.13.1-cdh5.3.5/conf\n\n4: 安装顺序启动zk,hdfs，zkfc,yarn,hbase,kafka(yarn一定需要启动，因为hive的sql语句会转换为mapreduce程序)\n\n5: 由于hive的数据存储在hdfs中，因此需要在hdfs中先创建一个/user/hive/warehouse目录，且给与对应的权限\nhdfs dfs -mkdir -p /user/hive/warehouse\nhdfs dfs -chmod g+w /user/hive/warehouse\n\n6: 进入hive\nhive### show databases;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h2",{attrs:{id:"四-hive与mysql的集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-hive与mysql的集成"}},[s._v("#")]),s._v(" 四：Hive与MySQL的集成")]),s._v(" "),n("ul",[n("li",[s._v("配置")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1: 在/opt/modules/hive-0.13.1-cdh5.3.5/conf创建hive-site.xml文件,将连接MySQL的配置写在文件中\n<configuration>\n\t<property>\n\t\t<name>javax.jdo.option.ConnectionURL</name>\n\t\t<value>jdbc:mysql://node1/metastore?createDatabaseIfNotExist=true</value>\n\t</property>\n\t<property>\n\t    <name>javax.jdo.option.ConnectionDriverName</name>\n\t    <value>com.mysql.jdbc.Driver</value>\n\t</property>\n\t<property>\n\t    <name>javax.jdo.option.ConnectionUserName</name>\n\t    <value>root</value>\n\t</property>\n\t<property>\n\t    <name>javax.jdo.option.ConnectionPassword</name>\n\t    <value>yhy3426356</value>\n\t</property>\n\t<property>\n\t    <name>hive.cli.print.header</name>\n\t    <value>true</value>\n\t</property>\n\t<property>\n\t    <name>hive.cli.print.current.db</name>\n\t    <value>true</value>\n\t</property>\n</configuration>\n\n2: 在mysql创建hive可连接用户\nmysql -pyhy3426356\ngrant all on *.* to root@'%' identified by 'yhy3426356';\nflush privileges;\n\n3: 将MySQL驱动jar包mysql-connector-java-5.1.45.jar到/opt/modules/hive-0.13.1-cdh5.3.5/lib\n\n4: hive创建数据表test\n[root@node3 ~]# hive\nhive### use default;\nOK\n# 这里是指定表的每一行的分隔符为'\\t'，这样方便向表中插入数据，因为hive中的默认表分隔符为：SOH字符\nhive### create table test(id int, name string) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t';\nOK\nhive### show tables;\nOK\ntest\n\n5：创建多行表数据写入/opt/datas/test.txt，这里的间隔符一定需要是table键\n001    kafka\n002    zookeeper\n003    hadoop\n004    mapreduce\n005    spark\n\n6: 在hive里面加载/opt/datas/test.txt中的表数据\n# 加载数据\nhive### load data local inpath '/opt/datas/test.txt' into table test;\n# 查看数据\nselect * from test;\n1       kafka\n2       zookeeper\n3       hadoop\n4       mapreduce\n5       sparkd\n\n# 执行一个聚合函数，转换为mapreduce程序\nselect count(1) from test; \nHadoop job information for Stage-1: number of mappers: 2; number of reducers: 1\n2019-08-24 15:36:26,216 Stage-1 map = 0%,  reduce = 0%\n2019-08-24 15:36:36,548 Stage-1 map = 50%,  reduce = 0%, Cumulative CPU 1.52 sec\n2019-08-24 15:36:38,749 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 3.0 sec\n2019-08-24 15:36:44,012 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 4.13 sec\nMapReduce Total cumulative CPU time: 4 seconds 130 msec\nEnded Job = job_1566631755379_0001\nMapReduce Jobs Launched: \nStage-Stage-1: Map: 2  Reduce: 1   Cumulative CPU: 4.13 sec   HDFS Read: 541 HDFS Write: 3 SUCCESS\nTotal MapReduce CPU Time Spent: 4 seconds 130 msec\nOK\n10\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br")])]),n("h2",{attrs:{id:"五-根据业务需求在hive中创建数据表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五-根据业务需求在hive中创建数据表"}},[s._v("#")]),s._v(" 五：根据业务需求在hive中创建数据表")]),s._v(" "),n("ul",[n("li",[s._v("创建hive数据表，将hive数据表链接到hbase中")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('1：vi hive-site.xml添加\n<property>\n\t<name>hbase.zookeeper.quorum</name>\n\t<value>node1,node2,node3</value>\n</property>\n       \n2: 将hbase的一些包创建软连接到hive的lib目录下\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-server-0.98.6-cdh5.3.5.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/hbase-server-0.98.6-cdh5.3.5.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-client-0.98.6-cdh5.3.5.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/hbase-client-0.98.6-cdh5.3.5.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-protocol-0.98.6-cdh5.3.5.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/hbase-protocol-0.98.6-cdh5.3.5.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-it-0.98.6-cdh5.3.5.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/hbase-it-0.98.6-cdh5.3.5.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/htrace-core-2.04.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/htrace-core-2.04.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-hadoop2-compat-0.98.6-cdh5.3.5.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/hbase-hadoop2-compat-0.98.6-cdh5.3.5.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-hadoop-compat-0.98.6-cdh5.3.5.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/hbase-hadoop-compat-0.98.6-cdh5.3.5.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/high-scale-lib-1.1.1.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/high-scale-lib-1.1.1.jar\nln -s /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-common-0.98.6-cdh5.3.5.jar /opt/modules/hive-0.13.1-cdh5.3.5/lib/hbase-common-0.98.6-cdh5.3.5.jar\n\n3: 进入hive命令行客户端\n# hive里面有两种表，一种是管理的内部表，一种是外部表，外部表删除之后，连接的数据不会删除，保证了hbase数据的安全性\nhive (default)### create external table weblogs(id string,datatime string, userid string, searchname string, retorder string, cliorder string, cliurl string) stored by \'org.apache.hadoop.hive.hbase.HBaseStorageHandler\' WITH SERDEPROPERTIES ("hbase.columns.mapping" = ":key, info:datatime, info:userid, info:searchname, info:retorder, info:cliorder, info:cliurl") TBLPROPERTIES("hbase.table.name" = "weblogs");\n\n4: 查看hive中weblogs标的数据，这些数据来自于hbase中\nhive (default)### select * from weblogs limit 2;\nweblogs.id      weblogs.datatime        weblogs.userid  weblogs.searchname      weblogs.retorder        weblogs.cliorder        weblogs.cliurl\n0014362172758659586-00:01:07-1566407416312      00:01:07        0014362172758659586     [明星合成]      67      22      1.yulaikezhan.com/forumdisplay.php?fid=50\n0014362172758659586-00:02:28-1566406463477      00:02:28        0014362172758659586     [明星合成]      82      26      av.avbox.us/\n\n5：查看weblogs表有多少条数据, 一共1686条记录\nhive (default)### select count(userid) from weblogs;\nOK\n_c0\n1686\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);