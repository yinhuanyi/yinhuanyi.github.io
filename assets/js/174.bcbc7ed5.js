(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{2141:function(n,s,t){"use strict";t.r(s);var a=t(9),e=Object(a.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"一-gin框架基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-gin框架基础"}},[n._v("#")]),n._v(" 一：gin框架基础")]),n._v(" "),a("h3",{attrs:{id:"一-url路径参数获取和校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-url路径参数获取和校验"}},[n._v("#")]),n._v(" (一)：url路径参数获取和校验")]),n._v(" "),a("ul",[a("li",[n._v("对URL的路径进行获取和校验，这使用"),a("code",[n._v("c.ShouldBindUri()")]),n._v("函数对请求的URL路径进行获取，并且基于Person结构体定义的Id和Name字段的tag标签 "),a("code",[n._v('uri:"id" binding:"required"')]),n._v(", 获取了http://localhost:8080/robby/123中，name为robby，id为123")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('type Person struct {\n\t// uri目的是解析路由中的url模糊匹配用的\n\tId   string `uri:"id" binding:"required"`\n\tName string `uri:"name" binding:"required"`\n}\n\nfunc main() {\n\trouter := gin.Default()\n\t// 这里是url的参数提前说明，URL路径校验\n\trouter.GET("/:name/:id", func(c *gin.Context) {\n\t\tvar person Person\n\t\tif err := c.ShouldBindUri(&person); err != nil {\n\t\t\tc.JSON(http.StatusNotFound, gin.H{\n\t\t\t\t"code": "404",\n\t\t\t\t"data": nil,\n\t\t\t})\n\t\t}\n\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t"id":   person.Id,\n\t\t\t"name": person.Name,\n\t\t})\n\t})\n\n\trouter.Run(":8080")\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br")])]),a("h3",{attrs:{id:"二-gin返回http协议的protobuf格式数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-gin返回http协议的protobuf格式数据"}},[n._v("#")]),n._v(" (二)：gin返回HTTP协议的protobuf格式数据")]),n._v(" "),a("ul",[a("li",[n._v("项目结构如下")])]),n._v(" "),a("p",[a("img",{attrs:{src:t(588),alt:"Alt text"}})]),n._v(" "),a("ul",[a("li",[n._v("user.proto内容如下，在user.proto文件中，定义了一个Teacher结构")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('syntax = "proto3";\noption go_package = "./;proto";\n\n\nmessage Teacher {\n  string name=1;\n  // 这是一个数组\n  repeated string courses=2;\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br")])]),a("ul",[a("li",[a("p",[n._v("将user.proto生成user.pb.go(命令行生成)")])]),n._v(" "),a("li",[a("p",[n._v("在gin框架的handler中，返回这个数据")])])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('func main() {\n\trouter := gin.Default()\n\t\n\t// protobuf返回\n\trouter.GET("/someProtobuf", func(c *gin.Context) {\n\t\tteacher := &proto.Teacher{\n\t\t\tName:    "Robby",\n\t\t\tCourses: []string{"Golang", "Python", "Java"},\n\t\t}\n\t\tc.ProtoBuf(http.StatusOK, teacher)\n\t\t\n\t})\n\n\trouter.Run(":8080")\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br")])]),a("ul",[a("li",[a("p",[n._v("在Python代码中，请求这个接口，并且解析protobuf的数据")])]),n._v(" "),a("li",[a("p",[n._v("Python项目结构如下")])])]),n._v(" "),a("p",[a("img",{attrs:{src:t(589),alt:"Alt text"}})]),n._v(" "),a("ul",[a("li",[n._v("在test.py文件中请求gin的protobuf接口")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("import requests\nfrom request_grpc_test.proto import user_pb2_grpc, user_pb2\n\n// 获取结构数据\nteacher = user_pb2.Teacher()\nret = requests.get(\"http://localhost:8080/someProtobuf\")\n\n# 解析二进制内容到teacher这个结构中\nteacher.ParseFromString(ret.content)\n\n# name=Robby, courses=['Golang', 'Python', 'Java']\nprint(\"name={}, courses={}\".format(teacher.name, teacher.courses))\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br")])]),a("h2",{attrs:{id:"二-gin框架表单验证-https-github-com-go-playground-validator库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-gin框架表单验证-https-github-com-go-playground-validator库"}},[n._v("#")]),n._v(" 二：gin框架表单验证(https://github.com/go-playground/validator库)")]),n._v(" "),a("h3",{attrs:{id:"一-gin里面默认集成了validator库-https-pkg-go-dev-github-com-go-playground-validator-v10-readme-examples"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-gin里面默认集成了validator库-https-pkg-go-dev-github-com-go-playground-validator-v10-readme-examples"}},[n._v("#")]),n._v(" "),a("code",[n._v("(一)：gin里面默认集成了validator库")]),n._v("(https://pkg.go.dev/github.com/go-playground/validator/v10#readme-examples)")]),n._v(" "),a("ul",[a("li",[n._v("对于web服务的表单验证，需要注意的是，validator库使用的是"),a("code",[n._v('validate:"max=10,min=1"')]),n._v("这种写法，但是集成到gin后，在struct中的写法如下，为"),a("code",[n._v('binding:"required,email"')])])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('type Person struct {\n\tName       string `json:"name" binding:"required"`\n\tEmail      string `json:"email" binding:"required,email"`\n\tPassword   string `json:"password" binding:"required"`\n\tRePassword string `json:"re_password" binding:"required,eqfield=Password"` // 可以跨字段校验相等\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br")])]),a("h3",{attrs:{id:"二-gin中处理表单验证后的错误返回"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-gin中处理表单验证后的错误返回"}},[n._v("#")]),n._v(" (二)：gin中处理表单验证后的错误返回")]),n._v(" "),a("ul",[a("li",[n._v("在gin中，默认的情况下，错误返回是这样的")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('func main() {\n\trouter := gin.Default()\n\trouter.POST("/user", func(c *gin.Context) {\n\t\tvar person Person\n\t\tif err := c.ShouldBindJSON(&person); err != nil {\n\t\t\t// 只要有错误，直接返回err.Error()字符串\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t"err": err.Error(),\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t"name": person.Name,\n\t\t})\n\n\t})\n\trouter.Run(":8080")\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br")])]),a("ul",[a("li",[n._v("使用Python的requests请求(返回的错误提示是英文的)")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("import requests\n\nrsp = requests.post(\"http://localhost:8080/user\", json={})\n// {\"err\":\"Key: 'Person.Name' Error:Field validation for 'Name' failed on the 'required' tag\\nKey: 'Person.Email' Error:Field validation for 'Email' failed on the 'required' tag\\nKey: 'Person.Password' Error:Field validation for 'Password' failed on the 'required' tag\\nKey: 'Person.RePassword' Error:Field validation for 'RePassword' failed on the 'required' tag\"}\n\nprint(rsp.text)\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br")])]),a("ul",[a("li",[n._v("那么，对gin中validator校验的错误提示进行改进，将英文改为中文")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('\npackage main\n\nimport (\n\t"errors"\n\t"fmt"\n\t"net/http"\n\t"reflect"\n\t"strings"\n\n\ten_translations "github.com/go-playground/validator/v10/translations/en"\n\tzh_translations "github.com/go-playground/validator/v10/translations/zh"\n\n\tut "github.com/go-playground/universal-translator"\n\n\t"github.com/go-playground/locales/en"\n\n\t"github.com/go-playground/locales/zh"\n\n\t"github.com/gin-gonic/gin/binding"\n\t"github.com/go-playground/validator/v10"\n\n\t"github.com/gin-gonic/gin"\n)\n\ntype Person struct {\n\tName       string `json:"name" binding:"required"`\n\tEmail      string `json:"email" binding:"required,email"`\n\tPassword   string `json:"password" binding:"required"`\n\tRePassword string `json:"re_password" binding:"required,eqfield=Password"` // 可以跨字段校验相等\n}\n\nvar trans ut.Translator\n\n// 对返回的错误进行处理, 去掉结构名称，只保留字段名称\nfunc removeTopStruct(fileds map[string]string) map[string]string {\n\trsp := make(map[string]string)\n\tfor key, value := range fileds {\n\t\trsp[key[strings.Index(key, ".")+1:]] = value\n\t}\n\treturn rsp\n}\n\n// InitTrans 初始化翻译器, 将gin的翻译器设置为中文翻译\nfunc InitTrans(locale string) (err error) {\n\n\t// 修改gin框架中validator引擎属性，实现定制\n\tv, ok := binding.Validator.Engine().(*validator.Validate)\n\tif !ok {\n\t\treturn errors.New("翻译器断言错误")\n\n\t}\n\n\t// 由于目前返回的是大写的字段名称，因此改为json tag定义的字段名称\n\tv.RegisterTagNameFunc(func(field reflect.StructField) string {\n\t\t// field.Tag.Get("json") == "name" binding:"required"\n\t\tname := strings.Split(field.Tag.Get("json"), " ")[0]\n\t\tif name == "-" {\n\t\t\treturn ""\n\t\t}\n\t\treturn name\n\t})\n\n\tzhT := zh.New() // 中文翻译器\n\tenT := en.New() // 英文翻译器\n\t// 第一个参数是备用的语言环境，后面的参数是应该支持的语言环境\n\tuni := ut.New(enT, zhT, enT)\n\t// 获取特定语言的翻译器\n\ttrans, ok = uni.GetTranslator(locale)\n\tif !ok {\n\t\treturn errors.New(" uni.GetTranslator error")\n\t}\n\n\t// 根据用户的需求，将gin的validator与trans翻译器绑定\n\tswitch locale {\n\tcase "en":\n\t\tif err = en_translations.RegisterDefaultTranslations(v, trans); err != nil {\n\t\t\treturn err\n\t\t}\n\n\tcase "zh":\n\t\tif err = zh_translations.RegisterDefaultTranslations(v, trans); err != nil {\n\t\t\treturn err\n\t\t}\n\tdefault:\n\t\tif err = en_translations.RegisterDefaultTranslations(v, trans); err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\n\treturn\n\n}\n\nfunc main() {\n\t// 初始化gin的翻译器\n\tif err := InitTrans("zh"); err != nil {\n\t\tfmt.Println(err)\n\t}\n\n\trouter := gin.Default()\n\t// 这里是url的参数提前说明，URL路径校验\n\trouter.POST("/user", func(c *gin.Context) {\n\t\tvar person Person\n\t\tif err := c.ShouldBindJSON(&person); err != nil {\n\t\t\t//// 将错误类型转换\n\t\t\terr, ok := err.(validator.ValidationErrors)\n\t\t\tif !ok {\n\t\t\t\tc.JSON(http.StatusInternalServerError, gin.H{\n\t\t\t\t\t"err": "翻译器转换错误",\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\t\t\t// 返回翻译的错误\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t// removeTopStruct函数是处理返回map\n\t\t\t\t"error": removeTopStruct(err.Translate(trans)),\n\t\t\t})\n\t\t\treturn\n\t\t}\n\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t"name": person.Name,\n\t\t})\n\t})\n\n\trouter.Run(":8080")\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br"),a("span",{staticClass:"line-number"},[n._v("97")]),a("br"),a("span",{staticClass:"line-number"},[n._v("98")]),a("br"),a("span",{staticClass:"line-number"},[n._v("99")]),a("br"),a("span",{staticClass:"line-number"},[n._v("100")]),a("br"),a("span",{staticClass:"line-number"},[n._v("101")]),a("br"),a("span",{staticClass:"line-number"},[n._v("102")]),a("br"),a("span",{staticClass:"line-number"},[n._v("103")]),a("br"),a("span",{staticClass:"line-number"},[n._v("104")]),a("br"),a("span",{staticClass:"line-number"},[n._v("105")]),a("br"),a("span",{staticClass:"line-number"},[n._v("106")]),a("br"),a("span",{staticClass:"line-number"},[n._v("107")]),a("br"),a("span",{staticClass:"line-number"},[n._v("108")]),a("br"),a("span",{staticClass:"line-number"},[n._v("109")]),a("br"),a("span",{staticClass:"line-number"},[n._v("110")]),a("br"),a("span",{staticClass:"line-number"},[n._v("111")]),a("br"),a("span",{staticClass:"line-number"},[n._v("112")]),a("br"),a("span",{staticClass:"line-number"},[n._v("113")]),a("br"),a("span",{staticClass:"line-number"},[n._v("114")]),a("br"),a("span",{staticClass:"line-number"},[n._v("115")]),a("br"),a("span",{staticClass:"line-number"},[n._v("116")]),a("br"),a("span",{staticClass:"line-number"},[n._v("117")]),a("br"),a("span",{staticClass:"line-number"},[n._v("118")]),a("br"),a("span",{staticClass:"line-number"},[n._v("119")]),a("br"),a("span",{staticClass:"line-number"},[n._v("120")]),a("br"),a("span",{staticClass:"line-number"},[n._v("121")]),a("br"),a("span",{staticClass:"line-number"},[n._v("122")]),a("br"),a("span",{staticClass:"line-number"},[n._v("123")]),a("br"),a("span",{staticClass:"line-number"},[n._v("124")]),a("br"),a("span",{staticClass:"line-number"},[n._v("125")]),a("br"),a("span",{staticClass:"line-number"},[n._v("126")]),a("br"),a("span",{staticClass:"line-number"},[n._v("127")]),a("br"),a("span",{staticClass:"line-number"},[n._v("128")]),a("br")])]),a("h2",{attrs:{id:"三-自定义中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-自定义中间件"}},[n._v("#")]),n._v(" 三：自定义中间件")]),n._v(" "),a("h3",{attrs:{id:"一-中间件原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-中间件原理"}},[n._v("#")]),n._v(" (一)：中间件原理")]),n._v(" "),a("ul",[a("li",[n._v("将handler作为中间件")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("r.Use(logger.GinLogger(), logger.GinRecovery(true))\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br")])]),a("ul",[a("li",[n._v("Use方法会将handler添加到group.Handlers中")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// Use adds middleware to the group, see example code in GitHub.\nfunc (group *RouterGroup) Use(middleware ...HandlerFunc) IRoutes {\n\tgroup.Handlers = append(group.Handlers, middleware...)\n\treturn group.returnObj()\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("ul",[a("li",[n._v("当调用了POST方法的时候")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('v1.POST("/signup", controllers.SignUpHandler)\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br")])]),a("ul",[a("li",[n._v("将这个POST方法对应的handler加到队列的后面")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('// 先计算当前handlers队列的长度，和传递进来的handlers的长度，将两个合并，返回\nfunc (group *RouterGroup) combineHandlers(handlers HandlersChain) HandlersChain {\n\tfinalSize := len(group.Handlers) + len(handlers)\n\tif finalSize >= int(abortIndex) {\n\t\tpanic("too many handlers")\n\t}\n\tmergedHandlers := make(HandlersChain, finalSize)\n\tcopy(mergedHandlers, group.Handlers)\n\tcopy(mergedHandlers[len(group.Handlers):], handlers)\n\treturn mergedHandlers\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br")])]),a("ul",[a("li",[n._v("当某个中间件中调用了"),a("code",[n._v("c.Next()方法")]),n._v(",会将后面的一个handler取出来，调用一下")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// Next should be used only inside middleware.\n// It executes the pending handlers in the chain inside the calling handler.\n// See example in GitHub.\nfunc (c *Context) Next() {\n\tc.index++\n\tfor c.index < int8(len(c.handlers)) {\n\t\tc.handlers[c.index](c)\n\t\tc.index++\n\t}\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br")])]),a("ul",[a("li",[n._v("当中间件中调用了"),a("code",[n._v("c.Abort()方法")]),n._v("，会将c.index设置为最大，此时gin去调用handlers队列中的handler时，发现index最大，因此终止当前请求")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// Abort prevents pending handlers from being called. Note that this will not stop the current handler.\n// Let's say you have an authorization middleware that validates that the current request is authorized.\n// If the authorization fails (ex: the password does not match), call Abort to ensure the remaining handlers\n// for this request are not called.\nfunc (c *Context) Abort() {\n\tc.index = abortIndex\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br")])]),a("ul",[a("li",[n._v("在中间件中，"),a("code",[n._v("return")]),n._v("不会终止当前请求，只会终止当前的handler，因为handlers中还有其他的handler，gin会依次从中取出并且调用")])])])}),[],!1,null,null,null);s.default=e.exports},588:function(n,s,t){n.exports=t.p+"assets/img/2021-06-0910.31.10.7ae1a71c.png"},589:function(n,s,t){n.exports=t.p+"assets/img/2021-06-0910.36.12.5c34e134.png"}}]);