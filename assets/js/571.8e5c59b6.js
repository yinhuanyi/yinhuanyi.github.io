(window.webpackJsonp=window.webpackJsonp||[]).push([[571],{2608:function(s,a,n){"use strict";n.r(a);var e=n(9),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-elastalert入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-elastalert入门"}},[s._v("#")]),s._v(" 一："),n("code",[s._v("ElastAlert入门")])]),s._v(" "),n("h3",{attrs:{id:"一-elastalert介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-elastalert介绍"}},[s._v("#")]),s._v(" (一)ElastAlert介绍")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("ElastAlert从0.2版本开始，必须使用Python3.6")])]),s._v(" "),n("li",[n("p",[s._v("轻松灵活的发出Elasticsearch告警")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ElastAlert是一个简单的框架，用于从Elasticsearch中的数据中发出异常，峰值或其他感兴趣模式的警报。\nElastAlert适用于所有版本的Elasticsearch。\n在Yelp，我们使用Elasticsearch，Logstash和Kibana来管理不断增长的数据和日志。 Kibana非常适合可视化和查询数据，但是我们很快意识到，它需要一个辅助工具来警告数据中的不一致情况。为此，创建了ElastAlert。\n如果您有近乎实时地将数据写入Elasticsearch并希望在该数据与某些模式匹配时收到警报，则ElastAlert是为您提供的工具。如果您可以在Kibana中看到它，则ElastAlert可以对其发出警报。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("摘要(重写，用自己的使用心得叙述)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("我们将ElastAlert设计为可靠，高度模块化，并且易于设置和配置。\n它通过将Elasticsearch与两种类型的组件（规则类型和警报）结合起来工作。定期查询Elasticsearch，并将数据传递到规则类型，该规则类型确定何时找到匹配项。发生匹配时，将为该警报提供一个或多个警报，这些警报将根据匹配采取行动。\n这是由一组规则配置的，每个规则定义一个查询，一个规则类型和一组警报。\nElastAlert包含几种具有通用监视范例的规则类型：\n\n1：频率匹配：在某段时间内，关键字出现的频率\n2：频率的峰值匹配：频率增加或减少匹配\n3：至少多少次匹配：在某一段时间内，少于X个事件时匹配\n4：字段匹配：当某个字段与黑名单/白名单匹配时匹配\n5：事件匹配：匹配与给定筛选器匹配的任何事件\n6：比较匹配：当一个字段在一段时间内有两个不同的值时进行匹配\n7：新内容匹配：当字段中出现从未见过的术语时匹配\n8：阈值匹配：当字段的唯一值数高于或低于阈值时匹配\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("主要告警类型")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("any：只要有匹配就报警\n\nblacklist：compare_key字段的内容匹配上blacklist数组里任意内容；\n\nwhitelist：compare_key字段的内容一个都没能匹配上whitelist数组里内容；\n\nchange：在相同query_key条件下，compare_key字段的内容，在 timeframe范围内 发送变化；\n\nfrequency：在相同query_key条件下，timeframe 范围内有num_events个被过滤出 来的异常；\n\nspike：在相同query_key条件下，前后两个timeframe范围内数据量相差比例超过spike_height。其中可以通过spike_type设置具体涨跌方向是- up、down、both。还可以通过threshold_ref设置要求上一个周期数据量的下限，threshold_cur设置要求当前周期数据量的下限，如果数据量不到下限，也不触发；\n\nflatline：timeframe范围内，数据量小于threshold阈值；\n\nnew_term：fields字段新出现之前terms_window_size(默认30天)范围内最多的terms_size(默认50)个结果以外的数据；\n\ncardinality：在相同 query_key 条件下，timeframe范围内cardinality_field的值超过 max_cardinality或者低于min_cardinality\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("ul",[n("li",[s._v("支持的内建消息推送接口")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Email (有用)\nJIRA\nOpsGenie\nCommands (命令行)\nHipChat\nMS Teams\nSlack\nTelegram \nGoogleChat\nAWS SNS\nVictorOps\nPagerDuty\nPagerTree\nExotel\nTwilio\nGitter\nLine Notify\nZabbix （有用）\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("相关组件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：告警服务ElastAlert，版本V0.2.1\n2：展示插件：elastalert-kibana-plugin， kibana安装这个组件后，用户可以通过kibana管理告警规则(包括 增删查改)\n3：API服务ElastAlert Server，暴露restful api提供管理告警规则的能力，与elastalert-kibana-plugin配合使用。当ElastAlert Server服务启动时启动ElastAlert\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"二-elastalert安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-elastalert安装"}},[s._v("#")]),s._v(" (二)ElastAlert安装")]),s._v(" "),n("ul",[n("li",[s._v("克隆代码")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("git clone https://github.com/Yelp/elastalert.git\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("进入项目目录，给目录绑定Python3.6.3虚拟环境，安装elastalert(补充依赖不匹配的解决方法， jira卸载老版本，安装2.0.0版本。elasticsearch使用7.8版本可以兼容7.7版本)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd elastalert\npyenv local elastalert.3.6.3\n# 这里会报错：elastalert 0.2.4 has requirement elasticsearch==7.0.0, but you'll have elasticsearch 7.8.0 which is incompatible.\n# 这里会报错：elastalert 0.2.4 has requirement jira>=2.0.0, but you'll have jira 1.0.14 which is incompatible\npip install -r requirements.txt\npip install -r requirements-dev.txt\npython setup.py install\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("安装成功后可以看到有四个脚本命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ll /root/.pyenv/shims/elastalert*\n-rwxr-xr-x 1 root root 390 Jul 26 15:38 /root/.pyenv/shims/elastalert\n-rwxr-xr-x 1 root root 390 Jul 26 15:38 /root/.pyenv/shims/elastalert-create-index\n-rwxr-xr-x 1 root root 390 Jul 26 15:38 /root/.pyenv/shims/elastalert-rule-from-kibana\n-rwxr-xr-x 1 root root 390 Jul 26 15:38 /root/.pyenv/shims/elastalert-test-rule\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("四个脚本介绍")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1: elastalert \n\n2: elastalert-create-index 会创建一个索引，ElastAlert会把执行记录存放到这个索引中，默认情况下，索引名叫elastalert_statuselastalert-rule-from-kibana从Kibana3已保存的仪表盘中读取Filtering设置，帮助生成config.yaml里的配置。不过注意，它只会读取filtering，不包括queries。\n\n3：elastalert-rule-from-kibana 测试kibana的告警规则\n\n4：elastalert-test-rule 测试自定义配置中的rule设置\n测试示例：elastalert-test-rule example_rules/shenmingxing_miner_WarnPostSkipped.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"三-elastalert配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-elastalert配置"}},[s._v("#")]),s._v(" (三)ElastAlert配置")]),s._v(" "),n("ul",[n("li",[s._v("在主配置文件的模板config.yaml.example基础上修改全局配置")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("首先将主配置文件的模板config.yaml.example，拷贝一份为：config.yaml\n\n1：rules_folder：ElastAlert将加载规则配置文件的地方，它将尝试加载文件夹中的每个.yaml文件。\n2：run_every：ElastAlert查询Elasticsearch的频率。\n3：buffer_time：是查询窗口的大小，从每个查询运行的时间向后延伸。对于其中use_count_query或use_terms_query设置为true的规则，此值将被忽略。\n4：es_host：是Elasticsearch集群的地址，ElastAlert将存储有关其状态、查询运行、警报和错误的数据。每个规则也可以设置不同的elasticsearch主机进行查询。\n5：es_port：Elasticsearch对应的端口。\n6：use_ssl： （可选的）是否使用TLS;连接到es_host；设置为True或False。\n7：verify_certs： （可选的）是否验证TLS证书; 设置为True或False，默认是True。\n8：client_cert： （可选的）PEM证书的路径。\n9：client_key： （可选的） 作为客户端密钥使用的私钥文件的路径。\n10：ca_certs： （可选的） 用于验证SSL连接的CA证书的路径。\n11：es_username： （可选的） 用于连接Elasticsearch的basic-auth用户名。\n12：es_password： （可选的） 用于连接Elasticsearch的密码。\n13：es_url_prefix： （可选的） Elasticsearch端点的URL前缀。\n14：es_send_get_body_as： （可选的） 查询Elasticsearch方法- GET，POST或source，默认是GET。\n15：writeback_index：是ElastAlert将存储数据的索引名称。\n16：alert_time_limit： 是失败警报的重试窗口。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("创建Elasticsearch索引")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("elastalert-create-index这个命令会在elasticsearch创建索引，便于ElastAlert将有关其查询及其警报的信息和元数据保存回Elasticsearch。这不是必须的步骤，但是强烈建议创建。因为对于审计，测试很有用，并且重启elastalert不影响计数和发送alert。默认情况下，创建的索引叫 elastalert_status。\n\n\nroot@yw4-2:/app/elastalert# elastalert-create-index\nElastic Version: 7.7.0\nReading Elastic 6 index mappings:\nReading index mapping 'es_mappings/6/silence.json'\nReading index mapping 'es_mappings/6/elastalert_status.json'\nReading index mapping 'es_mappings/6/elastalert.json'\nReading index mapping 'es_mappings/6/past_elastalert.json'\nReading index mapping 'es_mappings/6/elastalert_error.json'\nIndex elastalert_status already exists. Skipping index creation.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("ul",[n("li",[s._v("ElastAlert查询")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ElastAlert 根据elastalert_status去确定首次启动的时候在什么时间范围内去查询，以避免重复查询。对于每个规则，它将从最近的结束时间开始查询。包括：\nrule_name：相应规则的名称。\nstarttime：查询的开始时间戳。\nendtime：查询结束时间戳。\nhits：查询结果的数量。\nmatches：处理命中后规则返回的匹配数。请注意，这并不一定意味着警报被触发。\ntime_taken：此查询运行所需的秒数。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("在example_rules目录下创建一条告警规则，名称为 my_test_frequency.yaml (告警类型为frequency，使用邮件告警接口)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('root@yw4-2:/app/elastalert# cat example_rules/my_test_frequency.yaml\n# 规则名称\nname: frequency keyword\n\n# 规则类型\ntype: frequency\n\n# 匹配的索引\nindex: lotus-*\ntimestamp_field: "@timestamp"\n\n# 查询到10条\nnum_events: 10\n\n# 在5分钟内有10条这样的数据，则告警\ntimeframe:\n  minutes: 5\n\n# dsl查询语句\nfilter:\n- query:\n    query_string:\n      query: "message: WARN"\n\nsmtp_auth_file: /app/elastalert/example_rules/my_test_frequency.yaml\nalert_text: "you have a error message" #主题的名称\nsmtp_host: "smtp.mxhichina.com"\nsmtp_port: 587\nemail_reply_to: "filmanager@ipfsmain.cn"\nfrom_addr: "filmanager@ipfsmain.cn"\nuser: "filmanager@ipfsmain.cn"\npassword: "Xingjidalu123"\n\n# 告警方式\nalert:\n- "email"\n\n# 告警邮件发送给谁\nemail:\n- "yhy@ipfsmain.cn"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("ul",[n("li",[s._v("查询 "),n("code",[s._v("Upload file failed!")]),s._v("关键字，有一条就告警(告警类型为any, 使用邮件告警接口)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('WARNING:root:Querying from 2020-07-27 16:35 CST to 2020-07-27 16:36 CST took longer than 0:01:00!\n# 规则名称\nname: any keyword\n\n# 规则类型\ntype: any\n\n# 匹配的索引\nindex: lotus-*\ntimestamp_field: "@timestamp"\n\n\n# dsl查询语句\nfilter:\n- query:\n    match:\n       message:\n          query: "Upload file failed"\n          operator: "and"\n\nsmtp_auth_file: /app/elastalert/example_rules/my_test_frequency.yaml\nalert_text: "you have a error message" #主题的名称\nsmtp_host: "smtp.mxhichina.com"\nsmtp_port: 587\nemail_reply_to: "filmanager@ipfsmain.cn"\nfrom_addr: "filmanager@ipfsmain.cn"\nuser: "filmanager@ipfsmain.cn"\npassword: "Xingjidalu123"\n# 告警方式\nalert:\n- "email"\n\nemail:\n- "yhy@ipfsmain.cn"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("ul",[n("li",[s._v("查询 "),n("code",[s._v("Upload file failed!")]),s._v("关键字，有一条就告警(告警类型为any, 使用command告警接口)"),n("code",[s._v("使用较多")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 规则名称\nname: Upload Fail\n\n# 规则类型\ntype: any\n\n# 匹配的索引\nindex: storage-*\ntimestamp_field: "@timestamp"\n\n\n# 查询字符串\nfilter:\n- query:\n    query_string:\n      query: \'"*Upload file failed*"\'\n\n# 告警方式\nalert:\n- "command"\n\n# 脚本第一个参数是warning、第二个参数是用户名、第三个参数是内容\ncommand: [\n  "/app/elastalert/alert.sh",\n  "warning",\n  "shenmingxing",\n  "Upload Fail: Upload file failed"\n]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("ul",[n("li",[s._v("alert.sh脚本内容为")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#!/bin/bash\n\nlevel=$1\nusername=$2\ncontent=$3\n\nif [ $level == "warning" ]; then\n\t\n\t# 发送get请求\n    curl -G --data-urlencode "username=$username" --data-urlencode "content=$content"  http://10.102.0.14:8000/monitor/log_warning/\n\nelif [ $level == "disaster" ]; then\n\n    curl -G --data-urlencode "username=$username" --data-urlencode "content=$content"  http://10.102.0.14:8000/monitor/log_disaster/\n\nfi\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"四-启动elastalert"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-启动elastalert"}},[s._v("#")]),s._v(" (四)启动ElastAlert")]),s._v(" "),n("ul",[n("li",[s._v("测试一个rule规则是否正确")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("elastalert-test-rule  example_rules/renchao_window_post2.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("单个rule规则启动")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /app/elastalert\n# 直接启动即可\npython -m elastalert.elastalert --verbose --rule renchao_window_post2.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("写一个脚本，全部启动，且记录日志(在/app/elastalert目录下，创建一个logs目录)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#!/bin/bash\n# 杀掉进程\nps -ef | grep [y]aml | awk '{print $2}' | xargs kill -9\n\nsleep 2\n\ncd /app/elastalert\n\n# 启动所有规则\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_busy_win_post.yaml &### /app/elastalert/logs/liulinxin_busy_win_post.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_no_window_post.yaml &### /app/elastalert/logs/liulinxin_no_window_post.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_sector_id.yaml &### /app/elastalert/logs/liulinxin_sector_id.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_window_post.yaml &### /app/elastalert/logs/liulinxin_window_post.log &\nnohup python -m elastalert.elastalert --verbose --rule renchao_window_post2.yaml &### /app/elastalert/logs/renchao_window_post2.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_no_space.yaml &### /app/elastalert/logs/shenmingxing_no_space.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_upload_success.yaml &### /app/elastalert/logs/shenmingxing_upload_success.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_upload.yaml &### /app/elastalert/logs/shenmingxing_upload.log &\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h2",{attrs:{id:"二-elastalert-get或post接口开发-有时间就开发-在gitlab上开源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-elastalert-get或post接口开发-有时间就开发-在gitlab上开源"}},[s._v("#")]),s._v(" 二："),n("code",[s._v("ElastAlert GET或POST接口开发(有时间就开发，在gitlab上开源)")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("开发方法: https://elastalert.readthedocs.io/en/latest/recipes/adding_alerts.html")])]),s._v(" "),n("li",[n("p",[s._v("仿造模型：https://github.com/xuyaoqiang/elastalert-dingtalk-plugin")])]),s._v(" "),n("li",[n("p",[s._v("模仿开发仓库：https://github.com/yinhuanyi/elastalert-post-plugin")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"三-elastalert-星际大陆落地使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-elastalert-星际大陆落地使用"}},[s._v("#")]),s._v(" 三："),n("code",[s._v("ElastAlert 星际大陆落地使用")])]),s._v(" "),n("h3",{attrs:{id:"一-需求场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-需求场景"}},[s._v("#")]),s._v(" (一) 需求场景")]),s._v(" "),n("ul",[n("li",[s._v("对日志的关键字进行匹配，匹配到了就告警")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("关键字匹配一般是一个短语，因此在dsl语句中使用match_phrase进行匹配\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"二-配置过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-配置过程"}},[s._v("#")]),s._v(" (二) 配置过程")]),s._v(" "),n("ul",[n("li",[s._v("编辑"),n("code",[s._v("config.yaml")]),s._v("主配置文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 指定匹配规则存放的目录\nrules_folder: example_rules\n# 指定查询ES的频率\nrun_every:\n  minutes: 1\n# 指定查询窗口的大小\nbuffer_time:\n  minutes: 1\n# 指定全局的ES节点IP地址，这个配置在example_rules目录的每个规则中可以被修改\nes_host: 10.102.0.4\n# 指定ES的端口\nes_port: 9200\n# 指定告警索引\nwriteback_index: elastalert_status\nwriteback_alias: elastalert_alerts\n# 指定告警失败的重试窗口\nalert_time_limit:\n  hours: 2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("编写一个告警推送脚本")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#! /usr/bin/env python\n# coding: utf-8\n\nimport sys\nimport requests\nfrom datetime import datetime\n\n# 获取告警级别\nlevel = sys.argv[1]\n# 获取告警@的用户\nusername = sys.argv[2]\n# 获取告警关键字\ncontent = sys.argv[3]\n# 获取日志中主机的IP\nip = sys.argv[4]\n# 获取日志中主机的主机名\nhostname = sys.argv[5]\n# 获取主机角色\nrole = sys.argv[6]\n# 获取日志索引\nindex = sys.argv[7]\n# 获取日志路径\nlog_path = sys.argv[8]\n# 获取日志信息\nmessage = sys.argv[9]\n\n# 将告警内容推送到Fil-Manager\nif level == 'warning':\n    ret = requests.get('http://10.102.0.14:8000/monitor/log_warning/',params={'username': username, 'content': content, 'ip': ip, 'hostname': hostname, 'role': role, 'index': index, 'log_path': log_path, 'message': message})\n    with open('/app/elastalert/logs/alert_warning.log', 'a') as f:\n        print('{} {} {} {} {} {} {} {} {}'.format(datetime.now(), ret.text, content, ip, hostname, role, index, log_path, message), file=f)\nelif level == 'disaster':\n    ret = requests.get('http://10.102.0.14:8000/monitor/log_disaster/',params={'username': username, 'content': content, 'ip': ip,'hostname': hostname, 'role': role, 'index': index, 'log_path': log_path, 'message': message})\n    with open('/app/elastalert/logs/alert_disaster.log', 'a') as f:\n        print('{} {} {} {} {} {} {} {} {}'.format(datetime.now(), ret.text, content, ip, hostname, role, index, log_path, message), file=f)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("ul",[n("li",[s._v("编写一个启动elastalert规则的脚本")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#!/bin/bash\nps -ef | grep [y]aml | awk '{print $2}' | xargs kill -9\n\nsleep 2\n\ncd /app/elastalert\n\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_busy_win_post.yaml &### /app/elastalert/logs/liulinxin_busy_win_post.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_no_window_post.yaml &### /app/elastalert/logs/liulinxin_no_window_post.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_window_post.yaml &### /app/elastalert/logs/liulinxin_window_post.log &\nnohup python -m elastalert.elastalert --verbose --rule renchao_window_post2.yaml &### /app/elastalert/logs/renchao_window_post2.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_space_device.yaml &### /app/elastalert/logs/liulinxin_space_device.log &\nnohup python -m elastalert.elastalert --verbose --rule chenjinming_storage_disk.yaml &### /app/elastalert/logs/chenjinming_storage_disk.log &\nnohup python -m elastalert.elastalert --verbose --rule chenjinming_seal_disk.yaml &### /app/elastalert/logs/chenjinming_seal_disk.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_remote_version.yaml &### /app/elastalert/logs/liulinxin_remote_version.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_submitPost_failed.yaml &### /app/elastalert/logs/liulinxin_submitPost_failed.log &\nnohup python -m elastalert.elastalert --verbose --rule caoyalun_not_cover.yaml &### /app/elastalert/logs/caoyalun_not_cover.log &\nnohup python -m elastalert.elastalert --verbose --rule caoyalun_not_repay.yaml &### /app/elastalert/logs/caoyalun_not_repay.log &\nnohup python -m elastalert.elastalert --verbose --rule caoyalun_aggregate_initial.yaml &### /app/elastalert/logs/caoyalun_aggregate_initial.log &\nnohup python -m elastalert.elastalert --verbose --rule caoyalun_pre-commit_deposit.yaml &### /app/elastalert/logs/caoyalun_pre-commit_deposit.log &\nnohup python -m elastalert.elastalert --verbose --rule liulinxin_replay_took.yaml &### /app/elastalert/logs/liulinxin_replay_took.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_seal_enter_maintenance.yaml &### /app/elastalert/logs/shenmingxing_seal_enter_maintenance.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_seal_invalid_memory_address.yaml &### /app/elastalert/logs/shenmingxing_seal_invalid_memory_address.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_seal_manifest_corrupted.yaml &### /app/elastalert/logs/shenmingxing_seal_manifest_corrupted.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_seal_no_space_left_on_device.yaml &### /app/elastalert/logs/shenmingxing_seal_no_space_left_on_device.log &\nnohup python -m elastalert.elastalert --verbose --rule shenmingxing_storage_abnormal_Down.yaml &### /app/elastalert/logs/shenmingxing_storage_abnormal_Down.log &\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("ul",[n("li",[s._v("在example_rules目录下，编写告警规则")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 规则名称, 必须唯一\nname: No Space\n# 指定ES地址\nes_host: yw3-2\nes_port: 9200\n# 规则类型\ntype: any\n# 指定只要匹配就告警\nrealert:\n  minutes: 0\n# 匹配的索引\nindex: storage-*\n# 指定时间戳字段\ntimestamp_field: "@timestamp"\n# 指定ES的查询规则\nfilter:\n- query:\n    match_phrase:\n        "message": {"query": "no space left on device"}\n\n# 告警方式\nalert:\n- "command"\n\n# 指定执行的命令\ncommand: [\n  "/app/elastalert/alert.py",\n  "warning",\n  "shenmingxing",\n  "no space left on device",\n  "%(fields.ip)s",\n  "%(host.name)s",\n  "%(type)s",\n  "%(_index)s",\n  "%(log.file.path)s",\n  "%(message)s"\n]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("ul",[n("li")])])}),[],!1,null,null,null);a.default=t.exports}}]);