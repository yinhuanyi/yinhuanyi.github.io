(window.webpackJsonp=window.webpackJsonp||[]).push([[614],{2680:function(s,n,a){"use strict";a.r(n);var e=a(9),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-普通搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-普通搭建"}},[s._v("#")]),s._v(" 一：普通搭建")]),s._v(" "),a("h3",{attrs:{id:"一-搭建es集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-搭建es集群"}},[s._v("#")]),s._v(" （一）：搭建ES集群")]),s._v(" "),a("ul",[a("li",[s._v("集群安装")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('1: yum安装\n\n2：修改elasticsearch.yml\ncluster.name: yhy-es\nnode.name: yhy-node-2\npath.data: /var/lib/elasticsearch\npath.logs: /var/log/elasticsearch\nbootstrap.memory_lock: false\nbootstrap.system_call_filter: false\nnode.master: true\nnode.data: true\nnetwork.host: 172.16.18.202\ndiscovery.seed_hosts: ["172.16.18.202", "172.16.18.203", "172.16.18.204"]\ncluster.initial_master_nodes: ["172.16.18.202"]\nhttp.cors.enabled: true\nhttp.cors.allow-origin: "*"\nhttp.port: 9200\n\n3: 线上\n# 集群名称\ncluster.name: cluster-name\n# 节点名称\nnode.name: node1\n# 是否有资格成为主节点\nnode.master: true\n# 是否数据节点\nnode.data: true\n# 数据路径\npath.data: \n# 日志路径\npath.logs: \n# 监听地址\nnetwork.host: 192.168.23.41\n# 监听端口\nhttp.port: 9200\n# 集群地址\ndiscovery.zen.ping.unicast.hosts: ["192.168.23.41", "192.168.23.42", "192.168.23.43", "192.168.23.44", "192.168.23.45"]\n# 集群最少主节点数，通常配置为“主节点数/2+1”，防止脑裂。\ndiscovery.zen.minimum_master_nodes: 3\n# 最少恢复节点数\ngateway.recover_after_nodes: 4\n# 开启内存锁，防止内存数据被转移到交换分区，影响性能。\nbootstrap.memory_lock: true\n# 批量操作队列长度\nthread_pool.bulk.queue_size: 1600\n\n3: 修改jvm.options\n-Xms512m\n-Xmx512m\n\n4: 如果启动集群，出现脑裂，每个ES节点都显示自己是主节点，那么需要删除path.data数据目录下的数据，再重启集群\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br")])]),a("ul",[a("li",[s._v("head插件安装")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1: 下载\ngit clone https://github.com/mobz/elasticsearch-head.git\n\n2：安装nodejs，必须最新版本\ncurl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -\nsudo apt-get install -y nodejs\n\n3：安装grunt\ncd elasticsearch-head/\nnpm install -g grunt-cli\nnpm install\n\n4: 编辑Gruntfile.js, 添加hostname，指定绑定的IP地址\nconnect: {\n        server: {\n                options: {\n                        hostname: '0.0.0.0',\n                        port: 9100,\n                        base: '.',\n                        keepalive: true\n                }\n        }\n}\n\n5: 编辑_site/app.js, 选择ES集群主节点地址\nthis.base_uri = this.config.base_uri || this.prefs.get(\"app-base_uri\") || \"http://172.16.18.202:9200\";\n\n6: 启动\nnohup npm run start &\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h3",{attrs:{id:"二-logstash日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-logstash日志"}},[s._v("#")]),s._v(" （二）：Logstash日志")]),s._v(" "),a("ul",[a("li",[s._v("如果只是做日志检索，那么logstash的配置文件可以这样")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('input{\n    file {\n        path =### "/var/log/messages*"\n        type =### "syslog"\n        start_position =### "beginning" #从头读\n        # sincedb_path =### "/dev/null"  # 不写入到path路径中\n        # 多行编解码器将折叠多行消息并将它们合并为一个事件, 适用于Java日志的traceback。\n        #codec =### multiline {\n        #    pattern =### "^\\S"  ##匹配每行的开头\n        #    negate =### true    ## 是否开启正则匹配\n        #    what =### "previous" ##未匹配的内容向前合并,\n        #}\n    }\n}\n\n\n# 指定数据到哪里去\noutput{\n     if [type] == "syslog" {\n             elasticsearch{\n                hosts =### ["172.16.18.202:9200"]\n                index =### "syslog"\n        }\n     }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("ul",[a("li",[s._v("生产环境这样")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('input {\n  file {\n    path =### ["/data/logs/match-exchangebtc/match-exchangebtc-info.log", "/data/logs/match-exchangebtc/match-exchangebtc-error.log"]\n    type =### "match-exchangebtc"\n    codec =### multiline {\n      pattern =### "^2020"\n      negate =### true\n      what =### "previous"\n    }\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts =### ["ops-elk-01:9200", "ops-elk-02:9200", "ops-elk-03:9200", "ops-elk-04:9200", "ops-elk-05:9200"]\n    index =### "%{[type]}-%{+YYYY.MM.dd}"\n  }\n  s3 {\n    access_key_id =### "xxxxxx"\n    secret_access_key =### "xxxxxx"\n    region =### "ap-northeast-1-xxxx"\n    bucket =### "contract-log-backup-xxxx"\n    prefix =### "%{+YYYY}/%{+MM}/%{+dd}/%{[type]}"  # 将日志上传到“桶/年/月/日/应用”目录中\n    time_file =### 60  # 每隔60分钟强制滚动\n    size_file =### 52428800  # 每当压缩的日志等于50MB时滚动\n    encoding =### "gzip"  # 将日志压缩后再上传到S3\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("ul",[a("li",[s._v("如果logstash有多个pipline，在/etc/systemd/system/logstash.service文件中修改")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[Unit]\nDescription=logstash\n\n[Service]\nType=simple\nUser=root\nGroup=root\n# Load env vars from /etc/default/ and /etc/sysconfig/ if they exist.\n# Prefixing the path with \'-\' makes it try to load, but if the file doesn\'t\n# exist, it continues onward.\nEnvironmentFile=-/etc/default/logstash\nEnvironmentFile=-/etc/sysconfig/logstash\n# 这里需要指定-f参数，说明读取/etc/logstash/conf.d项目下的所有的yml文件\nExecStart=/usr/share/logstash/bin/logstash "--path.settings" "/etc/logstash" "-f" "/etc/logstash/conf.d"\nRestart=always\nWorkingDirectory=/\nNice=19\nLimitNOFILE=16384\n\n[Install]\nWantedBy=multi-user.target\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"三-kibana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-kibana"}},[s._v("#")]),s._v(" （三）：Kibana")]),s._v(" "),a("ul",[a("li",[s._v("修改")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('server.port: 5601\nserver.host: "172.16.18.205"\nelasticsearch.hosts: ["http://172.16.18.202:9200"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"四-elastalert可以对日志的字段基于正则匹配告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-elastalert可以对日志的字段基于正则匹配告警"}},[s._v("#")]),s._v(" （四）：elastalert可以对日志的字段基于正则匹配告警")]),s._v(" "),a("ul",[a("li",[s._v("这个工具可以满足匹配到Error信息，然后发送报警信息")])]),s._v(" "),a("h3",{attrs:{id:"五-二进制安装的elasticsearch的unit-file文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-二进制安装的elasticsearch的unit-file文件"}},[s._v("#")]),s._v(" （五）：二进制安装的Elasticsearch的Unit File文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("########################################\n# Created by: Robby                    #\n# Date: 2019-10-23                     #\n# Function: start/stop elasticsearch   #\n########################################\n\n[Unit]\nDescription=elasticsearch\nAfter=network.target\n\n[Service]\nLimitNOFILE=655360\nLimitNPROC=131072\nLimitMEMLOCK=infinity\nUser=ubuntu\nExecStart=/data/contract/elasticsearch/bin/elasticsearch -p /data/contract/elasticsearch/config/pid\nExecStop=kill -9 `cat /data/contract/elasticsearch/config/pid`\n\n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h2",{attrs:{id:"二-加入kafka消息队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-加入kafka消息队列"}},[s._v("#")]),s._v(" 二：加入Kafka消息队列")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("配置好kafka集群，通过kafka集群处理Logstash_client -### kafka -> Logstash_server的消息")])]),s._v(" "),a("li",[a("p",[s._v("Logstash_client 端配置")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('input {\n  file {\n    path =### "/data/contract/trade-risk/log/*.log"\n    type =### "trade-risk"\n    codec =### multiline {\n      pattern =### "^2"\n      negate =### true\n      what =### "previous"\n    }\n  }\n  file {\n    path =### "/data/contract/trade-settlement/log/*.log"\n    type =### "trade-settlement"\n    codec =### multiline {\n      pattern =### "^2"\n      negate =### true\n      what =### "previous"\n    }\n  }\n}\n\noutput {\n  kafka {\n    bootstrap_servers =### "ops-elk-01.tyo-prd1.huobiinternal:9092,ops-elk-02.tyo-prd1.huobiinternal:9092,ops-elk-03.tyo-prd1.huobiinternal:9092,ops-elk-04.tyo-prd1.huobiinternal:9092,ops-elk-05.tyo-prd1.huobiinternal:9092,ops-elk-06.tyo-prd1.huobiinternal:9092,ops-elk-07.tyo-prd1.huobiinternal:9092,ops-elk-08.tyo-prd1.huobiinternal:9092,ops-elk-09.tyo-prd1.huobiinternal:9092,ops-elk-10.tyo-prd1.huobiinternal:9092,ops-elk-11.tyo-prd1.huobiinternal:9092,ops-elk-12.tyo-prd1.huobiinternal:9092,ops-elk-13.tyo-prd1.huobiinternal:9092"\n    codec =### json\n    topic_id =### "%{[type]}"\n  }\n  s3 {\n    access_key_id =### "xxxxx"\n    secret_access_key =### "xxxxx"\n    region =### "ap-xxxx-1"\n    bucket =### "xxxxx-log-backup"\n    prefix =### "%{+YYYY}/%{+MM}/%{+dd}/%{[type]}"  # 将日志上传到“桶/年/月/日/应用”目录中\n    time_file =### 60  # 每隔60分钟强制滚动\n    size_file =### 52428800  # 每当压缩的日志等于50MB时滚动\n    encoding =### "gzip"  # 将日志压缩后再上传到S3\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("ul",[a("li",[s._v("Logstash_server 端配置")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('1：input {\n    kafka {\n        bootstrap_servers =### "ops-elk-01.tyo-prd1.huobiinternal:9092,ops-elk-02.tyo-prd1.huobiinternal:9092,ops-elk-03.tyo-prd1.huobiinternal:9092,ops-elk-04.tyo-prd1.huobiinternal:9092,ops-elk-05.tyo-prd1.huobiinternal:9092,ops-elk-06.tyo-prd1.huobiinternal:9092,ops-elk-07.tyo-prd1.huobiinternal:9092,ops-elk-08.tyo-prd1.huobiinternal:9092,ops-elk-09.tyo-prd1.huobiinternal:9092,ops-elk-10.tyo-prd1.huobiinternal:9092,ops-elk-11.tyo-prd1.huobiinternal:9092,ops-elk-12.tyo-prd1.huobiinternal:9092,ops-elk-13.tyo-prd1.huobiinternal:9092"\n        topics =### ["nginx-app-access", "nginx-access-colo", "nginx-error", "nginx-error-colo", "nginx-app-error"]\n        group_id =### "nginx"\n        client_id =### "nginx"\n#        consumer_threads =### 17\n    }\n}\n\nfilter {\n  json {\n    source =### "message"\n  }\n  if [type] =~ "access" {\n    mutate {\n      gsub =### [\'message\', \'\\\\x\', \'\\\\\\x\']\n    }\n    json {\n      source =### "message"\n      remove_field =### "message"\n    }\n    date {\n      match =### ["time_local", "dd/MMM/yyyy:HH:mm:ss Z"]\n    }\n    mutate {\n      remove_field =### [\n        "time_local"\n      ]\n      convert =### {\n        "server_port" =### "integer"\n        "status" =### "integer"\n        "request_time" =### "float"\n        "upstream_response_time" =### "float"\n        "upstream_status" =### "integer"\n        "request_length" =### "integer"\n        "body_bytes_sent" =### "integer"\n      }\n    }\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts =### ["ops-elk-01.tyo-prd1.huobiinternal:9200", "ops-elk-02.tyo-prd1.huobiinternal:9200", "ops-elk-03.tyo-prd1.huobiinternal:9200", "ops-elk-04.tyo-prd1.huobiinternal:9200", "ops-elk-05.tyo-prd1.huobiinternal:9200", "ops-elk-06.tyo-prd1.huobiinternal:9200", "ops-elk-07.tyo-prd1.huobiinternal:9200", "ops-elk-08.tyo-prd1.huobiinternal:9200", "ops-elk-09.tyo-prd1.huobiinternal:9200", "ops-elk-10.tyo-prd1.huobiinternal:9200", "ops-elk-11.tyo-prd1.huobiinternal:9200", "ops-elk-12.tyo-prd1.huobiinternal:9200", "ops-elk-13.tyo-prd1.huobiinternal:9200"]\n    index =### "%{[type]}-%{+YYYY.MM.dd}"\n  }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);