(window.webpackJsonp=window.webpackJsonp||[]).push([[232],{2172:function(t,s,a){"use strict";a.r(s);var n=a(9),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"一-架构设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-架构设计"}},[t._v("#")]),t._v(" 一：架构设计")]),t._v(" "),n("h3",{attrs:{id:"一-架构思想"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-架构思想"}},[t._v("#")]),t._v(" (一) 架构思想")]),t._v(" "),n("p",[n("img",{attrs:{src:a(673),alt:"Alt text"}})]),t._v(" "),n("ul",[n("li",[t._v("由于历史记录服务的特点在于读写都非常频繁，属于"),n("strong",[t._v("高QPS业务")]),t._v("，对于这种业务场景一般使用的架构是"),n("strong",[t._v("Write Back思想")]),t._v("，即 "),n("strong",[t._v("回写思想")]),t._v("。数据的写入过程如下")])]),t._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("：写入的数据从业务网关")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("或者其他的"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BFF")]),t._v("层Server服务端"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("写入到 History Server，此时History Server会将数据写入到History Service\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("：History "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Service先将每个写入请求的数据写入到Redis中，当写入到达一定数量后")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("例如有"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("次写入请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("，然后聚合这一段时间的写入请求的数据")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("不是所有字段，可能只有id或name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，将聚合数据写入到kafka，History Job 从kafka消费聚合数据，再查询Redis获取聚合数据的所有字段，再写入到MySQL中\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("ul",[n("li",[t._v("读取数据会先从Redis中读取，Redis中没有会从MySQL读取，然后再进行Cache build，将数据写入到Redis中")])])])}),[],!1,null,null,null);s.default=e.exports},673:function(t,s,a){t.exports=a.p+"assets/img/2022-03-1017.23.37.18f0261c.png"}}]);