(window.webpackJsonp=window.webpackJsonp||[]).push([[486],{2458:function(s,n,e){"use strict";e.r(n);var a=e(9),r=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"一-orm的增删查改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-orm的增删查改"}},[s._v("#")]),s._v(" 一：ORM的增删查改")]),s._v(" "),e("h3",{attrs:{id:"一-导入模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-导入模块"}},[s._v("#")]),s._v(" （一）导入模块")]),s._v(" "),e("ul",[e("li",[e("ol",[e("li",[s._v("使用sqlalchemy"),e("code",[s._v("创建数据库")]),s._v("，"),e("code",[s._v("创建数据表")]),s._v("，"),e("code",[s._v("查询数据表")]),s._v("的基本流程")])])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 创建连接相关\nfrom sqlalchemy import create_engine\n\n# 和 sqlapi 交互，执行转换后的 sql 语句，用于创建基类\nfrom sqlalchemy.ext.declarative import declarative_base\n\n# 创建表中的字段(列)\nfrom sqlalchemy import Column\n\n# 表中字段的属性\nfrom sqlalchemy import Integer, String, ForeignKey\nfrom sqlalchemy import UniqueConstraint, Index\nfrom sqlalchemy.orm import sessionmaker, relationship\n\n# 创建连接对象，并使用 pymsql 引擎\nmysql_ip, port, database, user, password = '127.0.0.1', 3306, 'sqlalchemy_test', 'root', 'yhy3426356'\n\n# 创建连接引擎\nengine = create_engine('mysql+pymysql://{user}:{password}@{mysql_ip}:{port}/{database}?'\n                       'charset=utf8mb4'.format(user=user, password=password, mysql_ip=mysql_ip, port=port, database=database),\n                        echo=True,\n                        max_overflow=3000)\n\n# 创建表基类\nBase = declarative_base()\n\n\n# 创建单表: TODO： 这里有个问题，主键的自增字段从2开始\nclass Person(Base):\n    __tablename__ = 'person'\n    id = Column(Integer, primary_key=True)\n    # 必须指定长度，在PostgreSQL上不需要\n    name = Column(String(32))\n    age = Column(Integer)\n\n    __table_args__ = (\n        # 设置联合唯一约束, 这个是作用在物理表中的，相当于在表中给这两个字段做了UNIQUE KEY\n        UniqueConstraint('id', 'name', name='unique_id_name'),\n        # 给name字段建立索引\n        Index('index_name', 'name'),\n    )\n\n\ndef init_db():\n    \"\"\"创建所有定义的表到数据库中\"\"\"\n    Base.metadata.create_all(engine)\n\n\ndef drop_db():\n    \"\"\"从数据库中删除所有定义的表\"\"\"\n    Base.metadata.drop_all(engine)\n\n\n# 执行创建表\ninit_db()\n\n# 创建会话实例对象\nSession = sessionmaker(bind=engine)\nsession = Session()\n\n\nperson1 = Person(name='Robby', age=28,)\nsession.add(person1)\nsession.commit()\n\n# 返回记录实例对象列表\nret = session.query(Person).all()\nprint(ret)\n\n# 返回字段元组列表\nret = session.query(Person.name, Person.age).all()\nprint(ret)\n\n\n# 使用label可以给每个列取名字\nfor row in session.query(Person.name.label('t_name'), Person.age.label('t_age')).all():\n    print(row.t_name, row.t_age)\n\n\n# filter_by条件过滤，返回一个记录实例列表\nret = session.query(Person).filter_by(name='Robby').first()\nprint('filter_by = {}'.format(ret))\n\n# filter条件过滤，返回一个记录实例列表\nret = session.query(Person).filter(Person.age > 18).first()\nprint('filter = {}'.format(ret))\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br")])]),e("ul",[e("li",[s._v("​结果集内看到的是对象 、还是数据")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("​1：query(类名) 返回的就是对象\nret = session.query(Teacher).all()\n# 结果 [obj1, obj2, obj3]\n\n2：query(类名.字段名) 返回的就是含有数据的元组对象\nret = session.query(Teachers.name, Teachers.arg).all()\n# 结果 [('yangge', '18'), ('qiangge', '19'), ('shark', '23')]\n\n3：迭代查询结果集，由此可见query()方法返回的是一个迭代器,那么迭代器.all()返回的是一个列表\nfor name, age, in session.query(Teacher.name, Teacher.age):\n    print(name, age)\n    # 输出结果\n\tyangge 18\n\tqiangge 19\n\tshark 23\n\n4：可以使用 label() 给每个列名起别名\nfor row in session.query(Teacher.name.label('t_name')).all():\n    print(row.t_name)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h3",{attrs:{id:"二-filter-方法对应的关系运算符查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-filter-方法对应的关系运算符查询"}},[s._v("#")]),s._v(" （二）filter( )方法对应的关系运算符查询")]),s._v(" "),e("ul",[e("li",[s._v("以下适用于 filter( )")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("query = session.query(Teacher)\n\n# 字段值相等、不等、LIKE、ILIKE、IN、NOT IN、BETWEEN\nquery.filter(Teacher.name == 'shark').all()\nquery.filter(Teacher.name != 'shark').all()\nquery.filter(Teacher.name.like('%sha%')).all()\nquery.filter(Teacher.name.ilike('Sha___')).all()\nquery.filter(Teacher.id.in_([2,3])).all()\nquery.filter(~Teacher.id.in_([2,3])).all()\nquery.filter(Teacher.id.between(1, 3)).all()\n\n# 数据库中的空字符串不是 NUll ， python 中的 None 存到数据库中是 NULL，下面是查询name字段为NULL的记录\nquery.filter(Teacher.name == None).all()\nquery.filter(Teacher.name.is_(None)).all()\nquery.filter(Teacher.name != None).all()\nquery.filter(Teacher.name.isnot(None)).all()\n\n# AND查询，需要先导入and_函数\nfrom sqlalchemy import and_\nquery.filter(and_(Teacher.name == 'shark', Teacher.city == '北京')).all()\n\n# OR查询，需要先导入or_函数\nfrom sqlalchemy import or_\nquery.filter(or_(Teacher.name == 'shark', Teacher.name == 'xiguatian')).all()\n\n# AND 和 OR 的综合使用\nquery.filter(\n\tor_(\n        Teacher.id <= 2,\n        and_(Teacher.name == 'shark', Teacher.id > 3)\n    )).all()\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("ul",[e("li",[s._v("条件查询")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("LIKE语句：区分大小写\nquery.filter(Teacher.name.like('%sha%')).all()\n\nILIKE语句：不区分大小写\nquery.filter(Teacher.name.ilike('Sha___')).all()\n\nIN语句\nquery.filter(Teacher.id.in_([2,3])).all()\n\nNOT IN语句\nquery.filter(~Teacher.id.in_([2,3])).all()\n\nBETWEEN\nquery.filter(Teacher.id.between(1, 3)).all()\n\nIS NULL\nquery.filter(Teacher.name.is_(None)).all()\n\nIS NOT NULL\nquery.filter(Teacher.name.isnot(None)).all()\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("h3",{attrs:{id:"三-返回结果集控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-返回结果集控制"}},[s._v("#")]),s._v(" （三）返回结果集控制")]),s._v(" "),e("ul",[e("li",[s._v("all( ) 返回的是所有的结果集，是列表。first( ) 返回的是所有结果集中的第一个数据")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(Teacher).all()\n# 结果 [obj1,obj2,obj3]\n\nret = session.query(Teacher).first()\n# 结果 obj1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"四-limit控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-limit控制"}},[s._v("#")]),s._v(" （四）limit控制")]),s._v(" "),e("ul",[e("li",[s._v("基于切片控制limit")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(Person).filter(Person.age > 18)[0:2]\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"五-order-by-排序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五-order-by-排序"}},[s._v("#")]),s._v(" （五）order by 排序")]),s._v(" "),e("ul",[e("li",[s._v("基于字段"),e("code",[s._v("正序排序")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(Person).order_by(Person.name.asc()).all()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("基于字段"),e("code",[s._v("反序排序")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(Person).order_by(Person.name.desc()).all()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("先按name正向排序，假如有相同的再按照 id反向排序")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("session.query(Person).order_by(Person.name,Person.id.desc()).all()\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"六-count-统计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六-count-统计"}},[s._v("#")]),s._v(" （六）count 统计")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("session.query(Person).filter(Person.age=='18').count()\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"七-嵌套查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七-嵌套查询"}},[s._v("#")]),s._v(" （七）嵌套查询")]),s._v(" "),e("ul",[e("li",[s._v("person表")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("+----+-------+------+\n| id | name  | age  |\n+----+-------+------+\n|  2 | Robby |   28 |\n|  3 | Robby |   28 |\n|  4 | Robby |   28 |\n|  5 | Robby |   28 |\n|  6 | Robby |   28 |\n|  7 | Robby |   28 |\n|  8 | Robby |   28 |\n|  9 | Marry |   29 |\n+----+-------+------+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("part表")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("+----+--------------+-----------+\n| id | name         | person_id |\n+----+--------------+-----------+\n|  1 | 牛逼部门     |         8 |\n|  2 | 超牛逼部门    |         9 |\n+----+--------------+-----------+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("查询Marry这个人的部门名称")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(Part).filter(Part.person_id == session.query(Person).filter(Person.name == 'Marry').first().id).first()\n\n# 输出：超牛逼部门\nprint(ret.name)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"七-group-by分组统计查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七-group-by分组统计查询"}},[s._v("#")]),s._v(" （七）group by分组统计查询")]),s._v(" "),e("ul",[e("li",[s._v("查询表中的记录数量")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(func.count('*')).select_from(Person).first()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("SELECT count(*) AS count_1 FROM person LIMIT 1;\n+---------+\n| count_1 |\n+---------+\n|       8 |\n+---------+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("以年龄分组，并统计每组的数据数量, 可以看成分组后再查询")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 以Person.age分组，可以分为2组，然后再查看这两组的数量\nret = session.query(func.count(Person.age),Person.age).group_by(Person.age).all()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("SELECT count(person.age) AS count_1, person.age AS person_age FROM person GROUP BY person.age;\n\n+---------+------------+\n| count_1 | person_age |\n+---------+------------+\n|       7 |         28 |\n|       1 |         29 |\n+---------+------------+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("以年龄为分组，并统计每组的最大/最小 id 号，年龄总和/平均值")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(func.max(Person.id), func.min(Person.id), func.sum(Person.age), func.avg(Person.age), Person.age).group_by(Person.age).all()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 这里person_age必须是分组字段\nSELECT max(person.id) AS max_1, min(person.id) AS min_1, sum(person.age) AS sum_1, avg(person.age) AS avg_1, person.age AS person_age FROM person GROUP BY person.age;\n\n+-------+-------+-------+---------+------------+\n| max_1 | min_1 | sum_1 | avg_1   | person_age |\n+-------+-------+-------+---------+------------+\n|     8 |     2 |   196 | 28.0000 |         28 |\n|     9 |     9 |    29 | 29.0000 |         29 |\n+-------+-------+-------+---------+------------+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ul",[e("li",[s._v("group by分组后，having对分组数据进行过滤")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(func.max(Person.id), func.min(Person.age), func.sum(Person.age), func.avg(Person.age), Person.age).group_by(Person.age).having(func.min(Person.id) > 2).all()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("SELECT max(person.id) AS max_1, min(person.age) AS min_1, sum(person.age) AS sum_1, avg(person.age) AS avg_1, person.age AS person_age FROM person GROUP BY person.age HAVING min(person.id) > 2;\n+-------+-------+-------+---------+------------+\n| max_1 | min_1 | sum_1 | avg_1   | person_age |\n+-------+-------+-------+---------+------------+\n|     9 |    29 |    29 | 29.0000 |         29 |\n+-------+-------+-------+---------+------------+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"八-组合查询-基本没用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#八-组合查询-基本没用"}},[s._v("#")]),s._v(" （八）组合查询(基本没用)")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("q1 = session.query(Person.name).filter(Person.id > 2)\nq2 = session.query(Person.name).filter(Person.id < 6)\nret = q1.union_all(q2).all()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"九-更新数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#九-更新数据"}},[s._v("#")]),s._v(" （九）更新数据")]),s._v(" "),e("ul",[e("li",[s._v("查询后对应的记录后，更新数据")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ret = session.query(Person).filter(Person.id == 3).update({"name" : "尹欢一", "age": 30})\nsession.commit()\nprint(ret)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("UPDATE person SET name='尹欢一', age=30 WHERE person.id = 3;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查询后对应的记录后，更新数据")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ret = session.query(Person).filter(Person.id == 3).update({Person.name: Person.name + "讲师"}, synchronize_session=False)\nsession.commit()\nprint(ret)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("UPDATE person SET name=(concat(person.name, '讲师')) WHERE person.id = 3;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"十-删除数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#十-删除数据"}},[s._v("#")]),s._v(" （十）删除数据")]),s._v(" "),e("ul",[e("li",[s._v("删除id大于4的记录")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ret = session.query(Person).filter(Person.id > 4).delete()\nsession.commit()\nprint(ret)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("DELETE FROM person WHERE person.id > 4;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);n.default=r.exports}}]);