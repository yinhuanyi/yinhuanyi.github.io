(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{1613:function(s,n,a){s.exports=a.p+"assets/img/2020-03-143.04.47.a893c30c.png"},1614:function(s,n,a){s.exports=a.p+"assets/img/2021-07-163.36.33.96291a81.png"},1615:function(s,n,a){s.exports=a.p+"assets/img/2021-07-163.50.06.f6c2862d.png"},1616:function(s,n,a){s.exports=a.p+"assets/img/2021-07-163.53.49.675ee256.png"},1617:function(s,n,a){s.exports=a.p+"assets/img/2021-07-163.56.10.b95e40e6.png"},1618:function(s,n,a){s.exports=a.p+"assets/img/2021-07-163.59.41.15ca2045.png"},1619:function(s,n,a){s.exports=a.p+"assets/img/2021-07-164.08.22.4f3596df.png"},1620:function(s,n,a){s.exports=a.p+"assets/img/2021-07-166.10.47.0c0c37c8.png"},2606:function(s,n,a){"use strict";a.r(n);var t=a(9),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"一-搜索引擎中的正排索引与倒排索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-搜索引擎中的正排索引与倒排索引"}},[s._v("#")]),s._v(" 一：搜索引擎中的"),t("code",[s._v("正排索引与倒排索引")])]),s._v(" "),t("h3",{attrs:{id:"一-什么是搜索引擎中的正排索引与倒排索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-什么是搜索引擎中的正排索引与倒排索引"}},[s._v("#")]),s._v(" (一)：什么是搜索引擎中的正排索引与倒排索引")]),s._v(" "),t("ul",[t("li",[s._v("正排索引：也称之为doc values，默认在_source中，所有的字段开启了正排索引，正排索引的目的是排序和聚合")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("文档ID到文档内容、单词的关联关系\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("文档ID")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("内容")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("1")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("内容1")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("2")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("内容1")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("3")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("内容1")])])])]),s._v(" "),t("ul",[t("li",[s._v("倒排索引")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("单词到文档ID的关联关系\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("单词")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("文档ID")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("elasticsearch")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("1")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("python")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("2")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("java")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("3")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("oc")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("2")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("javascript")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("3")])])])]),s._v(" "),t("ul",[t("li",[s._v("正排索引与倒排索引的关联关系")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1613),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("搜索引擎实现过程")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\t通过用户输入的单词，借助文档的倒排索引，找到对应的文档，再通过正排索引返回文档的完整内容给用户\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"二-倒排索引的组成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-倒排索引的组成"}},[s._v("#")]),s._v(" (二)：倒排索引的组成")]),s._v(" "),t("ul",[t("li",[s._v("倒排索引是搜索引擎的核心，主要包括两个部分")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：单词词典(Term Dictionary)\n\n2：倒排列表(Posting List)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("单词词典")]),s._v("是倒排索引的重要组成部分")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：记录了所有文档的单词\n\n2：记录单词到倒排列表的关联信息，也就是单词关联的文档\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("倒排索引的单词词典")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1614),alt:"Alt text"}})]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("倒排索引的单词词典一般是使用B+Tree\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("倒排索引的列表")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("倒排列表(Posting List)记录了单词对应的文档集合，由倒排索引项(Posting)组成\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("倒排索引项主要包含的信息")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：文档ID，用于获取原始信息\n\n2：单词频率(TF, Term Frequency)，记录该单词在该文档中出现的次数，用于后续相关性算分\n\n3：位置(Position)，记录单词在文档中的分词位置，用于做词语搜索\n\n4：偏移(Offset)，记录单词在文档的开始和结束位置，用于做高亮显示\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("以“搜索引擎”这个词为例，说明倒排列表的构建过程")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1615),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("将单词词典和倒排列表整合在一起的结构如下")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1616),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("在ES中，一个doc文档包含多个字段，每个字段会有自己的倒排索引")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1617),alt:"Alt text"}})]),s._v(" "),t("h3",{attrs:{id:"三-es中的字段分词"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三-es中的字段分词"}},[s._v("#")]),s._v(" (三)：ES中的字段分词")]),s._v(" "),t("ul",[t("li",[s._v("分词：一个Doc中的字段文本，被切分为一系列的单词的过程，在ES中，这个过程叫做Analysis")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1618),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("在ES中，负责分词的组件叫做分词器 Analyze，每一个分词器由如下部分组成：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：char_filter：比如html_strip\n\t针对原始文本进行处理，比如去除HTML特殊标记\n\n2：tokenizer：比如standard\n\t将原始文本按照一定规则切分为单词\n\n3：filter：比如lowcase\n\t针对tokenizer处理的单词进行加工，如果大小写转换，删除，新增单词处理\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("下面是一个text文本字段，被分词器分词的过程")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1619),alt:"Alt text"}})]),s._v(" "),t("h3",{attrs:{id:"四-analyze-api-如果搜索效果与预期不一样-可以使用这个analyze-api进行诊断"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四-analyze-api-如果搜索效果与预期不一样-可以使用这个analyze-api进行诊断"}},[s._v("#")]),s._v(" (四)：Analyze API(如果搜索效果与预期不一样，可以使用这个Analyze API进行诊断)")]),s._v(" "),t("ul",[t("li",[s._v("ES提供了一个测试分词的API接口，方便验证分词效果，endpoint是_analyze")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：可以直接指定analyzer进行测试\n\n2：可以直接指定搜索中的字段进行测试\n\n3：可以自定义分词器，进行测试\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("使用Analyze API测试一个text类型的字段，查看分词后的效果")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('POST _analyze\n{\n  "analyzer": "standard",\n  "text": "hello word"  # 这里是指定了hello world这个文本进行了测试\n}\n\n\n{\n  "tokens" : [\n    {\n      "token" : "hello",  # 分词结果\n      "start_offset" : 0, # 起始偏移\n      "end_offset" : 5,   # 结束偏移\n      "type" : "<ALPHANUM>", \n      "position" : 0      # 分词位置\n    },\n    {\n      "token" : "word",\n      "start_offset" : 6,\n      "end_offset" : 10,\n      "type" : "<ALPHANUM>",\n      "position" : 1\n    }\n  ]\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("ul",[t("li",[s._v("也可以直接使用ES索引中的字段测试Analyze API")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('POST snarkctl-2021.06.05/_analyze\n{\n  "field": "message",\n  "text": "hello world 你好"\n}\n\n# 返回结果\n{\n  "tokens" : [\n    {\n      "token" : "hello",\n      "start_offset" : 0,\n      "end_offset" : 5,\n      "type" : "<ALPHANUM>",\n      "position" : 0\n    },\n    {\n      "token" : "world",\n      "start_offset" : 6,\n      "end_offset" : 11,\n      "type" : "<ALPHANUM>",\n      "position" : 1\n    },\n    {\n      "token" : "你",\n      "start_offset" : 12,\n      "end_offset" : 13,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 2\n    },\n    {\n      "token" : "好",\n      "start_offset" : 13,\n      "end_offset" : 14,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 3\n    }\n  ]\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("ul",[t("li",[s._v("可以自定义分词器进行测试")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('POST _analyze\n{\n  "tokenizer": "standard",\n  "filter": ["lowercase"],  # 将大写转换为小写\n  "text": "hello world 你好我是Robby"\n}\n\n# 返回结果\n{\n  "tokens" : [\n    {\n      "token" : "hello",\n      "start_offset" : 0,\n      "end_offset" : 5,\n      "type" : "<ALPHANUM>",\n      "position" : 0\n    },\n    {\n      "token" : "world",\n      "start_offset" : 6,\n      "end_offset" : 11,\n      "type" : "<ALPHANUM>",\n      "position" : 1\n    },\n    {\n      "token" : "你",\n      "start_offset" : 12,\n      "end_offset" : 13,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 2\n    },\n    {\n      "token" : "好",\n      "start_offset" : 13,\n      "end_offset" : 14,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 3\n    },\n    {\n      "token" : "我",\n      "start_offset" : 14,\n      "end_offset" : 15,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 4\n    },\n    {\n      "token" : "是",\n      "start_offset" : 15,\n      "end_offset" : 16,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 5\n    },\n    {\n      "token" : "robby",\n      "start_offset" : 16,\n      "end_offset" : 21,\n      "type" : "<ALPHANUM>",\n      "position" : 6\n    }\n  ]\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br")])]),t("h3",{attrs:{id:"五-es中的内置分词器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五-es中的内置分词器"}},[s._v("#")]),s._v(" (五)：ES中的内置分词器")]),s._v(" "),t("ul",[t("li",[s._v("内置分词器如下")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("standard ：这是默认的分词器\nsimple\nwhitespace\nstop\nkeyword\npattern\nlanguage\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("Standard 默认的分词器，处理文本的流程")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(1620),alt:"Alt text"}})]),s._v(" "),t("ul",[t("li",[s._v("测试"),t("code",[s._v("standard")]),s._v("分词器")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('POST _analyze\n{\n  "analyzer": "whitespace", \n  "text": "hello world 你好我是Robby"\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"六-es中的中文分词器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六-es中的中文分词器"}},[s._v("#")]),s._v(" (六)：ES中的中文分词器")]),s._v(" "),t("ul",[t("li",[s._v("中文分词的难点")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：中文分词指的是将一个中文文本切分为一个一个词语，在英文中，单词是空格分隔的，但是在中文中，单词没有分隔符\n\n2：切词不同，文本的含义不一样，例如\n\t乒乓球\\拍卖\\完了\n\t乒乓球拍\\卖\\完了\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("常见的中文分词器")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：IK\n\t①：可以实现中英文单词的切分，支持ik_smart、ik_maxword等模式\n\t②：可自定义词库\n\t③：github中的medcl/elasticsearch-analysis-ik插件\n\n2：jieba\n\t①：Python中最流行的分词系统，支持分词和磁性标注\n\t②：支持繁体分词，自定义词典，并行分词等\n\t③：github中的sing1ee/elasticsearch-jieba-plugin插件\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"七-es中自定义分词"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#七-es中自定义分词"}},[s._v("#")]),s._v(" (七)：ES中自定义分词")]),s._v(" "),t("ul",[t("li",[s._v("给一个索引自定义分词，需要在索引的settings中配置")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('PUT /test_index\n{\n  "settings": {\n    "analysis": {\n      "analyzer": {\n        "my_custom_analyzer": {\n          "type": "custom",\n          "char_filter": [\n            "html_strip"\n          ],\n          "tokenizer": "standard",\n          "filter": [\n            "lowercase",\n            "asciifolding"\n          ]\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("ul",[t("li",[s._v("在"),t("code",[s._v("test_index")]),s._v("这个索引中，使用刚刚定义的分词器对text文本分词")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('POST /test_index/_analyze\n{\n  "analyzer": "my_custom_analyzer",\n  "text": "nihao 你好 Hello"\n}\n\n# 返回结果\n{\n  "tokens" : [\n    {\n      "token" : "nihao",\n      "start_offset" : 0,\n      "end_offset" : 5,\n      "type" : "<ALPHANUM>",\n      "position" : 0\n    },\n    {\n      "token" : "你",\n      "start_offset" : 6,\n      "end_offset" : 7,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 1\n    },\n    {\n      "token" : "好",\n      "start_offset" : 7,\n      "end_offset" : 8,\n      "type" : "<IDEOGRAPHIC>",\n      "position" : 2\n    },\n    {\n      "token" : "hello",\n      "start_offset" : 9,\n      "end_offset" : 14,\n      "type" : "<ALPHANUM>",\n      "position" : 3\n    }\n  ]\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("h3",{attrs:{id:"八-es在什么时候会用到分词"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#八-es在什么时候会用到分词"}},[s._v("#")]),s._v(" (八)：ES在什么时候会用到分词")]),s._v(" "),t("ul",[t("li",[s._v("使用到分词时机有两个")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：在创建或更新文档的时候，会对文档的text字段进行分词\n\n2：查询文档时候，会对查询语句进行分词\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("创建或更新文档的时候，在mapping中指定"),t("code",[s._v("内置分词器")]),s._v("或"),t("code",[s._v("自定义分词器")]),s._v("，如果不指定，默认是使用standard分词器")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('PUT /index_new\n{\n  "mappings": {\n    "properties": {\n      "title": {\n        "type": "text",\n        "analyzer": "whitespace"\n      }\n    }\n  }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("在进行搜索查询的时候，指定分词器("),t("code",[s._v("但是，一般不会指定查询时候的分词器，因为需要保证查询的分词器和创建文档时使用的分词器一致")]),s._v(")")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('POST /index_new\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "hello",   # 这里是使用query查询hello单词，使用了whitespace分词器，但是一般不会这样指定。如果使用中文的分词器，那么在查询的时候【无需指定分词器】也会使用中文分词器对搜索语句进行分词\n        "analyzer": "whitespace"\n      }\n    }\n  }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"九-关于es分词的建议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#九-关于es分词的建议"}},[s._v("#")]),s._v(" (九)：关于ES分词的建议")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("明确string类型字段是否需要分词，如果不需要分词，需要将字段的类型设置为keyword，从而节约存储空间和提高文档的写入性能")])]),s._v(" "),t("li",[t("p",[s._v("多使用analyze API，查看文档的具体分词结果")])])])])}),[],!1,null,null,null);n.default=e.exports}}]);