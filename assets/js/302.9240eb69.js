(window.webpackJsonp=window.webpackJsonp||[]).push([[302],{1584:function(s,a,n){s.exports=n.p+"assets/img/CA3A2A8285C768B4E573AF7AB013A241.53af3795.png"},2598:function(s,a,n){"use strict";n.r(a);var e=n(9),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"一-spark介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-spark介绍"}},[s._v("#")]),s._v(" 一：Spark介绍")]),s._v(" "),e("h3",{attrs:{id:"一-概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-概念"}},[s._v("#")]),s._v(" (一)概念")]),s._v(" "),e("p",[e("img",{attrs:{src:n(1584),alt:"Alt text"}})]),s._v(" "),e("h2",{attrs:{id:"二-spark与hive集成配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-spark与hive集成配置"}},[s._v("#")]),s._v(" 二：Spark与Hive集成配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('1: Hive和Spark都有metastore存储，需要存储数据的元数据，因此，Spark也需要将metastore存储至MySQL中\n\n2: 将hive-site.xml配置文件拷贝到spark中\ncp hive-site.xml ../../spark-2.2.0-bin-custom-spark/conf/\n\n3：vi /opt/modules/spark-2.2.0-bin-custom-spark/conf/hive-site.xml\n<configuration>\n        <property>\n                <name>javax.jdo.option.ConnectionURL</name>\n                <value>jdbc:mysql://node1/metastore?createDatabaseIfNotExist=true</value>\n        </property>\n        <property>\n            <name>javax.jdo.option.ConnectionDriverName</name>\n            <value>com.mysql.jdbc.Driver</value>\n        </property>\n        <property>\n            <name>javax.jdo.option.ConnectionUserName</name>\n            <value>root</value>\n        </property>\n        <property>\n            <name>javax.jdo.option.ConnectionPassword</name>\n            <value>yhy3426356</value>\n        </property>\n        <property>\n            <name>hive.cli.print.header</name>\n            <value>true</value>\n        </property>\n        <property>\n            <name>hive.cli.print.current.db</name>\n            <value>true</value>\n        </property>\n        \x3c!-- 注释hive与hbase的集成     \n        <property>\n            <name>hbase.zookeeper.quorum</name>\n            <value>node1,node2,node3</value>\n        </property>\n        --\x3e\n\n        \x3c!-- 配置spark sql的metastore存储uri--\x3e\n        <property>\n            <name>hive.metastore.uris</name>\n            <value>thrift://node3:9083</value>\n        </property>\n</configuration>\n\n4: 将MySQL驱动拷贝到spark中\ncp -p  /opt/modules/hive-0.13.1-cdh5.3.5/lib/mysql-connector-java-5.1.45.jar /opt/modules/spark-2.2.0-bin-custom-spark/jars/ \n\n5：确保spark配置文件中已经开启HADOOP_CONF_DIR=/opt/modules/hadoop-2.5.0-cdh5.3.5/etc/hadoop\n\n6：在node3启动hive的metastore\n nohup hive --service metastore & \n\n7: 进入hive创建数据库和表\ncreate database kfk;\nuse kfk;\ncreate table if not exists test(userid string, username string) row format delimited fields terminated by \' \' stored as textfile;\n\n8: 创建数据表文件，用于将文件中的数据导入到hive表中\nvi /opt/datas/kfk.txt\n1 java\n2 scala\n3 python\n4 c++\n5 scala\n6 oc\n7 js\n\n9: 在hive的kfk库中将/opt/datas/kfk.txt文件内容导入到test表中, 此时的hive中就存在数据了\nload data local inpath "/opt/datas/kfk.txt" into table test;\n\n10：在spark-shell中查看hive中的数据\nspark-shell\nscala### spark.sql("select * from kfk.test").show\n+------+--------+\n|userid|username|\n+------+--------+\n|     1|    java|\n|     2|   scala|\n|     3|  python|\n|     4|     c++|\n|     5|   scala|\n|     6|      oc|\n|     7|      js|\n+------+--------+\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br")])]),e("h2",{attrs:{id:"三-在spark-shell中-使用spark-sql查询数据表-写入到mysql中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-在spark-shell中-使用spark-sql查询数据表-写入到mysql中"}},[s._v("#")]),s._v(" 三：在spark-shell中，使用spark SQL查询数据表，写入到MySQL中")]),s._v(" "),e("ul",[e("li",[s._v("在spark SQL中查询数据，写入到MySQL")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import java.util.Properties\n\nval df = spark.sql("select * from kfk.test");\nval connectionProperties = new Properties()\nconnectionProperties.setProperty("driver", "com.mysql.jdbc.Driver")\ndf.write.jdbc(url="jdbc:mysql://node1/test?user=root&password=yhy3426356", table="spark1", connectionProperties=connectionProperties)\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("在MySQL数据库中，查询写入的test表，test表在写入时自动新建的")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("MariaDB [test]### select * from spark1;\n+--------+----------+\n| userid | username |\n+--------+----------+\n| 1      | java     |\n| 2      | scala    |\n| 3      | python   |\n| 4      | c++      |\n| 5      | scala    |\n| 6      | oc       |\n| 7      | js       |\n+--------+----------+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h2",{attrs:{id:"四-thriftserver-与-beeline使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-thriftserver-与-beeline使用"}},[s._v("#")]),s._v(" 四：ThriftServer 与 beeline使用")]),s._v(" "),e("ul",[e("li",[s._v("由于node3节点已经启动了hive的ThriftServer，如果再启动spark的ThriftServer，必须设置新的socket端口")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1: 启动spark的ThriftServer，指定端口\nstart-thriftserver.sh --hiveconf hive.server2.thrift.port=10001 \n\n2: 进入beeline，查询数据，每启动一个beeline就是application下面的job\n[root@node3 ~]# beeline\nbeeline### !connect jdbc:hive2://node3:10001\n0: jdbc:hive2://node3:10001### select * from kfk.test;\n+---------+-----------+--+\n| userid  | username  |\n+---------+-----------+--+\n| 1       | java      |\n| 2       | scala     |\n| 3       | python    |\n| 4       | c++       |\n| 5       | scala     |\n| 6       | oc        |\n| 7       | js        |\n+---------+-----------+--+\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h2",{attrs:{id:"五-spark-sql与mysql集成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五-spark-sql与mysql集成"}},[s._v("#")]),s._v(" 五：Spark SQL与MySQL集成")]),s._v(" "),e("h3",{attrs:{id:"一-示例代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-示例代码"}},[s._v("#")]),s._v(" (一)示例代码")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 在spark-shell中\nval jdbcDF = spark.read.format("jdbc").option("url", "jdbc:mysql://node1/test").option("dbtable", "spark1").option("user", "root").option("password", "yhy3426356").load()\n jdbcDF.show\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"六-spark-sql与hbase集成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六-spark-sql与hbase集成"}},[s._v("#")]),s._v(" 六：Spark SQL与Hbase集成")]),s._v(" "),e("h3",{attrs:{id:"一-主要思想"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-主要思想"}},[s._v("#")]),s._v(" (一)主要思想")]),s._v(" "),e("ul",[e("li",[s._v("概念")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Spark SQL与Hbase集成的核心思想是Spark Sql通过Hive外部表来获取HBase的表数据，因此需要将Hbase和Hive的一些jar包导入到spark中\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("需要拷贝到spark的jar包")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cp /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-client-0.98.6-cdh5.3.5.jar  /opt/modules/spark-2.2.0-bin-custom-spark/jars/\ncp /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-common-0.98.6-cdh5.3.5.jar  /opt/modules/spark-2.2.0-bin-custom-spark/jars/\ncp /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-protocol-0.98.6-cdh5.3.5.jar  /opt/modules/spark-2.2.0-bin-custom-spark/jars/\ncp /opt/modules/hbase-0.98.6-cdh5.3.5/lib/hbase-server-0.98.6-cdh5.3.5.jar  /opt/modules/spark-2.2.0-bin-custom-spark/jars/\ncp /opt/modules/hbase-0.98.6-cdh5.3.5/lib/htrace-core-2.04.jar  /opt/modules/spark-2.2.0-bin-custom-spark/jars/\n\n\n将hive-hbase-handler-1.2.1.jar， mysql-connector-java-5.1.45.jar下载并上传\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("在spark-shell中，查询hive的default库中的weblogs表")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('spark.sql("select * from weblogs limit 10").show\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("在spark的stand-alone中，查询hive的default库中的weblogs表")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('1：在stand-alone模式下启动spark-shell\nspark-shell --master spark://node3:7077\nspark.sql("select * from weblogs limit 10").show\n+--------------------+--------+-------------------+--------------+--------+--------+--------------------+\n|                  id|datatime|             userid|    searchname|retorder|cliorder|              cliurl|\n+--------------------+--------+-------------------+--------------+--------+--------+--------------------+\n|00143621727586595...|00:01:07|0014362172758659586|        [明星合成]|      67|      22|1.yulaikezhan.com...|\n|00143621727586595...|00:02:28|0014362172758659586|        [明星合成]|      82|      26|        av.avbox.us/|\n|00143621727586595...|00:02:44|0014362172758659586|        [明星合成]|      83|      27|csdfhnuop.blog.so...|\n|00143621727586595...|00:02:56|0014362172758659586|        [明星合成]|      90|      28|www.pic13.cn/arti...|\n|00144256787737356...|00:00:20|0014425678773735684|[www.hntz.net]|       2|       1|    www.gaywang.com/|\n|00198239955021622...|00:00:08|0019823995502162295|      [抗震救灾晚会]|       8|      17|news.xinhuanet.co...|\n|00198239955021622...|00:00:34|0019823995502162295|      [抗震救灾晚会]|      10|      18|news.qq.com/a/200...|\n|00198239955021622...|00:01:03|0019823995502162295|  [2008抗震救灾晚会]|       1|      20|www.91ball.com/en...|\n|00198239955021622...|00:02:30|0019823995502162295|  [2008抗震救灾晚会]|      10|      24|v.youku.com/v_pla...|\n|00215283251798081...|00:02:34|0021528325179808183|       [电影本能1]|      32|      11|www.cc021.com/pla...|\n+--------------------+--------+-------------------+--------------+--------+--------+--------------------+\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);