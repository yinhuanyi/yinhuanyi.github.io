(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{1702:function(s,t,n){s.exports=n.p+"assets/img/2018-08-2910.37.38.0d669beb.png"},1703:function(s,t,n){s.exports=n.p+"assets/img/2018-08-2910.38.14.684d070f.png"},1704:function(s,t,n){s.exports=n.p+"assets/img/2018-08-2910.40.56.1059745a.png"},1705:function(s,t,n){s.exports=n.p+"assets/img/2018-08-2910.41.49.976aedfc.png"},2667:function(s,t,n){"use strict";n.r(t);var a=n(9),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"gitlab-ci-runner-部署django项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-runner-部署django项目"}},[s._v("#")]),s._v(" Gitlab Ci runner 部署Django项目")]),s._v(" "),a("h3",{attrs:{id:"一-gitlab-ci-runner服务器上运行djangoblog开源博客-博客地址-https-github-com-liangliangyy-djangoblog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-gitlab-ci-runner服务器上运行djangoblog开源博客-博客地址-https-github-com-liangliangyy-djangoblog"}},[s._v("#")]),s._v(" （一）gitlab-ci runner服务器上运行Djangoblog开源博客（博客地址: https://github.com/liangliangyy/DjangoBlog）")]),s._v(" "),a("ul",[a("li",[s._v("1：安装虚拟环境")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("由于开源博客是Python 3.5版本的Python，因此需要在gitlab-ci runner服务器先安装Python的虚拟环境\n这个虚拟环境使用在gitlab-runner这个用户下安装的。且创建一个xkd_course3.5.3的虚拟环境，将这个xkd_course3.5.3虚拟环境绑定到/app目录下\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:n(1702),alt:"Alt text"}})]),s._v(" "),a("p",[a("img",{attrs:{src:n(1703),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("2：将gitlab-ci用户的公钥添加到gitlab")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(1704),alt:"Alt text"}})]),s._v(" "),a("p",[a("img",{attrs:{src:n(1705),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("3：编写.gitlab-ci.yml文件，文件内容如下")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" clone\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" clone\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" xkd_course_runner1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd /app\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" git clone git@gitlab.9xkd.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("yinhuanyi/xkd_course.git\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd xkd_course\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pip install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Ur requirements.txt\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" xkd_course_runner1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "test success"\n\n\n\n'),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" xkd_course_runner1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd /app/xkd_course\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./manage.py makemigrations\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./manage.py migrate\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./manage.py collectstatic "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("noinput\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./manage.py compress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("force\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./manage.py runserver 0.0.0.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3333")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("ul",[a("li",[s._v("如果第一次使用git clone ssh协议的地址，需要交互输入"),a("code",[s._v("yes")]),s._v("， 解决的方法有两种")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("一种是在gitlab-ci runner 服务器上使用gitlab-runner用户手动git clone git@gitlab.9xkd.com:yinhuanyi/xkd_course.git， 交互下输入yes\n\n第二种是在gitlab-ci runner 服务器上修改/etc/ssh/ssh_config文件，把 StrictHostKeyChecking ask 这一项改为 StrictHostKeyChecking no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("4：将gitlab服务器中的xkd_course仓库中提交"),a("code",[s._v(".gitlab-ci.yml")]),s._v("文件")]),s._v(" "),a("li",[s._v("5：查看任务运行的job状态")]),s._v(" "),a("li",[s._v("6："),a("strong",[a("code",[s._v("提示：最好是将clone这个stage写成一个shell脚本，将这个脚本添加到gitlab-runner的环境变量PATH里面，脚本里面需要判断是否这个/app/xkd_course仓库已经存在，如果不存在，那么直接git clone。如果存在，那么说明remote版本库中的master分支代码变化了，需要先将remote的代码pull到本地，直接git pull 即可")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);