(window.webpackJsonp=window.webpackJsonp||[]).push([[559],{2573:function(n,s,e){"use strict";e.r(s);var a=e(9),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h3",{attrs:{id:"一-python-table-api-介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-python-table-api-介绍"}},[n._v("#")]),n._v(" 一：Python Table API 介绍")]),n._v(" "),e("h3",{attrs:{id:"一-python-table-api程序的通用结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-python-table-api程序的通用结构"}},[n._v("#")]),n._v(" (一)：Python Table API程序的通用结构")]),n._v(" "),e("ul",[e("li",[n._v("从Kafka接入，再写入Kafka")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("from pyflink.table import EnvironmentSettings, StreamTableEnvironment\n\n# 1：获取环境\nenv_settings = EnvironmentSettings.new_instance().in_streaming_mode().use_blink_planner().build()\n# 2：创建流table环境\ntable_env = StreamTableEnvironment.create(environment_settings=env_settings)\n\n# 3：添加依赖\nbase_dir = \"file:///Users/yinhuanyi/jar/\"\nkafka_jar = f\"{base_dir}flink-sql-connector-kafka-0.11_2.11-1.11.1.jar\"\njson_format_jar = f\"{base_dir}flink-json-1.11.1.jar\"\ntable_common_jar = f\"{base_dir}flink-table-common-1.11.1.jar\"\njar_seq = [kafka_jar, json_format_jar, table_common_jar]\njars = \";\".join(jar_seq)\ntable_env.get_config().get_configuration().set_string(\"pipeline.jars\", jars)\n\n# 4：定义数据source sql\nsource_ddl = '''\n             CREATE TABLE kafka_source ( message STRING ) \n             WITH ( 'connector' = 'kafka-0.11', \n                    'topic' = 'seal', \n                    'properties.bootstrap.servers' = '10.102.0.13:9092', \n                    'format' = 'json', \n                    'scan.startup.mode' = 'latest-offset')\n             '''\n\n# 5：定义数据sink sql\nsink_ddl = '''\n           CREATE TABLE kafka_sink ( message STRING ) \n           WITH ('connector' = 'kafka-0.11',\n                 'topic' = 'flinkTest',\n                 'properties.bootstrap.servers' = '10.102.0.13:9092',\n                 'properties.group.id' = 'testGroup',\n                 'format' = 'json',\n                 'scan.startup.mode' = 'latest-offset')\n           '''\n\n# 6：注册source和sink\ntable_env.execute_sql(source_ddl)\ntable_env.execute_sql(sink_ddl)\n\n# 7：table api获取数据表\nsource_table1 = table_env.from_path(\"kafka_source\")\n\n# 7：sql api获取数据表\n# source_table2 = table_env.sql_query(\"SELECT * FROM kafka_source\")\n\n\n# 8：算子函数计算\nresult_table = source_table1.select(\"message\")\n\n# 9：基于table api写入到sink\nresult_table.execute_insert('kafka_sink').get_job_client().get_job_execution_result().result()\n\n# 9：基于sql写入到sin\n# table_env.execute_sql(\"INSERT INTO kafka_sink SELECT * FROM kafka_source\").get_job_client().get_job_execution_result().result()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br"),e("span",{staticClass:"line-number"},[n._v("51")]),e("br"),e("span",{staticClass:"line-number"},[n._v("52")]),e("br"),e("span",{staticClass:"line-number"},[n._v("53")]),e("br"),e("span",{staticClass:"line-number"},[n._v("54")]),e("br"),e("span",{staticClass:"line-number"},[n._v("55")]),e("br"),e("span",{staticClass:"line-number"},[n._v("56")]),e("br")])]),e("ul",[e("li",[n._v("从Kafka接入，打印到标准输出(方便调试)")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("from pyflink.table import EnvironmentSettings, StreamTableEnvironment\n\n# 1：获取环境\nenv_settings = EnvironmentSettings.new_instance().in_streaming_mode().use_blink_planner().build()\n# 2：创建流table环境\ntable_env = StreamTableEnvironment.create(environment_settings=env_settings)\n\n# 3：添加依赖\nbase_dir = \"file:///Users/yinhuanyi/jar/\"\nkafka_jar = f\"{base_dir}flink-sql-connector-kafka-0.11_2.11-1.11.1.jar\"\njson_format_jar = f\"{base_dir}flink-json-1.11.1.jar\"\ntable_common_jar = f\"{base_dir}flink-table-common-1.11.1.jar\"\njar_seq = [kafka_jar, json_format_jar, table_common_jar]\njars = \";\".join(jar_seq)\ntable_env.get_config().get_configuration().set_string(\"pipeline.jars\", jars)\n\n# 4：定义数据source sql\nsource_ddl = '''\n             CREATE TABLE kafka_source ( message STRING ) \n             WITH ( 'connector' = 'kafka-0.11', \n                    'topic' = 'seal', \n                    'properties.bootstrap.servers' = '10.102.0.13:9092', \n                    'format' = 'json', \n                    'scan.startup.mode' = 'latest-offset')\n             '''\n\n# 5：定义数据print sqql\nsink_ddl = '''\n           CREATE TABLE print_table (f0 STRING) WITH ( 'connector' = 'print')\n           '''\n\n# 6：注册source和sink\ntable_env.execute_sql(source_ddl)\ntable_env.execute_sql(sink_ddl)\n\n# 7：table api获取数据表\nsource_table1 = table_env.from_path(\"kafka_source\")\n\n\n# 8：算子函数计算\nresult_table = source_table1.select(\"message\")\n\n# 9：基于table api写入到sink\nresult_table.execute_insert('print_table').get_job_client().get_job_execution_result().result()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br")])]),e("h3",{attrs:{id:"二-创建tableenvironment的几种方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-创建tableenvironment的几种方式"}},[n._v("#")]),n._v(" (二)：创建TableEnvironment的几种方式")]),n._v(" "),e("ul",[e("li",[n._v("创建不同的执行环境")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("from pyflink.table import EnvironmentSettings, StreamTableEnvironment, BatchTableEnvironment\n\n# create a blink streaming TableEnvironment\nenv_settings = EnvironmentSettings.new_instance().in_streaming_mode().use_blink_planner().build()\ntable_env = StreamTableEnvironment.create(environment_settings=env_settings)\n\n# create a blink batch TableEnvironment\nenv_settings = EnvironmentSettings.new_instance().in_batch_mode().use_blink_planner().build()\ntable_env = BatchTableEnvironment.create(environment_settings=env_settings)\n\n# create a flink streaming TableEnvironment\nenv_settings = EnvironmentSettings.new_instance().in_streaming_mode().use_old_planner().build()\ntable_env = StreamTableEnvironment.create(environment_settings=env_settings)\n\n# create a flink batch TableEnvironment\nenv_settings = EnvironmentSettings.new_instance().in_batch_mode().use_old_planner().build()\ntable_env = BatchTableEnvironment.create(environment_settings=env_settings)\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br")])]),e("ul",[e("li",[n._v("TableEnvironment对如下过程产生作用")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("1:Creating Tables：创建表\n\n2:Registering Tables as a temporary view：创建零时表\n\n3:Executing SQL queries, see SQL for more details：执行SQL查询\n\n4:Registering user-defined (scalar, table, or aggregation) functions, see General User-defined Functions and Vectorized User-defined Functions for more details：注册UDF\n\n5:Configuring the job, see Python Configuration for more details：配置任务\n\n6:Managing Python dependencies, see Dependency Management for more details：管理Python文件依赖\n\n7:Submitting the jobs for execution：提交任务执行\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br")])]),e("h3",{attrs:{id:"三-创建表对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-创建表对象"}},[n._v("#")]),n._v(" (三)：创建表对象")]),n._v(" "),e("ul",[e("li",[n._v("从列表中创建表")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("from pyflink.table import EnvironmentSettings, BatchTableEnvironment\n\nenv_settings = EnvironmentSettings.new_instance().in_batch_mode().use_blink_planner().build()\ntable_env = BatchTableEnvironment.create(environment_settings=env_settings)\n\ntable = table_env.from_elements([(1, 'Hi'), (2, 'Hello')])\ntable.to_pandas()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br")])]),e("ul",[e("li",[n._v("也可以在创建表的时候，指定字段名称")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("# 这里的id,data就是字段名称\ntable = table_env.from_elements([(1, 'Hi'), (2, 'Hello')], ['id', 'data'])\ntable.to_pandas()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br")])]),e("ul",[e("li",[n._v("可以手动修改字段数据类型")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("from pyflink.table import DataTypes\nfrom pyflink.table import DataTypes\n# 指定id字段的数据类型是TINYINT，data的字段类型是STRING\ntable = table_env.from_elements([(1, 'Hi'), (2, 'Hello')], \n                                DataTypes.ROW([DataTypes.FIELD(\"id\", DataTypes.TINYINT()), DataTypes.FIELD(\"data\", DataTypes.STRING())]))\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br")])]),e("ul",[e("li",[n._v("从连接器中获取数据")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("# create a blink stream TableEnvironment\nfrom pyflink.table import EnvironmentSettings, StreamTableEnvironment\n\nenv_settings = EnvironmentSettings.new_instance().in_streaming_mode().use_blink_planner().build()\ntable_env = StreamTableEnvironment.create(environment_settings=env_settings)\n\ntable_env.execute_sql(\"\"\"\n    CREATE TABLE random_source (\n        id BIGINT, \n        data TINYINT \n    ) WITH (\n        'connector' = 'datagen',\n        'fields.id.kind'='sequence',\n        'fields.id.start'='1',\n        'fields.id.end'='3',\n        'fields.data.kind'='sequence',\n        'fields.data.start'='4',\n        'fields.data.end'='6'\n    )\n\"\"\")\ntable = table_env.from_path(\"random_source\")\ntable.to_pandas()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br")])]),e("h3",{attrs:{id:"四-table-api-queries"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-table-api-queries"}},[n._v("#")]),n._v(" (四)：Table API Queries")]),n._v(" "),e("ul",[e("li",[n._v("Table API算子")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("from pyflink.table import EnvironmentSettings, BatchTableEnvironment\n\nenv_settings = EnvironmentSettings.new_instance().in_batch_mode().use_blink_planner().build()\ntable_env = BatchTableEnvironment.create(environment_settings=env_settings)\n\norders = table_env.from_elements([('Jack', 'FRANCE', 10), ('Rose', 'ENGLAND', 30), ('Jack', 'FRANCE', 20)],\n                                 ['name', 'country', 'revenue'])\n\n# compute revenue for all customers from France\nrevenue = orders \\\n    .select(\"name, country, revenue\") \\\n    .where(\"country === 'FRANCE'\") \\\n    .group_by(\"name\") \\\n    .select(\"name, revenue.sum AS rev_sum\")\n    \nrevenue.to_pandas()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br")])]),e("ul",[e("li",[n._v("SQL")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("from pyflink.table import EnvironmentSettings, StreamTableEnvironment\n\nenv_settings = EnvironmentSettings.new_instance().in_streaming_mode().use_blink_planner().build()\ntable_env = StreamTableEnvironment.create(environment_settings=env_settings)\n\n\ntable_env.execute_sql(\"\"\"\n    CREATE TABLE random_source (\n        id BIGINT, \n        data TINYINT\n    ) WITH (\n        'connector' = 'datagen',\n        'fields.id.kind'='sequence',\n        'fields.id.start'='1',\n        'fields.id.end'='8',\n        'fields.data.kind'='sequence',\n        'fields.data.start'='4',\n        'fields.data.end'='11'\n    )\n\"\"\")\n\ntable_env.execute_sql(\"\"\"\n    CREATE TABLE print_sink (\n        id BIGINT, \n        data_sum TINYINT \n    ) WITH (\n        'connector' = 'print'\n    )\n\"\"\")\n\ntable_env.execute_sql(\"\"\"\n    INSERT INTO print_sink\n        SELECT id, sum(data) as data_sum FROM \n            (SELECT id / 2 as id, data FROM random_source)\n        WHERE id > 1\n        GROUP BY id\n\"\"\").get_job_client().get_job_execution_result().result()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br")])]),e("h3",{attrs:{id:"_5-table-api-和-sql的混合使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-table-api-和-sql的混合使用"}},[n._v("#")]),n._v(" (5)：Table API 和 SQL的混合使用")]),n._v(" "),e("ul",[e("li",[n._v("Table API转SQL")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("table_env.execute_sql(\"\"\"\n    CREATE TABLE table_sink (\n        id BIGINT, \n        data VARCHAR \n    ) WITH (\n        'connector' = 'print'\n    )\n\"\"\")\n\n# convert the Table API table to a SQL view\ntable = table_env.from_elements([(1, 'Hi'), (2, 'Hello')], ['id', 'data'])\ntable_env.create_temporary_view('table_api_table', table)\n\n# emit the Table API table\ntable_env.execute_sql(\"INSERT INTO table_sink SELECT * FROM table_api_table\") \\\n    .get_job_client().get_job_execution_result().result()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br")])]),e("ul",[e("li",[n._v("SQL转Table API")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("# create a sql source table\ntable_env.execute_sql(\"\"\"\n    CREATE TABLE sql_source (\n        id BIGINT, \n        data TINYINT \n    ) WITH (\n        'connector' = 'datagen',\n        'fields.id.kind'='sequence',\n        'fields.id.start'='1',\n        'fields.id.end'='4',\n        'fields.data.kind'='sequence',\n        'fields.data.start'='4',\n        'fields.data.end'='7'\n    )\n\"\"\")\n\n# convert the sql table to Table API table\ntable = table_env.from_path(\"sql_source\")\n\n# or create the table from a sql query\ntable = table_env.sql_query(\"SELECT * FROM sql_source\")\n\n# emit the table\ntable.to_pandas()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br")])]),e("h3",{attrs:{id:"_6-将数据结果sink到表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-将数据结果sink到表"}},[n._v("#")]),n._v(" (6)：将数据结果sink到表")]),n._v(" "),e("ul",[e("li",[n._v("sink到一张表")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("table_env.execute_sql(\"\"\"\n    CREATE TABLE sink_table (\n        id BIGINT, \n        data VARCHAR \n    ) WITH (\n        'connector' = 'print'\n    )\n\"\"\")\n\ntable = table_env.from_elements([(1, 'Hi'), (2, 'Hello')], ['id', 'data'])\ntable.execute_insert(\"sink_table\").get_job_client().get_job_execution_result().result()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br")])]),e("ul",[e("li",[n._v("也可以使用SQL")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('table_env.create_temporary_view("table_source", table)\ntable_env.execute_sql("INSERT INTO sink_table SELECT * FROM table_source") \\\n    .get_job_client().get_job_execution_result().result()\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br")])]),e("ul",[e("li",[n._v("sink到多张表")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('# prepare source tables and sink tables\ntable = table_env.from_elements([(1, \'Hi\'), (2, \'Hello\')], [\'id\', \'data\'])\ntable_env.create_temporary_view("simple_source", table)\ntable_env.execute_sql("""\n    CREATE TABLE first_sink_table (\n        id BIGINT, \n        data VARCHAR \n    ) WITH (\n        \'connector\' = \'print\'\n    )\n""")\ntable_env.execute_sql("""\n    CREATE TABLE second_sink_table (\n        id BIGINT, \n        data VARCHAR\n    ) WITH (\n        \'connector\' = \'print\'\n    )\n""")\n\n# create a statement set\nstatement_set = table_env.create_statement_set()\n\n# emit the "table" object to the "first_sink_table"\n# \nstatement_set.add_insert("first_sink_table", table)\n\n# emit the "simple_source" to the "second_sink_table" via a insert sql query\nstatement_set.add_insert_sql("INSERT INTO second_sink_table SELECT * FROM simple_source")\n\n# execute the statement set\nstatement_set.execute().get_job_client().get_job_execution_result().result()\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);