(window.webpackJsonp=window.webpackJsonp||[]).push([[485],{2454:function(s,n,a){"use strict";a.r(n);var e=a(9),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-sqlalchemy的封装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-sqlalchemy的封装"}},[s._v("#")]),s._v(" 一：SQLAlchemy的封装")]),s._v(" "),a("h3",{attrs:{id:"一-思考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-思考"}},[s._v("#")]),s._v(" （一）思考")]),s._v(" "),a("ul",[a("li",[s._v("每次对Model的一次操作，需要经历9个步骤，比较繁琐，存在如下几个问题：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy import Column, BigInteger, String, create_engine\nfrom sqlalchemy.orm import sessionmaker\n\n# 1:创建一个基类\nBase = declarative_base()\n\n# 2:定义Model类\nclass Test(Base):\n    __tablename__ == 'test'\n    id = Column(BigInteger, primary_key=True)\n    name = Column(String(128))\n\n# 3:初始化数据库连接\nengine = create_engine('mysql+pymysql://root:password@localhost:3306/db_name')\n\n# 4:创建一个session类型\nDBSession = sessionmaker(bind=engine)\n\n# 5:创建一个session对象\nsession = DBSession()\n\n# 6:创建一个Test对象\nt = Test(id=1, name='abc')\n\ntry:\n    # 7:添加到session中\n    session.add(t)\n    # 8:提交保存到数据库\n    session.commit()\nexcept Exception as e:\n    session.rollback()\n    raise e\nfinally:\n    if session:\n        # 9:关闭session\n        session.close()\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("ul",[a("li",[s._v("以上代码的存在的问题")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1: 如果要连接一个新的数据库，对一个model的一次操作从第3步开始都需要重写一次，比较烦\n\n2：针对session的提交、异常回滚、关闭Model操作都要关心，造成了冗余代码\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("针对上面存在的问题，提出解决方法")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：如果代码里需要新增一个数据库访问，仅仅就是加下这个数据库的配置就行，数据库连接自动帮我创建好了\n\n2：有一个统一的地方帮我处理session的提交、异常回滚、关闭，我完全不需要去关注这些重复的操作\n\n3：在代码里拿到这个Model后就可以操作了，连session都不用关心\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);