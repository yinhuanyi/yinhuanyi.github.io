(window.webpackJsonp=window.webpackJsonp||[]).push([[450],{2374:function(s,e,a){"use strict";a.r(e);var n=a(9),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-scrapy-图片路径存储且item的json化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-scrapy-图片路径存储且item的json化"}},[s._v("#")]),s._v(" 一：Scrapy 图片路径存储且item的json化")]),s._v(" "),a("h3",{attrs:{id:"一-在pipline中重写item-completed方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-在pipline中重写item-completed方法"}},[s._v("#")]),s._v(" （一）：在pipline中重写item_completed方法")]),s._v(" "),a("ul",[a("li",[s._v("在ImagePipeline中重写item_completed方法获取图片的保存路径")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class ImagePipeline(ImagesPipeline):\n    def file_path(self, request, response=None, info=None):\n        ## start of deprecation warning block (can be removed in the future)\n        def _warn():\n            from scrapy.exceptions import ScrapyDeprecationWarning\n            import warnings\n            warnings.warn('ImagesPipeline.image_key(url) and file_key(url) methods are deprecated, '\n                          'please use file_path(request, response=None, info=None) instead',\n                          category=ScrapyDeprecationWarning, stacklevel=1)\n\n        # check if called from image_key or file_key with url as first argument\n        if not isinstance(request, Request):\n            _warn()\n            url = request\n        else:\n            url = request.url\n\n        # detect if file_key() or image_key() methods have been overridden\n        if not hasattr(self.file_key, '_base'):\n            _warn()\n            return self.file_key(url)\n        elif not hasattr(self.image_key, '_base'):\n            _warn()\n            return self.image_key(url)\n        ## end of deprecation warning block\n\n        image_guid = hashlib.sha1(to_bytes(url)).hexdigest()  # change to request.url after deprecation\n\n\n\n        # 修改为时间为目录\n        return '{}/{}.jpg'.format(datetime.now().year,image_guid)\n\n\n    def item_completed(self, results, item, info):\n\n        # 获取图片地址保存到列表中\n        values = [value['path'] for ok, value in results if ok]\n\n        # 给item赋值\n        item['image_path'] = values.pop(0) if values else 'default.jpg'\n\n        return item\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("h3",{attrs:{id:"二-创建md5函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-创建md5函数"}},[s._v("#")]),s._v(" （二）：创建md5函数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from hashlib import md5\n\ndef get_md5(url):\n    if isinstance(url, str):\n        # 先转化为字节码\n        url = url.encode()\n        print(url)\n\n    obj = md5()\n    obj.update(url)\n    return obj.hexdigest()\n\n\nif __name__ == '__main__':\n    print(get_md5('www.baidu.com'))\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"三-在item中添加字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-在item中添加字段"}},[s._v("#")]),s._v(" （三）：在item中添加字段")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import scrapy\n\n\n\nclass XkdDribbbleSpiderItem(scrapy.Item):\n\n    title = scrapy.Field()\n    image_url = scrapy.Field()\n    date = scrapy.Field()\n\n    # 添加图片路径到item中\n    image_path = scrapy.Field()\n    # 加页面的url地址添加到item中\n    url = scrapy.Field()\n    # 添加url的哈希值字段\n    url_id = scrapy.Field()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"四-将item在spider中返回"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-将item在spider中返回"}},[s._v("#")]),s._v(" （四）：将item在spider中返回")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import scrapy\nfrom urllib import parse\nfrom scrapy.http import Request\nfrom datetime import datetime\nfrom ..items import XkdDribbbleSpiderItem\nfrom ..utils.md5_tool import get_md5\n\nclass DribbbleSpider(scrapy.Spider):\n    name = 'dribbble'\n    allowed_domains = ['dribbble.com']\n    start_urls = ['https://dribbble.com/stories']\n\n\n    def parse(self, response):\n        # 获取a标签的url值\n        # selector\n        a_selectors = response.css('div.teaser a')\n\n        for a_selector in a_selectors:\n            image_url = a_selector.css('img::attr(src)').extract()[0]\n            page_url = a_selector.css('::attr(href)').extract()[0]\n\n            yield Request(url=parse.urljoin(response.url, page_url), callback=self.parse_analyse,meta={'a_image_url': image_url})\n\n\n    def parse_analyse(self, response):\n        title = response.css('header h1::text').extract_first()\n        image_url = response.meta.get('a_image_url')\n        date_raw = response.css('p span.date::text').extract()[0]\n        date_str = date_raw.strip()\n        date = datetime.strptime(date_str, '%b %d, %Y').date()\n\n        item = XkdDribbbleSpiderItem()\n\n        item['title'] = title\n        item['image_url'] = [image_url]\n        item['date'] = date\n        item['url'] = response.url\n        item['url_id'] = get_md5(response.url)\n\n        # item数据模型进行落地，数据持久化\n        yield item\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("h3",{attrs:{id:"五-创建jsonsavepipeline-用于写入item到文件中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-创建jsonsavepipeline-用于写入item到文件中"}},[s._v("#")]),s._v(" （五）：创建JsonSavePipeline，用于写入item到文件中")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import codecs\nimport json\n\nclass JsonSavePipeline:\n\n    def process_item(self, item, spider):\n        # 将spider中返回的item转化为字典\n        file = codecs.open('blog.json', mode='a')\n        dict_item = dict(item)\n        # 将字典json化\n        line = json.dumps(dict_item, ensure_ascii=False) + '\\n'\n        # 写入到文件\n        file.write(line)\n        # 再次返回item\n\n        file.close()\n        return item\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"六-在settings文件中添加jsonsavepipeline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六-在settings文件中添加jsonsavepipeline"}},[s._v("#")]),s._v(" （六）：在settings文件中添加JsonSavePipeline")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("'XKD_Dribbble_Spider.pipelines.JsonSavePipeline': 2,\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"七-将date从datetime类型转换为字符串类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七-将date从datetime类型转换为字符串类型"}},[s._v("#")]),s._v(" （七）：将date从datetime类型转换为字符串类型")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("由于datetime对象无法json化，因此必须使用字符串类型\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("json文件如下")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{"title": "10 Tips from team Dribbble for WFH success", "image_url": ["https://cdn.dribbble.com/users/1109696/screenshots/6117020/work_space.png"], "date": "Apr 10, 2019", "url": "https://dribbble.com/stories/2019/04/10/10-tips-from-team-dribbble-for-wfh-success", "url_id": "6b28fc70b2e37a648bcb58d37cf97336", "image_path": "2019/5df96a0069d98acbb2112718669c2779202a4ecf.jpg"}\n{"title": "Career change inspiration: From Graphic Designer to Illustrator ", "image_url": ["https://cdn.dribbble.com/users/1136162/screenshots/4880957/aquatic.gif"], "date": "Apr 22, 2019", "url": "https://dribbble.com/stories/2019/04/22/career-change-inspiration-from-graphic-designer-to-illustrator", "url_id": "878b9b6be80b927d3a0098be92bc6d47", "image_path": "2019/e7bcbe9059ac3c11895c6fdc9e6e9768a37f36f5.jpg"}\n{"title": "Design a prototype in Adobe XD using their curated Fonts pack and you could win big! ", "image_url": ["https://cdn.dribbble.com/users/2254924/screenshots/6283328/adobexd-fonts-project-dribbble-movie.png"], "date": "Apr 12, 2019", "url": "https://dribbble.com/stories/2019/04/12/design-a-prototype-in-adobe-xd-using-a-curated-fonts-pack-and-you-could-win-big", "url_id": "805948c2c9dd739ee19460504d2ba8c7", "image_path": "2019/dd959b770994d7d4dd51dd1ecbca919802497b0a.jpg"}\n{"title": "How to score a Dribbble invite: 4 Tips for getting drafted ", "image_url": ["https://cdn.dribbble.com/uploads/1049/original/b64ac4717c1c62e98f81300a21df6f1e.png?1554663790"], "date": "Apr 8, 2019", "url": "https://dribbble.com/stories/2019/04/08/how-to-score-a-dribbble-invite-4-tips-for-getting-drafted", "url_id": "a98bc33a16dc0bcfe4870f404275e53b", "image_path": "2019/2c7af0339e96ebe99be7dda3ca66f2b101a8cc5f.jpg"}\n{"title": "Get an inside look at design life in Houston, Texas ", "image_url": ["https://cdn.dribbble.com/users/26878/screenshots/6300861/dribbble_meetup_-_final.jpg"], "date": "Apr 9, 2019", "url": "https://dribbble.com/stories/2019/04/09/get-an-inside-look-at-design-life-in-houston-texas", "url_id": "336889a1d4d3c41af42b5809920f433a", "image_path": "2019/226169824f085b2c57dd73c561ded086372e37fd.jpg"}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);