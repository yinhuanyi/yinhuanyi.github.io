(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{1702:function(s,t,a){s.exports=a.p+"assets/img/GitLab.93622de3.png"},1703:function(s,t,a){s.exports=a.p+"assets/img/2020-04-141.49.45.df023c2a.png"},2667:function(s,t,a){"use strict";a.r(t);var n=a(9),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"一-gitlab-ci安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-gitlab-ci安装"}},[s._v("#")]),s._v(" （一）gitlab-ci安装")]),s._v(" "),n("h4",{attrs:{id:"_1-gitlab-ci-服务器的搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-gitlab-ci-服务器的搭建"}},[s._v("#")]),s._v(" 1：GitLab CI 服务器的搭建")]),s._v(" "),n("ul",[n("li",[s._v("准备好一台GitLab CI服务器且与Gitlab服务器在同一内网")])]),s._v(" "),n("h4",{attrs:{id:"_2-安装gitlab-ci-runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装gitlab-ci-runner"}},[s._v("#")]),s._v(" 2. 安装gitlab ci runner")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash\nyum install -y gitlab-ci-multi-runner \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("查看gitlab-ci是否运行")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gitlab-ci-multi-runner status\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("为后面实现gitlab-ci启动docker，所以安装docker")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -sSL https://get.docker.com/ | sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"_3-设置docker权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-设置docker权限"}},[s._v("#")]),s._v(" 3. 设置Docker权限")]),s._v(" "),n("p",[s._v("为了能让gitlab-runner能正确的执行docker命令，需要把gitlab-runner用户添加到docker group里, 然后重启docker和gitlab ci runner")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("usermod -aG docker gitlab-runner\nsystemctl restart docker.service\ngitlab-ci-multi-runner restart\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("将gitlab runner 注册到gitlab中，使得gitlab知道代码仓库变更的时候能够触发runner去执行任务")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gitlab-ci-multi-runner --help  # 查看帮助\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("执行"),n("code",[s._v("gitlab-ci-multi-runner register")]),s._v(" 之前需要将gitlab.9xkd.com解析到/etc/hosts文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("192.168.199.147    gitlab.9xkd.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("执行"),n("code",[s._v("gitlab-ci-multi-runner register")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@gitlab-ci ~]# gitlab-ci-multi-runner register\nRunning in system-mode.                            \n                                                   \nPlease enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):\nhttp://gitlab.9xkd.com/\nPlease enter the gitlab-ci token for this runner:\nBLrjfEfpDMdastyW_qqA\nPlease enter the gitlab-ci description for this runner:\n[gitlab-ci]: this is a xkd runner\nPlease enter the gitlab-ci tags for this runner (comma separated):\nxkd,demo\nWhether to run untagged builds [true/false]:\n[false]: \nWhether to lock Runner to current project [true/false]:\n[false]: \nRegistering runner... succeeded                     runner=BLrjfEfp           \nPlease enter the executor: docker-ssh, parallels, docker+machine, docker-ssh+machine, kubernetes, docker, ssh, virtualbox, shell:\nshell    \nRunner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded! \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("token在对应的项目中查找\n"),n("img",{attrs:{src:a(1702),alt:"Alt text"}})])]),s._v(" "),n("li",[n("p",[s._v("再注册完毕之后，你会发现在runner的setting中有一个runner，且tag是test, demo， 这就说明runner 注册成功\n"),n("img",{attrs:{src:a(525),alt:"Alt text"}})])]),s._v(" "),n("li",[n("p",[s._v("在hello_world这个项目里面创建一个.gitlab-ci.yml文件，用于定义pipeline（语法格式在CI/CD的pipeline中有详细的说明）， 只要一提交这个yml文件，任务就会在指定的runner上运行")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v(".gitlab-ci.yml文件书写方式")])])])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义pipeline运行的阶段, 定义三个阶段，一个是build, 一个test， 一个deploy")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义第一个任务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里的tags必须指定， 如果不指定，那么这个job就不知道在哪个runner上去执行，因为前面已经将一个runner绑定到gitlab上了，因此，这里直接指定就好了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" xkd  \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "我是job1"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "我在build stage"\n\n'),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二个任务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" xkd \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "我是job2"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "我在test stage"\n\n'),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第三个任务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" xkd \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "我是job3"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "我在deploy stage"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("在hello_world这个仓库里面，将.gitlab-ci.yml提交到远程仓库\n"),n("img",{attrs:{src:a(525),alt:"Alt text"}})])]),s._v(" "),n("li",[n("p",[s._v("查看在这个项目中，查看pipeline的结果")])])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1703),alt:"Alt text"}})])])}),[],!1,null,null,null);t.default=e.exports},525:function(s,t,a){s.exports=a.p+"assets/img/2018-08-287.16.41.4b5d8632.png"}}]);