(window.webpackJsonp=window.webpackJsonp||[]).push([[329],{2140:function(s,n,t){"use strict";t.r(n);var e=t(9),a=Object(e.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"一-consul服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-consul服务"}},[s._v("#")]),s._v(" 一：Consul服务")]),s._v(" "),t("h3",{attrs:{id:"一-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-介绍"}},[s._v("#")]),s._v(" (一)：介绍")]),s._v(" "),t("ul",[t("li",[s._v("Consul具有哪些特点")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\t服务发现（Service Discovery）：Consul提供了通过DNS或者HTTP接口的方式来注册服务和发现服务。一些外部的服务通过Consul很容易的找到它所依赖的服务。\n\n\t健康检查（Health Checking）：Consul的Client可以提供任意数量的健康检查，既可以与给定的服务相关联(“webserver是否返回200 OK”)，也可以与本地节点相关联(“内存利用率是否低于90%”)。操作员可以使用这些信息来监视集群的健康状况，服务发现组件可以使用这些信息将流量从不健康的主机路由出去。\n\n\tKey/Value存储：应用程序可以根据自己的需要使用Consul提供的Key/Value存储。 Consul提供了简单易用的HTTP接口，结合其他工具可以实现动态配置、功能标记、领袖选举等等功能。\n\t\n安全服务通信：Consul可以为服务生成和分发TLS证书，以建立相互的TLS连接。意图可用于定义允许哪些服务通信。服务分割可以很容易地进行管理，其目的是可以实时更改的，而不是使用复杂的网络拓扑和静态防火墙规则。\n\n\t多数据中心：Consul支持开箱即用的多数据中心. 这意味着用户不需要担心需要建立额外的抽象层让业务扩展到多个区域。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("Consul的使用场景")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\t服务发现场景中consul作为注册中心，服务地址被注册到consul中以后，可以使用consul提供的dns、http接口查询，consul支持health check\n\n\t服务隔离场景中consul支持以服务为单位设置访问策略，能同时支持经典的平台和新兴的平台，支持tls证书分发，service-to-service加密\n\n\t服务配置场景中consul提供key-value数据存储功能，并且能将变动迅速地通知出去，借助Consul可以实现配置共享，需要读取配置的服务可以从Consul中读取到准确的配置信息\n\n\tConsul可以帮助系统管理者更清晰的了解复杂系统内部的系统架构，运维人员可以将Consul看成一种监控软件，也可以看成一种资产（资源）管理系统\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"二-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-安装"}},[s._v("#")]),s._v(" (二)：安装")]),s._v(" "),t("ul",[t("li",[s._v("启动")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# consul agent -dev -client='0.0.0.0' 是执行命令\ndocker run -d -p 8500:8500 -p 8300:8300 -p 8302:8302 -p 8600:8600/udp consul consul agent -dev -client='0.0.0.0'\n\n# 让访问挂掉可以自动启动\ndocker container update --restart=always 【容器的ID】\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("consul主要的两个端口")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("8500：http的web页面端口\n8600：dns解析端口\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("服务DNS")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("dig @192.168.100.203 -p 8600 consul.service.consul SRV\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"三-服务注册"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三-服务注册"}},[s._v("#")]),s._v(" (三)：服务注册")]),s._v(" "),t("ul",[t("li",[s._v("go web层注册")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：基于user service在consul中的name，获取访问的IP和端口\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("user service层注册")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1：基于grpc提供一个健康检查的通用handler，将handler绑定到server上\n\n2：将user-srv服务注册到consul中\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"二-关于注册接口的设计思想"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-关于注册接口的设计思想"}},[s._v("#")]),s._v(" 二：关于注册接口的设计思想")]),s._v(" "),t("h3",{attrs:{id:"一-注册接口原始版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-注册接口原始版本"}},[s._v("#")]),s._v(" (一)：注册接口原始版本")]),s._v(" "),t("ul",[t("li",[s._v("在register.go中")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/**\n * @Author: Robby\n * @File name: register.go\n * @Create date: 2021-06-21\n * @Function:  把这个记录到笔记中： 这是go语言接口设计的思想\n **/\n\npackage consul\n\nimport (\n\t"fmt"\n\t"github.com/hashicorp/consul/api"\n)\n\n// Registry 这个结构是consul的地址\ntype Registry struct{\n\tHost string\n\tPort int\n}\n\n// NewRegistryClient 这个是register的构造方法, 本来是返回一个接口类型，但是返回了一个结构体指针，奥秘在于这个结构体实现了接口的方法，那么就可以被返回。因此：任何实现了RegistryClient接口方法的结构体都可以被返回\nfunc NewRegistryClient(host string, port int) RegistryClient{\n\treturn &Registry{\n\t\tHost: host,\n\t\tPort: port,\n\t}\n}\n\n// RegistryClient 接口\ntype RegistryClient interface {\n\tRegister(address string, port int, name string, tags []string, id string) error\n\tDeRegister(serviceId string) error\n}\n\n// Register 注册web访问到consul\nfunc (r *Registry)Register(host string, port int, name string, tags []string, id string) error {\n\tcfg := api.DefaultConfig()  // 创建consul的配置\n\tcfg.Address = fmt.Sprintf("%s:%d", r.Host, r.Port)\n\n\tclient, err := api.NewClient(cfg)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t//生成对应的检查对象\n\tcheck := &api.AgentServiceCheck{\n\t\tHTTP: fmt.Sprintf("http://%s:%d/health", host, port),\n\t\tTimeout: "5s",\n\t\tInterval: "5s",\n\t\tDeregisterCriticalServiceAfter: "10s",\n\t}\n\n\t//生成注册对象\n\tregistration := new(api.AgentServiceRegistration)\n\tregistration.Name = name\n\tregistration.ID = id\n\tregistration.Port = port\n\tregistration.Tags = tags\n\tregistration.Address = host\n\tregistration.Check = check\n\n\terr = client.Agent().ServiceRegister(registration)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn nil\n}\n\n// DeRegister 注销web访问到consul\nfunc (r *Registry)DeRegister(serviceId string) error{\n\tcfg := api.DefaultConfig()\n\tcfg.Address = fmt.Sprintf("%s:%d", r.Host, r.Port)\n\n\tclient, err := api.NewClient(cfg)\n\tif err != nil {\n\t\treturn err\n\t}\n\terr = client.Agent().ServiceDeregister(serviceId)\n\treturn err\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br")])]),t("ul",[t("li",[s._v("外部调用方式")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("// 返回一个结构体对象\nregisterClient := consul.NewRegistryClient(global.Conf.ConsulConfig.Host, global.Conf.ConsulConfig.Port) \n\n// 调用结构体方法，实现服务注册\nserviceId := uuid.NewV4().String() // 创建web的uuid\nerr := registerClient.Register(global.Conf.Host,\n\t\t\t\t\t\t\t\tglobal.Conf.Port,\n\t\t\t\t\t\t\t\tglobal.Conf.Name,\n\t\t\t\t\t\t\t\tglobal.Conf.Tags,\n\t\t\t\t\t\t\t\tserviceId)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("存在的设计问题")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("这样设计，外界调用注册方法NewRegistryClient的时候，无法知道需要实现什么方法\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("思考：是否可以向sort.Sort(s ) 函数一样，传递的s参数必须实现三个方法，Len( )、Less( )、Swap( ) 三个方法")])]),s._v(" "),t("h3",{attrs:{id:"二-注册接口改进版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二-注册接口改进版本"}},[s._v("#")]),s._v(" (二)：注册接口改进版本")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("将register.go文件，拆分为两个文件")])]),s._v(" "),t("li",[t("p",[s._v("register.go （这里只是判断client是否满足Register接口，也就是说是否实现了接口的方法）")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("// NewRegistryClient 这里是判断是否client实现了Register，DeRegister两个方法\nfunc NewRegistryClient(client RegistryClient) RegistryClient {\n\treturn client\n}\n\n// RegistryClient 接口\ntype RegistryClient interface {\n\tRegister(address string, port int, name string, tags []string, id string) error\n\tDeRegister(serviceId string) error\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("consul_register.go(这里相当于是自己写的结构体，和结构体实现的方法)")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('import (\n\t"fmt"\n\t"github.com/hashicorp/consul/api"\n)\n\n\n// Registry 这个结构是consul的地址\ntype Registry struct{\n\tHost string\n\tPort int\n}\n\n// Register 注册web访问到consul\nfunc (r *Registry)Register(host string, port int, name string, tags []string, id string) error {\n\tcfg := api.DefaultConfig()  // 创建consul的配置\n\tcfg.Address = fmt.Sprintf("%s:%d", r.Host, r.Port)\n\n\tclient, err := api.NewClient(cfg)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t//生成对应的检查对象\n\tcheck := &api.AgentServiceCheck{\n\t\tHTTP: fmt.Sprintf("http://%s:%d/health", host, port),\n\t\tTimeout: "5s",\n\t\tInterval: "5s",\n\t\tDeregisterCriticalServiceAfter: "5s",\n\t}\n\n\t//生成注册对象\n\tregistration := new(api.AgentServiceRegistration)\n\tregistration.Name = name\n\tregistration.ID = id\n\tregistration.Port = port\n\tregistration.Tags = tags\n\tregistration.Address = host\n\tregistration.Check = check\n\n\terr = client.Agent().ServiceRegister(registration)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn nil\n}\n\n// DeRegister 注销web访问到consul\nfunc (r *Registry)DeRegister(serviceId string) error{\n\tcfg := api.DefaultConfig()\n\tcfg.Address = fmt.Sprintf("%s:%d", r.Host, r.Port)\n\n\tclient, err := api.NewClient(cfg)\n\tif err != nil {\n\t\treturn err\n\t}\n\terr = client.Agent().ServiceDeregister(serviceId)\n\treturn err\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br")])]),t("ul",[t("li",[s._v("外部调用")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("// 实例化Registry\nclient := consul.Registry{Host: global.Conf.ConsulConfig.Host, Port: global.Conf.ConsulConfig.Port}\n\n// 创建新的registerClient， 且必须保证Registry实现了Register、DeRegister方法，否则报错\nregisterClient := consul.NewRegistryClient(&client)\n\n// 创建UUID\nserviceId := uuid.NewV4().String()\n\n// 调用RegistryClient接口的Register完成注册\nerr := registerClient.Register(global.Conf.Host,\n\t                           global.Conf.Port,\n\t                           global.Conf.Name,\n\t                           global.Conf.Tags,\n\t                           serviceId)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("思考：从这个设计角度来看，"),t("code",[s._v("Registry必须实现Register、DeRegister方法")]),s._v("，否则在"),t("code",[s._v("consul.NewRegistryClient(&client)")]),s._v("中会报错")])])])}),[],!1,null,null,null);n.default=a.exports}}]);