(window.webpackJsonp=window.webpackJsonp||[]).push([[220],{1831:function(s,n,a){s.exports=a.p+"assets/img/2019-09-114.39.20.5f0c41fa.png"},1832:function(s,n,a){s.exports=a.p+"assets/img/2019-09-1410.08.38.54428dc3.png"},2719:function(s,n,a){"use strict";a.r(n);var e=a(9),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"一-资产清单"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-资产清单"}},[s._v("#")]),s._v(" 一：资产清单")]),s._v(" "),e("h3",{attrs:{id:"一-资产清单概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-资产清单概念"}},[s._v("#")]),s._v(" (一)资产清单概念")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1：K8S的API Server提供RESTFUL API，能够进行 GET、PUT、DELETE、POST操作，这些操作类似于kubectl run, get, edit\n\n2：K8S上的资源对象\n\tpod: pod以控制器的方式管理和运行，常用的pod控制器有 ReplicaSet、Deployment，StatefulSet等\n\t服务以及均衡：Service、Ingress\n\t配置与存储：Volume、CSI、ConfigMap、secret、DownloadAPI\n\t集群级资源：Namespace、Node、Role、Cluster Role、Cluster Role Binding\n\t元数据资源：HPA、PodTemplate、LimitRange\n\n3: 创建资源的方法\n\tapiserver仅仅接收json格式的资源定义\n\tyaml格式提供配置清单，apiserver可自动将yaml格式的配置清单转换为json格式，在提交给apiserver\n\n4：大部分资源配置清单必须具有以下类型的定义\n\tapiVersion：资源是有版本的，可以使用kubectl api-versions查看所有的资源版本，版本的表示方式为group/version\n\tkind: 资源清单中需要指定资源的类别\n\tmetadata：资源清单中需要指定资源的元数据，包括name、namespace、labels、annotations\n\t对资源的引用方式为：/api/GROUP/VERSION/namespaces/NAMESPACE/TYPE/NAME,/api/v1/namespaces/default/pods/myapp-746644f8d6-2sfrq\n\tspec：期望的状态，disired state\n\tstatus: 当前状态，current state，有k8s集群自己定义\n\t\n5: 使用kubectl explain pods.spec：可以查看资源可以定义的字段解释\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("h3",{attrs:{id:"二-定义资源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-定义资源"}},[s._v("#")]),s._v(" (二)定义资源")]),s._v(" "),e("ul",[e("li",[s._v("定义自主类型的pod资源")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 注意：这个pod里面有两个容器，当kubectl get pods时只能看到pod的name为myapp\n# yamlw文件的写法上，- 表示一个列表中的元素\napiVersion: v1\nkind: Pod\nmetadata:\n\tname: pod-demo\n\tnamespace: default\n\tlabels: \n\t\tapp: myapp\n\t\ttier: frontend\nspec:\n\tcontainers:\n\t# 这里创建两个容器\n\t\t- name: myapp\n\t\t  image: ikubernetes/myapp:v1\n\t\t  ports:\n\t\t  - name: http\n\t\t\tcontainerPort: 80\n\t\t  - name: https\n\t\t    containerPort: 443\n\t\t- name: busybox\n\t\t  image: busybox:latest\n\t\t  imagePullPolicy: IfNotPresent\n\t\t  # conmand不会运行在shell中，如果需要运行shell，需要指定运行的shell环境\n\t\t  command: \n\t\t  - "/bin/sh"\n\t\t  - "-c"\n\t\t  - "echo $(date); sleep 50000000"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br")])]),e("ul",[e("li",[s._v("基于上面定义的yaml文件创建资源")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 创建pod资源\nkubectl create -f pod-demo.yaml \n\n# 查看pods发现启动了两个容器\nkubectl get pods -o wide\n\n# 查看newapp这个容器的日志\nkubectl logs pod-demo newapp\n\n# 进入到busybox这个容器中\nkubectl exec -it pod-demo -c busybox -- /bin/sh \n\n# 删除pod\nkubectl delete pods pod-demo 或者 kubectl delete -f pod-demo.yaml \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("ul",[e("li",[s._v("使用容器镜像的基本法则，也就是Dockerfile中Entrypoint和CMD、K8S的yaml文件中的command与args。下图表示为命令和参数指定不同，容器的最终命令运行结果，官方参考：https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(1831),alt:"Alt text"}})]),s._v(" "),e("ul",[e("li",[s._v("给资源打标签")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 给已经存在的pod打标签\nkubectl label pods pod-demo release=1.0\n\n# 查看\nkubectl get pods -o wide --show-labels\n\n# 给存在的标签重新赋值\nkubectl label pods pod-demo release=2.0 --overwrite\n\n# 查看拥有release和app标签的pod\nkubectl get pods -l release,app --show-labels\n\n# 获取指定标签值的pod，精确选择\nkubectl get pods -l release=2.0 --show-labels\n\n# 获取指定标签值的pod，模糊选择\nkubectl get pods -l "release in (1.0,2.0,3.0)" --show-labels\n\n# 也可以给node节点打标签\nkubectl label nodes worker1 memory=32\n\n# 当节点有标签，当添加资源时，就可以让资源对节点有倾向性，那么在定义pod资源的时候，就可以指定pod对节点的倾向性, 这里指定了node选择器为memory: "32"，如果key有数字，可以使用引号引起来\napiVersion: v1\nkind: Pod\nmetadata:\n    name: pod-demo\n    namespace: default\n    labels:\n        app: myapp\n        tier: frontend\nspec:\n    containers:\n        - name: newapp\n          image: ikubernetes/myapp:v1\n        - name: busybox\n          image: busybox:latest\n          command:\n          - "/bin/sh"\n          - "-c"\n          - "echo $(date); sleep 100000"\n    nodeSelector:\n        memory: "32"\n\n# 删除掉运行的pod，再次基于修改的yaml文件创建pod资源\nkubectl delete pods pod-demo\nkubectl create -f pod-demo.yaml\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br")])]),e("ul",[e("li",[s._v("给资源指定annotations")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 删除pod资源，给yaml文件设置annotations\nkubectl delete pods pod-demo\n\n# 给资源添加annotations\napiVersion: v1\nkind: Pod\nmetadata:\n    name: pod-demo\n    namespace: default\n    labels:\n        app: myapp\n        tier: frontend\n    annotations:\n        k8s/create-by: "Robby"\nspec:\n    containers:\n        - name: newapp\n          image: ikubernetes/myapp:v1\n        - name: busybox\n          image: busybox:latest\n          command:\n          - "/bin/sh"\n          - "-c"\n          - "echo $(date); sleep 100000"\n    nodeSelector:\n        memory: "32"\n\n# 查看pod的描述信息\nkubectl describe pods pod-demo\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("h2",{attrs:{id:"二-pod的生命周期"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-pod的生命周期"}},[s._v("#")]),s._v(" 二：pod的生命周期")]),s._v(" "),e("h3",{attrs:{id:"一-pod生命状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-pod生命状态"}},[s._v("#")]),s._v(" (一)pod生命状态")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1: Pending\n2: Running\n3: Failed\n4: Succeeded\n5: Unknown\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"二-pod创建过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-pod创建过程"}},[s._v("#")]),s._v(" (二)pod创建过程")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("在pod的生命周期中：\n\t1：初始化容器\n\t2：容器探测\n\t\tliveness probe: 探测容器是否正常\n\t\treadiness probe：探测容器是否准备就绪\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"三-pod中容器的重启策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-pod中容器的重启策略"}},[s._v("#")]),s._v(" (三)pod中容器的重启策略")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("restartPolicy：重启策略，默认是Always\n\tAlways: 容器挂了之后总是重启\n\tOnFailure：容器状态错误时，才重启\n\tNever: 不重启\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"四-pod中容器的liveness的探针的应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-pod中容器的liveness的探针的应用"}},[s._v("#")]),s._v(" (四)pod中容器的liveness的探针的应用")]),s._v(" "),e("ul",[e("li",[s._v("执行命令的探测方式")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 如果不指定restartPolicy重启策略，默认是Always\napiVersion: v1\nkind: Pod\nmetadata:\n    name: liveness-exec-pod\n    namespace: default\nspec:\n    containers:\n        - name: liveness-exec-container\n          image: busybox:latest\n          imagePullPolicy: IfNotPresent\n          command: ["/bin/sh", "-c", "touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 3600"]\n          livenessProbe:\n\t        # 这是指定命令执行的探测方式\n            exec:\n              command: ["test", "-e", "/tmp/healthy"]\n            initialDelaySeconds: 1\n            periodSeconds: 3\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("ul",[e("li",[s._v("发送http请求的探测方式")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 可以先查看字段说明, 查看帮助信息\nkubectl explain pods.spec.containers.livenessProbe.httpGet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n    name: liveness-http-pod\n    namespace: default\nspec:\n    containers:\n        - name: liveness-http-container\n          image: ikubernetes/myapp:v1\n          imagePullPolicy: IfNotPresent\n          # 指定容器暴露的端口\n          ports:\n          - name: http\n            containersPort: 80\n          livenessProbe:\n          \thttpGet:\n              # 可以直接饮用上面定义的http端口\n              port: http\n              path: /index.html\n            initialDelaySeconds: 1\n            periodSeconds: 3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 基于yaml创建pod\nkubectl create  -f liveness-http.yaml\n\n# 查看pods状态\nkubectl get pods \n\n# 进入liveness-http-pod这个pod中的liveness-http-container容器\nkubectl exec -it liveness-http-pod -c liveness-http-container -- /bin/sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"五-pod中容器的readiness的探针的应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五-pod中容器的readiness的探针的应用"}},[s._v("#")]),s._v(" (五)pod中容器的readiness的探针的应用")]),s._v(" "),e("ul",[e("li",[s._v("readiness探针示例")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n    name: readiness-http-pod\n    namespace: default\nspec:\n    containers:\n        - name: readiness-http-container\n          image: ikubernetes/myapp:v1\n          imagePullPolicy: IfNotPresent\n          # 指定容器暴露的端口\n          ports:\n          - name: http\n            containerPort: 80\n          # 定义readiness探针\n          readinessProbe:\n            httpGet:\n              # 可以直接饮用上面定义的http端口\n              port: http\n              path: /index.html\n            initialDelaySeconds: 1\n            periodSeconds: 3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 创建pod\nkubectl create -f readiness-http.yaml \n\n# 查看pods状态，此时readiness-http-pod是ready状态, 为1/1\nkubectl get pods\nNAME                            READY   STATUS    RESTARTS   AGE\nreadiness-http-pod              1/1     Running   0          14s\n\n# 进入到容器，删除index.html\nkubectl exec -it readiness-http-pod -c readiness-http-container -- /bin/sh\n/ # rm -f /usr/share/nginx/html/index.html\n\n# 查看pods状态，此时readiness-http-pod是非ready状态， 为0/1\nkubectl get pods\nNAME                            READY   STATUS    RESTARTS   AGE\nreadiness-http-pod              0/1     Running   0          75s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"六-pod中容器的lifecycle的探针的应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六-pod中容器的lifecycle的探针的应用"}},[s._v("#")]),s._v(" (六)pod中容器的lifecycle的探针的应用")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 指定容器启动之后进行postStart操作(这个postStart容器运行有错误)\napiVersion: v1\nkind: Pod\nmetadata:\n    name: poststart-pod\n    namespace: default\nspec:\n    containers:\n        - name: busybox-http\n          image: busybox:latest\n          imagePullPolicy: IfNotPresent\n          # 指定容器暴露的端口\n          ports:\n          - name: http\n            containerPort: 80\n          lifecycle:\n          \tpostStart:\n              exec: \n                command: ["/bin/sh", "-c", "mkdir -p /data/web/html; echo \'Hello World\' >### /data/web/html/index.html"]\n          command: ["/bin/httpd"]\n          args: ["-f", "-h /data/web/html"]\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("ul",[e("li",[s._v("资产清单定义文件小结")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\n# 一个yaml文件的基本组成要素\nPod级别有：\n\tapiVersion, kind, metadata, spec, status\n\nspec级别有：\n\tcontainers, nodeSelector, nodeName, restartPolicy\n\ncontainers级别有:\n\tname\n\timage\n\timagePullPolicy\n\tports\n\tlivenessProbe\n\treadinessProbe\n\tliftcycle\n\t\n\tExecAction: exec\n\tTCPSocketAction: tcpSocket\n\tHTTPGetAction: httpGet\n\n\n# Pod控制器\n一个pod资源的运行可以由：\n\t1：kubectl run 指定一个pod控制器运行容器，但是删除容器的时候，pod控制器又会启动一个容器，因为在pod控制器运行的时候，指定了replicas副本数，也就是运行的容器个数，只要运行容器个数少于指定给pod控制器的个数，那么pod控制器将会重新启动一个容器\n\t\n\t2：kubectl create -f pod.yaml 基于pod的资产清单运行容器。如果使用kubectl delete pods podName，那么pod就会被删除了, 因为此时的pod不是被pod控制器管理的pod，因此在生产环境中，运行的pod都是被pod控制器管理的pod\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("ul",[e("li",[s._v("Pod控制器的类型有")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\t1：ReplicationController\n\t2: ReplicaSet\n\t3: Deployment：建立在ReplicaSet之上\n\t4：DaemonSet\n\t5: Job\n\t6: CronJob\n\t7：StatefulSet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"七-replicaset控制器类型的pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七-replicaset控制器类型的pod"}},[s._v("#")]),s._v(" (七)replicaSet控制器类型的pod")]),s._v(" "),e("ul",[e("li",[s._v("定义一个ReplicaSet模板")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n    name: myapp\n    namespace: default\nspec:\n    replicas: 2\n    selector: \n      matchLabels:\n        # 选择的pod必须有下面的标签\n        app: myapp\n        release: canary\n\n    # 这里是指定的模板\n    template:\n      metadata: \n        name: myapp-pod\n        # 模板中的标签一定要符合标签选择器中的选择标准\n        labels: \n          app: myapp\n          release: canary\n          environment: qa\n      spec:\n        containers:\n        - name: myapp-container\n          image: ikubernetes/myapp:v1\n          ports: \n          - name: http\n            containerPort: 80\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 查看rs\nkubectl get rs\nNAME                      DESIRED   CURRENT   READY   AGE\nmyapp                     2         2         2       10s\n\n# 查看pods\nkubectl get pods\nNAME                            READY   STATUS             RESTARTS   AGE\nmyapp-hldch                     1/1     Running            0          48s\nmyapp-kwwnq                     1/1     Running            0          48s\n\n# replicaSet控制器创建的pod资源满足多退少补，由于yaml文件中使用的是标签选择器进行选择的，因此，只要pod资源满足标签选择器选择，那么就会直接被纳入到replicaSet控制器所管理的pod资源中\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("如果需要给rs中添加pod，或减少pod，可以进行如下操作")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 直接动态编辑即可\nkubectl edit rs myapp\n\n# 直接把之前定义的replicas的2改为5，那么pod将会动态扩容至5个pod\n  replicas: 5\n\nkubectl get pods\nNAME          READY   STATUS    RESTARTS   AGE\nmyapp-4ddd5   1/1     Running   0          6s\nmyapp-kdmgm   1/1     Running   0          9h\nmyapp-n5v8j   1/1     Running   0          6s\nmyapp-ttmqq   1/1     Running   0          9h\nmyapp-x798j   1/1     Running   0          6s\n\n# 如果基于kubectl edit rs myapp命令，将镜像版本动态修改了，只有重新创建的pod才会使用新镜像\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"八-deploymentset控制器类型的pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#八-deploymentset控制器类型的pod"}},[s._v("#")]),s._v(" (八)deploymentSet控制器类型的pod")]),s._v(" "),e("ul",[e("li",[s._v("Deployment、ReplicaSet、Pod三者之家的关系")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(1832),alt:"Alt text"}})]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("由图可知：Deployment控制ReplicaSet，ReplicaSet控制Pod，在基于Service向外提供稳定可靠服务\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("创建一个Deployment")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("apiVersion: apps/v1\n# 类型是Deployment\nkind: Deployment\nmetadata:\n  name: myapp-deploy\n  namespace: default\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: myapp\n      release: canary\n  template:\n    metadata:\n      labels:\n        app: myapp\n        release: canary\n    spec:\n      containers:\n      - name: myapp\n        image: ikubernetes/myapp:v1\n        ports:\n        - name: http\n          containerPort: 80\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("ul",[e("li",[s._v("基于yaml创建deployment")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 创建deployment\nkubectl apply -f deploy-demo.yaml \n\n\n# 查看pods\nkubectl get pods\nNAME                           READY   STATUS    RESTARTS   AGE\nmyapp-deploy-f4db5d79c-tgnxk   1/1     Running   0          40s\nmyapp-deploy-f4db5d79c-xd72z   1/1     Running   0          40s\n\n# 查看rs\nkubectl get rs\nNAME                     DESIRED   CURRENT   READY   AGE\nmyapp-deploy-f4db5d79c   2         2         2       13m\n\n# 查看pods\nkubectl get deployment\nNAME           READY   UP-TO-DATE   AVAILABLE   AGE\nmyapp-deploy   2/2     2            2           14m\n\n\n# deployment默认的update方式是rollingUpdate，修改deploy-demo.yaml的image版本为V2版本\nvi deploy-demo.yaml\n\n# 自动完成image的版本更新\nkubectl apply -f deploy-demo.yaml \n\n# 再次查看rs， 发现image v1版本的DESIRED为0\nkubectl get rs -o wide\nNAME                      DESIRED   CURRENT   READY   AGE    CONTAINERS   IMAGES                 SELECTOR\nmyapp-deploy-55b78d8548   2         2         2       112s   myapp        ikubernetes/myapp:v2   app=myapp,pod-template-hash=55b78d8548,release=canary\nmyapp-deploy-f4db5d79c    0         0         0       24m    myapp        ikubernetes/myapp:v1   app=myapp,pod-template-hash=f4db5d79c,release=canary\n\n# 对deployment打补丁扩容， -p指的是修改yaml文件的哪个字段\nkubectl patch deployment myapp-deploy -p \'{"spec": {"replicas": 5}}\'\n\n# 也可以修改rollingUpdate策略, maxSurge表示滚动升级时会先启动1个pod，maxUnavailable表示滚动升级时允许的最大Unavailable的pod个数\nkubectl patch deployment myapp-deploy -p \'{"spec": {"strategy": {"rollingUpdate": {"maxSurge": 1, "maxUnavailable": 0}}}}\'\n\n# 可以直接使用kubectl set 命令，动态设置镜像的版本更新\nkubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3 \n\n# 查看当前的deployment滚动更新的版本, 可以看到此时已经更新的3个版本，\nkubectl rollout history deployment myapp-deploy\ndeployment.extensions/myapp-deploy \nREVISION  CHANGE-CAUSE\n1         <none>\n2         <none>\n3         <none>\n\n# 可以直接回滚到对应的v1版本\nkubectl rollout undo deployment myapp-deploy --to-revision=1\n\n# 此时再次查看版本更新历史记录，发现V1变成了V4\nkubectl rollout history deployment myapp-deploy\ndeployment.extensions/myapp-deploy \nREVISION  CHANGE-CAUSE\n2         <none>\n3         <none>\n4         <none>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br")])]),e("h3",{attrs:{id:"九-daemonset控制器类型的pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#九-daemonset控制器类型的pod"}},[s._v("#")]),s._v(" (九)DaemonSet控制器类型的pod")]),s._v(" "),e("ul",[e("li",[s._v("创建yaml文件, 此yaml文件中包含2类资源，一类是deployment的pod为redis，一类是DaemonSet的pod为filebeat")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: redis\n      role: logstor\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: logstor\n    spec:\n      containers:\n      - name: redis\n        image: redis:4.0-alpine\n        ports:\n        - name: redis\n          containerPort: 6379\n---\napiVersion: apps/v1\n# 类型是DaemonSet\nkind: DaemonSet\nmetadata:\n  name: filebeat-ds\n  namespace: default\nspec:\n  # 这里没有指定replica副本数，那么有几个worker节点就会运行几个pod，一个worker节点只能运行一个pod\n  selector:\n    matchLabels:\n      app: filebeat\n      release: stable\n  template:\n    metadata:\n      labels:\n        app: filebeat\n        release: stable\n    spec:\n      containers:\n      - name: filebeat\n        image: ikubernetes/filebeat:5.6.5-alpine\n        env:\n        # 指定给容器传递的环境变量\n        # 任何service的默认域名是：Service_NAME.NameSpace_NAME.Domain.LTD，那么如果定义redis这个service，那么域名就是redis.default.svc.cluster.local\n        - name: REDIS_HOST\n          value: redis.default.svc.cluster.local\n        - name: REDIS_LOG_LEVEL\n          value: info\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br")])]),e("ul",[e("li",[s._v("创建pods")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 创建pods\nkubectl apply -f ds-demo.yaml \n\n# 给redis这个pods创建service\nkubectl expose deployment redis --name=redis  --port=6379\n\n# 这里是想让filebeat服务的日志信息写入到redis中，因此pod之间需要被调用，即filebeat pod调用redis pod， 调用的方法是给redis pod创建一个service，这个service的服务默认名称根据名称规则应该是redis.default.svc.cluster.local，因此这样就实现了pod之间的相互调用\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);