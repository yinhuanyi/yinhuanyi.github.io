(window.webpackJsonp=window.webpackJsonp||[]).push([[383],{2251:function(n,t,s){"use strict";s.r(t);var e=s(9),a=Object(e.a)({},(function(){var n=this,t=n.$createElement,s=n._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"一-mongodb搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-mongodb搭建"}},[n._v("#")]),n._v(" 一：mongodb搭建")]),n._v(" "),s("h3",{attrs:{id:"一-简单对比mysql和mongodb的名词术语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-简单对比mysql和mongodb的名词术语"}},[n._v("#")]),n._v(" (一) 简单对比MySQL和MongoDB的名词术语")]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("术语区别")])])]),n._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[n._v("MySQL")]),n._v(" "),s("th",{staticStyle:{"text-align":"center"}},[n._v("MongoDB")])])]),n._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("database")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("database")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("table")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("collection")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("row")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("document")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("column")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("field")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("index")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("index")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("table joins")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$lookup")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("primary key")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("_id")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("group by")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("aggregation pipeline")])])])]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("聚合类比")])])]),n._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[n._v("MySQL")]),n._v(" "),s("th",{staticStyle:{"text-align":"center"}},[n._v("MongoDB")])])]),n._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("where")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$match")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("group by")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$group")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("having")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$match")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("select")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$project")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("order by")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$sort")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("limit")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$limit")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("sum")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$sum")])]),n._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[n._v("count")]),n._v(" "),s("td",{staticStyle:{"text-align":"center"}},[n._v("$sum")])])])]),n._v(" "),s("h3",{attrs:{id:"二-启动mongodb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-启动mongodb"}},[n._v("#")]),n._v(" (二) 启动mongodb")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("nohup ./mongod --dbpath=./data --bind_ip=0.0.0.0 &\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("h2",{attrs:{id:"二-mongodb操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-mongodb操作"}},[n._v("#")]),n._v(" 二：mongodb操作")]),n._v(" "),s("h3",{attrs:{id:"一-命令行创建库和表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-命令行创建库和表"}},[n._v("#")]),n._v(" (一) 命令行创建库和表")]),n._v(" "),s("ul",[s("li",[n._v("安装依赖")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("go get go.mongodb.org/mongo-driver/mongo\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("ul",[s("li",[n._v("创建数据库，创建表")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('// 创建库\n> use mydb\nswitched to db mydb\n\n// 创建表\n> db.createCollection("my_collection");\n{ "ok" : 1 }\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br")])]),s("h3",{attrs:{id:"二-insertone写入单行记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-insertone写入单行记录"}},[n._v("#")]),n._v(" (二) InsertOne写入单行记录")]),n._v(" "),s("ul",[s("li",[n._v("将记录写入到MongoDB")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('\n// TimePoint 记录任务执行的起始时间\ntype TimePoint struct {\n\tStartTime int64 `bson:"startTime"` // 起始时间\n\tEndTime   int64 `bson:"endTime"`   // 终止时间\n}\n\n// LogRecord 记录结构\ntype LogRecord struct {\n\tJobName   string `bson:"jobName"` // 任务名称\n\tCommand   string `bson:"command"` // shell命令\n\tErr       string `bson:"err"`     // 错误输出\n\tContent   string `bson:"content"` // 正确输出\n\tTimePoint `bson:"timePoint"`      // 时间点\n}\n\nfunc main() {\n\n\t// 1：创建连接\n\tclientOptions := options.Client().ApplyURI("mongodb://localhost:27017").SetConnectTimeout(5 * time.Second)\n\tclient, err := mongo.Connect(context.TODO(), clientOptions)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\terr = client.Ping(context.TODO(), nil)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfmt.Println("Connected to MongoDB!")\n\n\t// 2：选择库和表\n\tdatabase := client.Database("mydb")\n\tcollection := database.Collection("my_collection")\n\n\t// 3：插入记录\n\tlogRecord := &LogRecord{\n\t\tJobName: "job1",\n\t\tCommand: "echo hello",\n\t\tErr:     "",\n\t\tContent: "hello",\n\t\tTimePoint: TimePoint{\n\t\t\tStartTime: time.Now().Unix(),\n\t\t\tEndTime:   time.Now().Unix() + 100,\n\t\t},\n\t}\n\n\t// 4：插入数据，logRecord实例的结构体必须是bson标签化，当结构体写入的时候，会基于reflect进行反射写入到MongoDB中\n\tinsertRes, err := collection.InsertOne(context.Background(), logRecord)\n\tif err != nil {\n\t\tfmt.Println(err)\n\t}\n\n\t// 5：获取ID的十六进制\n\tdocId := insertRes.InsertedID.(primitive.ObjectID).Hex()\n\tfmt.Println(docId)\n\n}\n\n\n// 输出：\n61138ea7f2543e642f7b8679\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br")])]),s("ul",[s("li",[n._v("命令行中查看记录")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('> db.my_collection.find();\n{ "_id" : ObjectId("61138ea7f2543e642f7b8679"), "jobName" : "job1", "command" : "echo hello", "err" : "", "content" : "hello", "timePoint" : { "startTime" : NumberLong(1628671655), "endTime" : NumberLong(1628671755) } }\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br")])]),s("h3",{attrs:{id:"三-insertmany写入多行记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三-insertmany写入多行记录"}},[n._v("#")]),n._v(" (三) InsertMany写入多行记录")]),n._v(" "),s("ul",[s("li",[n._v("多行插入")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('// TimePoint 记录任务执行的起始时间\ntype TimePoint struct {\n\tStartTime int64 `bson:"startTime"` // 起始时间\n\tEndTime   int64 `bson:"endTime"`   // 终止时间\n}\n\n// LogRecord 记录结构\ntype LogRecord struct {\n\tJobName   string `bson:"jobName"` // 任务名称\n\tCommand   string `bson:"command"` // shell命令\n\tErr       string `bson:"err"`     // 错误输出\n\tContent   string `bson:"content"` // 正确输出\n\tTimePoint `bson:"timePoint"`      // 时间点\n}\n\nfunc main() {\n\n\t// 1：创建连接\n\tclientOptions := options.Client().ApplyURI("mongodb://localhost:27017").SetConnectTimeout(5 * time.Second)\n\tclient, err := mongo.Connect(context.TODO(), clientOptions)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\terr = client.Ping(context.TODO(), nil)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfmt.Println("Connected to MongoDB!")\n\n\t// 2：选择库和表\n\tdatabase := client.Database("mydb")\n\tcollection := database.Collection("my_collection")\n\n\t// 3：插入记录\n\tlogRecord1 := &LogRecord{\n\t\tJobName: "job1",\n\t\tCommand: "echo hello",\n\t\tErr:     "",\n\t\tContent: "hello",\n\t\tTimePoint: TimePoint{\n\t\t\tStartTime: time.Now().Unix(),\n\t\t\tEndTime:   time.Now().Unix() + 100,\n\t\t},\n\t}\n\n\tlogRecord2 := &LogRecord{\n\t\tJobName: "job1",\n\t\tCommand: "echo hello",\n\t\tErr:     "",\n\t\tContent: "hello",\n\t\tTimePoint: TimePoint{\n\t\t\tStartTime: time.Now().Unix(),\n\t\t\tEndTime:   time.Now().Unix() + 100,\n\t\t},\n\t}\n\n\t// 4：批量插入\n\tvar docs []interface{}\n\tdocs = append(docs, logRecord1, logRecord2)\n\tmanyInserts, err := collection.InsertMany(context.Background(), docs)\n\tif err != nil {\n\t\tfmt.Println(err)\n\t}\n\n\t// 5：获取结果\n\tfor id := range manyInserts.InsertedIDs {\n\t\tfmt.Println(id)\n\t}\n\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br")])]),s("h3",{attrs:{id:"四-find查询记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四-find查询记录"}},[n._v("#")]),n._v(" (四) Find查询记录")]),n._v(" "),s("ul",[s("li",[n._v("查询(只有查询操作才会返回cursor游标)")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('// TimePoint 记录任务执行的起始时间\ntype TimePoint struct {\n\tStartTime int64 `bson:"startTime"` // 起始时间\n\tEndTime   int64 `bson:"endTime"`   // 终止时间\n}\n\n// LogRecord 记录结构\ntype LogRecord struct {\n\tJobName   string `bson:"jobName"` // 任务名称\n\tCommand   string `bson:"command"` // shell命令\n\tErr       string `bson:"err"`     // 错误输出\n\tContent   string `bson:"content"` // 正确输出\n\tTimePoint `bson:"timePoint"`      // 时间点\n}\n\n// FindByJobName 基于job名称过滤\ntype FindByJobName struct {\n\tJobName string `bson:"jobName"` // 查询条件\n\n}\n\nfunc main() {\n\n\t// 1：创建连接\n\tclientOptions := options.Client().ApplyURI("mongodb://localhost:27017").SetConnectTimeout(5 * time.Second)\n\tclient, err := mongo.Connect(context.TODO(), clientOptions)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\terr = client.Ping(context.TODO(), nil)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfmt.Println("Connected to MongoDB!")\n\n\t// 2：选择库和表\n\tdatabase := client.Database("mydb")\n\tcollection := database.Collection("my_collection")\n\n\t// 3：jobName过滤\n\tcondition := &FindByJobName{JobName: "job1"}  // 相当于 {"jobName": "job1"}\n\n\t// 4：查询\n\tfilter := options.Find().SetLimit(2)\n\tcursor, err := collection.Find(context.Background(), condition, filter)\n\tif err != nil {\n\t\tfmt.Println(err)\n\t}\n\tdefer cursor.Close(context.Background())\n\n\t// 5：游标遍历\n\tvar results []*LogRecord\n\tfor cursor.Next(context.TODO()) {\n\t\t// 创建一个值，将单个文档解码为该值\n\t\tele := new(LogRecord)\n\t\t// 或者\n\t\t//ele := &LogRecord{}\n\t\terr = cursor.Decode(ele)\n\t\tif err != nil {\n\t\t\tfmt.Println(err)\n\t\t}\n\t\tfmt.Println(ele)\n\t\tresults = append(results, ele)\n\t}\n\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br")])]),s("h3",{attrs:{id:"五-delete删除记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五-delete删除记录"}},[n._v("#")]),n._v(" (五) Delete删除记录")]),n._v(" "),s("ul",[s("li",[n._v("删除")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('// TimeBefore 小于某时间\n// 序列化后为：{"$lt": timestamp}\ntype TimeBefore struct {\n\tBefore int64 `bson:"$lt"`\n}\n\n// Delete 删除\n// 序列化后相当于：{"timePoint.startTime": {"$lt": timestamp}}\ntype Delete struct {\n\tbeforeCond TimeBefore `bson:"timePoint.startTime"`\n}\n\nfunc main() {\n\n\t// 1：创建连接\n\tclientOptions := options.Client().ApplyURI("mongodb://localhost:27017").SetConnectTimeout(5 * time.Second)\n\tclient, err := mongo.Connect(context.TODO(), clientOptions)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\terr = client.Ping(context.TODO(), nil)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfmt.Println("Connected to MongoDB!")\n\n\t// 2：选择库和表\n\tdatabase := client.Database("mydb")\n\tcollection := database.Collection("my_collection")\n\n\t// 3：删除\n\t// 相当于 db.student.delete({"timePoint.startTime": {"$lt": 1628675097}})\n\tdelFilter := &Delete{beforeCond: TimeBefore{Before: time.Now().Unix()}}\n\tdeleteRes, err := collection.DeleteMany(context.Background(), delFilter)\n\tif err != nil {\n\t\tfmt.Println(err)\n\t}\n\n\t// 4：输出删除的行数\n\tfmt.Println(deleteRes.DeletedCount)\n}\n\n// 输出：5\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br")])])])}),[],!1,null,null,null);t.default=a.exports}}]);