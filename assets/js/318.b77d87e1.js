(window.webpackJsonp=window.webpackJsonp||[]).push([[318],{1835:function(n,s,e){n.exports=e.p+"assets/img/4525BFA9223ACFF090EA9611AF1BE524.3a3a2e46.png"},2722:function(n,s,e){"use strict";e.r(s);var a=e(9),r=Object(a.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"一-集群初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-集群初始化"}},[n._v("#")]),n._v(" 一：集群初始化")]),n._v(" "),a("h3",{attrs:{id:"一-初始化-集群中配置3个节点-每个节点使用2g内存-本次集群使用kubeadm安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-初始化-集群中配置3个节点-每个节点使用2g内存-本次集群使用kubeadm安装配置"}},[n._v("#")]),n._v(" "),a("code",[n._v("(一)初始化")]),n._v("(集群中配置3个节点，每个节点使用2G内存, 本次集群使用kubeadm安装配置)")]),n._v(" "),a("p",[a("img",{attrs:{src:e(1835),alt:"Alt text"}})]),n._v(" "),a("ul",[a("li",[n._v("配置镜像仓库，启动docker容器, 拉去docker的k8s镜像")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('1: 3个配置/etc/hosts，无密码登录，时间同步\n\n2：3个节点配置docker镜像仓库\ncd /etc/yum.repos.d/ && wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n3: 3个节点配置k8s镜像\nvi kubenetes.repo\n[kubernetes]\nname=Kubernetes Repo\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\ngpgcheck=0\nenabled=1\n\n4: 3个节点更新仓库\nyum repolist\n\n5：3个节点安装docker 和 k8s， 其中kubectl是API的客户端工具, 这里可以指定安装的版本\n例如查看docker的版本\nyum list docker-ce --showduplicates | sort -r\n安装指定docker的版本\nyum install docker-ce-18.06.3.ce-3.el7\n安装指定版本的kube\nyum install -y docker-ce-18.06.3.ce-3.el7  kubelet-1.15.3 kubeadm-1.15.3 \n\n6: master上由于docker容器的启动会先去官方仓库下载镜像，但是可能下载不到，因此这里修改unit file文件，在unit file文件指定http代理的环境变量\nvi /usr/lib/systemd/system/docker.service， 在ExecStart配置项之前添加\nEnvironment="NO_PROXY=127.0.0.0/8"\n\n7: master上让系统重读unif file文件\nsystemctl daemon-reload \n\n8：master上启动docker\nsystemctl restart docker\n\n9: master上为确保Iptables规则可以正常使用，需要设置IP系统系统参数，也可以直接加入到内核参数配置文件中，让配置永久生效\necho 1 ### /proc/sys/net/bridge/bridge-nf-call-ip6tables \necho 1 ### /proc/sys/net/bridge/bridge-nf-call-iptables\necho 1 ### /proc/sys/net/ipv4/ip_forward\n\n10：master上查看kubelet软件包的文件\n[root@node1 ~]# rpm -ql kubelet\n/etc/kubernetes/manifests\n/etc/sysconfig/kubelet\n/usr/bin/kubelet\n/usr/lib/systemd/system/kubelet.service\n\n11：master上设置kubelet、docker开机自启\nsystemctl enable kubelet\nsystemctl start kubelet\nsystemctl enable docker\n\n12：master上在kubelet参数配置文件中添加参数，禁用swap\nvi /etc/sysconfig/kubelet\nKUBELET_EXTRA_ARGS="--fail-swap-on=false"\n\n12: 查看一下google仓库中，k8s各个组件的镜像\nkubeadm config images list --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers\nregistry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.18.2\nregistry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.18.2\nregistry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.18.2\nregistry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.18.2\nregistry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2\nregistry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.3-0\nregistry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.6.7\n\n13：master上拉去docker镜像\n# --apiserver-advertise-address：是指定master使用哪个网卡与cluster通信\n# --service-cidr=10.1.0.0/16: 设置服务使用的默认子网\n# --pod-network-cidr：指明了Pod网络的CIDR，以用于Node相关配置\n\nkubeadm init --kubernetes-version=1.15.3(替换为k8s的版本)--apiserver-advertise-address=192.168.43.201(替换为master的外网地址) --image-repository registry.aliyuncs.com/google_containers --service-cidr=10.1.0.0/16 --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors=Swap\n\n# 这里有个坑，如果是在vps中，指定公网会报错：找不到master node，解决方法是：当初始化master节点的时候，在另外一个终端立马修改/etc/kubernetes/manifests/etcd.yaml，修改如下，\n    - --listen-client-urls=https://127.0.0.1:2379(删除公网IP)\n    - --listen-metrics-urls=http://127.0.0.1:2381\n    - --listen-peer-urls=https://127.0.0.1:2380(将公网IP修改为内网IP)\n\n14：master上本地下载docker镜像(这次安装的k8s是v1.15.3版本, 如下方法可以将docker进行直接pull到本地，在修改tag名称)\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.15.3\ndocker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.15.3 k8s.gcr.io/kube-proxy:v1.15.3\n\n15：master上这里还是直接写一个shell，将docker pull镜像的步骤和修改tag值的步骤都在脚本中完成\n#!/bin/bash\necho "Begining.... pull image form aliyun registry and docker tag k8s"\nimage_name=(\n    kube-apiserver:v1.18.2\n    kube-controller-manager:v1.18.2\n    kube-scheduler:v1.18.2\n    kube-proxy:v1.18.2\n    pause:3.1\n    etcd:3.3.10\n    coredns:1.3.1\n 　　)\naliyun_registry="registry.cn-hangzhou.aliyuncs.com/google_containers/"\nk8s_registry="k8s.gcr.io/"\nfor image in ${image_name[*]};do\n        # 拉取镜像\n        docker pull $aliyun_registry$image\n        # 给镜像打tag\n        docker tag  $aliyun_registry$image $k8s_registry$image\n        # 删除阿里云镜像，保留Google镜像\n\t\tdocker image rm $aliyun_registry$image\ndone\necho "End...."\necho "Local Docker Images List......"\ndocker images\n\n16: 下载完毕镜像之后再次初始化\nkubeadm init --kubernetes-version=1.18.2 --apiserver-advertise-address=125.124.57.184 --service-cidr=10.1.0.0/16 --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors=Swap\n\n16：master上初始化成功后提示\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.43.201:6443 --token nbskkp.gd4thv98h1jmz9ni \\\n    --discovery-token-ca-cert-hash sha256:3ccd23f9ee87e857e9cd9c8c1c54039caf172c83eb08ef22e4f7af26073c0d5a\n\n17：master上按照提示，执行初始化操作\nmkdir -p $HOME/.kube\ncp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nchown $(id -u):$(id -g) $HOME/.kube/config\n\n18：master上查看k8s集群的健康状态信息\nkubectl get componentstatus \nNAME                 STATUS    MESSAGE             ERROR\nscheduler            Healthy   ok                  \ncontroller-manager   Healthy   ok                  \netcd-0               Healthy   {"health":"true"}\n\n19：master上查看集群节点状态信息\nkubectl get nodes\nNAME     STATUS     ROLES    AGE     VERSION\nmaster   NotReady   master   8m47s   v1.15.3\n\n20: master上安装flannel(pod network)\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n21：master上此时节点变为ready状态, 需要等一段时间\n[root@master ~]# kubectl get nodes\nNAME     STATUS   ROLES    AGE   VERSION\nmaster   Ready    master   12m   v1.15.3\n\n22：master上查看k8s集群的名称空间\n[root@master ~]# kubectl get ns\nNAME              STATUS   AGE\ndefault           Active   16m\nkube-node-lease   Active   16m\nkube-public       Active   16m\nkube-system       Active   16m\n\n23：master上查看系统名称空间运行的pods\nkubectl get pods -n kube-system\nNAME                             READY   STATUS    RESTARTS   AGE\ncoredns-bccdc95cf-2x96q          1/1     Running   0          15m\ncoredns-bccdc95cf-zzgxd          1/1     Running   0          15m\netcd-master                      1/1     Running   0          14m\nkube-apiserver-master            1/1     Running   0          15m\nkube-controller-manager-master   1/1     Running   0          14m\nkube-flannel-ds-amd64-54skq      1/1     Running   0          5m1s\nkube-proxy-zcn27                 1/1     Running   0          15m\nkube-scheduler-master            1/1     Running   0          14m\n\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br"),a("span",{staticClass:"line-number"},[n._v("97")]),a("br"),a("span",{staticClass:"line-number"},[n._v("98")]),a("br"),a("span",{staticClass:"line-number"},[n._v("99")]),a("br"),a("span",{staticClass:"line-number"},[n._v("100")]),a("br"),a("span",{staticClass:"line-number"},[n._v("101")]),a("br"),a("span",{staticClass:"line-number"},[n._v("102")]),a("br"),a("span",{staticClass:"line-number"},[n._v("103")]),a("br"),a("span",{staticClass:"line-number"},[n._v("104")]),a("br"),a("span",{staticClass:"line-number"},[n._v("105")]),a("br"),a("span",{staticClass:"line-number"},[n._v("106")]),a("br"),a("span",{staticClass:"line-number"},[n._v("107")]),a("br"),a("span",{staticClass:"line-number"},[n._v("108")]),a("br"),a("span",{staticClass:"line-number"},[n._v("109")]),a("br"),a("span",{staticClass:"line-number"},[n._v("110")]),a("br"),a("span",{staticClass:"line-number"},[n._v("111")]),a("br"),a("span",{staticClass:"line-number"},[n._v("112")]),a("br"),a("span",{staticClass:"line-number"},[n._v("113")]),a("br"),a("span",{staticClass:"line-number"},[n._v("114")]),a("br"),a("span",{staticClass:"line-number"},[n._v("115")]),a("br"),a("span",{staticClass:"line-number"},[n._v("116")]),a("br"),a("span",{staticClass:"line-number"},[n._v("117")]),a("br"),a("span",{staticClass:"line-number"},[n._v("118")]),a("br"),a("span",{staticClass:"line-number"},[n._v("119")]),a("br"),a("span",{staticClass:"line-number"},[n._v("120")]),a("br"),a("span",{staticClass:"line-number"},[n._v("121")]),a("br"),a("span",{staticClass:"line-number"},[n._v("122")]),a("br"),a("span",{staticClass:"line-number"},[n._v("123")]),a("br"),a("span",{staticClass:"line-number"},[n._v("124")]),a("br"),a("span",{staticClass:"line-number"},[n._v("125")]),a("br"),a("span",{staticClass:"line-number"},[n._v("126")]),a("br"),a("span",{staticClass:"line-number"},[n._v("127")]),a("br"),a("span",{staticClass:"line-number"},[n._v("128")]),a("br"),a("span",{staticClass:"line-number"},[n._v("129")]),a("br"),a("span",{staticClass:"line-number"},[n._v("130")]),a("br"),a("span",{staticClass:"line-number"},[n._v("131")]),a("br"),a("span",{staticClass:"line-number"},[n._v("132")]),a("br"),a("span",{staticClass:"line-number"},[n._v("133")]),a("br"),a("span",{staticClass:"line-number"},[n._v("134")]),a("br"),a("span",{staticClass:"line-number"},[n._v("135")]),a("br"),a("span",{staticClass:"line-number"},[n._v("136")]),a("br"),a("span",{staticClass:"line-number"},[n._v("137")]),a("br"),a("span",{staticClass:"line-number"},[n._v("138")]),a("br"),a("span",{staticClass:"line-number"},[n._v("139")]),a("br"),a("span",{staticClass:"line-number"},[n._v("140")]),a("br"),a("span",{staticClass:"line-number"},[n._v("141")]),a("br"),a("span",{staticClass:"line-number"},[n._v("142")]),a("br"),a("span",{staticClass:"line-number"},[n._v("143")]),a("br"),a("span",{staticClass:"line-number"},[n._v("144")]),a("br"),a("span",{staticClass:"line-number"},[n._v("145")]),a("br"),a("span",{staticClass:"line-number"},[n._v("146")]),a("br"),a("span",{staticClass:"line-number"},[n._v("147")]),a("br"),a("span",{staticClass:"line-number"},[n._v("148")]),a("br"),a("span",{staticClass:"line-number"},[n._v("149")]),a("br"),a("span",{staticClass:"line-number"},[n._v("150")]),a("br"),a("span",{staticClass:"line-number"},[n._v("151")]),a("br"),a("span",{staticClass:"line-number"},[n._v("152")]),a("br"),a("span",{staticClass:"line-number"},[n._v("153")]),a("br"),a("span",{staticClass:"line-number"},[n._v("154")]),a("br"),a("span",{staticClass:"line-number"},[n._v("155")]),a("br"),a("span",{staticClass:"line-number"},[n._v("156")]),a("br"),a("span",{staticClass:"line-number"},[n._v("157")]),a("br"),a("span",{staticClass:"line-number"},[n._v("158")]),a("br"),a("span",{staticClass:"line-number"},[n._v("159")]),a("br"),a("span",{staticClass:"line-number"},[n._v("160")]),a("br"),a("span",{staticClass:"line-number"},[n._v("161")]),a("br"),a("span",{staticClass:"line-number"},[n._v("162")]),a("br"),a("span",{staticClass:"line-number"},[n._v("163")]),a("br"),a("span",{staticClass:"line-number"},[n._v("164")]),a("br"),a("span",{staticClass:"line-number"},[n._v("165")]),a("br"),a("span",{staticClass:"line-number"},[n._v("166")]),a("br"),a("span",{staticClass:"line-number"},[n._v("167")]),a("br"),a("span",{staticClass:"line-number"},[n._v("168")]),a("br"),a("span",{staticClass:"line-number"},[n._v("169")]),a("br"),a("span",{staticClass:"line-number"},[n._v("170")]),a("br"),a("span",{staticClass:"line-number"},[n._v("171")]),a("br"),a("span",{staticClass:"line-number"},[n._v("172")]),a("br"),a("span",{staticClass:"line-number"},[n._v("173")]),a("br"),a("span",{staticClass:"line-number"},[n._v("174")]),a("br"),a("span",{staticClass:"line-number"},[n._v("175")]),a("br"),a("span",{staticClass:"line-number"},[n._v("176")]),a("br")])]),a("ul",[a("li",[n._v("配置worker节点")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('1: 首先执行脚本，将kubeproxy镜像拉取下来\n#!/bin/bash\necho "Begining.... pull image form aliyun registry and docker tag k8s"\nimage_name=(\n    kube-apiserver:v1.18.2\n    kube-controller-manager:v1.18.2\n    kube-scheduler:v1.18.2\n    kube-proxy:v1.18.2\n    pause:3.1\n    etcd:3.3.10\n    coredns:1.3.1\n 　　)\naliyun_registry="registry.cn-hangzhou.aliyuncs.com/google_containers/"\nk8s_registry="k8s.gcr.io/"\nfor image in ${image_name[*]};do\n        # 拉取镜像\n        docker pull $aliyun_registry$image\n        # 给镜像打tag\n        docker tag  $aliyun_registry$image $k8s_registry$image\n        # 删除阿里云镜像，保留Google镜像\n\t\tdocker image rm $aliyun_registry$image\ndone\necho "End...."\necho "Local Docker Images List......"\ndocker images \n\n24: 在work1上，将docker和kubelet添加开机自启，将worker1加入到集群中\nvi /usr/lib/systemd/system/docker.service， 在ExecStart配置项之前添加\nEnvironment="NO_PROXY=127.0.0.0/8"\n\nvi /etc/sysconfig/kubelet\nKUBELET_EXTRA_ARGS="--fail-swap-on=false"\n\nsystemctl enable docker kubelet\nsystemctl start docker\necho 1 ### /proc/sys/net/bridge/bridge-nf-call-ip6tables \necho 1 ### /proc/sys/net/bridge/bridge-nf-call-iptables\necho 1 ### /proc/sys/net/ipv4/ip_forward\nswapoff -a \n \n# 加入到master cluster中\nkubeadm join 192.168.43.201:6443 --token nbskkp.gd4thv98h1jmz9ni \\\n    --discovery-token-ca-cert-hash sha256:3ccd23f9ee87e857e9cd9c8c1c54039caf172c83eb08ef22e4f7af26073c0d5a\n\n# 其实token和hash都可以获取\nkubeadm token create(重新创建token)\nopenssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed \'s/^.* //\' (获取hash)\n\n25：在master节点上查看机器节点状态\nkubectl get nodes\nNAME      STATUS   ROLES    AGE     VERSION\nmaster    Ready    master   31m     v1.15.3\nworker1   Ready    <none###   3m51s   v1.15.3\n\n26：将work2加入到集群\nvi /usr/lib/systemd/system/docker.service， 在ExecStart配置项之前添加\nEnvironment="NO_PROXY=127.0.0.0/8"\n\nvi /etc/sysconfig/kubelet\nKUBELET_EXTRA_ARGS="--fail-swap-on=false"\n\nsystemctl enable docker kubelet\nsystemctl start docker\necho 1 ### /proc/sys/net/bridge/bridge-nf-call-ip6tables \necho 1 ### /proc/sys/net/bridge/bridge-nf-call-iptables\necho 1 ### /proc/sys/net/ipv4/ip_forward\nswapoff -a \n\n# 加入到机器中\nkubeadm join 192.168.43.201:6443 --token nbskkp.gd4thv98h1jmz9ni \\\n    --discovery-token-ca-cert-hash sha256:3ccd23f9ee87e857e9cd9c8c1c54039caf172c83eb08ef22e4f7af26073c0d5a\n\n27：最后在master节点上查看\n[root@master ~]# kubectl get nodes\nNAME      STATUS     ROLES    AGE   VERSION\nmaster    Ready      master   40m   v1.15.3\nworker1   Ready      <none###   12m   v1.15.3\nworker2   Ready   <none###   42s   v1.15.3\n\n28：最终可以查看到pod的发布，其中kube-flannel和kube-proxy是发布在不同的节点上，因此，master和worker节点都会运行kube-proxy和kube-flannel这两个pod\n[root@master ~]# kubectl get pods -n kube-system -o wide \nNAME                             READY   STATUS    RESTARTS   AGE     IP               NODE     NOMINATED NODE   READINESS GATES\ncoredns-66bff467f8-2bgf7         1/1     Running   3          5h      10.244.0.6       master   <none###           <none>\ncoredns-66bff467f8-fwtfn         1/1     Running   3          5h      10.244.0.7       master   <none###           <none>\netcd-master                      1/1     Running   2          5h      192.168.1.104    master   <none###           <none>\nkube-apiserver-master            1/1     Running   4          5h      192.168.1.104    master   <none###           <none>\nkube-controller-manager-master   1/1     Running   2          5h      192.168.1.104    master   <none###           <none>\nkube-flannel-ds-amd64-cnc9t      1/1     Running   3          4h48m   192.168.1.104    master   <none###           <none>\nkube-flannel-ds-amd64-dgchw      1/1     Running   0          31m     172.18.157.35    node1    <none###           <none>\nkube-flannel-ds-amd64-dhcxp      1/1     Running   0          13m     172.18.193.131   node2    <none###           <none>\nkube-proxy-5phfv                 1/1     Running   0          13m     172.18.193.131   node2    <none###           <none>\nkube-proxy-ntqfz                 1/1     Running   0          31m     172.18.157.35    node1    <none###           <none>\nkube-proxy-pxmqq                 1/1     Running   2          5h      192.168.1.104    master   <none###           <none>\nkube-scheduler-master            1/1     Running   2          5h      192.168.1.104    master   <none###           <none>\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br")])]),a("ul",[a("li",[n._v("service的默认调度是基于iptables的，如果要想基于ipvs调度")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("1: 那么需要在/etc/sysconfig/kubelet文件中加入\nKUBE_PROXY_MODE=ipvs\n\n2: 内核模块载入 ip_vs, ip_vs_rr, ip_vs_wrr, ip_vs_sh, nf_conntrack_ipv4\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("ul",[a("li",[n._v("节点安装的服务分布")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("1：etcd缓存数据库集群，在master节点上配置\n2：flanenl网络管理服务，在所有节点上配置\n3：kube-apiserver、kube-scheduler、kube-controller-manager在master节点上配置\n4：kube-proxy、kubelet在worker节点上配置\n5：kubectl 是apiserver的一个客户端根据\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("h2",{attrs:{id:"二-kubenetes应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-kubenetes应用"}},[n._v("#")]),n._v(" 二：kubenetes应用")]),n._v(" "),a("ul",[a("li",[n._v("kubectl 子命令(中文解释待完成)")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('Basic Commands (Beginner):\n  create         Create a resource from a file or from stdin.\n  expose         使用 replication controller, service, deployment 或者 pod 并暴露它作为一个 新的\nKubernetes Service\n  run            在集群中运行一个指定的镜像\n  set            为 objects 设置一个指定的特征\n\nBasic Commands (Intermediate):\n  explain        查看资源的文档\n  get            显示一个或更多 resources\n  edit           在服务器上编辑一个资源\n  delete         Delete resources by filenames, stdin, resources and names, or by resources and label selector\n\nDeploy Commands:\n  rollout        Manage the rollout of a resource\n  scale          为 Deployment, ReplicaSet, Replication Controller 或者 Job 设置一个新的副本数量\n  autoscale      自动调整一个 Deployment, ReplicaSet, 或者 ReplicationController 的副本数量\n\nCluster Management Commands:\n  certificate    修改 certificate 资源.\n  cluster-info   显示集群信息\n  top            Display Resource (CPU/Memory/Storage) usage.\n  cordon         标记 node 为 unschedulable\n  uncordon       标记 node 为 schedulable\n  drain          Drain node in preparation for maintenance\n  taint          更新一个或者多个 node 上的 taints\n\nTroubleshooting and Debugging Commands:\n  describe       显示一个指定 resource 或者 group 的 resources 详情\n  logs           输出容器在 pod 中的日志\n  attach         Attach 到一个运行中的 container\n  exec           在一个 container 中执行一个命令\n  port-forward   Forward one or more local ports to a pod\n  proxy          运行一个 proxy 到 Kubernetes API server\n  cp             复制 files 和 directories 到 containers 和从容器中复制 files 和 directories.\n  auth           Inspect authorization\n\nAdvanced Commands:\n  diff           Diff live version against would-be applied version\n  apply          通过文件名或标准输入流(stdin)对资源进行配置\n  patch          使用 strategic merge patch 更新一个资源的 field(s)\n  replace        通过 filename 或者 stdin替换一个资源\n  wait           Experimental: Wait for a specific condition on one or many resources.\n  convert        在不同的 API versions 转换配置文件\n  kustomize      Build a kustomization target from a directory or a remote url.\n\nSettings Commands:\n  label          更新在这个资源上的 labels\n  annotate       更新一个资源的注解\n  completion     Output shell completion code for the specified shell (bash or zsh)\n\nOther Commands:\n  api-resources  Print the supported API resources on the server\n  api-versions   Print the supported API versions on the server, in the form of "group/version"\n  config         修改 kubeconfig 文件\n  plugin         Provides utilities for interacting with plugins.\n  version        输出 client 和 server 的版本信息\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br")])]),a("ul",[a("li",[n._v("创建一个pod")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("# 创建一个控制器名称为nginx-deploy的pods，镜像使用nginx:1.14-alpine，暴露的端口为80，副本数为1\nkubectl run nginx-deploy --image=nginx:1.14-alpine --port=80 --replicas=1\n\n# 查看deployment信息\nkubectl get deployment\n\n# 查看pods信息，NGINX容器的IP地址是10.244.2.2，运行在work2节点\nkubectl get pods -o wide\nNAME                            READY   STATUS    RESTARTS   AGE     IP           NODE      NOMINATED NODE   READINESS GATES\nnginx-deploy-7689897d8d-5hmlf   1/1     Running   0          2m44s   10.244.2.2   worker2   <none###           <none>\n\n# 可以使用ifconfig查看worker1、worker2节点的cni0网桥，worker1的pods所在的网络地址为10.244.1.0/24，worker2的pods网络地址为10.244.2.0/24，k8s的内部pods只能够在内外访问\n# kill掉一个pod, pod的名称可以有kubectl get pods查看，控制器会立马启动一个新的pod\nkubectl delete pod nginx-deploy-7689897d8d-5hmlf\n\n# 此时新的pod运行在worker2上，且IP为10.244.2.3\nkubectl get pods -o wide\nNAME                            READY   STATUS    RESTARTS   AGE   IP           NODE      NOMINATED NODE   READINESS GATES\nnginx-deploy-7689897d8d-tk5r2   1/1     Running   0          93s   10.244.2.3   worker2   <none###           <none>\n\n# 删除这个myapp deployment\n kubectl delete deployment  myapp\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br")])]),a("ul",[a("li",[n._v("将创建的nginx-deploy这个控制器的资源创建为一个service，service端口是80，pod端口是80，service名称为nginx，")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("# 创建service, 为pod提供固定访问端点\nkubectl expose deployment nginx-deploy --name=nginx --port=80 --target-port=80 --protocol=TCP\n\n# 查看所有的service\nkubectl get services\nNAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\nkubernetes   ClusterIP   10.1.0.1       <none###        443/TCP   5h50m\nnginx        ClusterIP   10.1.177.136   <none###        80/TCP    97s\n\n# 此时可以使用10.1.177.136访问nginx pod资源, 只要是访问10.1.177.136的80端口的请求都会通过ipvs规则将请求调度到对应的pod上\ncurl  10.1.177.136\n\n# 也可以指定coredns，通过名称解析到serviceIP，查看core-dns\nkubectl get service -n kube-system             \nNAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE\nkube-dns   ClusterIP   10.1.0.10    <none###        53/UDP,53/TCP,9153/TCP   5h56m\n\n# 通过nginx这个名称访问service\n# 再创建一个pod，使用busybox直接进入到容器，交互式分配tty,发现这个pod的dns使用的就是10.1.0.10的coredns的IP，在pod内部访问nginx的service可以直接访问到nginx服务\nkubectl run client --image=busybox --replicas=1 -it --restart=Never\n/ # wget -O - -q http://nginx:80\n\n# 在将这个nginx pod删除掉，再在busybox中访问，可以发现服务不受影响，因为控制器会再次重启一个新的pod\nkubectl delete pod nginx-deploy-7689897d8d-tk5r2\n/ # wget -O - -q http://nginx:80 (在busybox中依然可以访问到nginx服务)\n\n# 可以查看nginx这个service的详细信息, 当pod被删除后，会基于service的Selector选择器，从标签为nginx-deploy的pod中立即选择一个，然后启动起来 \n[root@master ~]# kubectl describe service nginx\nName:              nginx\nNamespace:         default\nLabels:            run=nginx-deploy\nAnnotations:       <none>\nSelector:          run=nginx-deploy \nType:              ClusterIP\nIP:                10.1.177.136\nPort:              <unset###  80/TCP\nTargetPort:        80/TCP\nEndpoints:         10.244.2.4:80\nSession Affinity:  None\nEvents:            <none>\n\n# 查看所有pod的标签\nkubectl get pods --show-labels\nNAME                            READY   STATUS    RESTARTS   AGE     LABELS\nclient                          1/1     Running   0          16m     run=client\nnginx-deploy-7689897d8d-smlmk   1/1     Running   0          5m34s   pod-template-hash=7689897d8d,run=nginx-deploy\n\n# 再创建一个pod，这次的replicas为2\nkubectl run myapp --image=ikubernetes/myapp:v1 --replicas=2\n\n# 查看pods，有两个pods正在运行\nkubectl get pods -o wide\nNAME                            READY   STATUS    RESTARTS   AGE   IP           NODE      NOMINATED NODE   READINESS GATES\nclient                          1/1     Running   0          24m   10.244.1.2   worker1   <none###           <none>\nmyapp-84cd4b7f95-7rh94          1/1     Running   0          71s   10.244.2.5   worker2   <none###           <none>\nmyapp-84cd4b7f95-kxwg7          1/1     Running   0          71s   10.244.1.3   worker1   <none###           <none>\nnginx-deploy-7689897d8d-smlmk   1/1     Running   0          14m   10.244.2.4   worker2   <none###           <none>\n\n# 给这个myapp pod创建一个service, 这次创建的service使用的是myapp这个pod，service名称为myapp, service端口为80\nkubectl expose deployment myapp --name=myapp --port=80\n\n# 查看所有的service，\nkubectl get services\nNAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\nkubernetes   ClusterIP   10.1.0.1       <none###        443/TCP   6h33m\nmyapp        ClusterIP   10.1.201.250   <none###        80/TCP    78s\nnginx        ClusterIP   10.1.177.136   <none###        80/TCP    45m\n\n# 访问myapp这个service\ncurl 10.1.201.250 \n\n# 或者在busybox里面访问\nwget -O - -q http://myapp:80\n# 每次访问都是随机调度的\n/ # while true; do wget -O - -q http://myapp/hostname.html; sleep 1; done\nmyapp-84cd4b7f95-7rh94\nmyapp-84cd4b7f95-kxwg7\nmyapp-84cd4b7f95-7rh94\nmyapp-84cd4b7f95-7rh94\nmyapp-84cd4b7f95-7rh94\nmyapp-84cd4b7f95-kxwg7\n\n# 可以直接将一个pod的replicas动态扩展到多个，例如5个, 被扩容的pod为myapp\n# 当然也可以随时缩容\nkubectl scale --replicas=5 deployment myapp\n\n# 查看扩容后的pods\nkubectl get pods\nNAME                            READY   STATUS    RESTARTS   AGE\nclient                          1/1     Running   0          40m\nmyapp-84cd4b7f95-7rh94          1/1     Running   0          17m\nmyapp-84cd4b7f95-cbbft          1/1     Running   0          11s\nmyapp-84cd4b7f95-hnr9b          1/1     Running   0          11s\nmyapp-84cd4b7f95-kxwg7          1/1     Running   0          17m\nmyapp-84cd4b7f95-lsshw          1/1     Running   0          11s\nnginx-deploy-7689897d8d-smlmk   1/1     Running   0          30m\n\n# 查看一个pod的容器名称，可以使用\nkubectl describe pods myapp-84cd4b7f95-7rh94\n\n# 可以动态的将一个pod的镜像升级替换，pod会灰度的替换升级\n# deployment myapp中myapp为pod的名称，myapp=ikubernets/myapp:v2指定myapp容器镜像\nkubectl set image deployment myapp myapp=ikubernetes/myapp:v2\n\n\n# 查看myapp这个pod的更新过程\nkubectl rollout status deployment myapp\n\n# 回滚版本\nkubectl rollout undo deployment myapp\n\n# k8s的自动扩容需要监控系统监控k8s的资源使用状态\n\n# 如果在集群外部访问nginx的service或myapp的service，只需要修改service类型为NodePod\nkubectl edit service myapp\n将type:ClusterIp 改为：type: NodePort\n\n# 再查看service，发现myapp的NodePort端口为30081\nkubectl get service\nmyapp        NodePort    10.1.201.250   <none###        80:30081/TCP   38m\n\n# 访问集群内的任意节点的30081都可以访问到myapp服务\nhttp://node1:30081/\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br"),a("span",{staticClass:"line-number"},[n._v("97")]),a("br"),a("span",{staticClass:"line-number"},[n._v("98")]),a("br"),a("span",{staticClass:"line-number"},[n._v("99")]),a("br"),a("span",{staticClass:"line-number"},[n._v("100")]),a("br"),a("span",{staticClass:"line-number"},[n._v("101")]),a("br"),a("span",{staticClass:"line-number"},[n._v("102")]),a("br"),a("span",{staticClass:"line-number"},[n._v("103")]),a("br"),a("span",{staticClass:"line-number"},[n._v("104")]),a("br"),a("span",{staticClass:"line-number"},[n._v("105")]),a("br"),a("span",{staticClass:"line-number"},[n._v("106")]),a("br"),a("span",{staticClass:"line-number"},[n._v("107")]),a("br"),a("span",{staticClass:"line-number"},[n._v("108")]),a("br"),a("span",{staticClass:"line-number"},[n._v("109")]),a("br"),a("span",{staticClass:"line-number"},[n._v("110")]),a("br"),a("span",{staticClass:"line-number"},[n._v("111")]),a("br"),a("span",{staticClass:"line-number"},[n._v("112")]),a("br"),a("span",{staticClass:"line-number"},[n._v("113")]),a("br"),a("span",{staticClass:"line-number"},[n._v("114")]),a("br"),a("span",{staticClass:"line-number"},[n._v("115")]),a("br"),a("span",{staticClass:"line-number"},[n._v("116")]),a("br"),a("span",{staticClass:"line-number"},[n._v("117")]),a("br"),a("span",{staticClass:"line-number"},[n._v("118")]),a("br"),a("span",{staticClass:"line-number"},[n._v("119")]),a("br"),a("span",{staticClass:"line-number"},[n._v("120")]),a("br"),a("span",{staticClass:"line-number"},[n._v("121")]),a("br"),a("span",{staticClass:"line-number"},[n._v("122")]),a("br"),a("span",{staticClass:"line-number"},[n._v("123")]),a("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);