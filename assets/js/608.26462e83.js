(window.webpackJsonp=window.webpackJsonp||[]).push([[608],{2672:function(s,a,n){"use strict";n.r(a);var t=n(9),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一-nginx常见基本配置问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-nginx常见基本配置问题"}},[s._v("#")]),s._v(" 一：NGINX常见基本配置问题")]),s._v(" "),n("h3",{attrs:{id:"一-多个虚拟主机访问的优先级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-多个虚拟主机访问的优先级"}},[s._v("#")]),s._v(" (一) 多个虚拟主机访问的优先级")]),s._v(" "),n("ul",[n("li",[s._v("NGINX会根据/etc/nginx/conf.d目录下文件的名称大小依次加载，如果使用IP访问，那么名称最小的将被访问到")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# /etc/nginx/conf.d/conf.dapp1.conf将会最先被访问到\n/etc/nginx/conf.d/conf.dapp1.conf\n/etc/nginx/conf.d/conf.dapp2.conf\n/etc/nginx/conf.d/conf.dapp3.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"二-location匹配的优先级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-location匹配的优先级"}},[s._v("#")]),s._v(" (二) location匹配的优先级")]),s._v(" "),n("ul",[n("li",[s._v("location匹配的优先级")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("= ：URI精确匹配 ，优先级第一\n^~ ：对于URI的左边进行匹配，不区分字符大小写，优先级第二\n~ ：模式匹配，正则表达式模式匹配，匹配时候区分大小写，优先级第三\n~* ：模式匹配，正则表达式模式匹配，匹配时候不区分大小写 ，优先级第三\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("例如："),n("code",[s._v("/etc/nginx/conf.d/app.conf")]),s._v("内容如下")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen       80;\n    server_name  _;\n\n    root /opt/app;\n\n    error_page   500 502 503 504  /50x.html;\n\t\n\t# 精确匹配优先级第一, 当请求http://192.168.100.200/code1，会匹配到这个location，此时的rewrite是break，会在当前主机查找是否存在/opt/app/code1/index.html这个页面，如果存在直接重新发起一个请求http://192.168.100.200/code1/index.html。如果不存在，直接返回404\n    location = /code1 {\n        rewrite ^(.*)$ /code1/index.html break;\n    }\n\t\n\t# 正则匹配优先级第三，\n    location ~ /code.* {\n        rewrite ^(.*)$ /code2/index.html break;\n    }\n\t\n\t# 左前缀正在匹配，优先级第二\n    location ^~ /code.* {\n        rewrite ^(.*)$ /code3/index.html break;\n    }\n\n    location = /50x.html {\n        root   html;\n    }\n\n    location @test_server {\n        proxy_pass http://192.168.100.246:9001;\n    }\n\n    location @product_server {\n        proxy_pass http://192.168.100.180:9002;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("h3",{attrs:{id:"三-try-files使用方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-try-files使用方式"}},[s._v("#")]),s._v(" (三) try_files使用方式")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("try_files是nginx中http_core核心模块所带的指令, 功能是按顺序检查文件是否存在，存在就返回，不存在会一直向后检查，直到所有的路径都不存在, 返回404")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("/etc/nginx/conf.d/app.conf")]),s._v(" 配置内容如下")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen       80;\n    server_name  _;\n\n    root /opt/app;\n\n    error_page   500 502 503 504  /50x.html;\n\n\t# 例如请求为：http://192.168.100.200/admin.html, 会进入到这个location中。$uri表示检查/opt/app/code/cache/admin.html是否存在，存在就返回，如果不存在请求发给@test_server这个location，在@test_server这个location中，将请求转发到http://192.168.100.246:9001/admin.html，如果存在就返回，如果不存在直接返回404\n    location / {\n        root /opt/app/code/cache;\n        try_files $uri @test_server;\n    }\n\n    location = /50x.html {\n        root   html;\n    }\n\n    location @test_server {\n        proxy_pass http://192.168.100.246:9001;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("h3",{attrs:{id:"四-nginx的alias和root的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-nginx的alias和root的区别"}},[s._v("#")]),s._v(" (四) NGINX的alias和root的区别")]),s._v(" "),n("ul",[n("li",[s._v("root指令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location ^~ /code/ {\n\troot /opt/app/;\n}\n\n当请求是http://192.168.100.200/code的时候，NGINX匹配查找的路径是：\n/opt/app/code/index.html\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("alias指令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location ^~ /code/ {\n\troot /opt/app/;\n}\n\n当请求是http://192.168.100.200/code的时候，NGINX匹配查找的路径是：\n/opt/app/index.html\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("这里有个问题需要注意的是，如果使用浏览器请求"),n("code",[s._v("http://192.168.100.200/code")]),s._v("，浏览器会自动301重定向到"),n("code",[s._v("http://192.168.100.200/code/")]),s._v("，如果是curl请求，也允许自动重定向，那么可以"),n("code",[s._v("curl -L http://192.168.100.200/code")])])]),s._v(" "),n("h3",{attrs:{id:"五-其他优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五-其他优化"}},[s._v("#")]),s._v(" (五) 其他优化")]),s._v(" "),n("ul",[n("li",[s._v("NGINX常见错误")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1：413 Request Entity Too Large\n调整NGINX的上传文件大小\nclient_max_body_size \n\n2：502 bad gateway\n后端服务无响应\n\n3：504 Gateway Time-out\n后台服务响应超时\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"二-nginx性能优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-nginx性能优化"}},[s._v("#")]),s._v(" 二：NGINX性能优化")]),s._v(" "),n("h3",{attrs:{id:"一-ab测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-ab测试"}},[s._v("#")]),s._v(" (一) ab测试")]),s._v(" "),n("ul",[n("li",[s._v("安装")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("yum install -y httpd-tools\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("使用")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# -n 总的请求数，-c 并发数，-k 是否开启长连接\nab -n 2000 -c 2 www.yhyblog.cn\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"二-针对每个nginx-worker的文件打开数的限制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-针对每个nginx-worker的文件打开数的限制"}},[s._v("#")]),s._v(" (二) 针对每个NGINX worker的文件打开数的限制")]),s._v(" "),n("ul",[n("li",[s._v("如下")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 在http段的外面配置\nworker_rlimit_nofile 65535;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"三-nginx中cpu的亲缘性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-nginx中cpu的亲缘性"}},[s._v("#")]),s._v(" (三) NGINX中CPU的亲缘性")]),s._v(" "),n("ul",[n("li",[s._v("如下")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# http段外面\n# 如果主机是4线程CPU\nworker_processes 4;\n# 如果主机是6核心，那么应该是000001\n# 如果主机是8核心，那么应该是00000001\nworker_cpu_affinity 0001 0010 010 1000;\n\n# 还有一种自动绑定的方式，这样就比较方便了\nworker_cpu_affinity auto;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("查看NGINX绑定的CPU")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ps -eo pid,args,psr | grep nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"四-nginx通用配置的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四-nginx通用配置的优化"}},[s._v("#")]),s._v(" (四) NGINX通用配置的优化")]),s._v(" "),n("ul",[n("li",[s._v("事件驱动")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# http段外面\nevents {\n\tuse epoll;\n\tworker_connections 10240;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("字符集调整")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# http段内部\nhttp{\n\n\tcharset utf-8;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("日志")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('http{\n\n\tlog_format main   \'$remote_addr - $remote_user [$time_local] "$request" \'\n\t\t\t          \'$status $body_bytes_sent "$http_referer" \'\n\t\t\t\t      \'"$http_user_agent" $http_x_forwarded_for "$request_uri"\'\n\t\t\t\t\t  \'"$upstream_addr" "$upstream_status" "$upstream_response_time" "$request_time"\';\n\n\taccess_log /var/log/nginx/access.log main;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"三-nginx-waf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三-nginx-waf"}},[s._v("#")]),s._v(" 三：NGINX WAF")]),s._v(" "),n("h3",{attrs:{id:"一-下载安装ngx-lua-waf模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-下载安装ngx-lua-waf模块"}},[s._v("#")]),s._v(" (一) 下载安装ngx_lua_waf模块")]),s._v(" "),n("ul",[n("li",[s._v("克隆代码")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("git clone https://github.com/loveshell/ngx_lua_waf.git\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("将模块拷贝到/etc/nginx目录下，并且重命名为waf")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cp -rp  ngx_lua_waf /etc/nginx/waf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("修改nginx.conf，添加waf加载路径")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('http {\n    lua_package_path "/etc/nginx/waf/?.lua";\n    lua_shared_dict limit 10m;\n    init_by_lua_file  /etc/nginx/waf/init.lua;\n    access_by_lua_file /etc/nginx/waf/waf.lua;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[s._v("修改/etc/nginx/waf/config.lua文件的RulePath路径")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('RulePath = "/etc/nginx/waf/wafconf/"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("重启NGINX")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("nginx -s reload -c /etc/nginx/nginx.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"二-waf的基本案例说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-waf的基本案例说明"}},[s._v("#")]),s._v(" (二) waf的基本案例说明")]),s._v(" "),n("ul",[n("li",[s._v("1：如果要防止post时候，SQL注入，需要修改"),n("code",[s._v("/etc/nginx/waf/wafconf/post")]),s._v("文件，写一个正则表达式，来匹配post提交的数据，例如，防止post提交"),n("code",[s._v("or")]),s._v("这样的关键字，就可以在"),n("code",[s._v("/etc/nginx/waf/wafconf/post")]),s._v("文件中加入如下正则表达式")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\\sor\\s+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("2：如果需要防止CC恶意攻击，需要修改"),n("code",[s._v("/etc/nginx/waf/config.lua")]),s._v("文件，将CC防护打开，设置访问频率")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('CCDeny="on"\n-- 这里是60秒内只能访问600次\nCCrate="600/60"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);