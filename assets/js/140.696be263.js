(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{2148:function(s,e,n){"use strict";n.r(e);var a=n(9),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-mq的应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-mq的应用场景"}},[s._v("#")]),s._v(" 一：MQ的应用场景")]),s._v(" "),a("h3",{attrs:{id:"一-服务解耦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-服务解耦"}},[s._v("#")]),s._v(" (一)：服务解耦")]),s._v(" "),a("p",[a("img",{attrs:{src:n(602),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("降低服务之间相互通信的耦合度")])]),s._v(" "),a("h3",{attrs:{id:"二-流量消峰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-流量消峰"}},[s._v("#")]),s._v(" (二)：流量消峰")]),s._v(" "),a("p",[a("img",{attrs:{src:n(603),alt:"Alt text"}})]),s._v(" "),a("ul",[a("li",[s._v("系统A慢慢的按照数据库能处理的并发量，从消息队列中慢慢拉取消息。在生产中，这个短暂的高峰期积压是允许的。")])]),s._v(" "),a("h2",{attrs:{id:"二-rocketmq-延时消息简单高效-死信队列-、完善的消息事务功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-rocketmq-延时消息简单高效-死信队列-、完善的消息事务功能"}},[s._v("#")]),s._v(" 二：RocketMQ（延时消息简单高效(死信队列)、完善的消息事务功能）")]),s._v(" "),a("h3",{attrs:{id:"一-使用docker安装rocketmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-使用docker安装rocketmq"}},[s._v("#")]),s._v(" (一)：使用docker安装RocketMQ")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("创建一个install目录，在install项目下再创建conf/broker.conf、docker-compose.yml文件")])]),s._v(" "),a("li",[a("p",[s._v("conf/broker.conf内容如下(这里的IP，一定要设置为外网可以访问的IP)")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("brokerClusterName=DefaultCluster\nbrokerName=broker-a\nbrokerId=0\nbrokerIP1=192.168.100.203\ndefaultTopicQueueNums=4\nautoCreateTopicEnable=true\nautoCreateSubscriptionGroup=true\nlistenPort=10911\ndeleteWhen=04\nfileReservedTime=120\nmapedFileSizeCommitLog=1073741824\nmapedFileSizeConsumeQueue=300000\ndiskMaxUsedSpaceRatio=88\nmaxMessageSize=65536\nbrokerRole=ASYNC_MASTER\nflushDiskType=ASYNC_FLUSH\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("docker-compose.yml内容如下")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('version: \'3.5\'\nservices:\n  rmqnamesrv:\n    image: foxiswho/rocketmq:server\n    container_name: rmqnamesrv\n    ports:\n      - 9876:9876\n    volumes:\n      - ./logs:/opt/logs\n      - ./store:/opt/store\n    networks:\n        rmq:\n          aliases:\n            - rmqnamesrv\n\n  rmqbroker:\n    image: foxiswho/rocketmq:broker\n    container_name: rmqbroker\n    ports:\n      - 10909:10909\n      - 10911:10911\n    volumes:\n      - ./logs:/opt/logs\n      - ./store:/opt/store\n      - ./conf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n        NAMESRV_ADDR: "rmqnamesrv:9876"\n        JAVA_OPTS: " -Duser.home=/opt"\n        JAVA_OPT_EXT: "-server -Xms256m -Xmx256m -Xmn256m"\n    command: mqbroker -c /etc/rocketmq/broker.conf\n    depends_on:\n      - rmqnamesrv\n    networks:\n      rmq:\n        aliases:\n          - rmqbroker\n\n  rmqconsole:\n    image: styletang/rocketmq-console-ng\n    container_name: rmqconsole\n    ports:\n      - 8080:8080\n    environment:\n        JAVA_OPTS: "-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false"\n    depends_on:\n      - rmqnamesrv\n    networks:\n      rmq:\n        aliases:\n          - rmqconsole\n\nnetworks:\n  rmq:\n    name: rmq\n    driver: bridge\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])]),a("ul",[a("li",[s._v("在install项目下，执行")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 如果碰到networks.rmq value Additional properties are not allowed ('name' was unexpected)问题，使用最新版本的docker-compose即可， curl -L https://github.com/docker/compose/releases/download/1.27.2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose && chmod +x /usr/local/bin/docker-compose\n\ndocker-compose up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("启动好了之后，就可以尝试发送消息，访问控制台页面"),a("code",[s._v("http://192.168.100.203:8080/")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1：创建一个topic主题\n2：在【消息】中选择topic，可以查看到刚刚发送的消息\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"二-rocketmq的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-rocketmq的概念"}},[s._v("#")]),s._v(" (二)：rocketmq的概念")]),s._v(" "),a("ul",[a("li",[s._v("角色")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("producer：消息的发送者\nconsumer：消息接受者\nbroker：暂存和传输消息\nnameserver：管理broker\ntopic：主题\nmessage queue：相当于是topic的分区，让消息并行发送\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("架构")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(604),alt:"Alt text"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1) Name Server\n\tName Server是一个几乎无状态节点，可集群部署，节点之间无任何信息同步。\n\n2) Broker\n\tBroker部署相对复杂，Broker分为Master与Slave，一个Master可以对应多个Slave，但是一个Slave只能对应一个Master，Master与Slave的对应关系通过指定相同的Broker Name，不同的Broker Id来定义，BrokerId为0表示Master，非0表示Slave。Master也可以部署多个。\n\t每个Broker与Name Server集群中的所有节点建立长连接，定时(每隔30s)注册Topic信息到所有Name Server。Name Server定时(每隔10s)扫描所有存活broker的连接，如果Name Server超过2分钟没有收到心跳，则Name Server断开与Broker的连接。\n\n3) Producer\n\tProducer与Name Server集群中的其中一个节点(随机选择)建立长连接，定期从Name Server取Topic路由信息，并向提供Topic服务的Master建立长连接，且定时向Master发送心跳。Producer完全无状态，可集群部署。\n\tProducer每隔30s（由ClientConfig的pollNameServerInterval）从Name server获取所有topic队列的最新情况，这意味着如果Broker不可用，Producer最多30s能够感知，在此期间内发往Broker的所有消息都会失败。\n\tProducer每隔30s（由ClientConfig中heartbeatBrokerInterval决定）向所有关联的broker发送心跳，Broker每隔10s中扫描所有存活的连接，如果Broker在2分钟内没有收到心跳数据，则关闭与Producer的连接。\n\t\n4) Consumer\n\tConsumer与Name Server集群中的其中一个节点(随机选择)建立长连接，定期从Name Server取Topic路由信息，并向提供Topic服务的Master、Slave建立长连接，且定时向Master、Slave发送心跳。Consumer既可以从Master订阅消息，也可以从Slave订阅消息，订阅规则由Broker配置决定。\n\tConsumer每隔30s从Name server获取topic的最新队列情况，这意味着Broker不可用时，Consumer最多最需要30s才能感知。\n\tConsumer每隔30s（由ClientConfig中heartbeatBrokerInterval决定）向所有关联的broker发送心跳，Broker每隔10s扫描所有存活的连接，若某个连接2分钟内没有发送心跳数据，则关闭连接；并向该Consumer Group的所有Consumer发出通知，Group内的Consumer重新分配队列，然后继续消费。\n\t当Consumer得到master宕机通知后，转向slave消费，slave不能保证master的消息100%都同步过来了，因此会有少量的消息丢失。但是一旦master恢复，未同步过去的消息会被最终消费掉。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"三-python下rabbitmq的开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-python下rabbitmq的开发"}},[s._v("#")]),s._v(" 三：Python下RabbitMQ的开发")]),s._v(" "),a("h3",{attrs:{id:"一-环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-环境配置"}},[s._v("#")]),s._v(" (一)：环境配置")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("使用rocketmq-client-python库:https://github.com/apache/rocketmq-client-python")])]),s._v(" "),a("li",[a("p",[s._v("在Mac OS下配置开发环境")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('wget https://github.com/apache/rocketmq-client-cpp/releases/download/2.0.0/rocketmq-client-cpp-2.0.0-bin-release.darwin.tar.gz\ntar -xzf rocketmq-client-cpp-2.0.0-bin-release.darwin.tar.gz\ncd rocketmq-client-cpp\nmkdir /usr/local/include/rocketmq\ncp include/* /usr/local/include/rocketmq\ncp lib/* /usr/local/lib\ninstall_name_tool -id "@rpath/librocketmq.dylib" /usr/local/lib/librocketmq.dylib\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[s._v("安装Python依赖库")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rocketmq-client-python\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"二-发送消息和接收消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-发送消息和接收消息"}},[s._v("#")]),s._v(" (二)：发送消息和接收消息")]),s._v(" "),a("ul",[a("li",[s._v("producer.py")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from rocketmq.client import Producer, Message\nfrom rocketmq.client import Message, SendStatus, ConsumeStatus, PushConsumer\n\ntopic = "hellormq"\n\n# 创建需要发送的消息\ndef create_message():\n    msg = Message(topic)\n    msg.set_keys("ipfsmain")\n    msg.set_tags(\'robby\')\n    # msg.set_delay_time_level(2) #1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\n    msg.set_property("name", "micro services")\n    msg.set_body("微服务开发")\n    #1. 如何解决远程解释器出问题\n    #2. 将缺失的依赖库装好\n    #3. 关闭防火墙， 重启docker和rocketmq\n    return msg\n\n\n# 这是发送同步消息\ndef send_message_sync(count):\n    producer = Producer("test")\n    producer.set_name_server_address("192.168.100.203:9876")\n\n    #首先要启动producer\n    producer.start()\n    for n in range(count):\n        msg = create_message()\n        ret = producer.send_sync(msg)\n        print(f"发送状态:{ret.status}, 消息id:{ret.msg_id}")\n    print("消息发送完成")\n    producer.shutdown()\n\n\nif __name__ == "__main__":\n    #发送普通消息\n    send_message_sync(5)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("ul",[a("li",[s._v("consumer.py")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from rocketmq.client import PushConsumer, ConsumeStatus\nimport time\n\ntopic = "hellormq"\n\ndef callback(msg):\n    print(msg.id, msg.body.decode("utf-8"), msg.get_property("name"))\n    return ConsumeStatus.CONSUME_SUCCESS\n\n\ndef start_consume_message():\n    # 这是一个groupid\n    consumer = PushConsumer("python_consumer")\n    consumer.set_name_server_address("192.168.100.203:9876")\n    consumer.subscribe(topic, callback)\n    print("开始消费消息")\n    consumer.start()\n\n    while True:\n        time.sleep(3600)\n\nif __name__ == "__main__":\n    start_consume_message()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h3",{attrs:{id:"三-rocketmq消息延时发送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-rocketmq消息延时发送"}},[s._v("#")]),s._v(" (三)：rocketmq消息延时发送")]),s._v(" "),a("ul",[a("li",[s._v("producer代码如下")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from rocketmq.client import Producer, Message\n\ntopic = "hellormq"\n\n# 创建需要发送的消息\ndef create_message():\n    msg = Message(topic)\n    msg.set_keys("ipfsmain")\n    msg.set_tags(\'robby\')\n    # 2意思是延时5秒发送\n    msg.set_delay_time_level(2) #1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\n    msg.set_property("name", "micro services --- robby")\n    msg.set_body("微服务开发")\n    return msg\n\n\n# 这是发送同步消息\ndef send_message_sync(count):\n    producer = Producer("test")\n    producer.set_name_server_address("192.168.100.203:9876")\n\n    #首先要启动producer\n    producer.start()\n    for n in range(count):\n        msg = create_message()\n        ret = producer.send_sync(msg)\n        print(f"发送状态:{ret.status}, 消息id:{ret.msg_id}")\n    print("消息发送完成")\n    producer.shutdown()\n\n\nif __name__ == "__main__":\n    #发送普通消息\n    send_message_sync(5)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("h3",{attrs:{id:"四-rocketmq事务消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-rocketmq事务消息"}},[s._v("#")]),s._v(" (四)：rocketmq事务消息")]),s._v(" "),a("ul",[a("li",[s._v("producer代码如下")])])])}),[],!1,null,null,null);e.default=r.exports},602:function(s,e,n){s.exports=n.p+"assets/img/2021-06-265.38.56.94659110.png"},603:function(s,e,n){s.exports=n.p+"assets/img/2021-06-265.42.54.862e1bcd.png"},604:function(s,e,n){s.exports=n.p+"assets/img/2021-06-2711.30.02.a7c1bd4c.png"}}]);