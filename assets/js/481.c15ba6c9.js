(window.webpackJsonp=window.webpackJsonp||[]).push([[481],{2439:function(s,n,e){"use strict";e.r(n);var a=e(9),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"一-使用request库实现知乎登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-使用request库实现知乎登录"}},[s._v("#")]),s._v(" （一）使用request库实现知乎登录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("知乎的接口发生了变化，无法实现登录请求，到时候换个网站测试\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"二-使用scrapy实现知乎登录-这部分的代码找到答案可以补上-如果找不到答案-可以换另外一个需要登录才能返回页面的站点测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-使用scrapy实现知乎登录-这部分的代码找到答案可以补上-如果找不到答案-可以换另外一个需要登录才能返回页面的站点测试"}},[s._v("#")]),s._v(" （二）使用scrapy实现知乎登录(这部分的代码找到答案可以补上，如果找不到答案，可以换另外一个需要登录才能返回页面的站点测试)")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("1：新建一个zhihu的spider, 现在命令行加入到项目的根目录")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("scrapy genspider zhihu www.zhihu.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("2：重写start_requests入口方法")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\t一般而言，start_requests方法是作为登录请求的第一个请求。第一个请求返回的结果会交给回调函数处理，在回调函数中，处理第二个请求，这样的一种模式，直到最后一个请求发起，返回的登录成功。\n\t\n\t在登录成功之后，就可以主页(index)发起请求，将请求的结果交给parse这个回调函数处理。一般在scrapy中，使用的都是深度优先解析的原则，如果一个url中还存在需要解析的页面，那么就会继续yield scrapy.Request实例，解析这个url，请求结果同样交给parse这个回调函数处理，这样就实现了深度优先策略\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"三-使用同一个pipeline类-处理多个item-也可以使用多个pipeline类-处理同一个item"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-使用同一个pipeline类-处理多个item-也可以使用多个pipeline类-处理同一个item"}},[s._v("#")]),s._v(" （三）使用同一个pipeline类，处理多个item(也可以使用多个pipeline类，处理同一个item)")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("第一种方式：在pipeline类内部可以判断item的classname，不同的item做不同的处理(写入不同的字段到MySQL数据库中)。但是这一种方式就将item的类写死了，如果哪天item的classname发生了变化，这里也需要改动")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("if item.__class__.__name__ == 'JobBoleArticleItem':\n\n    insert_sql = 'insert into ' \\\n                 'articles(title, create_date, url) ' \\\n                 'values (%s, %s, %s)'\n    self.cursor.execute(insert_sql,\n                        args=(item['title'],\n                              item['create_date'],\n                              item['url'],))\n    self.connect.commit()\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("ul",[e("li",[e("strong",[s._v("第二种方式：item类中创建一个方法，用来封装MySQL数据插入语句。那么不同item有不同的SQL操作语句，因此在pipeline类中，就无需关系SQL语句，只需要拿到SQL语句、SQL参数，调用cursor执行即可")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 在items.py类中修改\nclass JobBoleArticleItem(scrapy.Item):\n    title = scrapy.Field(\n\n    )\n    create_date = scrapy.Field(\n        # 预处理，将字符串转变为时间类型\n        input_processor = MapCompose(date_convert),\n    )\n    '''\n\n    中间还有很多item字段\n\n    '''\n   \n\n    content = scrapy.Field(\n\n    )\n\n    # 不同的item屏蔽自己的SQL语句\n    def get_insert_sql(self):\n\n        insert_sql = 'insert into ' \\\n                     'articles(title, create_date, url) ' \\\n                     'values (%s, %s, %s)'\n        args = (self['title'], self['create_date'], self['url'])\n        return insert_sql, args\n\n\n\n# 在pipelines.py文件中修改\nclass MysqlTwistedPipeline:\n\n    def __init__(self, dbpool):\n        self.dbpool = dbpool\n\n    # 重写from_settings方法，\n    @classmethod\n    def from_settings(cls, settings):\n        connkw = dict(\n            host=settings['MYSQL_HOST'],\n            user = settings['MYSQL_USER'],\n            password = settings['MYSQL_PASSWORD'],\n            db = settings['MYSQL_DB'],\n            port = settings['MYSQL_PORT'],\n            use_unicode = settings['MYSQL_OPTION']['USE_UNICODE'],\n            charset = settings['MYSQL_OPTION']['CHARSET'],\n            # 指定游标的类型\n            cursorclass = MySQLdb.cursors.DictCursor,\n        )\n\n        # 第一个参数MySQLdb表示使用的是MySQL数据库驱动模块，\n        dbpool = adbapi.ConnectionPool('MySQLdb', **connkw)\n\n        # 最后将这个pipeline实例返回\n        return  cls(dbpool)\n\n    # 重写process_item方法，实现数据库写入异步执行\n    def process_item(self, item, spider):\n        # 拿到异步查询对象\n        query = self.dbpool.runInteraction(self.do_insert, item)\n        # 添加异常回调函数\n        query.addErrback(self.handle_error)\n\n    # 获取异步插入的异常回调函数\n    def handle_error(self, failure):\n        print('Insert ========== {}'.format(failure))\n\n    # 插入数据的操作， 屏蔽了item的类型，item的SQL操作被自身所封装\n    def do_insert(self, cursor, item):\n        insert_sql, args = item.get_insert_sql()\n        cursor.execute(insert_sql,\n                        args=args)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br")])]),e("h3",{attrs:{id:"四-在item内部对item的字段值进行处理-字段值解析的时候可能只是定位带了标签-或者说解析不完全-之前使用的是item的预处理的方式将item的字段值进行处理-这里也可以使用item类内部封装方法进行处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-在item内部对item的字段值进行处理-字段值解析的时候可能只是定位带了标签-或者说解析不完全-之前使用的是item的预处理的方式将item的字段值进行处理-这里也可以使用item类内部封装方法进行处理"}},[s._v("#")]),s._v(" （四）在item内部对item的字段值进行处理(字段值解析的时候可能只是定位带了标签，或者说解析不完全，之前使用的是item的预处理的方式将item的字段值进行处理，这里也可以使用item类内部封装方法进行处理)")]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("类似于这样的， item的Field类中没有对item的字段值处理，字段值在get_insert_sql方法中进行了处理")])])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('class ZhihuAnswerItem(scrapy.Item):\n    #知乎的问题回答item\n    zhihu_id = scrapy.Field()\n    url = scrapy.Field()\n    question_id = scrapy.Field()\n    author_id = scrapy.Field()\n    content = scrapy.Field()\n    parise_num = scrapy.Field()\n    comments_num = scrapy.Field()\n    create_time = scrapy.Field()\n    update_time = scrapy.Field()\n    crawl_time = scrapy.Field()\n\n    def get_insert_sql(self):\n        #插入知乎question表的sql语句\n        insert_sql = """\n            insert into zhihu_answer(zhihu_id, url, question_id, author_id, content, parise_num, comments_num,\n              create_time, update_time, crawl_time\n              ) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)\n              ON DUPLICATE KEY UPDATE content=VALUES(content), comments_num=VALUES(comments_num), parise_num=VALUES(parise_num),\n              update_time=VALUES(update_time)\n        """\n\n        create_time = datetime.datetime.fromtimestamp(self["create_time"]).strftime(SQL_DATETIME_FORMAT)\n        update_time = datetime.datetime.fromtimestamp(self["update_time"]).strftime(SQL_DATETIME_FORMAT)\n        params = (\n            self["zhihu_id"], self["url"], self["question_id"],\n            self["author_id"], self["content"], self["parise_num"],\n            self["comments_num"], create_time, update_time,\n            self["crawl_time"].strftime(SQL_DATETIME_FORMAT),\n        )\n\n        return insert_sql, params\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);